<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Practical PHP" class="calibre4"><div class="preface" id="practical_php">
<h1 class="calibre10"><span class="keep-together">Chapter 7. </span>Practical PHP</h1>

<p class="author1">The previous chapters went over the elements of the PHP language. This chapter builds on your new programming skills to teach you how to perform some common but important practical tasks. You will learn the best ways to handle strings in order to achieve clear and concise code that displays in web browsers exactly how you want it to, including advanced date and time management. You’ll also find out how to create and otherwise modify files, including those uploaded by users.</p>

<section data-type="sect1" data-pdf-bookmark="Using printf" class="calibre4"><div class="preface" id="using_printf">
<h1 class="calibre11">Using printf</h1>

<p class="author1">You’ve<a contenteditable="false" data-primary="PHP programming language" data-secondary="printf function" data-type="indexterm" id="PHPprintf07" class="calibre6"/><a contenteditable="false" data-primary="printf function (PHP)" data-secondary="vs. print and echo functions" data-secondary-sortas="print and echo functions" data-type="indexterm" id="idm45694746820696" class="calibre6"/> already seen the <code class="calibre15">print</code> and <code class="calibre15">echo</code> functions, which simply output text to the browser. But a much more powerful function, <code class="calibre15">printf</code>, controls the format of the output by letting you put special formatting characters in a string. For each formatting character, <code class="calibre15">printf</code> expects you to pass an argument that it will display using that format. For instance, the following example uses the <code class="calibre15">%d</code> conversion specifier to display the value <code class="calibre15">3</code> in decimal:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">printf</code><code class="p">(</code><code class="s">"There are %d items in your basket"</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code></pre>

<p class="author1">If you replace the <code class="calibre15">%d</code> with <code class="calibre15">%b</code>, the value <code class="calibre15">3</code> will be displayed in binary (<code class="calibre15">11</code>). <a data-type="xref" href="#printf_conversion_specifiers" class="calibre6">Table 7-1</a> shows the conversion specifiers supported.<a contenteditable="false" data-primary="printf function (PHP)" data-secondary="printf conversion specifiers" data-type="indexterm" id="idm45694746785240" class="calibre6"/></p>

<table id="printf_conversion_specifiers" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-1. </span>The <code class="calibre60">printf</code> conversion specifiers</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Specifier</th>
			<th class="calibre37">Conversion action on argument arg</th>
			<th class="calibre37">Example (for an arg of 123)</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39">Display a % character (no <code class="calibre48">arg</code> required)</td>
			<td class="calibre39"><code class="calibre48">%</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">b</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> as a binary integer</td>
			<td class="calibre39"><code class="calibre48">1111011</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">c</code></td>
			<td class="calibre39">Display ASCII character for <code class="calibre48">arg</code></td>
			<td class="calibre39"><code class="calibre48">{</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">d</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> as a signed decimal integer</td>
			<td class="calibre39"><code class="calibre48">123</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">e</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> using scientific notation</td>
			<td class="calibre39"><code class="calibre48">1.23000e+2</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">f</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> as floating point</td>
			<td class="calibre39"><code class="calibre48">123.000000</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">o</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> as an octal integer</td>
			<td class="calibre39"><code class="calibre48">173</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">s</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> as a string</td>
			<td class="calibre39"><code class="calibre48">123</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">u</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> as an unsigned decimal</td>
			<td class="calibre39"><code class="calibre48">123</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">x</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> in lowercase hexadecimal</td>
			<td class="calibre39"><code class="calibre48">7b</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">X</code></td>
			<td class="calibre39">Display <code class="calibre48">arg</code> in uppercase hexadecimal</td>
			<td class="calibre39"><code class="calibre48">7B</code></td>
		</tr>
	</tbody>
</table>

<p class="author1">You can have as many specifiers as you like in a <code class="calibre15">printf</code> function, as long as you pass a matching number of arguments and as long as each specifier is prefaced by a <code class="calibre15">%</code> symbol. Therefore, the following code is valid and will output <code class="calibre15">"My name is Simon. I'm 33 years old, which is 21 in hexadecimal"</code>:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">printf</code><code class="p">(</code><code class="s">"My name is %s. I'm %d years old, which is %X in hexadecimal"</code><code class="p">,</code>
  <code class="s">'Simon'</code><code class="p">,</code> <code class="mi">33</code><code class="p">,</code> <code class="mi">33</code><code class="p">);</code></pre>

<p class="author1">If you leave out any arguments, you will receive a parse error informing you that a right bracket, <code class="calibre15">)</code>, was unexpectedly encountered or that there are too few arguments.</p>

<p class="author1">A<a contenteditable="false" data-primary="HTML (Hypertext Markup Language)" data-secondary="setting colors with printf" data-type="indexterm" id="idm45694746684888" class="calibre6"/><a contenteditable="false" data-primary="colors" data-secondary="in HTML" data-type="indexterm" id="idm45694746683640" class="calibre6"/> more practical example of <code class="calibre15">printf</code> sets colors in HTML using decimal values. For example, suppose you know you want a color that has a triplet value of 65 red, 127 green, and 245 blue but don’t want to convert this to hexadecimal yourself. Here’s an easy solution:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">printf</code><code class="p">(</code><code class="s">"&lt;span style='color:#%X%X%X'&gt;Hello&lt;/span&gt;"</code><code class="p">,</code> <code class="mi">65</code><code class="p">,</code> <code class="mi">127</code><code class="p">,</code> <code class="mi">245</code><code class="p">);</code></pre>

<p class="author1">Check the format of the color specification between the apostrophes (<code class="calibre15">''</code>) carefully. First comes the pound, or hash, sign (<code class="calibre15">#</code>) expected by the color specification. Then come three <code class="calibre15">%X</code> format specifiers, one for each of your numbers. The resulting output from this command is as follows:</p>

<pre data-programming-language="perl" class="calibre29">
<strong class="calibre31">&lt;span style='color:#417FF5'&gt;Hello&lt;/span&gt;</strong></pre>

<p class="author1">Usually, you’ll find it convenient to use variables or expressions as arguments to <code class="calibre15">printf</code>. For instance, if you stored values for your colors in the three variables <code class="calibre15">$r</code>, <code class="calibre15">$g</code>, and <code class="calibre15">$b</code>, you could create a darker color with this:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">printf</code><code class="p">(</code><code class="s">"&lt;span style='color:#%X%X%X'&gt;Hello&lt;/span&gt;"</code><code class="p">,</code> <code class="nv">$r</code><code class="o">-</code><code class="mi">20</code><code class="p">,</code> <code class="nv">$g</code><code class="o">-</code><code class="mi">20</code><code class="p">,</code> <code class="nv">$b</code><code class="o">-</code><code class="mi">20</code><code class="p">);</code></pre>

<section data-type="sect2" data-pdf-bookmark="Precision Setting" class="calibre4"><div class="preface" id="precision_setting">
<h2 class="calibre28">Precision Setting</h2>

<p class="author1">Not<a contenteditable="false" data-primary="printf function (PHP)" data-secondary="precision setting" data-type="indexterm" id="PHPprec07" class="calibre6"/><a contenteditable="false" data-primary="currency conversion" data-type="indexterm" id="idm45694746599224" class="calibre6"/> only can you specify a conversion type, but you can also set the precision of the displayed result. For example, amounts of currency are usually displayed with only two digits of precision. However, after a calculation, a value may have a greater precision than this, such as 123.42 / 12, which results in 10.285. To ensure that such values are correctly stored internally, but displayed with only two digits of precision, you can insert the string <code class="calibre15">".2"</code> between the <code class="calibre15">%</code> symbol and the conversion specifier:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">printf</code><code class="p">(</code><code class="s">"The result is: $%.2f"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code></pre>

<p class="author1">The output from this command is as follows:</p>

<pre data-programming-language="perl" class="calibre29">
<strong class="calibre31">The result is $10.29</strong></pre>

<p class="author1">But you actually have even more control than that, because you can also specify whether to pad output with either zeros or spaces by prefacing the specifier with certain values. <a data-type="xref" href="#precision_setting-id00018" class="calibre6">Example 7-1</a> shows four possible combinations.</p>

<div data-type="example" id="precision_setting-id00018" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-1. </span>Precision setting</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="k">echo</code> <code class="s">"&lt;pre&gt;"</code><code class="p">;</code> <code class="c">// Enables viewing of the spaces</code>

  <code class="c">// Pad to 15 spaces</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"The result is $%15f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code>

  <code class="c">// Pad to 15 spaces, fill with zeros</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"The result is $%015f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code>

  <code class="c">// Pad to 15 spaces, 2 decimal places precision</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"The result is $%15.2f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code>

  <code class="c">// Pad to 15 spaces, 2 decimal places precision, fill with zeros</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"The result is $%015.2f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code>

  <code class="c">// Pad to 15 spaces, 2 decimal places precision, fill with # symbol</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"The result is $%'#15.2f</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">The output from this example looks like this:</p>

<pre data-programming-language="perl" class="calibre29">
<strong class="calibre31">The result is $      10.285000
The result is $00000010.285000
The result is $          10.29
The result is $000000000010.29
The result is $##########10.29</strong></pre>

<p class="author1">The way it works is simple if you go from right to left (see <a data-type="xref" href="#conversion_specifier_components" class="calibre6">Table 7-2</a>). Notice that:</p>

<ul class="printings">
	<li class="calibre9">
	<p class="author1">The rightmost character is the conversion specifier: in this case, <code class="calibre15">f</code> for floating point.</p>
	</li>
	<li class="calibre9">
	<p class="author1">Just before the conversion specifier, if there is a period and a number together, then the precision of the output is specified as the value of the number.</p>
	</li>
	<li class="calibre9">
	<p class="author1">Regardless of whether there’s a precision specifier, if there is a number, then that represents the number of characters to which the output should be padded. In the previous example, this is 15 characters. If the output is already equal to or greater than the padding length, then this argument is ignored.</p>
	</li>
	<li class="calibre9">
	<p class="author1">The leftmost parameter allowed after the <code class="calibre15">%</code> symbol is a <code class="calibre15">0</code>, which is ignored unless a padding value has been set, in which case the output is padded with zeros instead of spaces. If a pad character other than zero or a space is required, you can use any one of your choice as long as you preface it with a single quotation mark, like this: <code class="calibre15">'#</code>.</p>
	</li>
	<li class="calibre9">
	<p class="author1">On the left is the <code class="calibre15">%</code> symbol, which starts the conversion.<a contenteditable="false" data-primary="printf function (PHP)" data-secondary="conversion specifier components" data-type="indexterm" id="idm45694746468664" class="calibre6"/><a contenteditable="false" data-startref="PHPprec07" data-type="indexterm" id="idm45694746467224" class="calibre6"/></p>
	</li>
</ul>

<table id="conversion_specifier_components" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-2. </span>Conversion specifier components</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Start conversion</th>
			<th class="calibre37">Pad character</th>
			<th class="calibre37">Number of pad characters</th>
			<th class="calibre37">Display precision</th>
			<th class="calibre37">Conversion specifier</th>
			<th class="calibre37">Example</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39"> </td>
			<td class="calibre39"><code class="calibre48">15</code></td>
			<td class="calibre39"> </td>
			<td class="calibre39"><code class="calibre48">f</code></td>
			<td class="calibre39"><code class="calibre48">10.285000</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39"><code class="calibre48">0</code></td>
			<td class="calibre39"><code class="calibre48">15</code></td>
			<td class="calibre39"><code class="calibre48">.2</code></td>
			<td class="calibre39"><code class="calibre48">f</code></td>
			<td class="calibre39"><code class="calibre48">000000000010.29</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39"><code class="calibre48">'#</code></td>
			<td class="calibre39"><code class="calibre48">15</code></td>
			<td class="calibre39"><code class="calibre48">.4</code></td>
			<td class="calibre39"><code class="calibre48">f</code></td>
			<td class="calibre39"><code class="calibre48">########10.2850</code></td>
		</tr>
	</tbody>
</table>
</div></section>

<section data-type="sect2" data-pdf-bookmark="String Padding" class="calibre4"><div class="preface" id="string_padding">
<h2 class="calibre28">String Padding</h2>

<p class="author1">You<a contenteditable="false" data-primary="printf function (PHP)" data-secondary="string padding" data-type="indexterm" id="PHPstpad07" class="calibre6"/><a contenteditable="false" data-primary="strings (PHP)" data-secondary="string padding" data-type="indexterm" id="SPHPpad07" class="calibre6"/><a contenteditable="false" data-primary="justification, right or left" data-type="indexterm" id="idm45694746443912" class="calibre6"/> can also pad strings to required lengths (as you can with numbers), select different padding characters, and even choose between left and right justification. <a data-type="xref" href="#string_padding-id00019" class="calibre6">Example 7-2</a> shows various examples.</p>

<div data-type="example" id="string_padding-id00019" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-2. </span>String padding</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="k">echo</code> <code class="s">"&lt;pre&gt;"</code><code class="p">;</code> <code class="c">// Enables viewing of the spaces</code>

  <code class="nv">$h</code> <code class="o">=</code> <code class="s">'Rasmus'</code><code class="p">;</code>

  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code>         <code class="nv">$h</code><code class="p">);</code> <code class="c">// Standard string output</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%12s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code>       <code class="nv">$h</code><code class="p">);</code> <code class="c">// Right justify with spaces to width 12</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%-12s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code>      <code class="nv">$h</code><code class="p">);</code> <code class="c">// Left justify with spaces</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%012s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code>      <code class="nv">$h</code><code class="p">);</code> <code class="c">// Pad with zeros</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%'#12s]</code><code class="se">\n\n</code><code class="s">"</code><code class="p">,</code>   <code class="nv">$h</code><code class="p">);</code> <code class="c">// Use the custom padding character '#'</code>

  <code class="nv">$d</code> <code class="o">=</code> <code class="s">'Rasmus Lerdorf'</code><code class="p">;</code>        <code class="c">// The original creator of PHP</code>

  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%12.8s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code>     <code class="nv">$d</code><code class="p">);</code> <code class="c">// Right justify, cutoff of 8 characters</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%-12.12s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code>   <code class="nv">$d</code><code class="p">);</code> <code class="c">// Left justify, cutoff of 12 characters</code>
  <code class="nb">printf</code><code class="p">(</code><code class="s">"[%-'@12.10s]</code><code class="se">\n</code><code class="s">"</code><code class="p">,</code> <code class="nv">$d</code><code class="p">);</code> <code class="c">// Left justify, pad with '@', cutoff 10 chars</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">Note how for purposes of layout in a web page, I’ve used the <code class="calibre15">&lt;pre&gt;</code> HTML tag to preserve all the spaces and the <code class="calibre15">\n</code> newline character after each of the lines to be displayed. The output from this example is as follows:</p>

<pre data-programming-language="perl" class="calibre29">
<strong class="calibre31">[Rasmus]
[      Rasmus]
[Rasmus      ]
[000000Rasmus]
[######Rasmus]

[    Rasmus L]
[Rasmus Lerdo]
[Rasmus Ler@@]</strong></pre>

<p class="author1">When you specify a padding value, strings of a length equal to or greater than that value will be ignored, <em class="hyperlink">unless</em> a cutoff value is given that shortens the strings back to less than the padding value.</p>

<p class="author1"><a data-type="xref" href="#string_conversion_specifier_components" class="calibre6">Table 7-3</a> shows the components available to string conversion specifiers.<a contenteditable="false" data-primary="" data-startref="SPHPpad07" data-type="indexterm" id="idm45694746332584" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="PHPstpad07" data-type="indexterm" id="idm45694746331240" class="calibre6"/><a contenteditable="false" data-primary="printf function (PHP)" data-secondary="string conversion specifier components" data-type="indexterm" id="idm45694746329864" class="calibre6"/></p>

<table id="string_conversion_specifier_components" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-3. </span>String conversion specifier components</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Start conversion</th>
			<th class="calibre37">Left/right justify</th>
			<th class="calibre37">Padding character</th>
			<th class="calibre37">Number of pad characters</th>
			<th class="calibre37">Cutoff</th>
			<th class="calibre37">Conversion specifier</th>
			<th class="calibre37">Example<br class="calibre57"/>
			(using “Rasmus”)</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39"> </td>
			<td class="calibre39"> </td>
			<td class="calibre39"> </td>
			<td class="calibre39"> </td>
			<td class="calibre39"><code class="calibre48">s</code></td>
			<td class="calibre39"><code class="calibre48">[Rasmus]</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39"><code class="calibre48">-</code></td>
			<td class="calibre39"> </td>
			<td class="calibre39"><code class="calibre48">10</code></td>
			<td class="calibre39"> </td>
			<td class="calibre39"><code class="calibre48">s</code></td>
			<td class="calibre39"><code class="calibre48">[Rasmus ]</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">%</code></td>
			<td class="calibre39"> </td>
			<td class="calibre39"><code class="calibre48">'#</code></td>
			<td class="calibre39"><code class="calibre48">8</code></td>
			<td class="calibre39"><code class="calibre48">.4</code></td>
			<td class="calibre39"><code class="calibre48">s</code></td>
			<td class="calibre39"><code class="calibre48">[####Rasm]</code></td>
		</tr>
	</tbody>
</table>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Using sprintf" class="calibre4"><div class="preface" id="using_sprintf">
<h2 class="calibre28">Using sprintf</h2>

<p class="author1">Often, you<a contenteditable="false" data-primary="printf function (PHP)" data-secondary="sprintf function" data-type="indexterm" id="idm45694746307624" class="calibre6"/><a contenteditable="false" data-primary="sprintf function (PHP)" data-type="indexterm" id="idm45694746306216" class="calibre6"/> don’t want to output the result of a conversion but need it to use elsewhere in your code. This is where the <code class="calibre15">sprintf</code> function comes in. With it, you can send the output to another variable rather than to the browser.</p>

<p class="author1">You<a contenteditable="false" data-primary="colors" data-secondary="in HTML" data-type="indexterm" id="idm45694746303912" class="calibre6"/> might use it to make a conversion, as in the following example, which returns the hexadecimal string value for the RGB color group 65, 127, 245 in <code class="calibre15">$hexstring</code>:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$hexstring</code> <code class="o">=</code> <code class="nb">sprintf</code><code class="p">(</code><code class="s">"%X%X%X"</code><code class="p">,</code> <code class="mi">65</code><code class="p">,</code> <code class="mi">127</code><code class="p">,</code> <code class="mi">245</code><code class="p">);</code></pre>

<p class="author1">Or<a contenteditable="false" data-primary="" data-startref="PHPprintf07" data-type="indexterm" id="idm45694746098984" class="calibre6"/> you may wish to store output in a variable for other use or display:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$out</code> <code class="o">=</code> <code class="nb">sprintf</code><code class="p">(</code><code class="s">"The result is: $%.2f"</code><code class="p">,</code> <code class="mi">123.42</code> <code class="o">/</code> <code class="mi">12</code><code class="p">);</code>
<code class="k">echo</code> <code class="nv">$out</code><code class="p">;</code></pre>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Date and Time Functions" class="calibre4"><div class="preface" id="date_and_time_functions">
<h1 class="calibre11">Date and Time Functions</h1>

<p class="author1">To<a contenteditable="false" data-primary="PHP programming language" data-secondary="date and time functions" data-type="indexterm" id="PHPdate07" class="calibre6"/><a contenteditable="false" data-primary="date and time functions (PHP)" data-secondary="determining current timestamp" data-type="indexterm" id="idm45694746233912" class="calibre6"/><a contenteditable="false" data-primary="timestamps, determining current" data-type="indexterm" id="idm45694746232600" class="calibre6"/><a contenteditable="false" data-primary="time function (PHP)" data-type="indexterm" id="idm45694746231528" class="calibre6"/> keep track of the date and time, PHP uses standard Unix timestamps, which are simply the number of seconds since the start of January 1, 1970. To determine the current timestamp, you can use the <code class="calibre15">time</code> function:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="k">echo</code> <code class="nb">time</code><code class="p">();</code></pre>

<p class="author1">Because the value is stored as seconds, to obtain the timestamp for this time next week, you would use the following, which adds 7 days × 24 hours × 60 minutes × 60 seconds to the returned value:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="k">echo</code> <code class="nb">time</code><code class="p">()</code> <code class="o">+</code> <code class="mi">7</code> <code class="o">*</code> <code class="mi">24</code> <code class="o">*</code> <code class="mi">60</code> <code class="o">*</code> <code class="mi">60</code><code class="p">;</code></pre>

<p class="author1">If<a contenteditable="false" data-primary="mktime function (PHP)" data-type="indexterm" id="idm45694745912344" class="calibre6"/> you wish to create a timestamp for a given date, you can use the <code class="calibre15">mktime</code> function. Its output is the timestamp <code class="calibre15">1669852800</code> for the first second of the first minute of the first hour of the first day of December in the year 2022:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="k">echo</code> <code class="nb">mktime</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">12</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">2022</code><code class="p">);</code></pre>

<p class="author1">The parameters to pass are, in order from left to right:</p>

<ul class="printings">
	<li class="calibre9">
	<p class="author1">The number of the hour (0–23)</p>
	</li>
	<li class="calibre9">
	<p class="author1">The number of the minute (0–59)</p>
	</li>
	<li class="calibre9">
	<p class="author1">The number of seconds (0–59)</p>
	</li>
	<li class="calibre9">
	<p class="author1">The number of the month (1–12)</p>
	</li>
	<li class="calibre9">
	<p class="author1">The number of the day (1–31)</p>
	</li>
	<li class="calibre9">
	<p class="author1">The year (1970–2038, or 1901–2038 with PHP 5.1.0+ on 32-bit signed systems)</p>
	</li>
</ul>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">You may ask why you are limited to the years 1970 through 2038. Well, it’s because the original developers of Unix chose the start of the year 1970 as the base date that no programmer should need to go before!</p>

<p class="author1">Luckily, as of version 5.1.0, PHP supports systems using a signed 32-bit integer for the timestamp, and dates from 1901 to 2038 are allowed on them. However, that introduces a problem even worse than the original one, because the Unix designers also decided that nobody would still be using Unix after about 70 years or so and therefore believed they could get away with storing the timestamp as a 32-bit value—which will run out on January 19, 2038!</p>

<p class="author1">This<a contenteditable="false" data-primary="Y2K38 bug" data-type="indexterm" id="idm45694746109624" class="calibre6"/><a contenteditable="false" data-primary="security issues" data-secondary="Y2K38 bug" data-type="indexterm" id="idm45694746108488" class="calibre6"/><a contenteditable="false" data-primary="DateTime class (PHP)" data-type="indexterm" id="idm45694746107112" class="calibre6"/> will create what has come to be known as the Y2K38 bug (much like the millennium bug, which was caused by storing years as two-digit values, and which also had to be fixed). PHP introduced the <code class="calibre15">DateTime</code> class in version 5.2 to overcome this issue, but it will work only on 64-bit architecture, which most computers will be these days (but do check before you use it).</p>
</div>

<p class="author1">To<a contenteditable="false" data-primary="date and time functions (PHP)" data-secondary="date function" data-type="indexterm" id="idm45694746140088" class="calibre6"/> display the date, use the <code class="calibre15">date</code> function, which supports a plethora of formatting options enabling you to display the date any way you wish. The format is as follows:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">date</code><code class="p">(</code><code class="nv">$format</code><code class="p">,</code> <code class="nv">$timestamp</code><code class="p">);</code></pre>

<p class="author1">The parameter <code class="calibre15">$format</code> should be a string containing formatting specifiers as detailed in <a data-type="xref" href="#major_date_function_format_specifier" class="calibre6">Table 7-4</a>, and <code class="calibre15">$timestamp</code> should be a Unix timestamp. For the complete list of specifiers, please see the <a href="https://tinyurl.com/phpdate" class="calibre6">documentation</a>. The following command will output the current date and time in the format <code class="calibre15">"Monday February 17th, 2025 - 1:38pm"</code>:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="k">echo</code> <code class="nb">date</code><code class="p">(</code><code class="s">"l F jS, Y - g:ia"</code><code class="p">,</code> <code class="nb">time</code><code class="p">());</code></pre>

<table id="major_date_function_format_specifier" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-4. </span>The<a contenteditable="false" data-primary="date and time functions (PHP)" data-secondary="date function format specifiers" data-type="indexterm" id="idm45694746007816" class="calibre6"/> major date function format specifiers</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Format</th>
			<th class="calibre37">Description</th>
			<th class="calibre37">Returned value</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td colspan="3" class="calibre39"><strong class="calibre16">Day specifiers</strong></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">d</code></td>
			<td class="calibre39">Day of month, two digits, with leading zeros</td>
			<td class="calibre39"><code class="calibre48">01</code> to <code class="calibre48">31</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">D</code></td>
			<td class="calibre39">Day of the week, three letters</td>
			<td class="calibre39"><code class="calibre48">Mon</code> to <code class="calibre48">Sun</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">j</code></td>
			<td class="calibre39">Day of month, no leading zeros</td>
			<td class="calibre39"><code class="calibre48">1</code> to <code class="calibre48">31</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">l</code></td>
			<td class="calibre39">Day of week, full names</td>
			<td class="calibre39"><code class="calibre48">Sunday</code> to <code class="calibre48">Saturday</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">N</code></td>
			<td class="calibre39">Day of week, numeric, Monday to Sunday</td>
			<td class="calibre39"><code class="calibre48">1</code> to <code class="calibre48">7</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">S</code></td>
			<td class="calibre39">Suffix for day of month (useful with specifier <code class="calibre48">j</code>)</td>
			<td class="calibre39"><code class="calibre48">st</code>, <code class="calibre48">nd</code>, <code class="calibre48">rd</code>, or <code class="calibre48">th</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">w</code></td>
			<td class="calibre39">Day of week, numeric, Sunday to Saturday</td>
			<td class="calibre39"><code class="calibre48">0</code> to <code class="calibre48">6</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">z</code></td>
			<td class="calibre39">Day of year</td>
			<td class="calibre39"><code class="calibre48">0</code> to <code class="calibre48">365</code></td>
		</tr>
		<tr class="calibre40">
			<td colspan="3" class="calibre39"><strong class="calibre16">Week specifier</strong></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">W</code></td>
			<td class="calibre39">Week number of year</td>
			<td class="calibre39"><code class="calibre48">01</code> to <code class="calibre48">52</code></td>
		</tr>
		<tr class="calibre40">
			<td colspan="3" class="calibre39"><strong class="calibre16">Month specifiers</strong></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">F</code></td>
			<td class="calibre39">Month name</td>
			<td class="calibre39"><code class="calibre48">January</code> to <code class="calibre48">December</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">m</code></td>
			<td class="calibre39">Month number with leading zeros</td>
			<td class="calibre39"><code class="calibre48">01</code> to <code class="calibre48">12</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">M</code></td>
			<td class="calibre39">Month name, three letters</td>
			<td class="calibre39"><code class="calibre48">Jan</code> to <code class="calibre48">Dec</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">n</code></td>
			<td class="calibre39">Month number, no leading zeros</td>
			<td class="calibre39"><code class="calibre48">1</code> to <code class="calibre48">12</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">t</code></td>
			<td class="calibre39">Number of days in given month</td>
			<td class="calibre39"><code class="calibre48">28</code> to <code class="calibre48">31</code></td>
		</tr>
		<tr class="calibre40">
			<td colspan="3" class="calibre39"><strong class="calibre16">Year specifiers</strong></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">L</code></td>
			<td class="calibre39">Leap year</td>
			<td class="calibre39"><code class="calibre48">1</code> = Yes, <code class="calibre48">0</code> = No</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">y</code></td>
			<td class="calibre39">Year, 2 digits</td>
			<td class="calibre39"><code class="calibre48">00</code> to <code class="calibre48">99</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">Y</code></td>
			<td class="calibre39">Year, 4 digits</td>
			<td class="calibre39"><code class="calibre48">0000</code> to <code class="calibre48">9999</code></td>
		</tr>
		<tr class="calibre40">
			<td colspan="3" class="calibre39"><strong class="calibre16">Time specifiers</strong></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">a</code></td>
			<td class="calibre39">Before or after midday, lowercase</td>
			<td class="calibre39"><code class="calibre48">am</code> or <code class="calibre48">pm</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">A</code></td>
			<td class="calibre39">Before or after midday, uppercase</td>
			<td class="calibre39"><code class="calibre48">AM</code> or <code class="calibre48">PM</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">g</code></td>
			<td class="calibre39">Hour of day, 12-hour format, no leading zeros</td>
			<td class="calibre39"><code class="calibre48">1</code> to <code class="calibre48">12</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">G</code></td>
			<td class="calibre39">Hour of day, 24-hour format, no leading zeros</td>
			<td class="calibre39"><code class="calibre48">0</code> to <code class="calibre48">23</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">h</code></td>
			<td class="calibre39">Hour of day, 12-hour format, with leading zeros</td>
			<td class="calibre39"><code class="calibre48">01</code> to <code class="calibre48">12</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">H</code></td>
			<td class="calibre39">Hour of day, 24-hour format, with leading zeros</td>
			<td class="calibre39"><code class="calibre48">00</code> to <code class="calibre48">23</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">i</code></td>
			<td class="calibre39">Minutes, with leading zeros</td>
			<td class="calibre39"><code class="calibre48">00</code> to <code class="calibre48">59</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">s</code></td>
			<td class="calibre39">Seconds, with leading zeros</td>
			<td class="calibre39"><code class="calibre48">00</code> to <code class="calibre48">59</code></td>
		</tr>
	</tbody>
</table>

<section data-type="sect2" data-pdf-bookmark="Date Constants" class="calibre4"><div class="preface" id="date_constants">
<h2 class="calibre28">Date Constants</h2>

<p class="author1">There<a contenteditable="false" data-primary="date and time functions (PHP)" data-secondary="date constants" data-type="indexterm" id="idm45694745930936" class="calibre6"/><a contenteditable="false" data-primary="constants (PHP)" data-type="indexterm" id="idm45694745929464" class="calibre6"/> are a number of useful constants that you can use with the <code class="calibre15">date</code> command to return the date in specific formats. For example, <code class="calibre15">date(DATE_RSS)</code> returns the current date and time in the valid format for an RSS feed. Some of the more commonly used constants are as follows:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">DATE_ATOM</code></dfn></dt>
	<dd class="calibre14">This<a contenteditable="false" data-primary="Atom feeds" data-type="indexterm" id="idm45694745925592" class="calibre6"/> is the format for Atom feeds. The PHP format is <code class="calibre15">"Y-m-d\TH:i:sP"</code>, and example output is <code class="calibre15">"2025-05-15T12:00:00+00:00"</code>.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">DATE_COOKIE</code></dfn></dt>
	<dd class="calibre14">This<a contenteditable="false" data-primary="cookies" data-secondary="date constants in PHP" data-type="indexterm" id="idm45694745922376" class="calibre6"/> is the format for cookies set from a web server or JavaScript. The PHP format is <code class="calibre15">"l, d-M-y H:i:s T"</code>, and example output is <code class="calibre15">"Thursday, 15-May-25 12:00:00 UTC"</code>.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">DATE_RSS</code></dfn></dt>
	<dd class="calibre14">This<a contenteditable="false" data-primary="RSS feeds" data-type="indexterm" id="idm45694745918792" class="calibre6"/> is the format for RSS feeds. The PHP format is <code class="calibre15">"D, d M Y H:i:s O"</code>, and example output is <code class="calibre15">"Thu, 15 May 2025 12:00:00 UTC"</code>.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">DATE_W3C</code></dfn></dt>
	<dd class="calibre14">This<a contenteditable="false" data-primary="World Wide Web Consortium" data-type="indexterm" id="idm45694745915416" class="calibre6"/> is the format for the World Wide Web Consortium. The PHP format is <code class="calibre15">"Y-m-d\TH:i:sP"</code>, and example output is <code class="calibre15">"2025-05-15T12:00:00+00:00"</code>.</dd>
</dl>

<p class="author1">The complete list can be found in the <a href="https://tinyurl.com/phpdatetime" class="calibre6">documentation</a>.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Using checkdate" class="calibre4"><div class="preface" id="using_checkdate">
<h2 class="calibre28">Using checkdate</h2>

<p class="author1">You’ve<a contenteditable="false" data-primary="date and time functions (PHP)" data-secondary="checkdate function" data-type="indexterm" id="idm45694729251064" class="calibre6"/><a contenteditable="false" data-primary="checkdate function (PHP)" data-type="indexterm" id="idm45694729249640" class="calibre6"/> seen how to display a valid date in a variety of formats. But how can you check whether a user has submitted a valid date to your program? The answer is to pass the month, day, and year to the <code class="calibre15">checkdate</code> function, which returns a value of <code class="calibre15">TRUE</code> if the date is valid or <code class="calibre15">FALSE</code> if it is not.</p>

<p class="author1">For example, if September 31 of any year is input, it will always be an invalid date. <a data-type="xref" href="#checking_for_the_validity_of_a_date" class="calibre6">Example 7-3</a> shows code that you could use for this. As it stands, it will find the given date invalid.<a contenteditable="false" data-primary="" data-startref="PHPdate07" data-type="indexterm" id="idm45694729245304" class="calibre6"/></p>

<div data-type="example" id="checking_for_the_validity_of_a_date" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-3. </span>Checking for the validity of a date</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="nv">$month</code> <code class="o">=</code> <code class="mi">9</code><code class="p">;</code>    <code class="c">// September (only has 30 days)</code>
  <code class="nv">$day</code>   <code class="o">=</code> <code class="mi">31</code><code class="p">;</code>   <code class="c">// 31st</code>
  <code class="nv">$year</code>  <code class="o">=</code> <code class="mi">2025</code><code class="p">;</code> <code class="c">// 2025</code>

  <code class="k">if</code> <code class="p">(</code><code class="nb">checkdate</code><code class="p">(</code><code class="nv">$month</code><code class="p">,</code> <code class="nv">$day</code><code class="p">,</code> <code class="nv">$year</code><code class="p">))</code> <code class="k">echo</code> <code class="s">"Date is valid"</code><code class="p">;</code>
  <code class="k">else</code> <code class="k">echo</code> <code class="s">"Date is invalid"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="File Handling" class="calibre4"><div class="preface" id="file_handling">
<h1 class="calibre11">File Handling</h1>

<p class="author1">Powerful<a contenteditable="false" data-primary="PHP programming language" data-secondary="file handling" data-type="indexterm" id="PHPfile07" class="calibre6"/> as it is, MySQL is not the only (or necessarily the best) way to store all data on a web server. Sometimes it can be quicker and more convenient to directly access files on the hard disk. Cases in which you might need to do this are when modifying images such as uploaded user avatars or with logfile that you wish to process.</p>

<p class="author1">First, though, a note<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="naming rules" data-type="indexterm" id="idm45694729198904" class="calibre6"/><a contenteditable="false" data-primary="names and naming" data-secondary="files in PHP" data-type="indexterm" id="idm45694729186536" class="calibre6"/> about file naming: if you are writing code that may be used on various PHP installations, there is no way of knowing whether these systems are case-sensitive. For example, Windows and<a contenteditable="false" data-primary="macOS" data-secondary="filenames in" data-type="indexterm" id="idm45694729184824" class="calibre6"/> macOS filenames are not case-sensitive, but Linux and Unix filenames are. Therefore, you should always assume that the system is case-sensitive and stick to a convention such as all-lowercase filenames.</p>

<section data-type="sect2" data-pdf-bookmark="Checking Whether a File Exists" class="calibre4"><div class="preface" id="checking_whether_a_file_exists">
<h2 class="calibre28">Checking Whether a File Exists</h2>

<p class="author1">To<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="file_exists function" data-type="indexterm" id="idm45694729181432" class="calibre6"/><a contenteditable="false" data-primary="file_exists function (PHP)" data-type="indexterm" id="idm45694729180024" class="calibre6"/> determine whether a file already exists, you can use the <code class="calibre15">file_exists</code> function, which returns either <code class="calibre15">TRUE</code> or <code class="calibre15">FALSE</code> and is used like this:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="k">if</code> <code class="p">(</code><code class="nb">file_exists</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">))</code> <code class="k">echo</code> <code class="s">"File exists"</code><code class="p">;</code></pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Creating a File" class="calibre4"><div class="preface" id="creating_a_file">
<h2 class="calibre28">Creating a File</h2>

<p class="author1">At<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="file creation" data-type="indexterm" id="idm45694729167976" class="calibre6"/> this point, <em class="hyperlink">testfile.txt</em> doesn’t exist, so let’s create it and write a few lines to it. Type <a data-type="xref" href="#creating_a_simple_text_file" class="calibre6">Example 7-4</a> and save it as <em class="hyperlink">testfile.php</em>.</p>

<div data-type="example" id="creating_a_simple_text_file" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-4. </span>Creating a simple text file</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// testfile.php</code>
  <code class="nv">$fh</code> <code class="o">=</code> <code class="nb">fopen</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">,</code> <code class="s">'w'</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Failed to create file"</code><code class="p">);</code>

  <code class="nv">$text</code> <code class="o">=</code> <code class="s">&lt;&lt;&lt;_END</code>
<code class="s">Line 1</code>
<code class="s">Line 2</code>
<code class="s">Line 3</code>
<code class="s">_END;</code>

  <code class="nb">fwrite</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="nv">$text</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Could not write to file"</code><code class="p">);</code>
  <code class="nb">fclose</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>
  <code class="k">echo</code> <code class="s">"File 'testfile.txt' written successfully"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">Should<a contenteditable="false" data-primary="die function (PHP)" data-type="indexterm" id="idm45694729112872" class="calibre6"/> a program call the <code class="calibre15">die</code> function, the open file will be automatically closed as part of terminating the program.</p>

<p class="author1">When you run this in a browser, all being well, you will receive the message <code class="calibre15">File 'testfile.txt' written successfully</code>. If you receive an error message, your hard disk may be full or, more likely, you may not have permission to create or write to the file, in which case you should modify the attributes of the destination folder according to your operating system. Otherwise, the file <em class="hyperlink">testfile.txt</em> should now be residing in the same folder in which you saved the <em class="hyperlink">testfile.php</em> program. Try opening the file in a text or program editor—the contents will look like this:</p>

<pre data-programming-language="perl" class="calibre29">
Line 1
Line 2
Line 3</pre>

<p class="author1">This<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="sequence of" data-type="indexterm" id="idm45694729078248" class="calibre6"/> simple example shows the sequence that all file handling takes:</p>

<ol class="calibre25">
	<li class="calibre26">
	<p class="author1">Always<a contenteditable="false" data-primary="fopen function (PHP)" data-type="indexterm" id="idm45694729075656" class="calibre6"/> start by opening the file. You do this through a call to <code class="calibre15">fopen</code>.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Then you can call other functions; here we write to the file (<code class="calibre15">fwrite</code>), but you can also read from an existing file (<code class="calibre15">fread</code> or <code class="calibre15">fgets</code>) and do other things.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Finish by closing the file (<code class="calibre15">fclose</code>). Although the program does this for you when it ends, you should clean up by closing the file when you’re finished.</p>
	</li>
</ol>

<p class="author1">Every open file requires a file resource so that PHP can access and manage it. The preceding example sets the variable <code class="calibre15">$fh</code> (which I chose to stand for <em class="hyperlink">file handle</em>) to the value returned by the <code class="calibre15">fopen</code> function. Thereafter, each file-handling function that accesses the opened file, such as <code class="calibre15">fwrite</code> or <code class="calibre15">fclose</code>, must be passed <code class="calibre15">$fh</code> as a parameter to identify the file being accessed. Don’t worry about the content of the <code class="calibre15">$fh</code> variable; it’s a number PHP uses to refer to internal information about the file—you just pass the variable to other functions.</p>

<p class="author1">Upon failure, <code class="calibre15">FALSE</code> will be returned by <code class="calibre15">fopen</code>. The previous example shows a simple way to capture and respond to the failure: it calls the <code class="calibre15">die</code> function to end the program and give the user an error message. A web application would never abort in this crude way (you would create a web page with an error message instead), but this is fine for our testing purposes.</p>

<p class="author1">Notice the second parameter to the <code class="calibre15">fopen</code> call. It is simply the character <code class="calibre15">w</code>, which tells the function to open the file for writing. The function creates the file if it doesn’t already exist. Be careful when playing around with these functions: if the file already exists, the <code class="calibre15">w</code> mode parameter causes the <code class="calibre15">fopen</code> call to delete the old contents (even if you don’t write anything new!).</p>

<p class="author1">There are several different mode parameters that can be used here, as detailed in <a data-type="xref" href="#supported_fopen_modes" class="calibre6">Table 7-5</a>. The modes that include a <code class="calibre15">+</code> symbol are further explained in the section <a data-type="xref" href="#updating_files" class="calibre6">“Updating Files”</a>.<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="fopen modes" data-type="indexterm" id="idm45694729058664" class="calibre6"/></p>

<table id="supported_fopen_modes" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-5. </span>The supported <code class="calibre60">fopen</code> modes</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Mode</th>
			<th class="calibre37">Action</th>
			<th class="calibre37">Description</th>
		</tr>
		<tr class="calibre40">
			<td class="calibre61"><code class="calibre48">'r'</code></td>
			<td class="calibre61">Read from file’s beginning</td>
			<td class="calibre61">Open for reading only; place the file pointer at the beginning of the file. Return <code class="calibre48">FALSE</code> if the file doesn’t already exist.</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre61"><code class="calibre48">'r+'</code></td>
			<td class="calibre61">Read from file’s beginning and allow writing</td>
			<td class="calibre61">Open for reading and writing; place the file pointer at the beginning of the file. Return <code class="calibre48">FALSE</code> if the file doesn’t already exist.</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre61"><code class="calibre48">'w'</code></td>
			<td class="calibre61">Write from file’s beginning and truncate file</td>
			<td class="calibre61">Open for writing only; place the file pointer at the beginning of the file and truncate the file to zero length. If the file doesn’t exist, attempt to create it.</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre61"><code class="calibre48">'w+'</code></td>
			<td class="calibre61">Write from file’s beginning, truncate file, and allow reading</td>
			<td class="calibre61">Open for reading and writing; place the file pointer at the beginning of the file and truncate the file to zero length. If the file doesn’t exist, attempt to create it.</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre61"><code class="calibre48">'a'</code></td>
			<td class="calibre61">Append to file’s end</td>
			<td class="calibre61">Open for writing only; place the file pointer at the end of the file. If the file doesn’t exist, attempt to create it.</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre61"><code class="calibre48">'a+'</code></td>
			<td class="calibre61">Append to file’s end and allow reading</td>
			<td class="calibre61">Open for reading and writing; place the file pointer at the end of the file. If the file doesn’t exist, attempt to create it.</td>
		</tr>
	</thead>
</table>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Reading from Files" class="calibre4"><div class="preface" id="reading_from_files">
<h2 class="calibre28">Reading from Files</h2>

<p class="author1">The<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="reading from files" data-type="indexterm" id="idm45694729038056" class="calibre6"/><a contenteditable="false" data-primary="fgets function (PHP)" data-type="indexterm" id="idm45694729001784" class="calibre6"/> easiest way to read from a text file is to grab a whole line through <code class="calibre15">fgets</code> (think of the final <code class="calibre15">s</code> as standing for <em class="hyperlink">string</em>), as in <a data-type="xref" href="#reading_a_file_with_fgets" class="calibre6">Example 7-5</a>.</p>

<div data-type="example" id="reading_a_file_with_fgets" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-5. </span>Reading a file with <code class="calibre15">fgets</code></h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="nv">$fh</code> <code class="o">=</code> <code class="nb">fopen</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">,</code> <code class="s">'r'</code><code class="p">)</code> <code class="k">or</code>
    <code class="k">die</code><code class="p">(</code><code class="s">"File does not exist or you lack permission to open it"</code><code class="p">);</code>

  <code class="nv">$line</code> <code class="o">=</code> <code class="nb">fgets</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>
  <code class="nb">fclose</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>
  <code class="k">echo</code> <code class="nv">$line</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">If you created the file as shown in <a data-type="xref" href="#creating_a_simple_text_file" class="calibre6">Example 7-4</a>, you’ll get the first line:</p>

<pre data-programming-language="perl" class="calibre29">
Line 1</pre>

<p class="author1">You<a contenteditable="false" data-primary="fread function (PHP)" data-type="indexterm" id="idm45694728886792" class="calibre6"/> can retrieve multiple lines or portions of lines through the <code class="calibre15">fread</code> function, as in <a data-type="xref" href="#reading_a_file_with_fread" class="calibre6">Example 7-6</a>.</p>

<div data-type="example" id="reading_a_file_with_fread" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-6. </span>Reading a file with <code class="calibre15">fread</code></h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="nv">$fh</code> <code class="o">=</code> <code class="nb">fopen</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">,</code> <code class="s">'r'</code><code class="p">)</code> <code class="k">or</code>
    <code class="k">die</code><code class="p">(</code><code class="s">"File does not exist or you lack permission to open it"</code><code class="p">);</code>

  <code class="nv">$text</code> <code class="o">=</code> <code class="nb">fread</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code>
  <code class="nb">fclose</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>
  <code class="k">echo</code> <code class="nv">$text</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">I’ve requested three characters in the <code class="calibre15">fread</code> call, so the program displays this:</p>

<pre data-programming-language="perl" class="calibre29">
Lin</pre>

<p class="author1">The <code class="calibre15">fread</code> function is commonly used with binary data. If you use it on text data that spans more than one line, remember to count newline characters.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Copying Files" class="calibre4"><div class="preface" id="copying_files">
<h2 class="calibre28">Copying Files</h2>

<p class="author1">Let’s try<a contenteditable="false" data-primary="copy function (PHP)" data-type="indexterm" id="idm45694728944568" class="calibre6"/><a contenteditable="false" data-primary="file handling (PHP)" data-secondary="copying files" data-type="indexterm" id="idm45694728943432" class="calibre6"/> out the PHP <code class="calibre15">copy</code> function to create a clone of <em class="hyperlink">testfile.txt</em>. Type <a data-type="xref" href="#copying_a_file" class="calibre6">Example 7-7</a>, save it as <em class="hyperlink">copyfile.php</em>, and then call up the program in your browser.</p>

<div data-type="example" id="copying_a_file" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-7. </span>Copying a file</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// copyfile.php</code>
  <code class="nb">copy</code><code class="p">(</code><code class="s">'testfile.txt'</code><code class="p">,</code> <code class="s">'testfile2.txt'</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Could not copy file"</code><code class="p">);</code>
  <code class="k">echo</code> <code class="s">"File successfully copied to 'testfile2.txt'"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">If you check your folder again, you’ll see that you now have the new file <em class="hyperlink">testfile2.txt</em> in it. By the way, if you don’t want your programs to exit on a failed copy attempt, you could try the alternate syntax in <a data-type="xref" href="#alternate_syntax_for_copying_a_file" class="calibre6">Example 7-8</a>. This uses the <code class="calibre15">!</code> (<code class="calibre15">NOT</code>) operator as a quick-and-easy shorthand. Placed in front of an expression, it applies the <code class="calibre15">NOT</code> operator to it, so the equivalent statement here in English would begin “If not able to copy...”.</p>

<div data-type="example" id="alternate_syntax_for_copying_a_file" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-8. </span>Alternate syntax for copying a file</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// copyfile2.php</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">copy</code><code class="p">(</code><code class="s">'testfile.txt'</code><code class="p">,</code> <code class="s">'testfile2.txt'</code><code class="p">))</code> <code class="k">echo</code> <code class="s">"Could not copy file"</code><code class="p">;</code>
  <code class="k">else</code> <code class="k">echo</code> <code class="s">"File successfully copied to 'testfile2.txt'"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Moving a File" class="calibre4"><div class="preface" id="moving_a_file">
<h2 class="calibre28">Moving a File</h2>

<p class="author1">To<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="moving files" data-type="indexterm" id="idm45694728844568" class="calibre6"/><a contenteditable="false" data-primary="rename function (PHP)" data-type="indexterm" id="idm45694728843160" class="calibre6"/> move a file, rename it with the <code class="calibre15">rename</code> function, as in <a data-type="xref" href="#moving_a_file-id00020" class="calibre6">Example 7-9</a>.</p>

<div data-type="example" id="moving_a_file-id00020" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-9. </span>Moving a file</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// movefile.php</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">rename</code><code class="p">(</code><code class="s">'testfile2.txt'</code><code class="p">,</code> <code class="s">'testfile2.new'</code><code class="p">))</code>
    <code class="k">echo</code> <code class="s">"Could not rename file"</code><code class="p">;</code>
  <code class="k">else</code> <code class="k">echo</code> <code class="s">"File successfully renamed to 'testfile2.new'"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">You can use the <code class="calibre15">rename</code> function on directories, too. To avoid any warning messages if the original file doesn’t exist, you can call the <code class="calibre15">file_exists</code> function first to check.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Deleting a File" class="calibre4"><div class="preface" id="deleting_a_file">
<h2 class="calibre28">Deleting a File</h2>

<p class="author1">Deleting<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="deleting files" data-type="indexterm" id="idm45694728790680" class="calibre6"/><a contenteditable="false" data-primary="unlink function (PHP)" data-type="indexterm" id="idm45694728739128" class="calibre6"/> a file is just a matter of using the <code class="calibre15">unlink</code> function to remove it from the filesystem, as in <a data-type="xref" href="#deleting_a_file-id00021" class="calibre6">Example 7-10</a>.</p>

<div data-type="example" id="deleting_a_file-id00021" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-10. </span>Deleting a file</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// deletefile.php</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">unlink</code><code class="p">(</code><code class="s">'testfile2.new'</code><code class="p">))</code> <code class="k">echo</code> <code class="s">"Could not delete file"</code><code class="p">;</code>
  <code class="k">else</code> <code class="k">echo</code> <code class="s">"File 'testfile2.new' successfully deleted"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">Whenever you access files on your hard disk directly, you must also always ensure that it is impossible for your filesystem to be compromised. For example, if you are deleting a file based on user input, you must make absolutely certain it is a file that can be safely deleted and that the user is allowed to delete it.</p>
</div>

<p class="author1">As with moving a file, a warning message will be displayed if the file doesn’t exist, which you can avoid by using <code class="calibre15">file_exists</code> to first check for its existence before calling <code class="calibre15">unlink</code>.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Updating Files" class="calibre4"><div class="preface" id="updating_files">
<h2 class="calibre28">Updating Files</h2>

<p class="author1">Often, you<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="updating files" data-type="indexterm" id="idm45694728692808" class="calibre6"/> will want to add more data to a saved file, which you can do in many ways. You can use one of the append write modes (see <a data-type="xref" href="#supported_fopen_modes" class="calibre6">Table 7-5</a>), or you can simply open a file for reading and writing with one of the other modes that supports writing, and move the file pointer to the correct place within the file that you wish to write to or read from.</p>

<p class="author1">The<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="file pointers and file handles" data-type="indexterm" id="idm45694728663368" class="calibre6"/> <em class="hyperlink">file pointer</em> is the position within a file at which the next file access will take place, whether it’s a read or a write. It is not the same as the <em class="hyperlink">file handle</em> (as stored in the variable <code class="calibre15">$fh</code> in <a data-type="xref" href="#creating_a_simple_text_file" class="calibre6">Example 7-4</a>), which contains details about the file being accessed.</p>

<p class="author1">You can see this in action by typing <a data-type="xref" href="#updating_a_file" class="calibre6">Example 7-11</a> and saving it as <em class="hyperlink">update.php</em>. Then call it up in your browser.</p>

<div data-type="example" id="updating_a_file" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-11. </span>Updating a file</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// update.php</code>
  <code class="nv">$fh</code>   <code class="o">=</code> <code class="nb">fopen</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">,</code> <code class="s">'r+'</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Failed to open file"</code><code class="p">);</code>
  <code class="nv">$text</code> <code class="o">=</code> <code class="nb">fgets</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>

  <code class="nb">fseek</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="n">SEEK_END</code><code class="p">);</code>
  <code class="nb">fwrite</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="s">"</code><code class="se">\n</code><code class="err">$text</code><code class="s">"</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Could not write to file"</code><code class="p">);</code>
  <code class="nb">fclose</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>

  <code class="k">echo</code> <code class="s">"File 'testfile.txt' successfully updated"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">This program opens <em class="hyperlink">testfile.txt</em> for both reading and writing by setting the mode with <code class="calibre15">'r+'</code>, which puts the file pointer right at the start. It then uses the <code class="calibre15">fgets</code> function to read in a single line from the file (up to the first line feed). After that, the <code class="calibre15">fseek</code> function is called to move the file pointer right to the file end, at which point the line of text that was extracted from the start of the file (stored in <code class="calibre15">$text</code>) is then appended to the file’s end (preceded by a <code class="calibre15">\n</code> line feed) and the file is closed. The resulting file now looks like this:</p>

<pre data-programming-language="perl" class="calibre29">
Line 1
Line 2
Line 3
Line 1</pre>

<p class="author1">The first line has successfully been copied and then appended to the file’s end.</p>

<p class="author1">As<a contenteditable="false" data-primary="fseek function (PHP)" data-type="indexterm" id="idm45694728592792" class="calibre6"/> used here, in addition to the <code class="calibre15">$fh</code> file handle, the <code class="calibre15">fseek</code> function was passed two other parameters, <code class="calibre15">0</code> and <code class="calibre15">SEEK_END</code>. <code class="calibre15">SEEK_END</code> tells the function to move the file pointer to the end of the file, and <code class="calibre15">0</code> tells it how many positions it should then be moved backward from that point. In the case of <a data-type="xref" href="#updating_a_file" class="calibre6">Example 7-11</a>, a value of <code class="calibre15">0</code> is used because the pointer is required to remain at the file’s end.</p>

<p class="author1">There are two other seek options available to the <code class="calibre15">fseek</code> function: <code class="calibre15">SEEK_SET</code> and <code class="calibre15">SEEK_CUR</code>. The <code class="calibre15">SEEK_SET</code> option tells the function to set the file pointer to the exact position given by the preceding parameter. Thus, the following example moves the file pointer to position 18:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">fseek</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="mi">18</code><code class="p">,</code> <code class="n">SEEK_SET</code><code class="p">);</code></pre>

<p class="author1"><code class="calibre15">SEEK_CUR</code> sets the file pointer to the current position <em class="hyperlink">plus</em> the value of the given offset. Therefore, if the file pointer is currently at position 18, the following call will move it to position 23:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">fseek</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="n">SEEK_CUR</code><code class="p">);</code>
</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Locking Files for Multiple Accesses" class="calibre4"><div class="preface" id="locking_files_for_multiple_accesses">
<h2 class="calibre28">Locking Files for Multiple Accesses</h2>

<p class="author1">Web<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="locking files for multiple accesses" data-type="indexterm" id="idm45694728564456" class="calibre6"/><a contenteditable="false" data-primary="flock function (PHP)" data-type="indexterm" id="idm45694728563080" class="calibre6"/> programs are often called by many users at the same time. If more than one person tries to write to a file simultaneously, it can become corrupted. And if one person writes to it while another is reading from it, the file is all right, but the person reading it can get odd results. To handle simultaneous users, you must use the file-locking <code class="calibre15">flock</code> function. This function queues up all other requests to access a file until your program releases the lock. So, whenever your programs use write access on files that may be accessed concurrently by multiple users, you should also add file locking to them, as in <a data-type="xref" href="#updating_a_file_with_file_locking" class="calibre6">Example 7-12</a>, which is an updated version of <a data-type="xref" href="#updating_a_file" class="calibre6">Example 7-11</a>.</p>

<div data-type="example" id="updating_a_file_with_file_locking" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-12. </span>Updating a file with file locking</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="nv">$fh</code>   <code class="o">=</code> <code class="nb">fopen</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">,</code> <code class="s">'r+'</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Failed to open file"</code><code class="p">);</code>
  <code class="nv">$text</code> <code class="o">=</code> <code class="nb">fgets</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>

  <code class="k">if</code> <code class="p">(</code><code class="nb">flock</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="n">LOCK_EX</code><code class="p">))</code>
  <code class="p">{</code>
    <code class="nb">fseek</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="n">SEEK_END</code><code class="p">);</code>
    <code class="nb">fwrite</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="s">"</code><code class="err">$text</code><code class="s">"</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s">"Could not write to file"</code><code class="p">);</code>
    <code class="nb">flock</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="n">LOCK_UN</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="nb">fclose</code><code class="p">(</code><code class="nv">$fh</code><code class="p">);</code>
  <code class="k">echo</code> <code class="s">"File 'testfile.txt' successfully updated"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">There is a trick to file locking to preserve the best possible response time for your website visitors: perform it directly before a change you make to a file, and then unlock it immediately afterward. Having a file locked for any longer than this will slow down your application unnecessarily. This is why the calls to <code class="calibre15">flock</code> in <a data-type="xref" href="#updating_a_file_with_file_locking" class="calibre6">Example 7-12</a> are directly before and after the <code class="calibre15">fwrite</code> call.</p>

<p class="author1">The first call to <code class="calibre15">flock</code> sets an exclusive file lock on the file referred to by <code class="calibre15">$fh</code> using the <code class="calibre15">LOCK_EX</code> parameter:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">flock</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="n">LOCK_EX</code><code class="p">);</code></pre>

<p class="author1">From this point onward, no other processes can write to (or even read from) the file until you release the lock by using the <code class="calibre15">LOCK_UN</code> parameter, like this:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nb">flock</code><code class="p">(</code><code class="nv">$fh</code><code class="p">,</code> <code class="n">LOCK_UN</code><code class="p">);</code></pre>

<p class="author1">As soon as the lock is released, other processes are again allowed access to the file. This is one reason why you should reseek to the point you wish to access in a file each time you need to read or write data—another process could have changed the file since the last access.</p>

<p class="author1">However, did you notice that the call to request an exclusive lock is nested as part of an <code class="calibre15">if</code> statement? This is because <code class="calibre15">flock</code> is not supported on all systems; thus, it is wise to check whether you successfully secured a lock, just in case one could not be obtained.</p>

<p class="author1">Something<a contenteditable="false" data-primary=" advisory locks" data-type="indexterm" id="idm45694728408216" class="calibre6"/> else you must consider is that <code class="calibre15">flock</code> is what is known as an <em class="hyperlink">advisory</em> lock. This means that it locks out only other processes that call the function. If you have any code that goes right in and modifies files without implementing <code class="calibre15">flock</code> file locking, it will always override the locking and could wreak havoc on your files.</p>

<p class="author1">By the way, implementing file locking and then accidentally leaving it out in one section of code can lead to an extremely hard-to-locate bug.</p>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1"><code class="calibre15">flock</code> will not work on NFS and many other networked filesystems. Also, when using a multithreaded server like ISAPI, you may not be able to rely on <code class="calibre15">flock</code> to protect files against other PHP scripts running in parallel threads of the same server instance. Additionally, <code class="calibre15">flock</code> is not supported on any system using the old FAT filesystem, such as older versions of Windows, although you are unlikely to come across such systems (hopefully).</p>

<p class="author1">If in doubt, you can try making a quick lock on a test file at the start of a program to see whether you can obtain a lock on the file. Don’t forget to unlock it (and maybe delete it if not needed) after checking.</p>

<p class="author1">Also remember that any call to the <code class="calibre15">die</code> function automatically unlocks a lock and closes the file as part of ending the program.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Reading an Entire File" class="calibre4"><div class="preface" id="reading_an_entire_file">
<h2 class="calibre28">Reading an Entire File</h2>

<p class="author1">A handy function for reading<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="reading files in total" data-type="indexterm" id="idm45694728381320" class="calibre6"/><a contenteditable="false" data-primary="file_get_contents (PHP)" data-type="indexterm" id="idm45694728379944" class="calibre6"/> in an entire file without having to use file handles is <code class="calibre15">file_get_contents</code>. It’s very easy to use, as you can see in <a data-type="xref" href="#using_file_get_contents" class="calibre6">Example 7-13</a>.</p>

<div data-type="example" id="using_file_get_contents" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-13. </span>Using <code class="calibre15">file_get_contents</code></h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="k">echo</code> <code class="s">"&lt;pre&gt;"</code><code class="p">;</code>  <code class="c">// Enables display of line feeds</code>
  <code class="k">echo</code> <code class="nb">file_get_contents</code><code class="p">(</code><code class="s">"testfile.txt"</code><code class="p">);</code>
  <code class="k">echo</code> <code class="s">"&lt;/pre&gt;"</code><code class="p">;</code> <code class="c">// Terminates &lt;pre&gt; tag</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">But the function is actually a lot more useful than that, because you can also use it to fetch a file from a server across the internet, as in <a data-type="xref" href="#grabbing_the_oapostrophereilly_home_page" class="calibre6">Example 7-14</a>, which requests the HTML from the O’Reilly home page and then displays it as if the user had surfed to the page itself. The result will be similar to <a data-type="xref" href="#oreillyhome" class="calibre6">Figure 7-1</a>.</p>

<div data-type="example" id="grabbing_the_oapostrophereilly_home_page" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-14. </span>Grabbing the O’Reilly home page</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code>
  <code class="k">echo</code> <code class="nb">file_get_contents</code><code class="p">(</code><code class="s">"http://oreilly.com"</code><code class="p">);</code>
<code class="cp">?&gt;</code><code class="x"/>
</pre>
</div>

<figure class="calibre23"><div id="oreillyhome" class="figure"><img alt="" class="iimagesoreillyhomepng" src="Images/pmj6_0701.png"/>
<h6 class="calibre24"><span class="keep-together">Figure 7-1. </span>The O’Reilly home page grabbed with <code class="calibre15">file_get_contents</code></h6>
</div></figure>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Uploading Files" class="calibre4"><div class="preface" id="uploading_files">
<h2 class="calibre28">Uploading Files</h2>

<p class="author1">Uploading<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="uploading files" data-type="indexterm" id="FHup07" class="calibre6"/><a contenteditable="false" data-primary="uploading files" data-type="indexterm" id="upfile07" class="calibre6"/> files to a web server is a subject that seems daunting to many people, but it actually couldn’t be much easier. All you need to do to upload a file from a form is choose a special type of encoding called <code class="calibre15">multipart/form-data</code>, and your browser will handle the rest. To see how this works, type the program in <a data-type="xref" href="#image_uploader_uploaddotphp" class="calibre6">Example 7-15</a> and save it as <em class="hyperlink">upload.php</em>. When you run it, you’ll see a form in your browser that lets you upload a file of your choice.</p>

<div data-type="example" id="image_uploader_uploaddotphp" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-15. </span>Image uploader upload.php</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// upload.php</code>
  <code class="k">echo</code> <code class="s">&lt;&lt;&lt;_END</code>
<code class="s">    &lt;html&gt;&lt;head&gt;&lt;title&gt;PHP Form Upload&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</code>
<code class="s">    &lt;form method='post' action='upload.php' enctype='multipart/form-data'&gt;</code>
<code class="s">    Select File: &lt;input type='file' name='filename' size='10'&gt;</code>
<code class="s">    &lt;input type='submit' value='Upload'&gt;</code>
<code class="s">    &lt;/form&gt;</code>
<code class="s">_END;</code>

  <code class="k">if</code> <code class="p">(</code><code class="nv">$_FILES</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="nv">$name</code> <code class="o">=</code> <code class="nv">$_FILES</code><code class="p">[</code><code class="s">'filename'</code><code class="p">][</code><code class="s">'name'</code><code class="p">];</code>
    <code class="nb">move_uploaded_file</code><code class="p">(</code><code class="nv">$_FILES</code><code class="p">[</code><code class="s">'filename'</code><code class="p">][</code><code class="s">'tmp_name'</code><code class="p">],</code> <code class="nv">$name</code><code class="p">);</code>
    <code class="k">echo</code> <code class="s">"Uploaded image '</code><code class="err">$name</code><code class="s">'&lt;br&gt;&lt;img src='</code><code class="err">$name</code><code class="s">'&gt;"</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="k">echo</code> <code class="s">"&lt;/body&gt;&lt;/html&gt;"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">Let’s examine this program a section at a time. The first line of the multiline <code class="calibre15">echo</code> statement starts an HTML document, displays the title, and then starts the document’s body.</p>

<p class="author1">Next we come to the form, which selects the POST method of form submission, sets the target for posted data to the program <em class="hyperlink">upload.php</em> (the program itself), and tells the web browser that the data posted should be encoded via the content type of <code class="calibre15">multipart/form-data</code>, the mime type used for file uploads.</p>

<p class="author1">With the form set up, the next lines display the prompt <code class="calibre15">Select File:</code> and then request two inputs. The first request is for a file; it uses an input type of <code class="calibre15">file</code>, a name of <code class="calibre15">filename</code>, and an input field with a width of 10 characters. The second requested input is just a submit button that is given the label <code class="calibre15">Upload</code> (which replaces the default button text of Submit Query). And then the form is closed.</p>

<p class="author1">This short program shows a common technique in web programming in which a single program is called twice: once when the user first visits a page and again when the user clicks the submit button.</p>

<p class="author1">The PHP code to receive the uploaded data is fairly simple, because all uploaded files are placed into the associative system array <code class="calibre15">$_FILES</code>. Therefore, a quick check to see whether <code class="calibre15">$_FILES</code> contains anything is sufficient to determine whether the user has uploaded a file. This is done with the statement <code class="calibre15">if ($_FILES)</code>.</p>

<p class="author1">The first time the user visits the page, before uploading a file, <code class="calibre15">$_FILES</code> is empty, so the program skips this block of code. When the user uploads a file, the program runs again and discovers an element in the <code class="calibre15">$_FILES</code> array.</p>

<p class="author1">Once the program realizes that a file was uploaded, the actual name, as read from the uploading computer, is retrieved and placed into the variable <code class="calibre15">$name</code>. Now all that’s necessary is to move the uploaded file from the temporary location in which PHP stored it to a more permanent one. We do this using the <code class="calibre15">move_uploaded_file</code> <span class="keep-together">function,</span> passing it the original name of the file, with which it is saved to the current directory.</p>

<p class="author1">Finally, the uploaded image is displayed within an <code class="calibre15">IMG</code> tag, and the result should look like <a data-type="xref" href="#uploading_an_image_as_form_data" class="calibre6">Figure 7-2</a>.</p>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">If you run this program and receive a warning message such as <span class="keep-together"><code class="calibre15">Permission denied</code></span> for the <code class="calibre15">move_uploaded_file</code> function call, then you may not have the correct permissions set for the folder in which the program is running.</p>
</div>

<figure class="calibre23"><div id="uploading_an_image_as_form_data" class="figure"><img alt="Uploading an image as form data" src="Images/pmj6_0702.png" class="calibre62"/>
<h6 class="calibre24"><span class="keep-together">Figure 7-2. </span>Uploading an image as form data</h6>
</div></figure>

<section data-type="sect3" data-pdf-bookmark="Using $_FILES" class="calibre4"><div class="preface" id="using_dollar_files">
<h3 class="calibre43">Using $_FILES</h3>

<p class="author1">Five<a contenteditable="false" data-primary="$_FILES array (PHP)" data-primary-sortas="FILES array (PHP)" data-type="indexterm" id="idm45694728144440" class="calibre6"/> things are stored in the <code class="calibre15">$_FILES</code> array when a file is uploaded, as shown in <a data-type="xref" href="#contents_of_the_dollar_files_array" class="calibre6">Table 7-6</a> (where <em class="hyperlink"><code class="calibre18">file</code></em> is the file upload field name supplied by the submitting form).</p>

<table id="contents_of_the_dollar_files_array" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-6. </span>The contents of the <code class="calibre60">$_FILES</code> array</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Array element</th>
			<th class="calibre37">Contents</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">$_FILES['<em class="calibre30">file</em>']['<em class="calibre30">name</em>']</code></td>
			<td class="calibre39">The name of the uploaded file (e.g., <em class="hyperlink">smiley.jpg</em>)</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">$_FILES['<em class="calibre30">file</em>']['<em class="calibre30">type</em>']</code></td>
			<td class="calibre39">The content type of the file (e.g., <em class="hyperlink">image/jpeg</em>)</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">$_FILES['<em class="calibre30">file</em>']['<em class="calibre30">size</em>']</code></td>
			<td class="calibre39">The file’s size in bytes</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">$_FILES['<em class="calibre30">file</em>']['<em class="calibre30">tmp_name</em>']</code></td>
			<td class="calibre39">The name of the temporary file stored on the server</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">$_FILES['<em class="calibre30">file</em>']['<em class="calibre30">error</em>']</code></td>
			<td class="calibre39">The error code resulting from the file upload</td>
		</tr>
	</tbody>
</table>

<p class="author1">Content<a contenteditable="false" data-primary="internet media types" data-type="indexterm" id="idm45694728121480" class="calibre6"/><a contenteditable="false" data-primary="content types" data-type="indexterm" id="idm45694728120344" class="calibre6"/><a contenteditable="false" data-primary="MIME (Multipurpose Internet Mail Extension)" data-type="indexterm" id="idm45694728119240" class="calibre6"/> types used to be known as <em class="hyperlink">MIME</em> (Multipurpose Internet Mail Extension) types, but because their use later expanded to the whole internet, now they are often called <em class="hyperlink">internet media types</em>. <a data-type="xref" href="#some_common_internet_media_content_types" class="calibre6">Table 7-7</a> shows some of the more frequently used types that turn up in <code class="calibre15">$_FILES['</code><em class="hyperlink"><code class="calibre18">file</code></em><code class="calibre15">']['</code><em class="hyperlink"><code class="calibre18">type</code></em><code class="calibre15">']</code>.</p>

<table id="some_common_internet_media_content_types" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 7-7. </span>Some common internet media content types</caption>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">application/pdf</code></td>
			<td class="calibre39"><code class="calibre48">image/gif</code></td>
			<td class="calibre39"><code class="calibre48">multipart/form-data</code></td>
			<td class="calibre39"><code class="calibre48">text/xml</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">application/zip</code></td>
			<td class="calibre39"><code class="calibre48">image/jpeg</code></td>
			<td class="calibre39"><code class="calibre48">text/css</code></td>
			<td class="calibre39"><code class="calibre48">video/mpeg</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">audio/mpeg</code></td>
			<td class="calibre39"><code class="calibre48">image/png</code></td>
			<td class="calibre39"><code class="calibre48">text/html</code></td>
			<td class="calibre39"><code class="calibre48">video/mp4</code></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">audio/x-wav</code></td>
			<td class="calibre39"><code class="calibre48">application/json</code></td>
			<td class="calibre39"><code class="calibre48">text/plain</code></td>
			<td class="calibre39"><code class="calibre48">audio/webm</code></td>
		</tr>
	</tbody>
</table>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Validation" class="calibre4"><div class="preface" id="validation">
<h3 class="calibre43">Validation</h3>

<p class="author1">I<a contenteditable="false" data-primary="file handling (PHP)" data-secondary="form data validation" data-type="indexterm" id="idm45694728099032" class="calibre6"/><a contenteditable="false" data-primary="form data validation" data-type="indexterm" id="idm45694728097736" class="calibre6"/><a contenteditable="false" data-primary="form data validation" data-see="also file handling" data-type="indexterm" id="idm45694728096632" class="calibre6"/><a contenteditable="false" data-primary="validation" data-secondary="form data validation using PHP" data-type="indexterm" id="idm45694728095256" class="calibre6"/> hope it now goes without saying (although I’ll do so anyway) that form data validation is of the utmost importance, due to the possibility of users attempting to hack into your server.</p>

<p class="author1">In addition to maliciously formed input data, some of the things you also have to check are whether a file was actually received and, if so, whether the right type of data was sent.</p>

<p class="author1">Taking all these things into account, <a data-type="xref" href="#more_secure_version_of_uploaddotphp" class="calibre6">Example 7-16</a>, <em class="hyperlink">upload2.php</em>, is a more secure rewrite of <em class="hyperlink">upload.php</em>.</p>

<div data-type="example" id="more_secure_version_of_uploaddotphp" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-16. </span>A more secure version of upload.php</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// upload2.php</code>
  <code class="k">echo</code> <code class="s">&lt;&lt;&lt;_END</code>
<code class="s">    &lt;html&gt;&lt;head&gt;&lt;title&gt;PHP Form Upload&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</code>
<code class="s">    &lt;form method='post' action='upload2.php' enctype='multipart/form-data'&gt;</code>
<code class="s">    Select a JPG, GIF, PNG or TIF File:</code>
<code class="s">    &lt;input type='file' name='filename' size='10'&gt;</code>
<code class="s">    &lt;input type='submit' value='Upload'&gt;&lt;/form&gt;</code>
<code class="s"> _END;</code>

  <code class="k">if</code> <code class="p">(</code><code class="nv">$_FILES</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="nv">$name</code> <code class="o">=</code> <code class="nv">$_FILES</code><code class="p">[</code><code class="s">'filename'</code><code class="p">][</code><code class="s">'name'</code><code class="p">];</code>

    <code class="k">switch</code><code class="p">(</code><code class="nv">$_FILES</code><code class="p">[</code><code class="s">'filename'</code><code class="p">][</code><code class="s">'type'</code><code class="p">])</code>
    <code class="p">{</code>
      <code class="k">case</code> <code class="s">'image/jpeg'</code><code class="o">:</code> <code class="nv">$ext</code> <code class="o">=</code> <code class="s">'jpg'</code><code class="p">;</code> <code class="k">break</code><code class="p">;</code>
      <code class="k">case</code> <code class="s">'image/gif'</code><code class="o">:</code>  <code class="nv">$ext</code> <code class="o">=</code> <code class="s">'gif'</code><code class="p">;</code> <code class="k">break</code><code class="p">;</code>
      <code class="k">case</code> <code class="s">'image/png'</code><code class="o">:</code>  <code class="nv">$ext</code> <code class="o">=</code> <code class="s">'png'</code><code class="p">;</code> <code class="k">break</code><code class="p">;</code>
      <code class="k">case</code> <code class="s">'image/tiff'</code><code class="o">:</code> <code class="nv">$ext</code> <code class="o">=</code> <code class="s">'tif'</code><code class="p">;</code> <code class="k">break</code><code class="p">;</code>
      <code class="k">default</code><code class="o">:</code>           <code class="nv">$ext</code> <code class="o">=</code> <code class="s">''</code><code class="p">;</code>    <code class="k">break</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">if</code> <code class="p">(</code><code class="nv">$ext</code><code class="p">)</code>
    <code class="p">{</code>
      <code class="nv">$n</code> <code class="o">=</code> <code class="s">"image.</code><code class="err">$ext</code><code class="s">"</code><code class="p">;</code>
      <code class="nb">move_uploaded_file</code><code class="p">(</code><code class="nv">$_FILES</code><code class="p">[</code><code class="s">'filename'</code><code class="p">][</code><code class="s">'tmp_name'</code><code class="p">],</code> <code class="nv">$n</code><code class="p">);</code>
      <code class="k">echo</code> <code class="s">"Uploaded image '</code><code class="err">$name</code><code class="s">' as '</code><code class="err">$n</code><code class="s">':&lt;br&gt;"</code><code class="p">;</code>
      <code class="k">echo</code> <code class="s">"&lt;img src='</code><code class="err">$n</code><code class="s">'&gt;"</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">else</code> <code class="k">echo</code> <code class="s">"'</code><code class="err">$name</code><code class="s">' is not an accepted image file"</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="k">else</code> <code class="k">echo</code> <code class="s">"No image has been uploaded"</code><code class="p">;</code>

  <code class="k">echo</code> <code class="s">"&lt;/body&gt;&lt;/html&gt;"</code><code class="p">;</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">The non-HTML section of code has been expanded from the half-dozen lines of <a data-type="xref" href="#image_uploader_uploaddotphp" class="calibre6">Example 7-15</a> to more than 20 lines, starting at <code class="calibre15">if ($_FILES)</code>.</p>

<p class="author1">As with the previous version, this <code class="calibre15">if</code> line checks whether any data was actually posted, but there is now a matching <code class="calibre15">else</code> near the bottom of the program that echoes a message to the screen when nothing has been uploaded.</p>

<p class="author1">Within the <code class="calibre15">if</code> statement, the variable <code class="calibre15">$name</code> is assigned the value of the filename as retrieved from the uploading computer (just as before), but this time we won’t rely on the user having sent us valid data. Instead, a <code class="calibre15">switch</code> statement checks the uploaded content type against the four types of image this program supports. If a match is made, the variable <code class="calibre15">$ext</code> is set to the three-letter file extension for that type. Should no match be found, the file uploaded was not of an accepted type and the variable <code class="calibre15">$ext</code> is set to the empty string <code class="calibre15">""</code>.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">In this example the file type still comes from the browser and can be modified or changed by the user uploading the file. In this instance such user manipulation is not of concern as the files are only being treated as images. But if the file could ever be executable, you should not rely on information you have not ascertained to be absolutely correct.</p>
</div>

<p class="author1">The next section of code then checks the variable <code class="calibre15">$ext</code> to see whether it contains a string and, if so, creates a new filename called <code class="calibre15">$n</code> with the base name <em class="hyperlink">image</em> and the extension stored in <code class="calibre15">$ext</code>. This means that the program has full control over the file type of the file to be created, as it can be only one of <em class="hyperlink">image.jpg</em>, <em class="hyperlink">image.gif</em>, <em class="hyperlink">image.png</em>, or <em class="hyperlink">image.tif</em>.</p>

<p class="author1">Safe in the knowledge that the program has not been compromised, the rest of the PHP code is much the same as in the previous version. It moves the uploaded temporary image to its new location and then displays it while also displaying the old and new image names.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">Don’t worry about having to delete the temporary file that PHP creates during the upload process, because if the file has not been moved or renamed, it will be automatically removed when the program exits.</p>
</div>

<p class="author1">After the <code class="calibre15">if</code> statement, there is a matching <code class="calibre15">else</code>, which is executed only if an unsupported image type was uploaded (in which case it displays an appropriate error message).</p>

<p class="author1">When you write your own file-uploading routines, I strongly advise you to use a similar approach and have prechosen names and locations for uploaded files. That way, no attempts to add pathnames and other malicious data to the variables you use can get through. If this means that more than one user could end up having a file uploaded with the same name, you could prefix such files with their user’s usernames, or save them to individually created folders for each user.</p>

<p class="author1">But if you must use a supplied filename, you should sanitize it by allowing only alphanumeric characters and the period, which you can do with the following command, using a regular expression (see <a data-type="xref" href="ch18.xhtml#using_ajax" class="calibre6">Chapter 18</a>) to perform a search and replace on <code class="calibre15">$name</code>:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$name</code> <code class="o">=</code> <code class="nb">preg_replace</code><code class="p">(</code><code class="s">"/[^A-Za-z0-9.]/"</code><code class="p">,</code> <code class="s">""</code><code class="p">,</code> <code class="nv">$name</code><code class="p">);</code></pre>

<p class="author1">This leaves only the characters A–Z, a–z, 0–9 and periods in the string <code class="calibre15">$name</code>, and strips out everything else.</p>

<p class="author1">Even better, to ensure that your program will work on all systems, regardless of whether they are case-sensitive or case-insensitive, you should probably use the following command instead, which changes all uppercase characters to lowercase at the same time:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$name</code> <code class="o">=</code> <code class="nb">strtolower</code><code class="p">(</code><code class="nb">preg_replace</code><code class="p">(</code><code class="s">"[^A-Za-z0-9.]"</code><code class="p">,</code> <code class="s">""</code><code class="p">,</code> <code class="nv">$name</code><code class="p">));</code></pre>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">Sometimes<a contenteditable="false" data-startref="upfile07" data-type="indexterm" id="idm45694727865784" class="calibre6"/><a contenteditable="false" data-startref="FHup07" data-type="indexterm" id="idm45694727864712" class="calibre6"/><a contenteditable="false" data-startref="PHPfile07" data-type="indexterm" id="idm45694727863608" class="calibre6"/> you may encounter the media type of <code class="calibre15">image/pjpeg</code>, which indicates a progressive JPEG, but you can safely add this to your code as an alias of <code class="calibre15">image/jpeg</code>, like this:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre45">
<code class="k">case</code> <code class="s">'image/pjpeg'</code><code class="o">:</code>
<code class="k">case</code> <code class="s">'image/jpeg'</code><code class="o">:</code> <code class="nv">$ext</code> <code class="o">=</code> <code class="s">'jpg'</code><code class="p">;</code> <code class="k">break</code><code class="p">;</code></pre>
</div>
</div></section>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="System Calls" class="calibre4"><div class="preface" id="system_calls">
<h1 class="calibre11">System Calls</h1>

<p class="author1">Sometimes<a contenteditable="false" data-primary="PHP programming language" data-secondary="system calls" data-type="indexterm" id="PHPsys07" class="calibre6"/><a contenteditable="false" data-primary="system calls (PHP)" data-type="indexterm" id="system07" class="calibre6"/><a contenteditable="false" data-primary="exec system call (PHP)" data-type="indexterm" id="exec07" class="calibre6"/> PHP will not have the function you need to perform a certain action, but the operating system it is running on may. In such cases, you can use the <code class="calibre15">exec</code> system call to do the job.</p>

<p class="author1">For example, to quickly view the contents of the current directory, you can use a program such as <a data-type="xref" href="#executing_a_system_command" class="calibre6">Example 7-17</a>. If you are on a Windows system, it will run as is using the Windows <code class="calibre15">dir</code> command. On<a contenteditable="false" data-primary="macOS" data-secondary="system calls" data-type="indexterm" id="idm45694727805576" class="calibre6"/> Linux, Unix, or macOS, comment out or remove the first line and uncomment the second to use the <code class="calibre15">ls</code> system command. You may wish to type this program, save it as <em class="hyperlink">exec.php</em>, and call it up in your browser.</p>

<div data-type="example" id="executing_a_system_command" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 7-17. </span>Executing a system command</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;?</code><code class="n">php</code> <code class="c">// exec.php</code>
  <code class="nv">$cmd</code> <code class="o">=</code> <code class="s">"dir"</code><code class="p">;</code>   <code class="c">// Windows, Mac, Linux</code>
  <code class="c">// $cmd = "ls"; // Linux, Unix &amp; Mac</code>

  <code class="nb">exec</code><code class="p">(</code><code class="nb">escapeshellcmd</code><code class="p">(</code><code class="nv">$cmd</code><code class="p">),</code> <code class="nv">$output</code><code class="p">,</code> <code class="nv">$status</code><code class="p">);</code>

  <code class="k">if</code> <code class="p">(</code><code class="nv">$status</code><code class="p">)</code> <code class="k">echo</code> <code class="s">"Exec command failed"</code><code class="p">;</code>
  <code class="k">else</code>
  <code class="p">{</code>
    <code class="k">echo</code> <code class="s">"&lt;pre&gt;"</code><code class="p">;</code>
    <code class="k">foreach</code><code class="p">(</code><code class="nv">$output</code> <code class="k">as</code> <code class="nv">$line</code><code class="p">)</code> <code class="k">echo</code> <code class="nb">htmlspecialchars</code><code class="p">(</code><code class="s">"</code><code class="err">$line\n</code><code class="s">"</code><code class="p">);</code>
    <code class="k">echo</code> <code class="s">"&lt;/pre&gt;"</code><code class="p">;</code>
  <code class="p">}</code>
<code class="cp">?&gt;</code><code class="x"/></pre>
</div>

<p class="author1">The <code class="calibre15">htmlspecialchars</code> function is called<a contenteditable="false" data-primary="htmlspecialchars function (PHP)" data-type="indexterm" id="idm45694727727112" class="calibre6"/> to turn any special characters returned by the system into ones that HTML can understand and properly display, neatening the output. Depending on the system you are using, the result of running this program will look something like this (from a Windows <code class="calibre15">dir</code> command):</p>

<pre data-programming-language="perl" class="calibre29">
Volume in drive C is Hard Disk
 Volume Serial Number is DC63-0E29

 Directory of C:\Program Files (x86)\Ampps\www

11/04/2025  11:58    &lt;DIR&gt;          .
11/04/2025  11:58    &lt;DIR&gt;          ..
28/01/2025  16:45    &lt;DIR&gt;          5th_edition_examples
08/01/2025  10:34    &lt;DIR&gt;          cgi-bin
08/01/2025  10:34    &lt;DIR&gt;          error
29/01/2025  16:18            1,150 favicon.ico
              1 File(s)      1,150 bytes
              5 Dir(s)  1,611,387,486,208 bytes free</pre>

<p class="author1"><code class="calibre15">exec</code> takes three arguments:</p>

<ul class="printings">
	<li class="calibre9">
	<p class="author1">The command itself (in the previous case, <code class="calibre15">$cmd</code>)</p>
	</li>
	<li class="calibre9">
	<p class="author1">An array in which the system will put the output from the command (in the previous case, <code class="calibre15">$output</code>)</p>
	</li>
	<li class="calibre9">
	<p class="author1">A variable to contain the returned status of the call (which, in the previous case, is <code class="calibre15">$status</code>)</p>
	</li>
</ul>

<p class="author1">If you wish, you can omit the <code class="calibre15">$output</code> and <code class="calibre15">$status</code> parameters, but you will not know the output created by the call or even whether it completed successfully.</p>

<p class="author1">You<a contenteditable="false" data-primary="escapeshellcmd function (PHP)" data-type="indexterm" id="idm45694727717016" class="calibre6"/> should also note the use of the <code class="calibre15">escapeshellcmd</code> function. It is a good habit to always use this when issuing an <code class="calibre15">exec</code> call, because it sanitizes the command string, preventing the execution of arbitrary commands, should you supply user input to the call.</p>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">The system call functions are typically disabled on shared web hosts, as they pose a security risk. You should always try to solve your problems within PHP if you can, and go to the system directly only if it is really necessary. Also, going to the system is relatively slow, and you need to code two implementations if your application is expected to run on both Windows and Linux/Unix systems.<a contenteditable="false" data-primary="" data-startref="exec07" data-type="indexterm" id="idm45694727713320" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="system07" data-type="indexterm" id="idm45694727711944" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="PHPsys07" data-type="indexterm" id="idm45694727710568" class="calibre6"/></p>
</div>
</div></section>

<section data-type="sect1" data-pdf-bookmark="XHTML or HTML5?" class="calibre4"><div class="preface" id="xhtml_or_html5question_mark">
<h1 class="calibre11">XHTML or HTML5?</h1>

<p class="author1">Because<a contenteditable="false" data-primary="PHP programming language" data-secondary="XHTML vs. HTML5" data-type="indexterm" id="idm45694727707240" class="calibre6"/><a contenteditable="false" data-primary="XHTML syntax" data-type="indexterm" id="idm45694727705816" class="calibre6"/><a contenteditable="false" data-primary="HTML5" data-secondary="XHTML syntax and" data-type="indexterm" id="idm45694727704712" class="calibre6"/> XHTML documents need to be well formed, you can parse them using standard XML parsers—unlike HTML, which requires a lenient HTML-specific parser. For this reason, XHTML never really caught on, and when the time came to devise a new standard, the World Wide Web Consortium chose to support HTML5 rather than the newer XHTML2 standard.</p>

<p class="author1">HTML5 has some of the features of both HTML4 and XHTML but is much simpler to use and less strict to validate—and, happily, there is now just a single document type you need to place at the head of an HTML5 document (instead of the variety of strict, transitional, and frameset types previously required):</p>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code></pre>

<p class="author1">Just the simple word <code class="calibre15">html</code> is sufficient to tell the browser that your web page is designed for HTML5, and, because all the latest versions of the most popular browsers have been supporting most of the HTML5 specification since 2011 or so, this document type is generally the only one you need, unless you choose to cater to older browsers.</p>

<p class="author1">For all intents and purposes, when writing HTML documents, web developers can safely ignore the old XHTML document types and syntax (such as using <code class="calibre15">&lt;br /&gt;</code> instead of the simpler <code class="calibre15">&lt;br&gt;</code> tag). But if you find yourself having to cater to a very old browser or an unusual application that relies on XHTML, then you can get more information on how to do that at <a href="http://xhtml.com" class="calibre6"><em class="hyperlink">http://xhtml.com</em></a>.</p>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Questions" class="calibre4"><div class="preface" id="questions-id00022">
<h1 class="calibre11">Questions</h1>

<ol class="calibre25">
	<li class="calibre26">
	<p class="author1">Which <code class="calibre15">printf</code> conversion specifier would you use to display a floating-point number?</p>
	</li>
	<li class="calibre26">
	<p class="author1">What <code class="calibre15">printf</code> statement could be used to take the input string <code class="calibre15">"Happy Birthday"</code> and output the string <code class="calibre15">"**Happy"</code>?</p>
	</li>
	<li class="calibre26">
	<p class="author1">To send the output from <code class="calibre15">printf</code> to a variable instead of to a browser, what alternative function would you use?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How would you create a Unix timestamp for 7:11 a.m. on May 2, 2025?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which file access mode would you use with <code class="calibre15">fopen</code> to open a file in write and read mode, with the file truncated and the file pointer at the start?</p>
	</li>
	<li class="calibre26">
	<p class="author1">What is the PHP command for deleting the file <em class="hyperlink">file.txt</em>?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which PHP function is used to read in an entire file in one go, even from across the web?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which PHP superglobal variable holds the details on uploaded files?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which PHP function enables the running of system commands?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which of the following tag styles is preferred in HTML5: <code class="calibre15">&lt;hr&gt;</code> or <code class="calibre15">&lt;hr /&gt;</code>?</p>
	</li>
</ol>

<p class="author1">See <a data-type="xref" href="app01_split_006.xhtml#chapter_7_answers" class="calibre6">“Chapter 7 Answers”</a> in the <a data-type="xref" href="app01_split_000.xhtml#solutions_to_the_chapter_questions" class="calibre6">Appendix A</a> for the answers to these <span class="keep-together">questions</span>.</p>
</div></section>
</div></section></div></body></html>