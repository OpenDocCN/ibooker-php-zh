<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xml:lang="en"
      lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>PHP Cookbook</title>
<link rel="stylesheet" type="text/css" href="override_v1.css"/>
<link rel="stylesheet" type="text/css" href="epub.css"/>
</head>
<body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Strings"><div class="chapter" id="chapter_strings">
<h1><span class="label">Chapter 4. </span>Strings</h1>


<p>Strings are one of the fundamental building blocks of data in PHP. Each string represents an ordered sequence of bytes. Strings can range from human-readable sections of text (like <code>To be or not to be</code>) to sequences of raw bytes encoded as integers (such as <code>\110\145\154\154\157\40\127\157\162\154\144\41</code>).<sup><a data-type="noteref" id="idm45875185433888-marker" href="ch04.html#idm45875185433888">1</a></sup> Every element of data read or written by a PHP application is represented as a string.</p>

<p>In PHP, strings are typically encoded as <a href="https://oreil.ly/Tjsyx">ASCII values</a>, although <a data-type="indexterm" data-primary="strings" id="idm45875185432016"></a>you can convert between ASCII and other formats (like UTF-8) as necessary. Strings can contain <code>null</code> bytes when needed and are essentially limitless in terms of storage so long as the PHP process has adequate memory available.</p>

<p>The most basic way to create a string in PHP is with single quotes. Single-quoted strings are treated as literal <a data-type="indexterm" data-primary="variables" data-secondary="interpolation" id="idm45875185429888"></a><a data-type="indexterm" data-primary="interpolation" id="idm45875185428912"></a><a data-type="indexterm" data-primary="single-quoted strings" id="idm45875185428240"></a><a data-type="indexterm" data-primary="strings" data-secondary="single-quoted" id="idm45875185427568"></a>statements—there are no special characters or any kind of <em>interpolation</em> of variables. To include a literal single quote within a single-quoted string, you must <em>escape</em> that quote by prefixing it with a backslash—for example, <code>\'</code>. In fact, the only two characters that need to be—or even can be—escaped are the single quote itself or the backslash. <a data-type="xref" href="#single_quoted_strings">Example 4-1</a> shows single-quoted strings along with their corresponding printed output.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>Variable interpolation</em> is the practice of referencing a variable directly by name within a string and letting the interpreter replace the variable with its value at runtime. Interpolation allows for more flexible strings, as you can write a single string but dynamically replace some of its contents to fit the context of its location in code.</p>
</div>
<div id="single_quoted_strings" data-type="example">
<h5><span class="label">Example 4-1. </span>Single-quoted strings</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">print</code> <code class="s1">'Hello, world!'</code><code class="p">;</code>
<code class="c1">// Hello, world!</code>

<code class="k">print</code> <code class="s1">'You\'ve only got to escape single quotes and the \\ character.'</code><code class="p">;</code>
<code class="c1">// You've only got to escape single quotes and the \ character.</code>

<code class="k">print</code> <code class="s1">'Variables like $blue are printed as literals.'</code><code class="p">;</code>
<code class="c1">// Variables like $blue are printed as literals.</code>

<code class="k">print</code> <code class="s1">'\110\145\154\154\157\40\127\157\162\154\144\41'</code><code class="p">;</code>
<code class="c1">// \110\145\154\154\157\40\127\157\162\154\144\41</code></pre></div>

<p>More complicated strings might need to interpolate variables or reference special characters, like a newline or tab. For these more complicated use cases, PHP requires the use of double quotes instead and allows for various escape sequences, as shown in <a data-type="xref" href="#string_escape_sequences">Table 4-1</a>.</p>
<table id="string_escape_sequences">
<caption><span class="label">Table 4-1. </span>Double-quoted string escape sequences</caption>
<thead>
<tr>
<th>Escape sequence</th>
<th>Character</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>\n</code></p></td>
<td><p>Newline</p></td>
<td><p><code>"This string ends in a new line.\n"</code></p></td>
</tr>
<tr>
<td><p><code>\r</code></p></td>
<td><p>Carriage return</p></td>
<td><p><code>"This string ends with a carriage return.\r"</code></p></td>
</tr>
<tr>
<td><p><code>\t</code></p></td>
<td><p>Tab</p></td>
<td><p><code>"Lots\tof\tspace"</code></p></td>
</tr>
<tr>
<td><p><code>\\</code></p></td>
<td><p>Backslash</p></td>
<td><p><code>"You must escape the \\ character."</code></p></td>
</tr>
<tr>
<td><p><code>\$</code></p></td>
<td><p>Dollar sign</p></td>
<td><p><code>A movie ticket is \$10.</code></p></td>
</tr>
<tr>
<td><p><code>\"</code></p></td>
<td><p>Double quote</p></td>
<td><p><code>"Some quotes are \"scare quotes.\""</code></p></td>
</tr>
<tr>
<td><p><code>\0</code> through <code>\777</code></p></td>
<td><p>Octal character value</p></td>
<td><p><code>"\120\110\120"</code></p></td>
</tr>
<tr>
<td><p><code>\x0</code> through <code>\xFF</code></p></td>
<td><p>Hex character value</p></td>
<td><p><code>"\x50\x48\x50"</code></p></td>
</tr>
</tbody>
</table>

<p>Except for special characters that are explicitly escaped with leading backspaces, PHP will automatically substitute the value of any variable passed within a double-quoted string. Further, PHP will interpolate entire expressions within a <a data-type="indexterm" data-primary="expressions, interpolation" id="idm45875185384528"></a>double-quoted string if they’re wrapped in curly braces (<code>{}</code>) and treat them as a variable. <a data-type="xref" href="#double_quoted_interpolation">Example 4-2</a> shows how variables, complex or otherwise, are treated within double-quoted strings.</p>
<div id="double_quoted_interpolation" data-type="example">
<h5><span class="label">Example 4-2. </span>Variable interpolation within double-quoted strings</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">print</code><code> </code><code class="s2">"</code><code class="s2">The value of </code><code class="se">\$</code><code class="s2">var is </code><code class="si">$var</code><code class="s2">"</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO1-1" href="#callout_strings_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="k">print</code><code> </code><code class="s2">"</code><code class="s2">Properties of objects can be interpolated, too. </code><code class="si">{</code><code class="nv">$obj</code><code class="o">-&gt;</code><code class="na">value</code><code class="si">}</code><code class="s2">"</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO1-2" href="#callout_strings_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="k">print</code><code> </code><code class="s2">"</code><code class="s2">Prints the value of the variable returned by getVar(): </code><code class="si">{${</code><code class="nx">getVar</code><code class="p">()</code><code class="si">}}</code><code class="s2">"</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO1-3" href="#callout_strings_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO1-1" href="#co_strings_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The first reference to <code>$var</code> is escaped, but the second will be replaced by its actual value. If <code>$var = 'apple'</code>, the string will print <code>The value of $var is apple</code>.</p></dd>
<dt><a class="co" id="callout_strings_CO1-2" href="#co_strings_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Using curly braces enables the direct reference of object properties within a double-quoted string as if these properties were locally defined variables.</p></dd>
<dt><a class="co" id="callout_strings_CO1-3" href="#co_strings_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Assuming <code>getVar()</code> returns the name of a defined variable, this line will both execute the function and print the value assigned to that variable.</p></dd>
</dl></div>

<p>Both single- and double-quoted strings are represented as single lines. Often, though, a program will need to represent multiple lines of text (or multiple lines of encoded binary) as a string. In such a situation, the best tool at a developer’s disposal is a 
<span class="keep-together">Heredoc</span>.</p>

<p>A <em>Heredoc</em> is a literal block of text <a data-type="indexterm" data-primary="Heredocs" id="idm45875185307392"></a>that’s started with three angle brackets (the <code>&lt;&lt;&lt;</code> operator), followed by a named identifier, followed by a newline. Every subsequent line of text (including newlines) is part of the string, up to a completely independent line containing nothing but the Heredoc’s named identifier and a semicolon. <a data-type="xref" href="#heredoc_example">Example 4-3</a> illustrates how a Heredoc might look in code.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The identifier used for a Heredoc does not need to be capitalized. However, it is common convention in PHP to always capitalize these identifiers to help distinguish them from the text definition of the string.</p>
</div>
<div id="heredoc_example" data-type="example">
<h5><span class="label">Example 4-3. </span>String definition using the Heredoc syntax</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$poem</code> <code class="o">=</code> <code class="s">&lt;&lt;&lt;POEM</code>
<code class="s">To be or not to be,</code>
<code class="s">That is the question</code>
<code class="s">POEM;</code></pre></div>

<p>Heredocs function just like double-quoted strings and allow variable interpolation (or special characters like escaped hexadecimals) within them. This can be particularly powerful when encoding blocks of HTML within an application, as variables can be used to make the strings dynamic.</p>

<p>In some situations, though, you might want a string literal rather than something open to variable interpolation. In that case, PHP’s Nowdoc syntax provides a single-quoted style alternative to Heredoc’s double-quoted string analog. A Nowdoc looks almost exactly like a Heredoc, except the identifier itself is enclosed in single <a data-type="indexterm" data-primary="Nowdoc syntax" id="idm45875185298256"></a>quotes, as in <a data-type="xref" href="#nowdoc_example">Example 4-4</a>.</p>
<div id="nowdoc_example" data-type="example">
<h5><span class="label">Example 4-4. </span>String definition using the Nowdoc syntax</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$poem</code> <code class="o">=</code> <code class="s">&lt;&lt;&lt;'POEM'</code>
<code class="s">To be or not to be,</code>
<code class="s">That is the question</code>
<code class="s">POEM;</code></pre></div>

<p>Both single and double quotes can be used within Heredoc and Nowdoc blocks without additional escaping. Nowdocs, however, will not interpolate or dynamically replace any values, whether they are escaped or otherwise.</p>

<p>The recipes that follow help further illustrate how strings can be used in PHP and the various problems they can solve.</p>






<section data-type="sect1" data-pdf-bookmark="4.1 Accessing Substrings Within a Larger String"><div class="sect1" id="idm45875185253248">
<h1>4.1 Accessing Substrings Within a Larger String</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875185252128">
<h2>Problem</h2>

<p>You want to identify whether a string <a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="accessing" id="strgbgs"></a><a data-type="indexterm" data-primary="substrings" data-secondary="accessing" id="sbsgccs"></a>contains a specific substring. For example, you want to know if a URL contains the text <code>/secret/</code>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875185280176">
<h2>Solution</h2>

<p>Use <code>strpos()</code>:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">if</code> <code class="p">(</code><code class="nb">strpos</code><code class="p">(</code><code class="nv">$url</code><code class="p">,</code> <code class="s1">'/secret/'</code><code class="p">)</code> <code class="o">!==</code> <code class="k">false</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">// A secret fragment was detected, run additional logic</code>
    <code class="c1">// ...</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875189701136">
<h2>Discussion</h2>

<p>PHP’s <code>strpos()</code> function will <a data-type="indexterm" data-primary="strpos() function" id="idm45875189682320"></a><a data-type="indexterm" data-primary="functions" data-secondary="strpos()" id="idm45875189681584"></a>scan through a given string and identify the starting position of the first occurrence of a given substring. This function literally looks for a needle in a haystack, as the function’s arguments are named <code>$haystack</code> and <code>$needle</code>, respectively. If the substring (<code>$needle</code>) is not found, the function returns a Boolean <code>false</code>.</p>

<p>It’s important in this case to <a data-type="indexterm" data-primary="strings" data-secondary="strict equality comparison" id="idm45875189709616"></a><a data-type="indexterm" data-primary="strict equality comparison, strings" id="idm45875189708672"></a>use <em>strict equality comparison</em>, as <code>strpos()</code> will return <code>0</code> if the substring appears at the very beginning of the string being searched. Remember from <a data-type="xref" href="ch02.html#equality_operators">Recipe 2.3</a> that comparing values with only two equals signs will attempt to recast the types, converting an integer <code>0</code> into a Boolean <code>false</code>; always use strict comparison operators (either <code>===</code> for equality or <code>!==</code> for inequality) to avoid confusion.</p>

<p>If the <code>$needle</code> appears multiple times within a string, <code>strpos()</code> only returns the position of the first occurrence. You can search for additional occurrences by adding an optional position offset as a third parameter to the function call, as in <a data-type="xref" href="#identify_all_substring_occurrences">Example 4-5</a>. Defining an offset also allows you to search the latter part <a data-type="indexterm" data-primary="substrings" data-secondary="counting occurrences" id="idm45875189671408"></a>of a string for a substring that you know already appears earlier in the string.</p>
<div id="identify_all_substring_occurrences" data-type="example">
<h5><span class="label">Example 4-5. </span>Count all occurrences of a substring</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">function</code><code> </code><code class="nf">count_occurrences</code><code class="p">(</code><code class="nv">$haystack</code><code class="p">,</code><code> </code><code class="nv">$needle</code><code class="p">)</code><code>
</code><code class="p">{</code><code>
    </code><code class="nv">$occurrences</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code>
    </code><code class="nv">$offset</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code>
    </code><code class="nv">$pos</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO2-1" href="#callout_strings_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="k">do</code><code> </code><code class="p">{</code><code>
        </code><code class="nv">$pos</code><code> </code><code class="o">=</code><code> </code><code class="nb">strpos</code><code class="p">(</code><code class="nv">$haystack</code><code class="p">,</code><code> </code><code class="nv">$needle</code><code class="p">,</code><code> </code><code class="nv">$offset</code><code class="p">);</code><code>

        </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$pos</code><code> </code><code class="o">!==</code><code> </code><code class="k">false</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_strings_CO2-2" href="#callout_strings_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
            </code><code class="nv">$occurrences</code><code> </code><code class="o">+=</code><code> </code><code class="mi">1</code><code class="p">;</code><code>
            </code><code class="nv">$offset</code><code> </code><code class="o">=</code><code> </code><code class="nv">$pos</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO2-3" href="#callout_strings_CO2-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
        </code><code class="p">}</code><code>
    </code><code class="p">}</code><code> </code><code class="k">while</code><code> </code><code class="p">(</code><code class="nv">$pos</code><code> </code><code class="o">!==</code><code> </code><code class="k">false</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO2-4" href="#callout_strings_CO2-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>

    </code><code class="k">return</code><code> </code><code class="nv">$occurrences</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$str</code><code> </code><code class="o">=</code><code> </code><code class="s1">'How much wood would a woodchuck chuck if a woodchuck could chuck wood?'</code><code class="p">;</code><code>

</code><code class="k">print</code><code> </code><code class="nx">count_occurrences</code><code class="p">(</code><code class="nv">$str</code><code class="p">,</code><code> </code><code class="s1">'wood'</code><code class="p">);</code><code> </code><code class="c1">// 4
</code><code class="k">print</code><code> </code><code class="nx">count_occurrences</code><code class="p">(</code><code class="nv">$str</code><code class="p">,</code><code> </code><code class="s1">'nutria'</code><code class="p">);</code><code> </code><code class="c1">// 0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO2-1" href="#co_strings_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>All of the variables are initially set to <code>0</code> so you can track new string occurrences.</p></dd>
<dt><a class="co" id="callout_strings_CO2-2" href="#co_strings_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>If and only if the string was found should an occurrence be counted.</p></dd>
<dt><a class="co" id="callout_strings_CO2-3" href="#co_strings_CO2-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>If the string was found, update the offset but also increment by <code>1</code> so you don’t repeatedly recount the occurrence you’ve already found.</p></dd>
<dt><a class="co" id="callout_strings_CO2-4" href="#co_strings_CO2-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Once you’ve reached the last occurrence <a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="accessing" data-startref="strgbgs" id="idm45875189555392"></a><a data-type="indexterm" data-primary="substrings" data-secondary="accessing" data-startref="sbsgccs" id="idm45875189507440"></a>of the target substring, exit the loop and return the total count.</p></dd>
</dl></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875189505968">
<h2>See Also</h2>

<p>PHP documentation on <a href="https://oreil.ly/w9Od4"><code>strpos()</code></a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.2 Extracting One String from Within Another"><div class="sect1" id="idm45875189503600">
<h1>4.2 Extracting One String from Within Another</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875189502352">
<h2>Problem</h2>

<p>You want to extract a small string from a <a data-type="indexterm" data-primary="strings" data-secondary="extracting" id="sgsxtr"></a>much larger string—for example, the domain name from an email address.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875189499328">
<h2>Solution</h2>

<p>Use <code>substr()</code> to select the part of the string you want to extract:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$string</code> <code class="o">=</code> <code class="s1">'eric.mann@cookbook.php'</code><code class="p">;</code>
<code class="nv">$start</code> <code class="o">=</code> <code class="nb">strpos</code><code class="p">(</code><code class="nv">$string</code><code class="p">,</code> <code class="s1">'@'</code><code class="p">);</code>

<code class="nv">$domain</code> <code class="o">=</code> <code class="nb">substr</code><code class="p">(</code><code class="nv">$string</code><code class="p">,</code> <code class="nv">$start</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875189455424">
<h2>Discussion</h2>

<p>PHP’s <code>substr()</code> function returns the <a data-type="indexterm" data-primary="substr() function" id="sbsrft"></a><a data-type="indexterm" data-primary="functions" data-secondary="substr()" id="fctsbsr"></a>portion of a given string, based on an initial offset (the second parameter) up to an optional length. The full function signature is as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">substr</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$string</code><code class="p">,</code> <code class="nx">int</code> <code class="nv">$offset</code><code class="p">,</code> <code class="o">?</code><code class="nx">int</code> <code class="nv">$length</code> <code class="o">=</code> <code class="k">null</code><code class="p">)</code><code class="o">:</code> <code class="nx">string</code></pre>

<p>If the <code>$length</code> parameter is omitted, <code>substr()</code> will return the entire remainder of the string. If the <code>$offset</code> parameter is greater than the length of the input string, an empty string is returned.</p>

<p>You can also specify a <em>negative</em> offset to <a data-type="indexterm" data-primary="substrings" data-secondary="negative offset" id="idm45875187838832"></a><a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="negative offset" id="idm45875187837824"></a>return a subset starting from the end of the string instead of the beginning, as in <a data-type="xref" href="#negative_substring_offset">Example 4-6</a>.</p>
<div id="negative_substring_offset" data-type="example">
<h5><span class="label">Example 4-6. </span>Substring with a negative offset</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'phpcookbook'</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">3</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO3-1" href="#callout_strings_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'phpcookbook'</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">2</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO3-2" href="#callout_strings_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'phpcookbook'</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">8</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO3-3" href="#callout_strings_CO3-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO3-1" href="#co_strings_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Returns <code>ook</code> (the last three characters)</p></dd>
<dt><a class="co" id="callout_strings_CO3-2" href="#co_strings_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Returns <code>ok</code> (the last two characters)</p></dd>
<dt><a class="co" id="callout_strings_CO3-3" href="#co_strings_CO3-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Returns <code>cook</code> (the middle four characters)</p></dd>
</dl></div>

<p>You should be aware of some other edge cases regarding offsets and string lengths with <code>substr()</code>. It is possible for the offset to legitimately start within the string, but for <code>$length</code> to run past the end of the string. PHP catches this discrepancy and merely returns the remainder of the original string, even if the final return is <em>less</em> than the specified <a data-type="indexterm" data-primary="substrings" data-secondary="length" id="idm45875187735136"></a><a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="length" id="idm45875187734128"></a>length. <a data-type="xref" href="#substring_lengths">Example 4-7</a> details some potential outputs of <code>substr()</code> based on various specified lengths.</p>
<div id="substring_lengths" data-type="example">
<h5><span class="label">Example 4-7. </span>Various substring lengths</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'Four score and twenty'</code><code class="p">,</code><code> </code><code class="mi">11</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO4-1" href="#callout_strings_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'Four score and twenty'</code><code class="p">,</code><code> </code><code class="mi">99</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO4-2" href="#callout_strings_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'Four score and twenty'</code><code class="p">,</code><code> </code><code class="mi">20</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO4-3" href="#callout_strings_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO4-1" href="#co_strings_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Returns <code>and</code></p></dd>
<dt><a class="co" id="callout_strings_CO4-2" href="#co_strings_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Returns an empty string</p></dd>
<dt><a class="co" id="callout_strings_CO4-3" href="#co_strings_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Returns <code>y</code></p></dd>
</dl></div>

<p>Another edge case is a negative <code>$length</code> supplied to the function. When requesting a substring with a negative length, PHP will remove that many characters from the substring it <a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="negative length" id="idm45875187683808"></a><a data-type="indexterm" data-primary="substrings" data-secondary="negative length" id="idm45875187650592"></a>returns, as illustrated in <a data-type="xref" href="#negative_substring_length">Example 4-8</a>.</p>
<div id="negative_substring_length" data-type="example">
<h5><span class="label">Example 4-8. </span>Substring with a negative length</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'Four score and twenty'</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO5-1" href="#callout_strings_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$substring</code><code> </code><code class="o">=</code><code> </code><code class="nb">substr</code><code class="p">(</code><code class="s1">'Four score and twenty'</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">,</code><code> </code><code class="o">-</code><code class="mi">11</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO5-2" href="#callout_strings_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO5-1" href="#co_strings_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Returns <code>score and twenty</code></p></dd>
<dt><a class="co" id="callout_strings_CO5-2" href="#co_strings_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Returns <code>score</code></p></dd>
</dl></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875189469088">
<h2>See Also</h2>

<p>PHP documentation for <a href="https://oreil.ly/z_w10"><code>substr()</code></a> and <a data-type="indexterm" data-primary="strings" data-secondary="extracting" data-startref="sgsxtr" id="idm45875187588560"></a><a data-type="indexterm" data-primary="substr() function" data-startref="sbsrft" id="idm45875187587312"></a><a data-type="indexterm" data-primary="functions" data-secondary="substr()" data-startref="fctsbsr" id="idm45875187586368"></a>for <a href="https://oreil.ly/NWcWJ"><code>strpos()</code></a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.3 Replacing Part of a String"><div class="sect1" id="idm45875187583920">
<h1>4.3 Replacing Part of a String</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875187582672">
<h2>Problem</h2>

<p>You want to replace just one <a data-type="indexterm" data-primary="strings" data-secondary="replacing part" id="strgrp"></a>part of a string with another string. For example, you want to obfuscate all but the last four digits of a phone number before printing it to the screen.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875187579712">
<h2>Solution</h2>

<p>Use <code>substr_replace()</code> to replace a <a data-type="indexterm" data-primary="substr_replace() function" id="sbsrpcfc"></a><a data-type="indexterm" data-primary="functions" data-secondary="substr_replace()" id="fcgbrpl"></a>component of an existing string based on its 
<span class="keep-together">position</span>:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$string</code> <code class="o">=</code> <code class="s1">'555-123-4567'</code><code class="p">;</code>
<code class="nv">$replace</code> <code class="o">=</code> <code class="s1">'xxx-xxx'</code>

<code class="nv">$obfuscated</code> <code class="o">=</code> <code class="nb">substr_replace</code><code class="p">(</code><code class="nv">$string</code><code class="p">,</code> <code class="nv">$replace</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="nb">strlen</code><code class="p">(</code><code class="nv">$replace</code><code class="p">));</code>
<code class="c1">// xxx-xxx-4567</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875187571904">
<h2>Discussion</h2>

<p>PHP’s <code>substr_replace()</code> function operates on a part of a string, similar to <code>substr()</code>, defined by an integer offset up to a specific length. <a data-type="xref" href="#substr_replace_signature">Example 4-9</a> shows the full function signature.</p>
<div id="substr_replace_signature" data-type="example">
<h5><span class="label">Example 4-9. </span>Full function signature of <code>substr_replace()</code></h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">substr_replace</code><code class="p">(</code>
    <code class="k">array</code><code class="o">|</code><code class="nx">string</code> <code class="nv">$string</code><code class="p">,</code>
    <code class="k">array</code><code class="o">|</code><code class="nx">string</code> <code class="nv">$replace</code><code class="p">,</code>
    <code class="k">array</code><code class="o">|</code><code class="nx">int</code> <code class="nv">$offset</code><code class="p">,</code>
    <code class="k">array</code><code class="o">|</code><code class="nx">int</code><code class="o">|</code><code class="k">null</code> <code class="nv">$length</code> <code class="o">=</code> <code class="k">null</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">string</code></pre></div>

<p>Unlike its <code>substr()</code> analog, <code>substr_replace()</code> can operate either on individual strings or on collections of strings. If an array of strings is passed in with scalar values for <code>$replace</code> and <code>$offset</code>, the function will run the replacement on each string, as <a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="replacing multiple" id="idm45875186368704"></a><a data-type="indexterm" data-primary="substrings" data-secondary="replacing" data-tertiary="multiple" id="idm45875186390880"></a>in <a data-type="xref" href="#replace_multiple_substrings">Example 4-10</a>.</p>
<div id="replace_multiple_substrings" data-type="example">
<h5><span class="label">Example 4-10. </span>Replacing multiple substrings at once</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$phones</code> <code class="o">=</code> <code class="p">[</code>
    <code class="s1">'555-555-5555'</code><code class="p">,</code>
    <code class="s1">'555-123-1234'</code><code class="p">,</code>
    <code class="s1">'555-991-9955'</code>
<code class="p">];</code>

<code class="nv">$obfuscated</code> <code class="o">=</code> <code class="nb">substr_replace</code><code class="p">(</code><code class="nv">$phones</code><code class="p">,</code> <code class="s1">'xxx-xxx'</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">7</code><code class="p">);</code>

<code class="c1">// xxx-xxx-5555</code>
<code class="c1">// xxx-xxx-1234</code>
<code class="c1">// xxx-xxx-9955</code></pre></div>

<p>In general, developers have a lot of flexibility with the parameters in this function. Similar to <code>substr()</code>, the following are true:</p>

<ul>
<li>
<p><code>$offset</code> can be negative, in which case replacements begin that number of characters from the <em>end</em> of the string.</p>
</li>
<li>
<p><code>$length</code> can be negative, representing the number of characters from the end of the string at which to stop replacing.</p>
</li>
<li>
<p>If <code>$length</code> is <code>null</code>, it will internally become the same as the length of the input string itself.</p>
</li>
<li>
<p>If <code>length</code> is <code>0</code>, <code>$replace</code> will be <em>inserted</em> into the string at the given <code>$offset</code>, and no replacement will take place at all.</p>
</li>
</ul>

<p>Finally, if <code>$string</code> is provided as an array, all other parameters can be provided as arrays as well. Each element will represent a setting for the string in the same position in <code>$string</code>, as <a data-type="indexterm" data-primary="strings" data-secondary="substrings" data-tertiary="replacing with parameters" id="idm45875186315984"></a><a data-type="indexterm" data-primary="substrings" data-secondary="replacing" data-tertiary="with array parameters" id="idm45875186314736"></a>illustrated by <a data-type="xref" href="#replace_with_array_parameters">Example 4-11</a>.</p>
<div id="replace_with_array_parameters" data-type="example">
<h5><span class="label">Example 4-11. </span>Replacing multiple substrings with array parameters</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$phones</code> <code class="o">=</code> <code class="p">[</code>
    <code class="s1">'555-555-5555'</code><code class="p">,</code>
    <code class="s1">'555-123-1234'</code><code class="p">,</code>
    <code class="s1">'555-991-9955'</code>
<code class="p">];</code>

<code class="nv">$offsets</code> <code class="o">=</code> <code class="p">[</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">4</code><code class="p">];</code>

<code class="nv">$replace</code> <code class="o">=</code> <code class="p">[</code>
    <code class="s1">'xxx-xxx'</code><code class="p">,</code>
    <code class="s1">'xxx-xxx'</code><code class="p">,</code>
    <code class="s1">'xxx-xxxx'</code>
<code class="p">];</code>

<code class="nv">$lengths</code> <code class="o">=</code> <code class="p">[</code><code class="mi">7</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">8</code><code class="p">];</code>

<code class="nv">$obfuscated</code> <code class="o">=</code> <code class="nb">substr_replace</code><code class="p">(</code><code class="nv">$phones</code><code class="p">,</code> <code class="nv">$replace</code><code class="p">,</code> <code class="nv">$offsets</code><code class="p">,</code> <code class="nv">$lengths</code><code class="p">);</code>

<code class="c1">// xxx-xxx-5555</code>
<code class="c1">// xxx-xxx-1234</code>
<code class="c1">// 555-xxx-xxxx</code></pre></div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>It is not a hard requirement for arrays passed in for <code>$string</code>, <code>$replace</code>, <code>$offset</code>, and <code>$length</code> to be all of the same size. PHP will not throw an error or warning if you pass arrays with different dimensions. Doing so will, however, result in unexpected output during the replacement operation—for example, truncating a string rather than replacing its contents. It’s a good idea to validate that the dimensions of each of these four arrays all match.</p>
</div>

<p>The <code>substr_replace()</code> function is convenient if you <a data-type="indexterm" data-primary="substr_replace() function" data-startref="sbsrpcfc" id="idm45875186067536"></a><a data-type="indexterm" data-primary="functions" data-secondary="substr_replace()" data-startref="fcgbrpl" id="idm45875186066592"></a>know exactly <em>where</em> you need to replace characters within a string. In some situations, you might not know the position of a substring that needs to be replaced, but you want to instead replace occurrences of a <em>specific</em> substring. In those circumstances, you would want to use either <code>str_replace()</code> or <code>str_ireplace()</code>.</p>

<p>These two functions will search a specified string to find an occurrence (or many occurrences) of a specified substring and replace it with something else. The functions are identical in their call pattern, but the extra <code>i</code> in <code>str_ireplace()</code> indicates that it <a data-type="indexterm" data-primary="searches, case-insensitive" id="idm45875186062144"></a><a data-type="indexterm" data-primary="case-insensitive searches" id="idm45875186061440"></a>searches for a pattern in a <em>case-insensitive</em> fashion. <a data-type="xref" href="#string_search_and_replace">Example 4-12</a> illustrates both functions in use.</p>
<div id="string_search_and_replace" data-type="example">
<h5><span class="label">Example 4-12. </span>Searching and replacing within a string</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$string</code><code> </code><code class="o">=</code><code> </code><code class="s1">'How much wood could a Woodchuck chuck if a woodchuck could chuck wood?'</code><code class="p">;</code><code>

</code><code class="nv">$beaver</code><code> </code><code class="o">=</code><code> </code><code class="nb">str_replace</code><code class="p">(</code><code class="s1">'woodchuck'</code><code class="p">,</code><code> </code><code class="s1">'beaver'</code><code class="p">,</code><code> </code><code class="nv">$string</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO6-1" href="#callout_strings_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$ibeaver</code><code> </code><code class="o">=</code><code> </code><code class="nb">str_ireplace</code><code class="p">(</code><code class="s1">'woodchuck'</code><code class="p">,</code><code> </code><code class="s1">'beaver'</code><code class="p">,</code><code> </code><code class="nv">$string</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO6-2" href="#callout_strings_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO6-1" href="#co_strings_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><em>How much wood could a Woodchuck chuck if a beaver could chuck wood?</em></p></dd>
<dt><a class="co" id="callout_strings_CO6-2" href="#co_strings_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><em>How much wood could a beaver chuck if a beaver could chuck wood?</em></p></dd>
</dl></div>

<p>Both <code>str_replace()</code> and <code>str_ireplace()</code> accept an optional <code>$count</code> parameter that is passed by reference. If specified, this variable will be updated with the number of replacements the function performed. In <a data-type="xref" href="#string_search_and_replace">Example 4-12</a>, this return value would have been <code>1</code> and <code>2</code>, respectively, because of the <a data-type="indexterm" data-primary="strings" data-secondary="replacing part" data-startref="strgrp" id="idm45875186019216"></a>capitalization of <code>Woodchuck</code>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875187533216">
<h2>See Also</h2>

<p>PHP documentation on <a href="https://oreil.ly/-BSkA"><code>substr_replace()</code></a>, <a href="https://oreil.ly/Vm7KH"><code>str_replace()</code></a>, and <a href="https://oreil.ly/8P46w"><code>str_ireplace()</code></a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.4 Processing a String One Byte at a Time"><div class="sect1" id="idm45875185984544">
<h1>4.4 Processing a String One Byte at a Time</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875185983296">
<h2>Problem</h2>

<p>You need to process a string <a data-type="indexterm" data-primary="strings" data-secondary="character-by-character processing" id="strcbcp"></a><a data-type="indexterm" data-primary="character-by-character string processing" id="cbcsgo"></a>of single-byte characters from beginning to end, one character at a time.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875185979360">
<h2>Solution</h2>

<p>Loop through each character of the string as if it were an array. <a data-type="xref" href="#count_capital_characters">Example 4-13</a> will count the <a data-type="indexterm" data-primary="strings" data-secondary="capital characters, counting" id="idm45875185977216"></a>number of capital letters in a string.</p>
<div id="count_capital_characters" data-type="example">
<h5><span class="label">Example 4-13. </span>Count capital characters in a string</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$capitals</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

<code class="nv">$string</code> <code class="o">=</code> <code class="s1">'The Carriage held but just Ourselves - And Immortality'</code><code class="p">;</code>
<code class="k">for</code> <code class="p">(</code><code class="nv">$i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$i</code> <code class="o">&lt;</code> <code class="nb">strlen</code><code class="p">(</code><code class="nv">$string</code><code class="p">);</code> <code class="nv">$i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nb">ctype_upper</code><code class="p">(</code><code class="nv">$string</code><code class="p">[</code><code class="nv">$i</code><code class="p">]))</code> <code class="p">{</code>
        <code class="nv">$capitals</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="c1">// $capitals = 5</code></pre></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875185963408">
<h2>Discussion</h2>

<p>Strings are not arrays in PHP, so you cannot loop over them directly. However, they do provide array-like access to individual characters within the string based on their position. You can reference individual characters by their integer offset (starting with 0), or even by a <em>negative</em> offset <a data-type="indexterm" data-primary="strings" data-secondary="integer offset" id="idm45875186164832"></a><a data-type="indexterm" data-primary="strings" data-secondary="negative offset" id="idm45875186163824"></a>to start at the end of the string.</p>

<p>Array-like access isn’t read-only, though. You can just as easily <em>replace</em> a single character in a string based on its <a data-type="indexterm" data-primary="strings" data-secondary="characters, replacing" id="idm45875186161952"></a>position, as demonstrated by <a data-type="xref" href="#replace_single_character_in_string">Example 4-14</a>.</p>
<div id="replace_single_character_in_string" data-type="example">
<h5><span class="label">Example 4-14. </span>Replacing a single character in a string</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$string</code> <code class="o">=</code> <code class="s1">'A new recipe made my coffee stronger this morning'</code><code class="p">;</code>
<code class="nv">$string</code><code class="p">[</code><code class="mi">31</code><code class="p">]</code> <code class="o">=</code> <code class="s1">'a'</code><code class="p">;</code>

<code class="c1">// A new recipe made my coffee stranger this morning</code></pre></div>

<p>It is also possible to convert <a data-type="indexterm" data-primary="strings" data-secondary="converting to arrays" id="idm45875186148800"></a>a string <em>directly</em> to an array by using <a href="https://oreil.ly/eNxaF"><code>str_split()</code></a> and then iterate over all items in the resulting array. This will work as an update to the Solution example, as illustrated in <a data-type="xref" href="#str_split_array">Example 4-15</a>.</p>
<div id="str_split_array" data-type="example">
<h5><span class="label">Example 4-15. </span>Converting a string into an array directly</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$capitals</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

<code class="nv">$string</code> <code class="o">=</code> <code class="s1">'The Carriage held but just Ourselves - And Immortality'</code><code class="p">;</code>
<code class="nv">$stringArray</code> <code class="o">=</code> <code class="nb">str_split</code><code class="p">(</code><code class="nv">$string</code><code class="p">);</code>
<code class="k">foreach</code> <code class="p">(</code><code class="nv">$stringArray</code> <code class="k">as</code> <code class="nv">$char</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nb">ctype_upper</code><code class="p">(</code><code class="nv">$char</code><code class="p">))</code> <code class="p">{</code>
        <code class="nv">$capitals</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="c1">// $capitals = 5</code></pre></div>

<p>The downside of <a data-type="xref" href="#str_split_array">Example 4-15</a> is that PHP now has to maintain <em>two</em> copies of your data: the original string and the resultant array. This isn’t a problem when handling small strings as in the example; if your strings instead represent entire files on disk, you will rapidly exhaust the memory available to PHP.</p>

<p>PHP makes accessing individual bytes (characters) within a string relatively easy without any changes in data type. Splitting a string into an array works but might be unnecessary unless you actually <em>need</em> an array of characters. <a data-type="xref" href="#str_split_reduce">Example 4-16</a> reimagines <a data-type="xref" href="#str_split_array">Example 4-15</a>, using an array reduction technique rather than counting the capital letters in a string directly.</p>
<div id="str_split_reduce" data-type="example">
<h5><span class="label">Example 4-16. </span>Counting capital letters in a string with array reduction</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$str</code> <code class="o">=</code> <code class="s1">'The Carriage held but just Ourselves - And Immortality'</code><code class="p">;</code>

<code class="nv">$caps</code> <code class="o">=</code> <code class="nb">array_reduce</code><code class="p">(</code><code class="nb">str_split</code><code class="p">(</code><code class="nv">$str</code><code class="p">),</code> <code class="nx">fn</code><code class="p">(</code><code class="nv">$c</code><code class="p">,</code> <code class="nv">$i</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nb">ctype_upper</code><code class="p">(</code><code class="nv">$i</code><code class="p">)</code> <code class="o">?</code> <code class="nv">$c</code><code class="o">+</code><code class="mi">1</code><code class="o">:</code> <code class="nv">$c</code><code class="p">,</code> <code class="mi">0</code><code class="p">);</code></pre></div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>While <a data-type="xref" href="#str_split_reduce">Example 4-16</a> is functionally equivalent to <a data-type="xref" href="#str_split_array">Example 4-15</a>, it is more concise and, consequently, more difficult to understand. While it is tempting to reimagine complex logic as one-line functions, unnecessary refactoring of your code for the sake of conciseness can be dangerous. The code might appear elegant but over time becomes more difficult to maintain.</p>
</div>

<p>The simplified reduction introduced in <a data-type="xref" href="#str_split_reduce">Example 4-16</a> is functionally accurate but still requires splitting the string into an array. It saves on lines of code in your program but still results in creating a second copy of your data. As mentioned before, if the strings over which you’re iterating are large (e.g., massive binary files), this <a data-type="indexterm" data-primary="strings" data-secondary="character-by-character processing" data-startref="strcbcp" id="idm45875190753872"></a><a data-type="indexterm" data-primary="character-by-character string processing" data-startref="cbcsgo" id="idm45875190752688"></a>will rapidly consume the memory available to PHP.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875186166192">
<h2>See Also</h2>

<p>PHP documentation on <a href="https://oreil.ly/8MOWh">string access and modification</a>, as well as documentation on <a href="https://oreil.ly/bQctH"><code>ctype_upper()</code></a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.5 Generating Random Strings"><div class="sect1" id="idm45875190748560">
<h1>4.5 Generating Random Strings</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875190747312">
<h2>Problem</h2>

<p>You want to generate a <a data-type="indexterm" data-primary="strings" data-secondary="generating random" id="stggrm"></a><a data-type="indexterm" data-primary="random strings, generating" id="rdstgg"></a>string of random characters.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875190743408">
<h2>Solution</h2>

<p>Use PHP’s native <code>random_int()</code> function:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">random_string</code><code class="p">(</code><code class="nv">$length</code> <code class="o">=</code> <code class="mi">16</code><code class="p">)</code>
<code class="p">{</code>
    <code class="nv">$characters</code> <code class="o">=</code> <code class="s1">'0123456789abcdefghijklmnopqrstuvwxyz'</code><code class="p">;</code>

    <code class="nv">$string</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>
    <code class="k">while</code> <code class="p">(</code><code class="nb">strlen</code><code class="p">(</code><code class="nv">$string</code><code class="p">)</code> <code class="o">&lt;</code> <code class="nv">$length</code><code class="p">)</code> <code class="p">{</code>
        <code class="nv">$string</code> <code class="o">.=</code> <code class="nv">$characters</code><code class="p">[</code><code class="nb">random_int</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="nb">strlen</code><code class="p">(</code><code class="nv">$characters</code><code class="p">)</code> <code class="o">-</code> <code class="mi">1</code><code class="p">)];</code>
    <code class="p">}</code>
    <code class="k">return</code> <code class="nv">$string</code><code class="p">;</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875190682928">
<h2>Discussion</h2>

<p>PHP has strong, <em>cryptographically secure</em> pseudorandom <a data-type="indexterm" data-primary="cryptographically secure pseudorandom number generator" id="idm45875190692400"></a>generator functions for both integers and bytes. It does not have a native function that generates random human-readable text, but the underlying functions can be used to create such a string of random text by leveraging lists of human-readable characters, as illustrated by the Solution example.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A <em>cryptographically secure pseudorandom number generator</em> is a function that returns numbers with no distinguishable or predictable pattern. Even forensic analysis cannot distinguish between random noise and the output of a cryptographically secure generator.</p>
</div>

<p>A valid and potentially simpler method for producing random strings is to leverage PHP’s <code>random_bytes()</code> function <a data-type="indexterm" data-primary="random_bytes() function" id="idm45875190689136"></a><a data-type="indexterm" data-primary="functions" data-secondary="random_bytes()" id="idm45875190688400"></a>and encode the binary output as ASCII text. <a data-type="xref" href="#random_byte_string">Example 4-17</a> illustrates two possible methods of using random bytes as a string.</p>
<div id="random_byte_string" data-type="example">
<h5><span class="label">Example 4-17. </span>Creating a string of random bytes</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$string</code><code> </code><code class="o">=</code><code> </code><code class="nb">random_bytes</code><code class="p">(</code><code class="mi">16</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO7-1" href="#callout_strings_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

</code><code class="nv">$hex</code><code> </code><code class="o">=</code><code> </code><code class="nb">bin2hex</code><code class="p">(</code><code class="nv">$string</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO7-2" href="#callout_strings_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">$base64</code><code> </code><code class="o">=</code><code> </code><code class="nb">base64_encode</code><code class="p">(</code><code class="nv">$string</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO7-3" href="#callout_strings_CO7-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO7-1" href="#co_strings_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Because the string of binary bytes will be encoded in a different format, keep in mind that the number of bytes produced will <em>not</em> match the length of the final string.</p></dd>
<dt><a class="co" id="callout_strings_CO7-2" href="#co_strings_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Encode the random string in hexadecimal format. Note that this format will double the length of the string—16 bytes is equivalent to 32 hexadecimal characters.</p></dd>
<dt><a class="co" id="callout_strings_CO7-3" href="#co_strings_CO7-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Leverage <a href="https://oreil.ly/NsyVs">Base64</a> encoding to convert the raw bytes on readable characters. Note that <a data-type="indexterm" data-primary="strings" data-secondary="generating random" data-startref="stggrm" id="idm45875190610288"></a><a data-type="indexterm" data-primary="random strings, generating" data-startref="rdstgg" id="idm45875190554400"></a>this format increases the length of the string by 33%–36%.</p></dd>
</dl></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875190553104">
<h2>See Also</h2>

<p>PHP documentation on <a href="https://oreil.ly/g3gAR"><code>random_int()</code></a> and on <a href="https://oreil.ly/2Zbio"><code>random_bytes()</code></a>. Also <a data-type="xref" href="ch05.html#recipe_random_numbers">Recipe 5.4</a> on generating random numbers.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.6 Interpolating Variables Within a String"><div class="sect1" id="idm45875190549168">
<h1>4.6 Interpolating Variables Within a String</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875190547952">
<h2>Problem</h2>

<p>You want to include dynamic <a data-type="indexterm" data-primary="strings" data-secondary="variables, interpolating" id="sgvbpl"></a><a data-type="indexterm" data-primary="variables" data-secondary="interpolating" id="vblplt"></a><a data-type="indexterm" data-primary="interpolation" data-secondary="string variables" id="iplsvb"></a>content in an otherwise static string.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875190542544">
<h2>Solution</h2>

<p>Use double quotes to wrap the string <a data-type="indexterm" data-primary="strings" data-secondary="double-quoted" id="idm45875190541200"></a><a data-type="indexterm" data-primary="double-quoted strings" id="idm45875190540224"></a>and insert a variable, object property, or even function/method call directly in the string itself:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">echo</code> <code class="s2">"There are </code><code class="si">{</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'cats'</code><code class="p">]</code><code class="si">}</code><code class="s2"> cats and </code><code class="si">{</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'dogs'</code><code class="p">]</code><code class="si">}</code><code class="s2"> outside."</code><code class="p">;</code>
<code class="k">echo</code> <code class="s2">"Your username is {strlen(</code><code class="si">$username</code><code class="s2">)} characters long."</code><code class="p">;</code>
<code class="k">echo</code> <code class="s2">"The car is painted </code><code class="si">{</code><code class="nv">$car</code><code class="o">-&gt;</code><code class="na">color</code><code class="si">}</code><code class="s2">."</code><code class="p">;</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875190513072">
<h2>Discussion</h2>

<p>Unlike single-quoted strings, double-quoted strings allow for complex, dynamic values as literals. Any word starting with a <code>$</code> character is interpreted as a variable name, unless that leading character is properly escaped.<sup><a data-type="noteref" id="idm45875190506912-marker" href="ch04.html#idm45875190506912">2</a></sup></p>

<p>While the Solution example wraps dynamic content in curly braces, this is not a requirement in PHP. Simple variables can easily be written as is within a double-quoted string and will be interpolated properly. However, more complex sequences become difficult to read without the braces. It’s a highly recommended best practice to always enclose any value you want interpolated to make the string more readable.</p>

<p>Unfortunately, string interpolation has its limits. The Solution example illustrates pulling data out of the superglobal <code>$_POST</code> array and inserting it directly into a string. This is potentially dangerous, as that content is generated directly by the user, and the string could be leveraged in a sensitive way. In fact, string interpolation like this is one of the largest vectors for injection attacks against applications.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In an injection attack, a third party can pass (or inject) executable or otherwise malicious input into your application and cause it to misbehave. More sophisticated ways to protect against this family of attacks are covered in <a data-type="xref" href="ch09.html#chapter_encryption">Chapter 9</a>.</p>
</div>

<p>To protect your string use against potentially malicious user-generated input, it’s a good idea to <a data-type="indexterm" data-primary="sprintf() function" id="idm45875190501840"></a><a data-type="indexterm" data-primary="functions" data-secondary="sprintf()" id="idm45875190343536"></a>instead use a format string via PHP’s <code>sprintf()</code> function to filter the content. <a data-type="xref" href="#interpolation_sprintf">Example 4-18</a> rewrites part of the Solution example to protect against malicious <code>$_POST</code> data.</p>
<div id="interpolation_sprintf" data-type="example">
<h5><span class="label">Example 4-18. </span>Using format strings to produce an interpolated string</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">echo</code> <code class="nb">sprintf</code><code class="p">(</code><code class="s1">'There are %d cats and %d dogs.'</code><code class="p">,</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'cats'</code><code class="p">],</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'dogs'</code><code class="p">]);</code></pre></div>

<p>Format strings are a basic form of <a data-type="indexterm" data-primary="input sanitization, format strings" id="idm45875190332992"></a>input sanitization in PHP. In <a data-type="xref" href="#interpolation_sprintf">Example 4-18</a>, you are explicitly assuming that the supplied <code>$_POST</code> data is numeric. The <code>%d</code> tokens within the format string will be replaced by the user-supplied data, but PHP will explicitly cast this data as integers during the replacement.</p>

<p>If, for example, this string were being inserted into a database, the formatting would protect against the potential of injection attacks against SQL interfaces. More complete methods of filtering and <a data-type="indexterm" data-primary="strings" data-secondary="variables, interpolating" data-startref="sgvbpl" id="idm45875190314768"></a><a data-type="indexterm" data-primary="variables" data-secondary="interpolating" data-startref="vblplt" id="idm45875190313552"></a><a data-type="indexterm" data-primary="interpolation" data-secondary="string variables" data-startref="iplsvb" id="idm45875190312336"></a>sanitizing user input are discussed in <a data-type="xref" href="ch09.html#chapter_encryption">Chapter 9</a>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875190310064">
<h2>See Also</h2>

<p>PHP documentation on <a href="https://oreil.ly/CAj-J">variable parsing</a> in double quotes and Heredoc as well as documentation on the <a href="https://oreil.ly/DMAg6"><code>sprintf()</code> function</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.7 Concatenating Multiple Strings Together"><div class="sect1" id="idm45875190306784">
<h1>4.7 Concatenating Multiple Strings Together</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875190305504">
<h2>Problem</h2>

<p>You need to create a new string <a data-type="indexterm" data-primary="strings" data-secondary="concatenation" id="sgscctn"></a><a data-type="indexterm" data-primary="concatenation" id="cctntn"></a>from two smaller strings.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875190301600">
<h2>Solution</h2>

<p>Use PHP’s string concatenation operator:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$first</code> <code class="o">=</code> <code class="s1">'To be or not to be'</code><code class="p">;</code>
<code class="nv">$second</code> <code class="o">=</code> <code class="s1">'That is the question'</code><code class="p">;</code>

<code class="nv">$line</code> <code class="o">=</code> <code class="nv">$first</code> <code class="o">.</code> <code class="s1">' '</code> <code class="o">.</code> <code class="nv">$second</code><code class="p">;</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875190242480">
<h2>Discussion</h2>

<p>PHP uses a single <code>.</code> character to join two strings together. This operator will also leverage type coercion to ensure that both values in the operation are strings before they’re concatenated, as shown in <a data-type="xref" href="#string_concatenation_examples">Example 4-19</a>.</p>
<div id="string_concatenation_examples" data-type="example">
<h5><span class="label">Example 4-19. </span>String concatenation</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">print</code><code> </code><code class="s1">'String '</code><code> </code><code class="o">.</code><code> </code><code class="mi">2</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO8-1" href="#callout_strings_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="k">print</code><code> </code><code class="mi">2</code><code> </code><code class="o">.</code><code> </code><code class="s1">' number'</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO8-2" href="#callout_strings_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="k">print</code><code> </code><code class="s1">'Boolean '</code><code> </code><code class="o">.</code><code> </code><code class="k">true</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO8-3" href="#callout_strings_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="k">print</code><code> </code><code class="mi">2</code><code> </code><code class="o">.</code><code> </code><code class="mi">3</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO8-4" href="#callout_strings_CO8-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO8-1" href="#co_strings_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Prints <code>String 2</code></p></dd>
<dt><a class="co" id="callout_strings_CO8-2" href="#co_strings_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Prints <code>2 number</code></p></dd>
<dt><a class="co" id="callout_strings_CO8-3" href="#co_strings_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Prints <code>Boolean 1</code> because Boolean values are cast to integers and then to strings</p></dd>
<dt><a class="co" id="callout_strings_CO8-4" href="#co_strings_CO8-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Prints <code>23</code></p></dd>
</dl></div>

<p>The string concatenation operator is a quick way to combine simple strings, but it can become somewhat verbose if you use it to combine <a data-type="indexterm" data-primary="concatenation" data-secondary="verbosity" id="idm45875190433136"></a><a data-type="indexterm" data-primary="verbosity, concatenation" id="idm45875190432192"></a>multiple strings with whitespace. Consider <a data-type="xref" href="#string_concatenation_verbose">Example 4-20</a>, where you try to combine a list of words into a string, each separated by a space.</p>
<div id="string_concatenation_verbose" data-type="example">
<h5><span class="label">Example 4-20. </span>Verbosity in concatenating large groups of strings</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$words</code><code> </code><code class="o">=</code><code> </code><code class="p">[</code><code>
    </code><code class="s1">'Whose'</code><code class="p">,</code><code>
    </code><code class="s1">'woods'</code><code class="p">,</code><code>
    </code><code class="s1">'these'</code><code class="p">,</code><code>
    </code><code class="s1">'are'</code><code class="p">,</code><code>
    </code><code class="s1">'I'</code><code class="p">,</code><code>
    </code><code class="s1">'think'</code><code class="p">,</code><code>
    </code><code class="s1">'I'</code><code class="p">,</code><code>
    </code><code class="s1">'know'</code><code>
</code><code class="p">];</code><code>

</code><code class="nv">$option1</code><code> </code><code class="o">=</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><code class="o">.</code><code> </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">.</code><code> </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code> </code><code class="o">.</code><code> </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code> </code><code class="o">.</code><code>
         </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code> </code><code class="o">.</code><code> </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code> </code><code class="o">.</code><code> </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code> </code><code class="o">.</code><code>
         </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$words</code><code class="p">[</code><code class="mi">7</code><code class="p">];</code><code> </code><a class="co" id="co_strings_CO9-1" href="#callout_strings_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

</code><code class="nv">$option2</code><code> </code><code class="o">=</code><code> </code><code class="s1">''</code><code class="p">;</code><code>
</code><code class="k">foreach</code><code> </code><code class="p">(</code><code class="nv">$words</code><code> </code><code class="k">as</code><code> </code><code class="nv">$word</code><code class="p">)</code><code> </code><code class="p">{</code><code>
    </code><code class="nv">$option2</code><code> </code><code class="o">.=</code><code> </code><code class="s1">' '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$word</code><code class="p">;</code><code> </code><a class="co" id="co_strings_CO9-2" href="#callout_strings_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">}</code><code>
</code><code class="nv">$option2</code><code> </code><code class="o">=</code><code> </code><code class="nb">ltrim</code><code class="p">(</code><code class="nv">$option2</code><code class="p">);</code><code> </code><a class="co" id="co_strings_CO9-3" href="#callout_strings_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_strings_CO9-1" href="#co_strings_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>One option is to individually concatenate each word in the collection with whitespace separators. As the word list grows, this quickly becomes unwieldy.</p></dd>
<dt><a class="co" id="callout_strings_CO9-2" href="#co_strings_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>You can, instead, loop over the collection and build up a concatenated string without accessing each item in the collection individually.</p></dd>
<dt><a class="co" id="callout_strings_CO9-3" href="#co_strings_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>When using a loop, you might end up with unnecessary whitespace. You need to remember to trim extraneous spaces from the start of the string.</p></dd>
</dl></div>

<p>Large, repetitive concatenation routines can be replaced by native PHP functions like <code>implode()</code>. This <a data-type="indexterm" data-primary="implode() function" id="idm45875174023616"></a><a data-type="indexterm" data-primary="functions" data-secondary="implode()" id="idm45875174022880"></a>function in particular accepts an array of data to be joined and a 
<span class="keep-together">definition</span> of the character (or characters) to be used between data elements. It returns the final, concatenated string.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Some developers prefer to use <code>join()</code> instead <a data-type="indexterm" data-primary="join() function" id="idm45875173973296"></a><a data-type="indexterm" data-primary="functions" data-secondary="join()" id="idm45875173972688"></a>of <code>implode()</code> as it’s seen to be a more descriptive name for the operation. The fact is, <code>join()</code> is an alias of <code>implode()</code>, and the PHP compiler doesn’t care which you use.</p>
</div>

<p>Rewriting <a data-type="xref" href="#string_concatenation_verbose">Example 4-20</a> to use <code>implode()</code> makes the entire operation much simpler, as demonstrated by <a data-type="xref" href="#string_concatenation_terse">Example 4-21</a>.</p>
<div id="string_concatenation_terse" data-type="example">
<h5><span class="label">Example 4-21. </span>A concise approach to string concatenation</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$words</code> <code class="o">=</code> <code class="p">[</code>
    <code class="s1">'Whose'</code><code class="p">,</code>
    <code class="s1">'woods'</code><code class="p">,</code>
    <code class="s1">'these'</code><code class="p">,</code>
    <code class="s1">'are'</code><code class="p">,</code>
    <code class="s1">'I'</code><code class="p">,</code>
    <code class="s1">'think'</code><code class="p">,</code>
    <code class="s1">'I'</code><code class="p">,</code>
    <code class="s1">'know'</code>
<code class="p">];</code>

<code class="nv">$string</code> <code class="o">=</code> <code class="nb">implode</code><code class="p">(</code><code class="s1">' '</code><code class="p">,</code> <code class="nv">$words</code><code class="p">);</code></pre></div>

<p>Take care to remember the parameter order for <code>implode()</code>. The string separator comes <em>first</em>, followed by the array over which you want to iterate. Earlier versions of PHP (prior to version 8.0) allowed the parameters to be specified in the opposite order. This behavior (specifying the array first and the separator second) was deprecated in PHP 7.4. As of PHP 8.0, this will throw a <code>TypeError</code>.</p>

<p>If you’re using a library written prior to PHP 8.0, be <a data-type="indexterm" data-primary="strings" data-secondary="concatenation" data-startref="sgscctn" id="idm45875173935328"></a><a data-type="indexterm" data-primary="concatenation" data-startref="cctntn" id="idm45875173934112"></a>sure you test that it’s not misusing either <code>implode()</code> or <code>join()</code> before you ship your project to production.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875173931952">
<h2>See Also</h2>

<p>PHP documentation on <a href="https://oreil.ly/bGYt0"><code>implode()</code></a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.8 Managing Binary Data Stored in Strings"><div class="sect1" id="idm45875173913264">
<h1>4.8 Managing Binary Data Stored in Strings</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875173912016">
<h2>Problem</h2>

<p>You want to encode data directly <a data-type="indexterm" data-primary="strings" data-secondary="binary data" id="sgbnd"></a><a data-type="indexterm" data-primary="binary data in strings" id="bnydsg"></a>as binary rather than as an ASCII-formatted representation, or you want to read data into your application that was explicitly encoded as binary data.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875173908112">
<h2>Solution</h2>

<p>Use <code>unpack()</code> to extract binary data from a string:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$unpacked</code> <code class="o">=</code> <code class="nb">unpack</code><code class="p">(</code><code class="s1">'S1'</code><code class="p">,</code> <code class="s1">'Hi'</code><code class="p">);</code> <code class="c1">// [1 =&gt; 26952]</code></pre>

<p>Use <code>pack()</code> to write binary data to a string:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$packed</code> <code class="o">=</code> <code class="nb">pack</code><code class="p">(</code><code class="s1">'S13'</code><code class="p">,</code> <code class="mi">72</code><code class="p">,</code> <code class="mi">101</code><code class="p">,</code> <code class="mi">108</code><code class="p">,</code> <code class="mi">108</code><code class="p">,</code> <code class="mi">111</code><code class="p">,</code> <code class="mi">44</code><code class="p">,</code> <code class="mi">32</code><code class="p">,</code> <code class="mi">119</code><code class="p">,</code> <code class="mi">111</code><code class="p">,</code>
               <code class="mi">114</code><code class="p">,</code> <code class="mi">108</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">33</code><code class="p">);</code> <code class="c1">// 'Hello, world!'</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875173807104">
<h2>Discussion</h2>

<p>Both <code>pack()</code> and <code>unpack()</code> empower you to <a data-type="indexterm" data-primary="unpack() function" id="idm45875173790720"></a><a data-type="indexterm" data-primary="functions" data-secondary="unpack()" id="idm45875173789984"></a><a data-type="indexterm" data-primary="pack() function" id="idm45875173789040"></a><a data-type="indexterm" data-primary="functions" data-secondary="pack()" id="idm45875173788368"></a>operate on raw binary strings, assuming you know the format of the binary string you’re working with. The first parameter of each function is a format specification. This specification is determined by specific format codes, as defined in <a data-type="xref" href="#binary_format_codes">Table 4-2</a>.</p>
<table id="binary_format_codes">
<caption><span class="label">Table 4-2. </span>Binary format string codes</caption>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>a</code></p></td>
<td><p>Null-padded string</p></td>
</tr>
<tr>
<td><p><code>A</code></p></td>
<td><p>Space-padded string</p></td>
</tr>
<tr>
<td><p><code>h</code></p></td>
<td><p>Hex string, low nibble first</p></td>
</tr>
<tr>
<td><p><code>H</code></p></td>
<td><p>Hex string, high nibble first</p></td>
</tr>
<tr>
<td><p><code>c</code></p></td>
<td><p>Signed char</p></td>
</tr>
<tr>
<td><p><code>C</code></p></td>
<td><p>Unsigned char</p></td>
</tr>
<tr>
<td><p><code>s</code></p></td>
<td><p>Signed short (always 16-bit, machine byte order)</p></td>
</tr>
<tr>
<td><p><code>S</code></p></td>
<td><p>Unsigned short (always 16-bit, machine byte order)</p></td>
</tr>
<tr>
<td><p><code>n</code></p></td>
<td><p>Unsigned short (always 16-bit, big-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>v</code></p></td>
<td><p>Unsigned short (always 16-bit, little-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>i</code></p></td>
<td><p>Signed integer (machine-dependent size and byte order)</p></td>
</tr>
<tr>
<td><p><code>I</code></p></td>
<td><p>Unsigned integer (machine-dependent size and byte order)</p></td>
</tr>
<tr>
<td><p><code>l</code></p></td>
<td><p>Signed long (always 32-bit, machine byte order)</p></td>
</tr>
<tr>
<td><p><code>L</code></p></td>
<td><p>Unsigned long (always 32-bit, machine byte order)</p></td>
</tr>
<tr>
<td><p><code>N</code></p></td>
<td><p>Unsigned long (always 32-bit, big-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>V</code></p></td>
<td><p>Unsigned long (always 32-bit, little-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>q</code></p></td>
<td><p>Signed long long (always 64-bit, machine byte order)</p></td>
</tr>
<tr>
<td><p><code>Q</code></p></td>
<td><p>Unsigned long long (always 64-bit, machine byte order)</p></td>
</tr>
<tr>
<td><p><code>J</code></p></td>
<td><p>Unsigned long long (always 64-bit, big-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>P</code></p></td>
<td><p>Unsigned long long (always 64-bit, little-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>f</code></p></td>
<td><p>Float (machine-dependent size and representation)</p></td>
</tr>
<tr>
<td><p><code>g</code></p></td>
<td><p>Float (machine-dependent size, little-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>G</code></p></td>
<td><p>Float (machine-dependent size, big-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>d</code></p></td>
<td><p>Double (machine-dependent size and representation)</p></td>
</tr>
<tr>
<td><p><code>e</code></p></td>
<td><p>Double (machine-dependent size, little-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>E</code></p></td>
<td><p>Double (machine-dependent size, big-endian byte order)</p></td>
</tr>
<tr>
<td><p><code>x</code></p></td>
<td><p>Null byte</p></td>
</tr>
<tr>
<td><p><code>X</code></p></td>
<td><p>Back up one byte</p></td>
</tr>
<tr>
<td><p><code>Z</code></p></td>
<td><p>Null-padded string</p></td>
</tr>
<tr>
<td><p><code>@</code></p></td>
<td><p>Null-fill to absolute position</p></td>
</tr>
</tbody>
</table>

<p>When defining a format string, you can specify each byte type individually or leverage an optional repeating character. In the Solution examples, the number of bytes is explicitly specified with an integer. You could just as easily use an asterisk (<code>*</code>) to specify that a type of byte repeats through the end of the string as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$unpacked</code> <code class="o">=</code> <code class="nb">unpack</code><code class="p">(</code><code class="s1">'S*'</code><code class="p">,</code> <code class="s1">'Hi'</code><code class="p">);</code> <code class="c1">// [1 =&gt; 26952]</code>
<code class="nv">$packed</code> <code class="o">=</code> <code class="nb">pack</code><code class="p">(</code><code class="s1">'S*'</code><code class="p">,</code> <code class="mi">72</code><code class="p">,</code> <code class="mi">101</code><code class="p">,</code> <code class="mi">108</code><code class="p">,</code> <code class="mi">108</code><code class="p">,</code> <code class="mi">111</code><code class="p">,</code> <code class="mi">44</code><code class="p">,</code> <code class="mi">32</code><code class="p">,</code> <code class="mi">119</code><code class="p">,</code> <code class="mi">111</code><code class="p">,</code>
               <code class="mi">114</code><code class="p">,</code> <code class="mi">108</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">33</code><code class="p">);</code> <code class="c1">// 'Hello, world!'</code></pre>

<p>PHP’s ability to convert between byte encoding types via <code>unpack()</code> also provides a simple method of converting ASCII characters to and from their binary equivalent. The <code>ord()</code> function will return the value of a specific character, but it requires looping over each character in a string if you want to unpack each in turn, as demonstrated in <a data-type="xref" href="#character_encoding_with_ord">Example 4-22</a>.</p>
<div id="character_encoding_with_ord" data-type="example">
<h5><span class="label">Example 4-22. </span>Retrieving character values with <code>ord()</code></h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$ascii</code> <code class="o">=</code> <code class="s1">'PHP Cookbook'</code><code class="p">;</code>

<code class="nv">$chars</code> <code class="o">=</code> <code class="p">[];</code>
<code class="k">for</code> <code class="p">(</code><code class="nv">$i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$i</code> <code class="o">&lt;</code> <code class="nb">strlen</code><code class="p">(</code><code class="nv">$ascii</code><code class="p">);</code> <code class="nv">$i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="nv">$chars</code><code class="p">[]</code> <code class="o">=</code> <code class="nb">ord</code><code class="p">(</code><code class="nv">$ascii</code><code class="p">[</code><code class="nv">$i</code><code class="p">]);</code>
<code class="p">}</code>

<code class="nb">var_dump</code><code class="p">(</code><code class="nv">$chars</code><code class="p">);</code></pre></div>

<p>Thanks to <code>unpack()</code>, you don’t need to explicitly iterate over the characters in a string. The <code>c</code> format character references a signed character, and <code>C</code> a signed one. Rather than building a loop, you can leverage <code>unpack()</code> directly as follows to get an equivalent result:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$ascii</code> <code class="o">=</code> <code class="s1">'PHP Cookbook'</code><code class="p">;</code>
<code class="nv">$chars</code> <code class="o">=</code> <code class="nb">unpack</code><code class="p">(</code><code class="s1">'C*'</code><code class="p">,</code> <code class="nv">$ascii</code><code class="p">);</code>

<code class="nb">var_dump</code><code class="p">(</code><code class="nv">$chars</code><code class="p">);</code></pre>

<p>Both the preceding <code>unpack()</code> example and the original loop implementation in <a data-type="xref" href="#character_encoding_with_ord">Example 4-22</a> produce the following array:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">array</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code> <code class="p">{</code>
  <code class="p">[</code><code class="mi">1</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">80</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">2</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">72</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">3</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">80</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">4</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">32</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">5</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">67</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">6</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">111</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">7</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">111</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">8</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">107</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">9</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">98</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">10</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">111</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">11</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">111</code><code class="p">)</code>
  <code class="p">[</code><code class="mi">12</code><code class="p">]</code><code class="o">=&gt;</code>
  <code class="nx">int</code><code class="p">(</code><code class="mi">107</code><code class="p">)</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875173792176">
<h2>See Also</h2>

<p>PHP documentation <a data-type="indexterm" data-primary="strings" data-secondary="binary data" data-startref="sgbnd" id="idm45875173608560"></a><a data-type="indexterm" data-primary="binary data in strings" data-startref="bnydsg" id="idm45875173290816"></a>on <a href="https://oreil.ly/0iieT"><code>pack()</code></a> and <a href="https://oreil.ly/Un_aD"><code>unpack()</code></a>.</p>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45875185433888"><sup><a href="ch04.html#idm45875185433888-marker">1</a></sup> This string is a byte representation, formatted in octal notation, of “Hello World!”</p><p data-type="footnote" id="idm45875190506912"><sup><a href="ch04.html#idm45875190506912-marker">2</a></sup> Review <a data-type="xref" href="#string_escape_sequences">Table 4-1</a> for more on double-character escape sequences.</p></div></div></section></div>
</div>
</body>
</html>