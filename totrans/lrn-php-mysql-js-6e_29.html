<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 26. The HTML5 Canvas" class="calibre4"><div class="preface" id="html5_canvas">
<h1 class="calibre10"><span class="keep-together">Chapter 26. </span>The HTML5 Canvas</h1>

<p class="author1">Although<a contenteditable="false" data-primary="HTML5" data-secondary="canvas element" data-see="also canvas (HTML5)" data-type="indexterm" id="idm45694672367912" class="calibre6"/> the collective term given to the new web technologies is <em class="hyperlink">HTML5</em>, they are not all simply HTML tags and properties. Such is the case with the canvas element. Yes, you create a canvas by using the <code class="calibre15">&lt;canvas&gt;</code> tag, and maybe supply a width and height, and can modify it a little with CSS, but to actually write to (or read from) a canvas, you must use JavaScript.</p>

<p class="author1">Thankfully, the JavaScript you need to learn is minimal and very easy to implement, plus I’ve already provided you with a set of three ready-made functions in <a data-type="xref" href="ch21.xhtml#accessing_css_from_javascript" class="calibre6">Chapter 21</a> (in the file <em class="hyperlink">OSC.js</em>) to make accessing objects such as the canvas even more straightforward. So, let’s dive right in and start using the new <code class="calibre15">&lt;canvas&gt;</code> tag.</p>

<section data-type="sect1" data-pdf-bookmark="Creating and Accessing a Canvas" class="calibre4"><div class="preface" id="creating_and_accessing_a_canvas">
<h1 class="calibre11">Creating and Accessing a Canvas</h1>

<p class="author1">In <a data-type="xref" href="ch25.xhtml#introduction_to_html5" class="calibre6">Chapter 25</a>, I<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="creating and accessing" data-type="indexterm" id="CHcreate24" class="calibre6"/> showed you how to draw a simple circle to display the Japanese flag, as reused here in <a data-type="xref" href="#displaying_the_japanese_flag_using_a_can" class="calibre6">Example 26-1</a>. Let’s now look at what exactly is going on here.</p>

<div data-type="example" id="displaying_the_japanese_flag_using_a_can" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-1. </span>Displaying the Japanese flag by using a canvas</h5>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;html&gt;</code>
  <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;title&gt;</code>The HTML5 Canvas<code class="nt">&lt;/title&gt;</code>
    <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">'OSC.js'</code><code class="nt">&gt;&lt;/script&gt;</code>
  <code class="nt">&lt;/head&gt;</code>
  <code class="nt">&lt;body&gt;</code>
    <code class="nt">&lt;canvas</code> <code class="na">id=</code><code class="s">'mycanvas'</code> <code class="na">width=</code><code class="s">'320'</code> <code class="na">height=</code><code class="s">'240'</code><code class="nt">&gt;</code>
      This is a canvas element given the ID <code class="nt">&lt;i&gt;</code>mycanvas<code class="nt">&lt;/i&gt;</code>
      This text is only visible in non-HTML5 browsers
    <code class="nt">&lt;/canvas&gt;</code>

    <code class="nt">&lt;script&gt;</code>
      <code class="n">canvas</code>            <code class="o">=</code> <code class="n">O</code><code class="p">(</code><code class="s">'mycanvas'</code><code class="p">)</code>
      <code class="n">context</code>           <code class="o">=</code> <code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code>
      <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="s">'red'</code>
      <code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">).</code><code class="n">border</code>  <code class="o">=</code> <code class="s">'1px solid black'</code>

      <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
      <code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">160</code><code class="p">,</code> <code class="mi">120</code><code class="p">)</code>
      <code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">160</code><code class="p">,</code> <code class="mi">120</code><code class="p">,</code> <code class="mi">70</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">*</code> <code class="mi">2</code><code class="p">,</code> <code class="k">false</code><code class="p">)</code>
      <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
      <code class="n">context</code><code class="p">.</code><code class="n">fill</code><code class="p">()</code>
    <code class="nt">&lt;/script&gt;</code>
  <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>

<p class="author1">First, of course, the <code class="calibre15">&lt;!DOCTYPE html&gt;</code> declaration tells the browser that the document will use HTML5. After this, a title is displayed and the three functions in the <em class="hyperlink">OSC.js</em> file are loaded in.</p>

<p class="author1">The body of the document defines a canvas element, gives it an ID of <code class="calibre15">mycanvas</code>, and gives it a width and height of 320 × 240 pixels. The text of the canvas, as explained in the previous chapter, will not appear in browsers that support the canvas element but will appear in older browsers that don’t.</p>

<p class="author1">This is followed by a section of JavaScript that styles and draws on the canvas. We begin by creating a <code class="calibre15">canvas</code> object by calling the <code class="calibre15">O</code> function on the canvas element. As you will recall, this calls the <code class="calibre15">document.getElementById</code> function and is therefore a much shorter way of referencing the element.</p>

<p class="author1">This is all stuff you’ve seen before, but next comes something new:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code> <code class="o">=</code> <code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code></pre>

<p class="author1">This command calls the <code class="calibre15">getContext</code> method of the new <code class="calibre15">canvas</code> object just created, requesting two-dimensional access to the canvas by passing the value <code class="calibre15">2d</code>.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">If<a contenteditable="false" data-primary="3D images" data-type="indexterm" id="idm45694672138360" class="calibre6"/> you want to display 3D on a canvas, you can either do the math yourself and “fake” it in 2D, or you can use<a contenteditable="false" data-primary="WebGL" data-type="indexterm" id="idm45694672136968" class="calibre6"/> WebGL (which is based on OpenGL ES), in which case you would create a <code class="calibre15">context</code> for it by calling <code class="calibre15">canvas.getContext('webgl')</code>. There’s no room to cover the subject any further here, but you can find a great tutorial at <a href="https://webglfundamentals.org" class="calibre6"><em class="hyperlink">https://webglfundamentals.org</em></a>. Alternatively, check out the <a href="https://threejs.org" class="calibre6">Three.jsJavaScript library</a> of 3D functions, which also uses WebGL.</p>
</div>

<p class="author1">Armed with this context in the object <code class="calibre15">context</code>, we prime the subsequent drawing commands by setting the <code class="calibre15">fillStyle</code> property of <code class="calibre15">context</code> to the value <code class="calibre15">red</code>:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="s">'red'</code></pre>

<p class="author1">Then the <code class="calibre15">S</code> function is called to set the <code class="calibre15">border</code> property of the canvas to a 1-pixel, solid black line to outline the flag image:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">).</code><code class="n">border</code> <code class="o">=</code> <code class="s">'1px solid black'</code></pre>

<p class="author1">With everything prepared, a path is opened on the context, and the drawing position is moved to the location (160, 120):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">160</code><code class="p">,</code> <code class="mi">120</code><code class="p">)</code></pre>

<p class="author1">After that, an arc is drawn centered on that coordinate, with a radius of 70 pixels, beginning at an angle of 0 degrees (which is the right-hand edge of the circle as you look at it) and continuing all the way around the circle in radians as determined by a value of 2 × π:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">160</code><code class="p">,</code> <code class="mi">120</code><code class="p">,</code> <code class="mi">70</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">*</code> <code class="mi">2</code><code class="p">,</code> <code class="k">false</code><code class="p">)</code></pre>

<p class="author1">The final value of <code class="calibre15">false</code> indicates a clockwise direction for drawing the arc; a value of <code class="calibre15">true</code> would indicate that the drawing should occur in a counterclockwise direction.</p>

<p class="author1">Finally, we close and fill the path, using the preselected value in the <code class="calibre15">fillStyle</code> property that we set to <code class="calibre15">red</code> a few lines earlier:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">fill</code><code class="p">()</code></pre>

<p class="author1">The result of loading this document into a web browser looks like <a data-type="xref" href="ch25.xhtml#drawing_the_japanese_flag_using_an_html5" class="calibre6">Figure 25-1</a> in the previous chapter.</p>

<section data-type="sect2" data-pdf-bookmark="The toDataURL Function" class="calibre4"><div class="preface" id="todataurl_function">
<h2 class="calibre28">The toDataURL Function</h2>

<p class="author1">After<a contenteditable="false" data-primary="toDataURL function (HTML5)" data-type="indexterm" id="idm45694671964120" class="calibre6"/> you have created an image in a canvas, you will sometimes want to make a copy of it, perhaps to repeat elsewhere on a web page, for animation purposes, to save to local storage, or to upload to a web server. This is particularly handy since users cannot use drag and drop to save a canvas image.</p>

<p class="author1">To illustrate how you do this, I have added a few lines of code to the previous example in <a data-type="xref" href="#copying_a_canvas_image" class="calibre6">Example 26-2</a> (highlighted in bold). These create a new <code class="calibre15">&lt;img&gt;</code> element with the ID <code class="calibre15">myimage</code>, give it a solid black border, and then copy the canvas image into the <code class="calibre15">&lt;img&gt;</code> element (see <a data-type="xref" href="#image_on_the_right_is_copied_from_th" class="calibre6">Figure 26-1</a>).</p>

<div data-type="example" id="copying_a_canvas_image" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-2. </span>Copying a canvas image</h5>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code><code class="calibre15">
</code><code class="nt">&lt;html</code><code class="nt">&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;head</code><code class="nt">&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;title</code><code class="nt">&gt;</code><code class="calibre15">Copying a Canvas</code><code class="nt">&lt;/title&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;script </code><code class="na">src=</code><code class="s">'OSC.js'</code><code class="nt">&gt;</code><code class="nt">&lt;/script&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;/head&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;body</code><code class="nt">&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;canvas</code><code class="calibre15"> </code><code class="na">id=</code><code class="s">'mycanvas'</code><code class="calibre15"> </code><code class="na">width=</code><code class="s">'320'</code><code class="calibre15"> </code><code class="na">height=</code><code class="s">'240'</code><code class="nt">&gt;</code><code class="calibre15">
      This is a canvas element given the ID </code><code class="nt">&lt;i</code><code class="nt">&gt;</code><code class="calibre15">mycanvas</code><code class="nt">&lt;/i&gt;</code><code class="calibre15">
      This text is only visible in non-HTML5 browsers
    </code><code class="nt">&lt;/canvas&gt;</code><code class="calibre15">

    </code><strong class="calibre31"><code class="na1">&lt;img</code><code class="calibre17"> </code><code class="na1">id=</code><code class="s2">'myimage'</code><code class="na1">&gt;</code></strong><code class="calibre15">

    </code><code class="nt">&lt;script</code><code class="nt">&gt;</code><code class="calibre15">
      </code><code class="n">canvas</code><code class="calibre15">            </code><code class="o">=</code><code class="calibre15"> </code><code class="n">O</code><code class="p">(</code><code class="s">'mycanvas'</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="calibre15">           </code><code class="o">=</code><code class="calibre15"> </code><code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="s">'red'</code><code class="calibre15">
      </code><code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">)</code><code class="p">.</code><code class="n">border</code><code class="calibre15">  </code><code class="o">=</code><code class="calibre15"> </code><code class="s">'1px solid black'</code><code class="calibre15">

      </code><code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">(</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">160</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">120</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">160</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">120</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">70</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="nb">Math</code><code class="p">.</code><code class="n">PI</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">2</code><code class="p">,</code><code class="calibre15"> </code><code class="k">false</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">(</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="p">.</code><code class="n">fill</code><code class="p">(</code><code class="p">)</code><code class="calibre15">

      </code><strong class="calibre31"><code class="nx1">S</code><code class="p1">(</code><code class="s2">'myimage'</code><code class="p1">)</code><code class="p1">.</code><code class="nx1">border</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'1px solid black'</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="nx1">O</code><code class="p1">(</code><code class="s2">'myimage'</code><code class="p1">)</code><code class="p1">.</code><code class="nx1">src</code><code class="calibre17">    </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">canvas</code><code class="p1">.</code><code class="nx1">toDataURL</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
    </code><code class="nt">&lt;/script&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;/body&gt;</code><code class="calibre15">
</code><code class="nt">&lt;/html&gt;</code></pre>
</div>

<figure class="calibre23"><div id="image_on_the_right_is_copied_from_th" class="figure"><img alt="The image on the right is copied from the left-hand canvas" src="Images/pmj6_2601.png" class="calibre151"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-1. </span>The image on the right is copied from the left-hand canvas</h6>
</div></figure>

<p class="author1">If you try this code for yourself, you will notice that although you cannot drag and drop the left-hand canvas image, you can do so with the right-hand picture, which you could also save to local storage or upload to a web server using the right JavaScript (and PHP on the server end).</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Specifying an Image Type" class="calibre4"><div class="preface" id="specifying_an_image_type">
<h2 class="calibre28">Specifying an Image Type</h2>

<p class="author1">When<a contenteditable="false" data-primary="image types, in HTML5" data-type="indexterm" id="idm45694671766808" class="calibre6"/> creating an image from a canvas, you can specify the type of image you want as either JPEG (<em class="hyperlink">.jpg</em> or <em class="hyperlink">.jpeg</em> files) or PNG (<em class="hyperlink">.png</em> files). The default is PNG (<code class="calibre15">image/png</code>), but should you need JPEG for some reason, you can alter the call to <code class="calibre15">toDataURL</code>. At the same time, you can also specify the amount of compression to use, between <code class="calibre15">0</code> (for lowest quality) and <code class="calibre15">1</code> (for highest quality). The following uses a compression value of <code class="calibre15">0.4</code> and should generate a reasonably good-looking image at a fairly low file size:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">O</code><code class="p">(</code><code class="s">'myimage'</code><code class="p">).</code><code class="n">src</code> <code class="o">=</code> <code class="n">canvas</code><code class="p">.</code><code class="n">toDataURL</code><code class="p">(</code><code class="s">'image/jpeg'</code><code class="p">,</code> <code class="mi">0.4</code><code class="p">)</code></pre>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">Remember that the <code class="calibre15">toDataURL</code> method applies to a <span class="keep-together"><code class="calibre15">canvas</code></span> object, not to any context created from that object.</p>
</div>

<p class="author1">Now that you know how to create canvas images and then copy or otherwise use them, it’s time to look at the drawing commands available, starting with rectangles.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The fillRect Method" class="calibre4"><div class="preface" id="fillrect_method">
<h2 class="calibre28">The fillRect Method</h2>

<p class="author1">There<a contenteditable="false" data-primary="rectangles, drawing in canvas" data-type="indexterm" id="rect24" class="calibre6"/><a contenteditable="false" data-primary="fillRect method (HTML5)" data-type="indexterm" id="idm45694671848120" class="calibre6"/> are three different methods you can call for drawing rectangles, the first of which is <code class="calibre15">fillRect</code>. To use it, you simply supply the top-left coordinates of your rectangle, followed by the width and height in pixels, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">600</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code></pre>

<p class="author1">By default, the rectangle will be filled with black, but you can use any other color you like by first issuing a command such as the following, where the argument can be any acceptable CSS color, name, or value:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="s">'blue'</code></pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The clearRect Method" class="calibre4"><div class="preface" id="clearrect_method">
<h2 class="calibre28">The clearRect Method</h2>

<p class="author1">You<a contenteditable="false" data-primary="clearRect method (HTML5)" data-type="indexterm" id="idm45694671627848" class="calibre6"/> can also draw a rectangle in which all the color values (red, green, blue, and alpha transparency) have been set to <code class="calibre15">0</code>, like in the following example, which uses the same order of coordinates and width and height arguments:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">clearRect</code><code class="p">(</code><code class="mi">40</code><code class="p">,</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">560</code><code class="p">,</code> <code class="mi">160</code><code class="p">)</code></pre>

<p class="author1">Once the <code class="calibre15">clearRect</code> method is applied, the new clear rectangle will strip all color from the area it covers, leaving only any underlying CSS color that has been applied to the canvas element.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The strokeRect Method" class="calibre4"><div class="preface" id="strokerect_method">
<h2 class="calibre28">The strokeRect Method</h2>

<p class="author1">When<a contenteditable="false" data-primary="strokeRect method (HTML5)" data-type="indexterm" id="idm45694671606392" class="calibre6"/> you want only an outlined rectangle, you can use a command such as the following, which will use the default of black or the currently selected stroke color:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">strokeRect</code><code class="p">(</code><code class="mi">60</code><code class="p">,</code> <code class="mi">60</code><code class="p">,</code> <code class="mi">520</code><code class="p">,</code> <code class="mi">120</code><code class="p">)</code></pre>

<p class="author1">To change the color used, you can first issue a command such as the following, supplying any valid CSS color argument:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">strokeStyle</code> <code class="o">=</code> <code class="s">'green'</code></pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Combining These Commands" class="calibre4"><div class="preface" id="combining_these_commands">
<h2 class="calibre28">Combining These Commands</h2>

<p class="author1">In <a data-type="xref" href="#drawing_several_rectangles" class="calibre6">Example 26-3</a>, the preceding rectangle-drawing commands have been combined to display the image shown in <a data-type="xref" href="#drawing_concentric_rectangles" class="calibre6">Figure 26-2</a>.</p>

<div data-type="example" id="drawing_several_rectangles" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-3. </span>Drawing several rectangles</h5>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;html&gt;</code>
  <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;title&gt;</code>Drawing Rectangles<code class="nt">&lt;/title&gt;</code>
    <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">'OSC.js'</code><code class="nt">&gt;&lt;/script&gt;</code>
  <code class="nt">&lt;/head&gt;</code>
  <code class="nt">&lt;body&gt;</code>
    <code class="nt">&lt;canvas</code> <code class="na">id=</code><code class="s">'mycanvas'</code> <code class="na">width=</code><code class="s">'640'</code> <code class="na">height=</code><code class="s">'240'</code><code class="nt">&gt;&lt;/canvas&gt;</code>

    <code class="nt">&lt;script&gt;</code>
      <code class="n">canvas</code>               <code class="o">=</code> <code class="n">O</code><code class="p">(</code><code class="s">'mycanvas'</code><code class="p">)</code>
      <code class="n">context</code>              <code class="o">=</code> <code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code>
      <code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">).</code><code class="n">background</code> <code class="o">=</code> <code class="s">'lightblue'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code>    <code class="o">=</code> <code class="s">'blue'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">strokeStyle</code>  <code class="o">=</code> <code class="s">'green'</code>

      <code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code>  <code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">600</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code>
      <code class="n">context</code><code class="p">.</code><code class="n">clearRect</code><code class="p">(</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">560</code><code class="p">,</code> <code class="mi">160</code><code class="p">)</code>
      <code class="n">context</code><code class="p">.</code><code class="n">strokeRect</code><code class="p">(</code><code class="mi">60</code><code class="p">,</code> <code class="mi">60</code><code class="p">,</code> <code class="mi">520</code><code class="p">,</code> <code class="mi">120</code><code class="p">)</code>
    <code class="nt">&lt;/script&gt;</code>
  <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>

<figure class="calibre23"><div id="drawing_concentric_rectangles" class="figure"><img alt="Drawing concentric rectangles" src="Images/pmj6_2602.png" class="calibre151"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-2. </span>Drawing concentric rectangles</h6>
</div></figure>

<p class="author1">Later in this chapter, you’ll see how you can further modify the output by changing stroke types and widths—but first, let’s turn to modifying fills by applying gradients (which were introduced in <a data-type="xref" href="ch19.xhtml#gradients" class="calibre6">“Gradients”</a> as part of CSS).<a contenteditable="false" data-primary="" data-startref="rect24" data-type="indexterm" id="idm45694671399576" class="calibre6"/></p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The createLinearGradient Method" class="calibre4"><div class="preface" id="createlineargradient_method">
<h2 class="calibre28">The createLinearGradient Method</h2>

<p class="author1">There<a contenteditable="false" data-primary="createLinearGradient method (HTML5)" data-type="indexterm" id="idm45694671395992" class="calibre6"/><a contenteditable="false" data-primary="gradients" data-type="indexterm" id="grad26" class="calibre6"/> are a couple of ways to apply a gradient to a fill but the simplest is with the <code class="calibre15">createLinearGradient</code> method. You specify start and end <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates relative to the canvas (not the object being filled). This allows for greater subtlety. For example, you can specify that a gradient begin at the far left and end at the far right of a canvas but apply it only within the area defined in a fill command, as shown in <a data-type="xref" href="#applying_a_gradient_fill" class="calibre6">Example 26-4</a>.</p>

<div data-type="example" id="applying_a_gradient_fill" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-4. </span>Applying a gradient fill</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createLinearGradient</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">80</code><code class="p">,</code> <code class="mi">640</code><code class="p">,</code><code class="mi">80</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="s">'white'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">'black'</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">gradient</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">80</code><code class="p">,</code> <code class="mi">80</code><code class="p">,</code> <code class="mi">480</code><code class="p">,</code><code class="mi">80</code><code class="p">)</code></pre>
</div>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">For brevity and clarity in this and many of the following examples, only salient lines of code are shown. Complete examples with the surrounding HTML, setup, and other sections of code are available to freely download from <a href="https://github.com/RobinNixon/lpmj6" class="calibre6">GitHub</a>.</p>
</div>

<p class="author1">In this example, we create a gradient fill object named <code class="calibre15">gradient</code> by making a call to the <code class="calibre15">createLinearGradient</code> method of the <code class="calibre15">context</code> object. The start position of (0, 80) is halfway down the left-hand canvas edge, while the end of (640, 80) is halfway down the right-hand edge.</p>

<p class="author1">To create your gradient, determine the direction in which you want it to flow and then locate two points to represent the start and end. No matter what values you supply for these points, the gradient will smoothly transition in the direction given, even if the points are outside the fill area.</p>

<p class="author1">Next, a couple of color stops are provided to specify that the very first color of the gradient is white and the final color is black. The gradient will then transition smoothly between these colors across the canvas from left to right.</p>

<p class="author1">With the <code class="calibre15">gradient</code> object now ready, it is applied to the <code class="calibre15">fillStyle</code> property of the <code class="calibre15">context</code> object so that the final <code class="calibre15">fillRect</code> call can use it. In this call, the fill is applied only in a central rectangular area of the canvas, so although the gradient goes from the far left to the far right of the canvas, the portion of it shown is only from 80 pixels in and down from the top-left corner, to a width of 480 and depth of 80 pixels. The result (when added to the previous example code) looks like <a data-type="xref" href="#central_rectangle_has_a_horizontal_g" class="calibre6">Figure 26-3</a>.</p>

<figure class="calibre23"><div id="central_rectangle_has_a_horizontal_g" class="figure"><img alt="The central rectangle has a horizontal gradient fill" class="calibre151" src="Images/pmj6_2603.png"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-3. </span>The central rectangle has a horizontal gradient fill</h6>
</div></figure>

<p class="author1">By specifying different start and end coordinates for a gradient, you can make it slant in any direction, as demonstrated with <a data-type="xref" href="#variety_of_gradients_at_different_angl" class="calibre6">Example 26-5</a> and shown in <a data-type="xref" href="#range_of_different_linear_gradients" class="calibre6">Figure 26-4</a>.</p>

<div data-type="example" id="variety_of_gradients_at_different_angl" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-5. </span>A variety of gradients at different angles and colors</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createLinearGradient</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">160</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="s">'white'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">'black'</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">gradient</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">135</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code>

<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createLinearGradient</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">240</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="s">'yellow'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">'red'</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">gradient</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">175</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">135</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code>

<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createLinearGradient</code><code class="p">(</code><code class="mi">320</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">480</code><code class="p">,</code> <code class="mi">240</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="s">'green'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">'purple'</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">gradient</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">330</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">135</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code>

<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createLinearGradient</code><code class="p">(</code><code class="mi">480</code><code class="p">,</code> <code class="mi">240</code><code class="p">,</code> <code class="mi">640</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="s">'orange'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">'magenta'</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">gradient</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">485</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">135</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="range_of_different_linear_gradients" class="figure"><img alt="A range of different linear gradients" src="Images/pmj6_2604.png" class="calibre152"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-4. </span>A range of different linear gradients</h6>
</div></figure>

<p class="author1">In this example, I chose to place the gradients directly on top of the areas to be filled to more clearly show the maximum variation in color from start to end.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The addColorStop Method in Detail" class="calibre4"><div class="preface" id="addcolorstop_method_in_detail">
<h2 class="calibre28">The addColorStop Method in Detail</h2>

<p class="author1">You<a contenteditable="false" data-primary="addColorStop method (HTML5)" data-type="indexterm" id="idm45694671021112" class="calibre6"/> can use as many color stops in a gradient as you like, not just the two start and end colors used so far in these examples. This makes it possible to clearly describe almost any type of gradient effect you can imagine. To do this, you must specify the percent of the gradient that each color should take up, by allocating a floating-point start position along the gradient range between <code class="calibre15">0</code> and <code class="calibre15">1</code>. You do not enter a color’s end position, because it is deduced from the start position of the next color stop, or the gradient end if the position is the last one you specify.</p>

<p class="author1">In the preceding examples, only the two start and end values were chosen, but to create a rainbow effect, you could set up your color stops as shown in <a data-type="xref" href="#adding_multiple_color_stops" class="calibre6">Example 26-6</a> (displayed in <a data-type="xref" href="#rainbow_effect_with_seven_stop_colors" class="calibre6">Figure 26-5</a>).</p>

<div data-type="example" id="adding_multiple_color_stops" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-6. </span>Adding multiple color stops</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.00</code><code class="p">,</code> <code class="s">'red'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.14</code><code class="p">,</code> <code class="s">'orange'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.28</code><code class="p">,</code> <code class="s">'yellow'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.42</code><code class="p">,</code> <code class="s">'green'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.56</code><code class="p">,</code> <code class="s">'blue'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.70</code><code class="p">,</code> <code class="s">'indigo'</code><code class="p">)</code>
<code class="n">gradient</code><code class="p">.</code><code class="n">addColorStop</code><code class="p">(</code><code class="mi">0.84</code><code class="p">,</code> <code class="s">'violet'</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="rainbow_effect_with_seven_stop_colors" class="figure"><img alt="A rainbow effect with seven stop colors" src="Images/pmj6_2605.png" class="calibre151"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-5. </span>A rainbow effect with seven stop colors</h6>
</div></figure>

<p class="author1">In <a data-type="xref" href="#adding_multiple_color_stops" class="calibre6">Example 26-6</a>, all the colors are spaced roughly equidistantly (with each color given 14% of the gradient and the final one 16), but you don’t have to stick to that; you can squish several colors near each other, while spacing others out. It’s entirely up to you how many colors you use and where in the gradient they start and end.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The createRadialGradient Method" class="calibre4"><div class="preface" id="createradialgradient_method">
<h2 class="calibre28">The createRadialGradient Method</h2>

<p class="author1">You<a contenteditable="false" data-primary="createRadialGradient method (HTML5)" data-type="indexterm" id="idm45694670959976" class="calibre6"/> aren’t restricted to only linear gradients in HTML; you can create radial gradients on a canvas too. It’s a little more complex than with a linear gradient but not much more so.</p>

<p class="author1">What you need to do is pass the center location as a pair of <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates, along with a radius in pixels. These are used as the start of the gradient and outer circumference, respectively. Then you also pass another set of coordinates and a radius to specify the end of the gradient.</p>

<p class="author1">So, for example, to create a gradient that simply starts at the center of a circle and then expands out, you could issue a command such as the one in <a data-type="xref" href="#creating_a_radial_gradient" class="calibre6">Example 26-7</a> (displayed in <a data-type="xref" href="#centered_radial_gradient" class="calibre6">Figure 26-6</a>). The coordinates for the start and end are the same, but the radius is <code class="calibre15">0</code> for the start and encompasses the entire gradient for the end.</p>

<div data-type="example" id="creating_a_radial_gradient" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-7. </span>Creating a radial gradient</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createRadialGradient</code><code class="p">(</code><code class="mi">320</code><code class="p">,</code> <code class="mi">120</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">320</code><code class="p">,</code> <code class="mi">120</code><code class="p">,</code> <code class="mi">320</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="centered_radial_gradient" class="figure"><img alt="A centered radial gradient" src="Images/pmj6_2606.png" class="calibre151"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-6. </span>A centered radial gradient</h6>
</div></figure>

<p class="author1">Or you can be fancy and move the location of the start and end of a radial gradient, as in <a data-type="xref" href="#stretching_a_radial_gradient" class="calibre6">Example 26-8</a> (and displayed in <a data-type="xref" href="#stretched_radial_gradient" class="calibre6">Figure 26-7</a>), which starts centered on location (0, 120) with a radius of 0 pixels and ends centered at (480, 120) with a radius of 480 pixels.</p>

<div data-type="example" id="stretching_a_radial_gradient" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-8. </span>Stretching a radial gradient</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">gradient</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createRadialGradient</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">120</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">480</code><code class="p">,</code> <code class="mi">120</code><code class="p">,</code> <code class="mi">480</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="stretched_radial_gradient" class="figure"><img alt="A stretched radial gradient" src="Images/pmj6_2607.png" class="calibre151"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-7. </span>A stretched radial gradient</h6>
</div></figure>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">By manipulating the figures supplied to this method, you can create a wide range of weird and wonderful effects—try it for yourself with the supplied examples.<a contenteditable="false" data-startref="grad26" data-type="indexterm" id="idm45694670816584" class="calibre6"/></p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Using Patterns for Fills" class="calibre4"><div class="preface" id="using_patterns_for_fills">
<h2 class="calibre28">Using Patterns for Fills</h2>

<p class="author1">In<a contenteditable="false" data-primary="fill patterns" data-type="indexterm" id="idm45694670813400" class="calibre6"/><a contenteditable="false" data-primary="patterns, using for fills" data-type="indexterm" id="idm45694670812264" class="calibre6"/> a similar manner to gradient fills, you can also apply an image as a fill pattern. This can be an image anywhere in the current document, or even one created from a canvas via the <code class="calibre15">toDataURL</code> method (explained earlier in this chapter).</p>

<p class="author1"><a data-type="xref" href="#using_an_image_for_a_pattern_fill" class="calibre6">Example 26-9</a> loads a 100 × 100–pixel image (the yin-yang symbol) into the new image object <code class="calibre15">image</code>. The following statement attaches to the <code class="calibre15">onload</code> event a function that creates a repeating pattern for the <code class="calibre15">fillStyle</code> property of the context. This is then used to fill a 600 × 200–pixel area within the canvas, as shown in <a data-type="xref" href="#tiling_an_image_by_using_it_as_a_pattern" class="calibre6">Figure 26-8</a>.</p>

<div data-type="example" id="using_an_image_for_a_pattern_fill" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-9. </span>Using an image for a pattern fill</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">image</code>     <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">image</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="s">'image.png'</code>

<code class="n">image</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">pattern</code>           <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createPattern</code><code class="p">(</code><code class="n">image</code><code class="p">,</code> <code class="s">'repeat'</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">pattern</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillRect</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">600</code><code class="p">,</code> <code class="mi">200</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>

<figure class="calibre23"><div id="tiling_an_image_by_using_it_as_a_pattern" class="figure"><img alt="Tiling an image by using it as a pattern fill" src="Images/pmj6_2608.png" class="calibre153"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-8. </span>Tiling an image by using it as a pattern fill</h6>
</div></figure>

<p class="author1">We create the pattern by using the <code class="calibre15">createPattern</code> method, which also supports nonrepeating patterns, or ones that just repeat in the x- or y-axes. We achieve this by passing one of the following values to it as the second argument, after the image to use:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">repeat</code></dfn></dt>
	<dd class="calibre14">Repeat the image both vertically and horizontally.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">repeat-x</code></dfn></dt>
	<dd class="calibre14">Repeat the image horizontally.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">repeat-y</code></dfn></dt>
	<dd class="calibre14">Repeat the image vertically.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">no-repeat</code></dfn></dt>
	<dd class="calibre14">Do not repeat the image.</dd>
</dl>

<p class="author1">The fill pattern is based on the entire canvas area, so where the fill command is set to apply only to a smaller area within the canvas, the images appear cut off at the top and left.</p>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">If the <code class="calibre15">onload</code> event had not been used in this example and, instead, the code was simply executed as soon as encountered, the image might not have already loaded by the time the web page was displayed and might not appear in the display. Attaching to this event ensures that the image is available for use in the canvas, because the event triggers only upon successful loading of an image.<a contenteditable="false" data-primary="" data-startref="CHcreate24" data-type="indexterm" id="idm45694670726024" class="calibre6"/></p>
</div>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Writing Text to the Canvas" class="calibre4"><div class="preface" id="writing_text_to_the_canvas">
<h1 class="calibre11">Writing Text to the Canvas</h1>

<p class="author1">As<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="writing text to" data-type="indexterm" id="CHtext24" class="calibre6"/><a contenteditable="false" data-primary="text, writing to canvas" data-type="indexterm" id="tet24" class="calibre6"/> you would expect from a set of graphics features, writing to the canvas with text is fully supported with a variety of font, alignment, and fill methods. But why would you want to write text to the canvas when there’s already such good support for web fonts in CSS these days?</p>

<p class="author1">Well, suppose you wish to display a graph or table with graphical elements. You’ll surely also want to label parts of it. What’s more, using the available commands, you can produce much more than simply a colored font. So, let’s start by assuming you’ve been tasked to create a header for a website on basket weaving, called WickerpediA (actually there’s already one of these, but let’s go ahead anyway).</p>

<p class="author1">To start with, you need to select a suitable font and size it appropriately, perhaps as in <a data-type="xref" href="#writing_text_to_the_canvas-id00118" class="calibre6">Example 26-10</a>, in which a font style of bold, a size of 140 pixels, and a typeface of Times have been selected. Also, the <code class="calibre15">textBaseline</code> property has been set to <code class="calibre15">top</code> so that the <code class="calibre15">strokeText</code> method can pass coordinates of (0, 0) for the top-left origin of the text, placing it at the top left of the canvas. <a data-type="xref" href="#text_has_been_written_to_the_canvas" class="calibre6">Figure 26-9</a> shows what this looks like.</p>

<div data-type="example" id="writing_text_to_the_canvas-id00118" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-10. </span>Writing text to the canvas</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">font</code>         <code class="o">=</code> <code class="s">'bold 140px Times'</code>
<code class="n">context</code><code class="p">.</code><code class="n">textBaseline</code> <code class="o">=</code> <code class="s">'top'</code>
<code class="n">context</code><code class="p">.</code><code class="n">strokeText</code><code class="p">(</code><code class="s">'WickerpediA'</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="text_has_been_written_to_the_canvas" class="figure"><img alt="The text has been written to the canvas" src="Images/pmj6_2609.png" class="calibre154"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-9. </span>The text has been written to the canvas</h6>
</div></figure>

<section data-type="sect2" data-pdf-bookmark="The strokeText Method" class="calibre4"><div class="preface" id="stroketext_method">
<h2 class="calibre28">The strokeText Method</h2>

<p class="author1">To<a contenteditable="false" data-primary="strokeText method (HTML5)" data-type="indexterm" id="idm45694680289944" class="calibre6"/> write text to the canvas, you send the text string and a pair of coordinates to the <code class="calibre15">strokeText</code> method, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">strokeText</code><code class="p">(</code><code class="s">'WickerpediA'</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code></pre>

<p class="author1">The <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates supplied will be used as a relative reference by the <code class="calibre15">textBaseline</code> and <code class="calibre15">textAlign</code> properties.</p>

<p class="author1">This method—using line drawing—is only one way of drawing text to the canvas. So, in addition to all of the following properties that affect text, line-drawing properties such as <code class="calibre15">lineWidth</code> (detailed later in this chapter) will also affect how text displays.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The textBaseline Property" class="calibre4"><div class="preface" id="textbaseline_property">
<h2 class="calibre28">The textBaseline Property</h2>

<p class="author1">The <code class="calibre15">textBaseline</code> property<a contenteditable="false" data-primary="textBaseline property (HTML5)" data-type="indexterm" id="idm45694670646488" class="calibre6"/> can be given any of the following values:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">top</code></dfn></dt>
	<dd class="calibre14">Aligns to the top of the text</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">middle</code></dfn></dt>
	<dd class="calibre14">Aligns to the middle of the text</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">alphabetic</code></dfn></dt>
	<dd class="calibre14">Aligns to the alphabetic baseline of the text</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">bottom</code></dfn></dt>
	<dd class="calibre14">Aligns to the bottom of the text</dd>
</dl>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The font Property" class="calibre4"><div class="preface" id="font_property">
<h2 class="calibre28">The font Property</h2>

<p class="author1">The<a contenteditable="false" data-primary="font property (HTML5)" data-type="indexterm" id="idm45694670604472" class="calibre6"/> font style can be any of <code class="calibre15">bold</code>, <code class="calibre15">italic</code>, or <code class="calibre15">normal</code> (the default), or a combination of <code class="calibre15">italic bold</code>, and the size values can be specified in <code class="calibre15">em</code>, <code class="calibre15">ex</code>, <code class="calibre15">px</code>, <code class="calibre15">%</code>, <code class="calibre15">in</code>, <code class="calibre15">cm</code>, <code class="calibre15">mm</code>, <code class="calibre15">pt</code>, or <code class="calibre15">pc</code> measures, just as with CSS. The font should be one available to the current browser, which generally means  <code class="calibre15">Helvetica</code>, <code class="calibre15">Impact</code>, <code class="calibre15">Courier</code>, <code class="calibre15">Times</code>, or <code class="calibre15">Arial</code>, or you can choose the default <code class="calibre15">Serif</code> or <code class="calibre15">Sans-serif</code> font of the user’s system. If you’re confident that another font you want to use will be available to the browser, you can specify that, too, but it’s a good idea to include at least one of the more common or default options after it so styling can fall back gracefully if the user doesn’t have your preferred font installed.</p>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">If you want to use a font such as <code class="calibre15">Times New Roman</code>, which incorporates spaces in its name, you should change the relevant line to something like this, in which the outer quotes are different from the ones surrounding the font name:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre45">
<code class="n">context</code><code class="p">.</code><code class="n">font</code> <code class="o">=</code> <code class="s">'bold 140px "Times New Roman"'</code></pre>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The textAlign Property" class="calibre4"><div class="preface" id="textalign_property">
<h2 class="calibre28">The textAlign Property</h2>

<p class="author1">In<a contenteditable="false" data-primary="textAlign property (HTML5)" data-type="indexterm" id="idm45694670568792" class="calibre6"/> addition to choosing how to align your text vertically, you can specify horizontal alignment by giving the <code class="calibre15">textAlign</code> property one of the following values:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">start</code></dfn></dt>
	<dd class="calibre14">Aligns the text to the left if the document direction is left to right, or otherwise to the right. This is the default setting.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">end</code></dfn></dt>
	<dd class="calibre14">Aligns the text to the right if the document direction is left to right, or otherwise to the left.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">left</code></dfn></dt>
	<dd class="calibre14">Aligns the text to the left.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">right</code></dfn></dt>
	<dd class="calibre14">Aligns the text to the right.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">center</code></dfn></dt>
	<dd class="calibre14">Centers the text.</dd>
</dl>

<p class="author1">You use the property like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">textAlign</code> <code class="o">=</code> <code class="s">'center'</code></pre>

<p class="author1">In the case of the current example, you need the text left-aligned so that it butts up neatly to the edge of the canvas, so the <code class="calibre15">textAlign</code> property is not used, and therefore the default left alignment occurs.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The fillText Method" class="calibre4"><div class="preface" id="filltext_method">
<h2 class="calibre28">The fillText Method</h2>

<p class="author1">You<a contenteditable="false" data-primary="fillText method (HTML5)" data-type="indexterm" id="idm45694670550200" class="calibre6"/> can also choose to use a fill property to fill in canvas text, which can be a solid color, a linear or radial gradient, or a pattern fill. Let’s try a pattern fill for our heading based on the texture of a wicker basket, as in <a data-type="xref" href="#filling_in_the_text_with_a_pattern" class="calibre6">Example 26-11</a>, the result of which is shown in <a data-type="xref" href="#text_now_has_a_pattern_fill" class="calibre6">Figure 26-10</a>.</p>

<div data-type="example" id="filling_in_the_text_with_a_pattern" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-11. </span>Filling in the text with a pattern</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">image</code>     <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">image</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="s">'wicker.jpg'</code>

<code class="n">image</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">pattern</code>           <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">createPattern</code><code class="p">(</code><code class="n">image</code><code class="p">,</code> <code class="s">'repeat'</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="n">pattern</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillText</code><code class="p">(</code>  <code class="s">'WickerpediA'</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">strokeText</code><code class="p">(</code><code class="s">'WickerpediA'</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>

<figure class="calibre23"><div id="text_now_has_a_pattern_fill" class="figure"><img alt="The text now has a pattern fill" src="Images/pmj6_2610.png" class="calibre154"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-10. </span>The text now has a pattern fill</h6>
</div></figure>

<p class="author1">For good measure, I also kept the <code class="calibre15">strokeText</code> call in this example to ensure a black outline to the text; without it, there wasn’t enough definition at the edges.</p>

<p class="author1">A wide variety of other fill types or patterns can also be used here, and the simplicity of the canvas makes it easy to experiment. What’s more, if you wish, once you have the heading just right, you can also choose to save a copy by issuing a call to <code class="calibre15">toDataURL</code>, as detailed earlier in the chapter. Then you can use the image as a logo for uploading to other sites, for example.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The measureText Method" class="calibre4"><div class="preface" id="measuretext_method">
<h2 class="calibre28">The measureText Method</h2>

<p class="author1">When<a contenteditable="false" data-primary="measureText method (HTML5)" data-type="indexterm" id="idm45694670439912" class="calibre6"/> working with canvas text, you may sometimes need to know how much space it will occupy so that you can best position it. You can achieve this with the <code class="calibre15">measureText</code> method, as follows (assuming all the various text properties have already been defined at this point):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">metrics</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">measureText</code><code class="p">(</code><code class="s">'WickerpediA'</code><code class="p">)</code>
<code class="n">width</code>   <code class="o">=</code> <code class="n">metrics</code><code class="p">.</code><code class="n">width</code></pre>

<p class="author1">Since the height of the text in pixels is equal to the font size in points when the font is defined, the <code class="calibre15">metrics</code> object doesn’t provide a height metric.<a contenteditable="false" data-primary="" data-startref="tet24" data-type="indexterm" id="idm45694670425944" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="CHtext24" data-type="indexterm" id="idm45694670419032" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Drawing Lines" class="calibre4"><div class="preface" id="drawing_lines">
<h1 class="calibre11">Drawing Lines</h1>

<p class="author1">The<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="drawing lines" data-type="indexterm" id="CHline24" class="calibre6"/><a contenteditable="false" data-primary="lines, drawing on canvas" data-type="indexterm" id="lines24" class="calibre6"/> canvas provides a plethora of line-drawing functions to cater to almost every need, including choices of lines, line caps and joins, and paths and curves of all types. But let’s start with a property I touched on in the previous section on writing text to the canvas.</p>

<section data-type="sect2" data-pdf-bookmark="The lineWidth Property" class="calibre4"><div class="preface" id="linewidth_property">
<h2 class="calibre28">The lineWidth Property</h2>

<p class="author1">All<a contenteditable="false" data-primary="lineWidth property (HTML5)" data-type="indexterm" id="idm45694670410680" class="calibre6"/> the canvas methods that draw with lines make use of several line properties, one of the most important being <code class="calibre15">lineWidth</code>. Using it is as simple as specifying a line width in pixels, like this, which sets the width to 3 pixels:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">lineWidth</code> <code class="o">=</code> <code class="mi">3</code></pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The lineCap and lineJoin Properties" class="calibre4"><div class="preface" id="linecap_and_linejoin_properties">
<h2 class="calibre28">The lineCap and lineJoin Properties</h2>

<p class="author1">When<a contenteditable="false" data-primary="lineCap property (HTML5)" data-type="indexterm" id="idm45694670400808" class="calibre6"/><a contenteditable="false" data-primary="lineJoin property (HTML5)" data-type="indexterm" id="idm45694670407352" class="calibre6"/> lines you draw come to an end and are more than a pixel wide, you can choose how this <em class="hyperlink">line cap</em> (as it is called) should appear by using the <code class="calibre15">lineCap</code> property, which can have the values <code class="calibre15">butt</code> (the default), <code class="calibre15">round</code>, or <code class="calibre15">square</code>, for example:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">lineCap</code> <code class="o">=</code> <code class="s">'round'</code></pre>

<p class="author1">Also, when you are joining lines together that are wider than a single pixel, it is important to specify exactly how they should meet. You achieve this with the <code class="calibre15">lineJoin</code> property, which can have values of <code class="calibre15">round</code>, <code class="calibre15">bevel</code>, or <code class="calibre15">miter</code> (the default), like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">lineJoin</code> <code class="o">=</code> <code class="s">'bevel'</code></pre>

<p class="author1"><a data-type="xref" href="#displaying_combinations_of_line_caps_and" class="calibre6">Example 26-12</a> (shown here in full since it’s a little more complicated) applies all three values of each property in combination, creating the result you’ll see in <a data-type="xref" href="#all_the_combinations_of_line_caps_and_jo" class="calibre6">Figure 26-11</a>. The <code class="calibre15">beginPath</code>, <code class="calibre15">closePath</code>, <code class="calibre15">moveTo</code>, and <code class="calibre15">lineTo</code> methods used by this example are explained next.</p>

<div data-type="example" id="displaying_combinations_of_line_caps_and" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-12. </span>Displaying combinations of line caps and joins</h5>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code>
<code class="nt">&lt;html&gt;</code>
  <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;title&gt;</code>Drawing Lines<code class="nt">&lt;/title&gt;</code>
    <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">'OSC.js'</code><code class="nt">&gt;&lt;/script&gt;</code>
  <code class="nt">&lt;/head&gt;</code>
  <code class="nt">&lt;body&gt;</code>
    <code class="nt">&lt;canvas</code> <code class="na">id=</code><code class="s">'mycanvas'</code> <code class="na">width=</code><code class="s">'535'</code> <code class="na">height=</code><code class="s">'360'</code><code class="nt">&gt;&lt;/canvas&gt;</code>

    <code class="nt">&lt;script&gt;</code>
      <code class="n">canvas</code>               <code class="o">=</code> <code class="n">O</code><code class="p">(</code><code class="s">'mycanvas'</code><code class="p">)</code>
      <code class="n">context</code>              <code class="o">=</code> <code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code>
      <code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">).</code><code class="n">background</code> <code class="o">=</code> <code class="s">'lightblue'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code>    <code class="o">=</code> <code class="s">'red'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">font</code>         <code class="o">=</code> <code class="s">'bold 13pt Courier'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">strokeStyle</code>  <code class="o">=</code> <code class="s">'blue'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">textBaseline</code> <code class="o">=</code> <code class="s">'top'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">textAlign</code>    <code class="o">=</code> <code class="s">'center'</code>
      <code class="n">context</code><code class="p">.</code><code class="n">lineWidth</code>    <code class="o">=</code> <code class="mi">20</code>
      <code class="n">caps</code>                 <code class="o">=</code> <code class="p">[</code><code class="s">'  butt'</code><code class="p">,</code> <code class="s">' round'</code><code class="p">,</code> <code class="s">'square'</code><code class="p">]</code>
      <code class="n">joins</code>                <code class="o">=</code> <code class="p">[</code><code class="s">' round'</code><code class="p">,</code> <code class="s">' bevel'</code><code class="p">,</code> <code class="s">' miter'</code><code class="p">]</code>

      <code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">3</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
      <code class="p">{</code>
        <code class="k">for</code> <code class="p">(</code><code class="n">k</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">k</code> <code class="o">&lt;</code> <code class="mi">3</code> <code class="p">;</code> <code class="o">++</code><code class="n">k</code><code class="p">)</code>
        <code class="p">{</code>
          <code class="n">context</code><code class="p">.</code><code class="n">lineCap</code>  <code class="o">=</code> <code class="n">caps</code><code class="p">[</code><code class="n">j</code><code class="p">]</code>
          <code class="n">context</code><code class="p">.</code><code class="n">lineJoin</code> <code class="o">=</code> <code class="n">joins</code><code class="p">[</code><code class="n">k</code><code class="p">]</code>

          <code class="n">context</code><code class="p">.</code><code class="n">fillText</code><code class="p">(</code><code class="s">' cap:'</code> <code class="o">+</code> <code class="n">caps</code><code class="p">[</code><code class="n">j</code><code class="p">],</code>  <code class="mi">88</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">180</code><code class="p">,</code> <code class="mi">45</code> <code class="o">+</code> <code class="n">k</code> <code class="o">*</code> <code class="mi">120</code><code class="p">)</code>
          <code class="n">context</code><code class="p">.</code><code class="n">fillText</code><code class="p">(</code><code class="s">'join:'</code> <code class="o">+</code> <code class="n">joins</code><code class="p">[</code><code class="n">k</code><code class="p">],</code> <code class="mi">88</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">180</code><code class="p">,</code> <code class="mi">65</code> <code class="o">+</code> <code class="n">k</code> <code class="o">*</code> <code class="mi">120</code><code class="p">)</code>

          <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
          <code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code> <code class="mi">20</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">180</code><code class="p">,</code> <code class="mi">100</code> <code class="o">+</code> <code class="n">k</code> <code class="o">*</code> <code class="mi">120</code><code class="p">)</code>
          <code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code> <code class="mi">20</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">180</code><code class="p">,</code>  <code class="mi">20</code> <code class="o">+</code> <code class="n">k</code> <code class="o">*</code> <code class="mi">120</code><code class="p">)</code>
          <code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">155</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">180</code><code class="p">,</code>  <code class="mi">20</code> <code class="o">+</code> <code class="n">k</code> <code class="o">*</code> <code class="mi">120</code><code class="p">)</code>
          <code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">155</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">180</code><code class="p">,</code> <code class="mi">100</code> <code class="o">+</code> <code class="n">k</code> <code class="o">*</code> <code class="mi">120</code><code class="p">)</code>
          <code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
          <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
        <code class="p">}</code>
      <code class="p">}</code>
    <code class="nt">&lt;/script&gt;</code>
  <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>

<p class="author1">This code sets up a few properties and then nests a pair of loops: one for the line caps and one for the joins. Inside the central loop, the current values for the <code class="calibre15">lineCap</code> and <code class="calibre15">lineJoin</code> properties are first set and then displayed in the canvas with the <code class="calibre15">fillText</code> method.</p>

<p class="author1">Using these settings, the code then draws nine shapes with a 20-pixel-wide line, each of which has a different combination of line cap and join settings, as shown in <a data-type="xref" href="#all_the_combinations_of_line_caps_and_jo" class="calibre6">Figure 26-11</a>.</p>

<p class="author1">As you can see, butted line caps are short, square ones are longer, and the round ones are somewhere between the two. Rounded line joins are curved, beveled ones are cut across the corner, and mitered ones have sharp corners. Line joins also apply to joins at angles other than 90 degrees.</p>

<figure class="calibre23"><div id="all_the_combinations_of_line_caps_and_jo" class="figure"><img alt="All the combinations of line caps and joins" src="Images/pmj6_2611.png" class="calibre155"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-11. </span>All the combinations of line caps and joins</h6>
</div></figure>

</div></section>

<section data-type="sect2" data-pdf-bookmark="The miterLimit Property" class="calibre4"><div class="preface" id="miterlimit_property">
<h2 class="calibre28">The miterLimit Property</h2>

<p class="author1">If<a contenteditable="false" data-primary="miterLimit property (HTML5)" data-type="indexterm" id="idm45694670003176" class="calibre6"/> you find that your mitered joins get cut off too short, you can extend them by using the <code class="calibre15">miterLimit</code> property, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">miterLimit</code> <code class="o">=</code> <code class="mi">15</code></pre>

<p class="author1">The default value is <code class="calibre15">10</code>, so you can reduce the miter limit too. If <code class="calibre15">miterLimit</code> is not set to a sufficiently large value for a miter, then sharply mitered joins will simply bevel instead. So, if you are having trouble with your pointed miters, simply increase the value you supply for <code class="calibre15">miterLimit</code> until the miter displays.<a contenteditable="false" data-primary="" data-startref="CHline24" data-type="indexterm" id="idm45694669998056" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="lines24" data-type="indexterm" id="idm45694669995016" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Using Paths" class="calibre4"><div class="preface" id="using_paths">
<h1 class="calibre11">Using Paths</h1>

<p class="author1">The<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="using paths" data-type="indexterm" id="CHpath24" class="calibre6"/><a contenteditable="false" data-primary="paths, using on canvas" data-type="indexterm" id="paths24" class="calibre6"/> previous example made use of two methods to set up paths for the line-drawing methods to follow. The <code class="calibre15">beginPath</code> method sets the start of a path, and <code class="calibre15">closePath</code> sets the end. Inside each path, you can then use various methods for moving the location of drawing and for creating lines, curves, and other shapes. Let’s examine the relevant section from <a data-type="xref" href="#displaying_combinations_of_line_caps_and" class="calibre6">Example 26-12</a>, simplified to create just a single instance of the pattern:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code>  <code class="mi">20</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">155</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">155</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code></pre>

<p class="author1">In this code snippet, a path is started in the first line, and then the drawing location is moved to a position 20 pixels across and 100 down from the top-left corner of the canvas, using a call to the <code class="calibre15">moveTo</code> method.</p>

<p class="author1">This is followed by three calls to <code class="calibre15">lineTo</code>, which draw three lines, first upward to the location (20, 20), then to the right to (155, 20), and then down again to (155, 100). Once this path has been set out, the <code class="calibre15">stroke</code> method is called to lay it down, and finally the path is closed because it’s no longer needed.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">It is essential to close paths as soon as you finish with them; otherwise, you can get some very unexpected results when using multiple paths.</p>
</div>

<section data-type="sect2" data-pdf-bookmark="The moveTo and lineTo Methods" class="calibre4"><div class="preface" id="moveto_and_lineto_methods">
<h2 class="calibre28">The moveTo and lineTo Methods</h2>

<p class="author1">The <code class="calibre15">moveTo</code> and <code class="calibre15">lineTo</code> methods<a contenteditable="false" data-primary="lineTo method (HTML5)" data-type="indexterm" id="idm45694669918392" class="calibre6"/><a contenteditable="false" data-primary="moveTo method (HTML5)" data-type="indexterm" id="idm45694669917256" class="calibre6"/> both take simple <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates as their arguments, with the difference being that <code class="calibre15">moveTo</code> picks up an imaginary pen from the current location and then moves it to a new one, while <code class="calibre15">lineTo</code> draws a line from the current location of the imaginary pen to the new one specified. Or, at least, a line will be drawn if the <code class="calibre15">stroke</code> method is called but not otherwise. So let’s just say that <code class="calibre15">lineTo</code> creates a <em class="hyperlink">potential</em> drawn line, but it could equally be part of the outline for a fill area, for example.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The stroke Method" class="calibre4"><div class="preface" id="stroke_method">
<h2 class="calibre28">The stroke Method</h2>

<p class="author1">The <code class="calibre15">stroke</code> method<a contenteditable="false" data-primary="stroke method (HTML5)" data-type="indexterm" id="idm45694669910728" class="calibre6"/> has the job of actually drawing all the lines created so far in a path onto the canvas. If it is issued from inside an unclosed path, this has the effect of immediately drawing everything up to the most recent imaginary pen location.</p>

<p class="author1">However, if you close a path and then issue a call to <code class="calibre15">stroke</code>, it has the effect of also joining a path from the current location back to the start location, which in this example would turn the shapes into rectangles (which we don’t want because we need to see the line caps as well as joins).</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">This joining effect on closing a path is required (as you will see a little later) to get paths ready for any <code class="calibre15">fill</code> methods you want to use on them; otherwise, the graphics you use for a fill might overflow the bounds of the path.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The rect Method" class="calibre4"><div class="preface" id="rect_method">
<h2 class="calibre28">The rect Method</h2>

<p class="author1">Should<a contenteditable="false" data-primary="rect method (HTML5)" data-type="indexterm" id="idm45694669904344" class="calibre6"/> it have been necessary to create four-sided rectangles instead of the three-sided shapes in the preceding example (and you didn’t wish to close the path yet), another <code class="calibre15">lineTo</code> call could have been issued to join everything up, like this (highlighted in bold):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">(</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">100</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">155</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">155</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">100</code><code class="p">)</code><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">lineTo</code><code class="p1">(</code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">100</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">(</code><code class="p">)</code></pre>

<p class="author1">But there’s a much simpler way to draw outlined rectangles, which is with the <code class="calibre15">rect</code> method, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">rect</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">155</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code></pre>

<p class="author1">In just a single call, this command takes two pairs of <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates and draws a rectangle with its top-left corner at location (20, 20) and bottom-right corner at (155,100).<a contenteditable="false" data-primary="" data-startref="CHpath24" data-type="indexterm" id="idm45694669814488" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="paths24" data-type="indexterm" id="idm45694669813176" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Filling Areas" class="calibre4"><div class="preface" id="filling_areas">
<h1 class="calibre11">Filling Areas</h1>

<p class="author1">Using<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="filing areas" data-type="indexterm" id="idm45694669768344" class="calibre6"/><a contenteditable="false" data-primary="fill patterns" data-type="indexterm" id="idm45694669766936" class="calibre6"/> paths, you can create complicated areas that can also be filled in with solid, gradient, or pattern fills. In <a data-type="xref" href="#filling_in_a_complex_path" class="calibre6">Example 26-13</a>, some basic trigonometry is used to create a complex star pattern. I won’t detail how the math works because that’s not important to the example (although if you want to play with the code, try changing the values assigned to <code class="calibre15">points</code>, and the <code class="calibre15">scale1</code> and <code class="calibre15">scale2</code> variables, for different effects).</p>

<div data-type="example" id="filling_in_a_complex_path" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-13. </span>Filling in a complex path</h5>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code><code class="calibre15">
</code><code class="nt">&lt;html</code><code class="nt">&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;head</code><code class="nt">&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;title</code><code class="nt">&gt;</code><code class="calibre15">Filling a Path</code><code class="nt">&lt;/title&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;script </code><code class="na">src=</code><code class="s">'OSC.js'</code><code class="nt">&gt;</code><code class="nt">&lt;/script&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;/head&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;body</code><code class="nt">&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;canvas</code><code class="calibre15"> </code><code class="na">id=</code><code class="s">'mycanvas'</code><code class="calibre15"> </code><code class="na">width=</code><code class="s">'320'</code><code class="calibre15"> </code><code class="na">height=</code><code class="s">'320'</code><code class="nt">&gt;</code><code class="nt">&lt;/canvas&gt;</code><code class="calibre15">

    </code><code class="nt">&lt;script</code><code class="nt">&gt;</code><code class="calibre15">
      </code><code class="n">canvas</code><code class="calibre15">               </code><code class="o">=</code><code class="calibre15"> </code><code class="n">O</code><code class="p">(</code><code class="s">'mycanvas'</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">context</code><code class="calibre15">              </code><code class="o">=</code><code class="calibre15"> </code><code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code><code class="calibre15">
      </code><code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">)</code><code class="p">.</code><code class="n">background</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="s">'lightblue'</code><code class="calibre15">
      </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">strokeStyle</code><code class="calibre17">  </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'orange'</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillStyle</code><code class="calibre17">    </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'yellow'</code></strong><code class="calibre15">

      </code><code class="n">orig</code><code class="calibre15">   </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">160</code><code class="calibre15">
      </code><code class="n">points</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">21</code><code class="calibre15">
      </code><code class="n">dist</code><code class="calibre15">   </code><code class="o">=</code><code class="calibre15"> </code><code class="nb">Math</code><code class="p">.</code><code class="n">PI</code><code class="calibre15"> </code><code class="o">/</code><code class="calibre15"> </code><code class="n">points</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">2</code><code class="calibre15">
      </code><code class="n">scale1</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">150</code><code class="calibre15">
      </code><code class="n">scale2</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">80</code><code class="calibre15">

      </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">beginPath</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">

      </code><code class="k">for</code><code class="calibre15"> </code><code class="p">(</code><code class="n">j</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">0</code><code class="calibre15"> </code><code class="p">;</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">&lt;</code><code class="calibre15"> </code><code class="n">points</code><code class="calibre15"> </code><code class="p">;</code><code class="calibre15"> </code><code class="o">++</code><code class="n">j</code><code class="p">)</code><code class="calibre15">
      </code><code class="p">{</code><code class="calibre15">
        </code><code class="n">x</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="nb">Math</code><code class="p">.</code><code class="n">sin</code><code class="p">(</code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="n">dist</code><code class="p">)</code><code class="calibre15">
        </code><code class="n">y</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="nb">Math</code><code class="p">.</code><code class="n">cos</code><code class="p">(</code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="n">dist</code><code class="p">)</code><code class="calibre15">
        </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">lineTo</code><code class="p1">(</code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">x</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale1</code><code class="p1">,</code><code class="calibre17"> </code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">y</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale1</code><code class="p1">)</code></strong><code class="calibre15">
        </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">lineTo</code><code class="p1">(</code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">x</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale2</code><code class="p1">,</code><code class="calibre17"> </code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">y</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale2</code><code class="p1">)</code></strong><code class="calibre15">
      </code><code class="p">}</code><code class="calibre15">

      </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">closePath</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">stroke</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fill</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
    </code><code class="nt">&lt;/script&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;/body&gt;</code><code class="calibre15">
</code><code class="nt">&lt;/html&gt;</code></pre>
</div>

<p class="author1">All you really need to look at are the lines highlighted in bold, in which a path is started, a pair of <code class="calibre15">lineTo</code> calls defines the shape, the path is closed, and then the <code class="calibre15">stroke</code> and <code class="calibre15">fill</code> methods are used to draw the shape outline in orange and fill it in with yellow (as shown in <a data-type="xref" href="#drawing_and_filling_in_a_complex_path" class="calibre6">Figure 26-12</a>).</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">With paths, it’s possible to create as complex an object as you like, either using formulae or loops (as in this example) or simply with a long string of <code class="calibre15">moveTo</code> and/or <code class="calibre15">lineTo</code> or other calls.</p>
</div>

<figure class="calibre23"><div id="drawing_and_filling_in_a_complex_path" class="figure"><img alt="Drawing and filling in a complex path" src="Images/pmj6_2612.png" class="calibre156"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-12. </span>Drawing and filling in a complex path</h6>
</div></figure>

</div></section>

<section data-type="sect1" data-pdf-bookmark="The clip Method" class="calibre4"><div class="preface" id="clip_method">
<h1 class="calibre11">The clip Method</h1>

<p class="author1">Sometimes<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="clip method" data-type="indexterm" id="idm45694669629608" class="calibre6"/> when you are building a path, you may want to ignore sections of the canvas (perhaps if you are drawing partly “behind” another object and want only the visible part to display). You can achieve this using the <code class="calibre15">clip</code> method, which creates a boundary outside of which <code class="calibre15">stroke</code>, <code class="calibre15">fill</code>, or other methods will not have any effect.</p>

<p class="author1">To illustrate this, <a data-type="xref" href="#creating_a_clip_area" class="calibre6">Example 26-14</a> creates an effect similar to window blinds by moving the imaginary pen pointer to the left-hand edge, then drawing a <code class="calibre15">lineTo</code> over to the right-hand edge, another down by 30 pixels, and then another back to the left-hand edge, and so on. This creates a sort of snaking pattern in which a series of 30-pixel-deep, horizontal bars are drawn on the canvas, as shown in <a data-type="xref" href="#path_of_horizontal_bars" class="calibre6">Figure 26-13</a>.</p>

<div data-type="example" id="creating_a_clip_area" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-14. </span>Creating a clip area</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">(</code><code class="p">)</code><code class="calibre15">

</code><code class="k">for</code><code class="calibre15"> </code><code class="p">(</code><code class="n">j</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">0</code><code class="calibre15"> </code><code class="p">;</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">&lt;</code><code class="calibre15"> </code><code class="mi">10</code><code class="calibre15"> </code><code class="p">;</code><code class="calibre15"> </code><code class="o">++</code><code class="n">j</code><code class="p">)</code><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code><code class="calibre15">  </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="p">)</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">620</code><code class="p">,</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="p">)</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">620</code><code class="p">,</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="calibre15"> </code><code class="o">+</code><code class="calibre15"> </code><code class="mi">30</code><code class="p">)</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code><code class="calibre15">  </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="calibre15"> </code><code class="o">+</code><code class="calibre15"> </code><code class="mi">30</code><code class="p">)</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">stroke</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">(</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="path_of_horizontal_bars" class="figure"><img alt="A path of horizontal bars" src="Images/pmj6_2613.png" class="calibre157"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-13. </span>A path of horizontal bars</h6>
</div></figure>

<p class="author1">To turn this example into a clipped area of the canvas, you simply need to replace the call to <code class="calibre15">stroke</code> (highlighted in bold in the example) with one to <code class="calibre15">clip</code>, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">clip</code><code class="p">()</code></pre>

<p class="author1">Now the outline of the bars won’t be seen, but a clipping area that consists of all the individual bars will be in place. To illustrate this, <a data-type="xref" href="#drawing_within_the_clipped_areaapostroph" class="calibre6">Example 26-15</a> makes this method substitution and then adds to the previous example by drawing on the canvas a simple picture of green grass below a blue sky containing a shining sun (modified from <a data-type="xref" href="#displaying_combinations_of_line_caps_and" class="calibre6">Example 26-12</a>), with the changes highlighted in bold and the result shown in <a data-type="xref" href="#drawing_occurs_only_within_the_allowed_c" class="calibre6">Figure 26-14</a>.</p>

<div class="calibre41" data-type="example" id="drawing_within_the_clipped_areaapostroph">
<h5 class="calibre42"><span class="keep-together">Example 26-15. </span>Drawing within the clipped area’s bounds</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillStyle</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'white'</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">strokeRect</code><code class="p1">(</code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">600</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">440</code><code class="p1">)</code></strong><code class="calibre15"> </code><code class="c">// Black border
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillRect</code><code class="p1">(</code><code class="calibre17">  </code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">600</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">440</code><code class="p1">)</code></strong><code class="calibre15"> </code><code class="c">// White background
</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">(</code><code class="p">)</code><code class="calibre15">

</code><code class="k">for</code><code class="calibre15"> </code><code class="p">(</code><code class="n">j</code><code class="calibre15"> </code><code class="o">=</code><code class="calibre15"> </code><code class="mi">0</code><code class="calibre15"> </code><code class="p">;</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">&lt;</code><code class="calibre15"> </code><code class="mi">10</code><code class="calibre15"> </code><code class="p">;</code><code class="calibre15"> </code><code class="o">++</code><code class="n">j</code><code class="p">)</code><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code><code class="calibre15">  </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="p">)</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">620</code><code class="p">,</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="p">)</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">620</code><code class="p">,</code><code class="calibre15"> </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="calibre15"> </code><code class="o">+</code><code class="calibre15"> </code><code class="mi">30</code><code class="p">)</code><code class="calibre15">
  </code><code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code><code class="calibre15">  </code><code class="n">j</code><code class="calibre15"> </code><code class="o">*</code><code class="calibre15"> </code><code class="mi">48</code><code class="calibre15"> </code><code class="o">+</code><code class="calibre15"> </code><code class="mi">30</code><code class="p">)</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">clip</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">(</code><code class="p">)</code><code class="calibre15">

</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillStyle</code><code class="calibre17">   </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'blue'</code></strong><code class="calibre15">         </code><code class="c">// Blue sky
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillRect</code><code class="p1">(</code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17">  </code><code class="mi1">600</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">320</code><code class="p1">)</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillStyle</code><code class="calibre17">   </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'green'</code></strong><code class="calibre15">        </code><code class="c">// Green grass
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillRect</code><code class="p1">(</code><code class="mi1">20</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">320</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">600</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">140</code><code class="p1">)</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">strokeStyle</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'orange'</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fillStyle</code><code class="calibre17">   </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">'yellow'</code></strong><code class="calibre15">

</code><strong class="calibre31"><code class="nx1">orig</code><code class="calibre17">   </code><code class="o1">=</code><code class="calibre17"> </code><code class="mi1">170</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">points</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="mi1">21</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">dist</code><code class="calibre17">   </code><code class="o1">=</code><code class="calibre17"> </code><code class="nb1">Math</code><code class="p1">.</code><code class="nx1">PI</code><code class="calibre17"> </code><code class="o1">/</code><code class="calibre17"> </code><code class="nx1">points</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="mi1">2</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">scale1</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="mi1">130</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">scale2</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="mi1">80</code></strong><code class="calibre15">

</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">beginPath</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">

</code><strong class="calibre31"><code class="k1">for</code><code class="calibre17"> </code><code class="p1">(</code><code class="nx1">j</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="mi1">0</code><code class="calibre17"> </code><code class="p1">;</code><code class="calibre17"> </code><code class="nx1">j</code><code class="calibre17"> </code><code class="o1">&lt;</code><code class="calibre17"> </code><code class="nx1">points</code><code class="calibre17"> </code><code class="p1">;</code><code class="calibre17"> </code><code class="o1">++</code><code class="nx1">j</code><code class="p1">)</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nx1">x</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nb1">Math</code><code class="p1">.</code><code class="nx1">sin</code><code class="p1">(</code><code class="nx1">j</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">dist</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nx1">y</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nb1">Math</code><code class="p1">.</code><code class="nx1">cos</code><code class="p1">(</code><code class="nx1">j</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">dist</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">lineTo</code><code class="p1">(</code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">x</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale1</code><code class="p1">,</code><code class="calibre17"> </code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">y</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale1</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">lineTo</code><code class="p1">(</code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">x</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale2</code><code class="p1">,</code><code class="calibre17"> </code><code class="nx1">orig</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">y</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="nx1">scale2</code><code class="p1">)</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">closePath</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">stroke</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">                     </code><code class="c">// Sun outline
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">fill</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">                       </code><code class="c">// Sun fill</code></pre>
</div>

<figure class="calibre23"><div id="drawing_occurs_only_within_the_allowed_c" class="figure"><img alt="Drawing occurs only within the allowed clipped area" src="Images/pmj6_2614.png" class="calibre157"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-14. </span>Drawing occurs only within the allowed clipped area</h6>
</div></figure>

<p class="author1">OK, we’re not going to win any competitions here, but you can see how powerful clipping can be when used effectively.</p>
</div></section>

<section data-type="sect1" data-pdf-bookmark="The isPointInPath Method" class="calibre4"><div class="preface" id="ispointinpath_method">
<h1 class="calibre11">The isPointInPath Method</h1>

<p class="author1">Sometimes<a contenteditable="false" data-primary="isPointInPath method (HTML5)" data-type="indexterm" id="idm45694669166248" class="calibre6"/><a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="isPointInPath method" data-type="indexterm" id="idm45694669165272" class="calibre6"/> you need to know whether a particular point lies in a path you’ve constructed. However, you will probably want to use this function only if you’re quite proficient with JavaScript and with writing fairly complex programs, and you’ll generally call it as part of a conditional <code class="calibre15">if</code> statement, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="k">if</code> <code class="p">(</code><code class="n">context</code><code class="p">.</code><code class="n">isPointInPath</code><code class="p">(</code><code class="mi">23</code><code class="p">,</code> <code class="mi">87</code><code class="p">))</code>
<code class="p">{</code>
  <code class="c">// Do something here</code>
<code class="p">}</code></pre>

<p class="author1">The first argument to the call is the location’s <em class="hyperlink">x</em> coordinate, and the second is the location’s <em class="hyperlink">y</em> coordinate. If the location specified lies along any of the points in the path, the method returns the value <code class="calibre15">true</code>, so the contents of the <code class="calibre15">if</code> statement are executed. Otherwise, the value <code class="calibre15">false</code> is returned, and the contents of the <code class="calibre15">if</code> statement don’t get executed.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">A perfect use for the <code class="calibre15">isPointInPath</code> method is creating games using the canvas in which you wish to check for a missile hitting a target, a ball hitting a wall or bat, or similar boundary conditions.</p>
</div>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Working with Curves" class="calibre4"><div class="preface" id="working_with_curves">
<h1 class="calibre11">Working with Curves</h1>

<p class="author1">In<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="working with curves" data-type="indexterm" id="CHcurve24" class="calibre6"/><a contenteditable="false" data-primary="curves, working with on canvas" data-type="indexterm" id="curves24" class="calibre6"/> addition to straight paths, you can create an almost infinite variety of curved paths with a selection of different methods, ranging from simple arcs and circles to complex quadratic and Bézier curves.</p>

<p class="author1">Actually, you don’t need to use paths to create many lines, rectangles, and curves, because you can draw them directly by simply calling their methods. But using paths gives you more precise control, so I tend to draw on the canvas within defined paths, as with the following examples.</p>

<section data-type="sect2" data-pdf-bookmark="The arc Method" class="calibre4"><div class="preface" id="arc_method">
<h2 class="calibre28">The arc Method</h2>

<p class="author1">The <code class="calibre15">arc</code> method<a contenteditable="false" data-primary="arc method (HTML5)" data-type="indexterm" id="idm45694668802440" class="calibre6"/> requires you to pass it the <em class="hyperlink">x</em> and <em class="hyperlink">y</em> location of the center of the arc, and the radius in pixels. In addition to these values, you need to pass a pair of radian offsets, and you can optionally include a direction, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">55</code><code class="p">,</code> <code class="mi">85</code><code class="p">,</code> <code class="mi">45</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="mi">2</code><code class="p">,</code> <code class="k">false</code><code class="p">)</code></pre>

<p class="author1">Since the default direction is clockwise (a value of <code class="calibre15">false</code>), this can be omitted, or you can change it to <code class="calibre15">true</code> to draw the arc in a counterclockwise direction.</p>

<p class="author1"><a data-type="xref" href="#drawing_a_variety_of_arcs" class="calibre6">Example 26-16</a> creates three sets of four arcs, the first two sets in a clockwise direction and the third set in a counterclockwise direction. Additionally, the first set of four arcs has its paths closed before the <code class="calibre15">stroke</code> method is called, so the start and end points are joined up, whereas the other two sets of arcs are drawn before the path is closed, so they are not joined up.</p>

<div data-type="example" id="drawing_a_variety_of_arcs" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-16. </span>Drawing a variety of arcs</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">strokeStyle</code> <code class="o">=</code> <code class="s">'blue'</code>
<code class="n">arcs</code> <code class="o">=</code>
<code class="p">[</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code><code class="p">,</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">*</code> <code class="mi">2</code><code class="p">,</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="mi">2</code><code class="p">,</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="mi">180</code> <code class="o">*</code> <code class="mi">59</code>
<code class="p">]</code>

<code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">80</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">160</code><code class="p">,</code> <code class="mi">80</code><code class="p">,</code> <code class="mi">70</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="n">arcs</code><code class="p">[</code><code class="n">j</code><code class="p">])</code>
  <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
<code class="p">}</code>

<code class="n">context</code><code class="p">.</code><code class="n">strokeStyle</code> <code class="o">=</code> <code class="s">'red'</code>

<code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">80</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">160</code><code class="p">,</code> <code class="mi">240</code><code class="p">,</code> <code class="mi">70</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="n">arcs</code><code class="p">[</code><code class="n">j</code><code class="p">])</code>
  <code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
<code class="p">}</code>

<code class="n">context</code><code class="p">.</code><code class="n">strokeStyle</code> <code class="o">=</code> <code class="s">'green'</code>

<code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">80</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">160</code><code class="p">,</code> <code class="mi">400</code><code class="p">,</code> <code class="mi">70</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="n">arcs</code><code class="p">[</code><code class="n">j</code><code class="p">],</code> <code class="k">true</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
<code class="p">}</code></pre>
</div>

<p class="author1">To create shorter code, I drew all the arcs using loops so that the length of each arc is stored in the array <code class="calibre15">arcs</code>. These values are in radians, and since a radian is equivalent to 180 ÷ π (π being the ratio of a circle’s circumference to its diameter, or approximately 3.1415927), they evaluate as follows:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">Math.PI</code></dfn></dt>
	<dd class="calibre14">Equivalent to 180 degrees</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">Math.PI * 2</code></dfn></dt>
	<dd class="calibre14">Equivalent to 360 degrees</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">Math.PI / 2</code></dfn></dt>
	<dd class="calibre14">Equivalent to 90 degrees</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">Math.PI / 180 * 59</code></dfn></dt>
	<dd class="calibre14">Equivalent to 59 degrees</dd>
</dl>

<p class="author1"><a data-type="xref" href="#variety_of_arc_types" class="calibre6">Figure 26-15</a> shows the three rows of arcs and illustrates both the use of the direction argument <code class="calibre15">true</code> in the final set and the importance of carefully choosing where you close paths depending on whether you want to draw a line connecting the start and end points.</p>

<figure class="calibre23"><div id="variety_of_arc_types" class="figure"><img alt="A variety of arc types" src="Images/pmj6_2615.png" class="calibre158"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-15. </span>A variety of arc types</h6>
</div></figure>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">If you prefer to work with degrees instead of radians, you could create a new <code class="calibre15">Math</code> library function, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre45">
<code class="nb">Math</code><code class="p">.</code><code class="n">degreesToRadians</code> <code class="o">=</code> <code class="k">function</code><code class="p">(</code><code class="n">degrees</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">return</code> <code class="n">degrees</code> <code class="o">*</code> <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="mi">180</code>
<code class="p">}</code></pre>

<p class="author1">And then replace the array-creating code, starting at the second line of <a data-type="xref" href="#drawing_a_variety_of_arcs" class="calibre6">Example 26-16</a>, with the following:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre45">
<code class="n">arcs</code> <code class="o">=</code>
<code class="p">[</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">degreesToRadians</code><code class="p">(</code><code class="mi">180</code><code class="p">),</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">degreesToRadians</code><code class="p">(</code><code class="mi">360</code><code class="p">),</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">degreesToRadians</code><code class="p">(</code><code class="mi">90</code><code class="p">),</code>
  <code class="nb">Math</code><code class="p">.</code><code class="n">degreesToRadians</code><code class="p">(</code><code class="mi">59</code><code class="p">)</code>
<code class="p">]</code></pre>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The arcTo Method" class="calibre4"><div class="preface" id="arcto_method">
<h2 class="calibre28">The arcTo Method</h2>

<p class="author1">Rather<a contenteditable="false" data-primary="arcTo method (HTML5)" data-type="indexterm" id="idm45694668495608" class="calibre6"/> than creating a whole arc at once, you can choose to arc from the current location in the path to another one, like in the following call to <code class="calibre15">arcTo</code> (which simply requires two pairs of <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates and a radius):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">arcTo</code><code class="p">(</code><code class="mi">100</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">200</code><code class="p">,</code> <code class="mi">200</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code></pre>

<p class="author1">The locations you pass to the method represent the points where imaginary tangent lines touch the circumference of the arc at its start and end points. A tangent is the angle at which a straight line touches the circumference of a circle such that the angles between the line and circle on either side of the point of touch are equal.</p>

<p class="author1">To illustrate how this works, <a data-type="xref" href="#drawing_eight_arcs_of_different_radii" class="calibre6">Example 26-17</a> draws eight different arcs with radii from 0 up to 280 pixels. Each time around the loop, a new path is created with a start point at location (20, 20). Then an arc is drawn using imaginary tangent lines from that location to position (240, 240), and from there to location (460, 20). In this instance, it defines a pair of tangents at 90 degrees to each other, in a <em class="hyperlink">V</em> shape.</p>

<div data-type="example" id="drawing_eight_arcs_of_different_radii" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-17. </span>Drawing eight arcs of different radii</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;=</code> <code class="mi">280</code> <code class="p">;</code> <code class="n">j</code> <code class="o">+=</code> <code class="mi">40</code><code class="p">)</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">arcTo</code><code class="p">(</code><code class="mi">240</code><code class="p">,</code> <code class="mi">240</code><code class="p">,</code> <code class="mi">460</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="n">j</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="mi">460</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>
<code class="p">}</code></pre>
</div>

<p class="author1">The <code class="calibre15">arcTo</code> method draws only up to the point at which the arc touches the second imaginary tangent. So, after each call to <code class="calibre15">arcTo</code>, the <code class="calibre15">lineTo</code> method creates the remainder of the line from wherever <code class="calibre15">arcTo</code> left off to location (460,20). Then the result is drawn to the canvas with a call to <code class="calibre15">stroke</code>, and the path is closed.</p>

<p class="author1">As you can see in <a data-type="xref" href="#drawing_arcs_of_different_radii" class="calibre6">Figure 26-16</a>, when <code class="calibre15">arcTo</code> is called with a radius value of <code class="calibre15">0</code>, it creates a sharp join. In this case, it’s a right angle (but if the two imaginary tangents are at other angles to each other, the join will be at that angle). Then, as the radius increases in size, you can see the arcs getting larger and larger.</p>

<figure class="calibre23"><div id="drawing_arcs_of_different_radii" class="figure"><img alt="Drawing arcs of different radii" src="Images/pmj6_2616.png" class="calibre159"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-16. </span>Drawing arcs of different radii</h6>
</div></figure>

<p class="author1">Essentially, what you can best use <code class="calibre15">arcTo</code> for is to curve from one section of drawing to another, following an arc based on the previous and subsequent positions, as if they were tangential to the arc to be created. If this sounds complicated, don’t worry: you’ll soon get the hang of it and find it’s actually a handy and logical way to draw arcs.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The quadraticCurveTo Method" class="calibre4"><div class="preface" id="quadraticcurveto_method">
<h2 class="calibre28">The quadraticCurveTo Method</h2>

<p class="author1">Useful<a contenteditable="false" data-primary="quadraticCurveTo method (HTML5)" data-type="indexterm" id="idm45694668242776" class="calibre6"/> as arcs are, they are only one type of curve and can be limiting for more-complex designs. But have no fear: there are still more ways to draw curves, such as the <code class="calibre15">quadraticCurveTo</code> method. Using this method, you can place an imaginary attractor near to (or far from) a curve to pull it in that direction, in a similar way to the path of an object in space being pulled by the gravity of the planets and stars it passes. Unlike with gravity, though, the farther away the attractor is, the <em class="hyperlink">more</em> it pulls!</p>

<p class="author1"><a data-type="xref" href="#drawing_a_cloud_with_quadratic_curves" class="calibre6">Example 26-18</a> contains six calls to this method, creating the path for a fluffy cloud, which is then filled in with white. <a data-type="xref" href="#drawing_with_quadratic_curves" class="calibre6">Figure 26-17</a> illustrates how the angles of the dashed line outside the cloud represent the attractor points applied to each curve.</p>

<div data-type="example" id="drawing_a_cloud_with_quadratic_curves" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-18. </span>Drawing a cloud with quadratic curves</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">180</code><code class="p">,</code> <code class="mi">60</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">quadraticCurveTo</code><code class="p">(</code><code class="mi">240</code><code class="p">,</code>   <code class="mi">0</code><code class="p">,</code> <code class="mi">300</code><code class="p">,</code>  <code class="mi">60</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">quadraticCurveTo</code><code class="p">(</code><code class="mi">460</code><code class="p">,</code>  <code class="mi">30</code><code class="p">,</code> <code class="mi">420</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">quadraticCurveTo</code><code class="p">(</code><code class="mi">480</code><code class="p">,</code> <code class="mi">210</code><code class="p">,</code> <code class="mi">340</code><code class="p">,</code> <code class="mi">170</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">quadraticCurveTo</code><code class="p">(</code><code class="mi">240</code><code class="p">,</code> <code class="mi">240</code><code class="p">,</code> <code class="mi">200</code><code class="p">,</code> <code class="mi">170</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">quadraticCurveTo</code><code class="p">(</code><code class="mi">100</code><code class="p">,</code> <code class="mi">200</code><code class="p">,</code> <code class="mi">140</code><code class="p">,</code> <code class="mi">130</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">quadraticCurveTo</code><code class="p">(</code> <code class="mi">40</code><code class="p">,</code>  <code class="mi">40</code><code class="p">,</code> <code class="mi">180</code><code class="p">,</code>  <code class="mi">60</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code> <code class="o">=</code> <code class="s">'white'</code>
<code class="n">context</code><code class="p">.</code><code class="n">fill</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code></pre>
</div>

<figure class="calibre23"><div id="drawing_with_quadratic_curves" class="figure"><img alt="Drawing with quadratic curves" src="Images/pmj6_2617.png" class="calibre159"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-17. </span>Drawing with quadratic curves</h6>
</div></figure>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">Incidentally, to achieve the dotted line around the cloud in this image, I used the <code class="calibre15">stroke</code> method in conjunction with the <code class="calibre15">setLineDash</code> method, which takes a list representing the dash and space lengths. In this instance, I used <code class="calibre15">setLineDash([2, 3])</code>, but you can create dashed lines as complicated as you like, such as <code class="calibre15">setLineDash([1, 2, 1, 3, 5, 1, 2, 4])</code>.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The bezierCurveTo Method" class="calibre4"><div class="preface" id="beziercurveto_method">
<h2 class="calibre28">The bezierCurveTo Method</h2>

<p class="author1">If<a contenteditable="false" data-primary="bezierCurveTo method (HTML5)" data-type="indexterm" id="idm45694668083352" class="calibre6"/> you still don’t find quadratic curves flexible enough for your needs, how about having access to two attractors for each curve? Using the <code class="calibre15">bezierCurveTo</code> method you can do just that, as in <a data-type="xref" href="#creating_a_beacutezier_curve_with_two_at" class="calibre6">Example 26-19</a>, where a curve is created between location (24, 20) and (240, 220) but with invisible attractors off the canvas (in this case) at locations (720, 480) and <span class="keep-together">(–240, –240).</span> <a data-type="xref" href="#beacutezier_curve_with_two_attractors" class="calibre6">Figure 26-18</a> shows how this curve gets warped.</p>

<div data-type="example" id="creating_a_beacutezier_curve_with_two_at" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-19. </span>Creating a Bézier curve with two attractors</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">moveTo</code><code class="p">(</code><code class="mi">240</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">bezierCurveTo</code><code class="p">(</code><code class="mi">720</code><code class="p">,</code> <code class="mi">480</code><code class="p">,</code> <code class="o">-</code><code class="mi">240</code><code class="p">,</code> <code class="o">-</code><code class="mi">240</code><code class="p">,</code> <code class="mi">240</code><code class="p">,</code> <code class="mi">220</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
<code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code></pre>
</div>

<figure class="calibre23"><div id="beacutezier_curve_with_two_attractors" class="figure"><img alt="A Bézier curve with two attractors" src="Images/pmj6_2618.png" class="calibre160"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-18. </span>A Bézier curve with two attractors</h6>
</div></figure>

<p class="author1">Attractors do not need to be at opposite sides of a canvas; you can place them anywhere, and when they are near each other, they will exert a combined pull (rather than opposing pulls, as in the preceding example). Using these various types of curve methods, it’s possible for you to draw every type of curve you could ever need.<a contenteditable="false" data-primary="" data-startref="CHcurve24" data-type="indexterm" id="idm45694667973240" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="curves24" data-type="indexterm" id="idm45694667971928" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Manipulating Images" class="calibre4"><div class="preface" id="manipulating_images">
<h1 class="calibre11">Manipulating Images</h1>

<p class="author1">Not<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="manipulating images" data-type="indexterm" id="CHimage24" class="calibre6"/><a contenteditable="false" data-primary="images" data-secondary="manipulating with canvas" data-type="indexterm" id="image24" class="calibre6"/> only can you draw and write on the canvas with graphical methods, but you can also place images on or extract them from a canvas. And you’re not limited to simple copy-and-paste commands, because you can stretch and distort images when reading or writing them and also have full control over compositing and shadow effects.</p>

<section data-type="sect2" data-pdf-bookmark="The drawImage Method" class="calibre4"><div class="preface" id="drawimage_method">
<h2 class="calibre28">The drawImage Method</h2>

<p class="author1">Using<a contenteditable="false" data-primary="drawImage method (HTML5)" data-type="indexterm" id="idm45694668044952" class="calibre6"/> the <code class="calibre15">drawImage</code> method, you can take an image object that was loaded from a website, uploaded to a server, or even extracted from a canvas and draw it onto a canvas. The method supports a wide variety of arguments, many of which are optional, but at its simplest you call <code class="calibre15">drawImage</code> as follows, passing just the image and a pair of <em class="hyperlink">x</em> and <em class="hyperlink">y</em> coordinates:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code></pre>

<p class="author1">This command draws the image contained in the <code class="calibre15">myimage</code> object onto the canvas with the context of <code class="calibre15">context</code>, with its top-left corner at location (20, 20).</p>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">To ensure that an image has been loaded before you use it, best practice is to enclose your image-handling code within a function that is triggered only upon image load, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre45">
<code class="n">myimage</code>     <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">myimage</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="s">'image.gif'</code>

<code class="n">myimage</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Resizing an Image" class="calibre4"><div class="preface" id="resizing_an_image">
<h2 class="calibre28">Resizing an Image</h2>

<p class="author1">If you need to resize an image when it is placed on the canvas, add a second pair of arguments to the call representing the width and height you require, like this (highlighted in bold):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">140</code><code class="p">,</code><code class="calibre15">  </code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">220</code></strong><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">220</code></strong><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">380</code><code class="p">,</code><code class="calibre15">  </code><code class="mi">20</code><code class="p">,</code><code class="calibre15">  </code><strong class="calibre31"><code class="mi1">80</code></strong><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">220</code></strong><code class="p">)</code></pre>

<p class="author1">Here the image is placed at two locations: the first is at (140, 20), where the image is enlarged (from a 100-pixel square to a 220-pixel square), while the second goes to location (380, 20) with the image being squashed horizontally and expanded vertically, to a width and height of 80 × 220 pixels.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Selecting an Image Area" class="calibre4"><div class="preface" id="selecting_an_image_area">
<h2 class="calibre28">Selecting an Image Area</h2>

<p class="author1">You’re not stuck having to use an entire image; it’s also possible to choose an area within an image when using <code class="calibre15">drawImage</code>. This can be handy, for example, if you wish to place all the graphical images you intend to use in a single image file and then just grab the sections of the image that you need. This is a trick developers often use to speed up page loading and decrease server hits.</p>

<p class="author1">It’s a little trickier to do this, though, because rather than adding more arguments at the end of the list for this method, when extracting a portion of an image, you must place those arguments first.</p>

<p class="author1">So, for example, to place an image at location (20, 140), you might issue this <span class="keep-together">command:</span></p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">140</code><code class="p">)</code></pre>

<p class="author1">And to give it a width and height of 100 × 100 pixels, you would modify the call like this (highlighted in bold):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">140</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">100</code></strong><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">100</code></strong><code class="p">)</code></pre>

<p class="author1">But to grab (or crop) just a 40 × 40–pixel subsection (for example), with its top-left corner at location (30, 30) of the image, you would call the method like this (with the new arguments in bold):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">30</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">30</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">40</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">40</code><code class="p1">,</code></strong><code class="calibre15"> </code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">140</code><code class="p">)</code></pre>

<p class="author1">And to resize the grabbed portion to 100 pixels square, you would use the following:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">30</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">30</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">40</code><code class="p1">,</code><code class="calibre17"> </code><code class="mi1">40</code></strong><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">140</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">100</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">100</code><code class="p">)</code></pre>

<div data-type="warning" epub:type="warning" class="calibre21"><h6 class="calibre22">Warning</h6>
<p class="author1">I find this very confusing and cannot think of a logical reason for why this method works this way. But since it does, I’m afraid there’s nothing you can do other than force yourself to remember which arguments go where under which conditions.</p>
</div>

<p class="author1"><a data-type="xref" href="#various_ways_of_drawing_an_image_on_the" class="calibre6">Example 26-20</a> uses a variety<a contenteditable="false" data-primary="drawImage method (HTML5)" data-type="indexterm" id="idm45694667680904" class="calibre6"/> of calls to the <code class="calibre15">drawImage</code> method to obtain the result shown in <a data-type="xref" href="Images/#drawing_images_to_a_canvas_with_resizing" class="calibre6">Figure 26-19</a>. To make things clearer, I have spaced out the arguments so that the values in each column provide the same information.</p>

<div data-type="example" id="various_ways_of_drawing_an_image_on_the" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-20. </span>Various ways of drawing an image on the canvas</h5>

<pre class="calibre29" data-code-language="javascript" data-programming-language="perl">
<code class="n">myimage</code>     <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">myimage</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="s">'image.png'</code>

<code class="n">myimage</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code>                  <code class="mi">20</code><code class="p">,</code>  <code class="mi">20</code>          <code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code>                 <code class="mi">140</code><code class="p">,</code>  <code class="mi">20</code><code class="p">,</code> <code class="mi">220</code><code class="p">,</code> <code class="mi">220</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code>                 <code class="mi">380</code><code class="p">,</code>  <code class="mi">20</code><code class="p">,</code>  <code class="mi">80</code><code class="p">,</code> <code class="mi">220</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">30</code><code class="p">,</code> <code class="mi">30</code><code class="p">,</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">40</code><code class="p">,</code>  <code class="mi">20</code><code class="p">,</code> <code class="mi">140</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>

<figure class="calibre23"><div id="drawing_images_to_a_canvas_with_resizing" class="figure"><img alt="Drawing images to a canvas with resizing and cropping" src="Images/pmj6_2619.png" class="calibre161"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-19. </span>Drawing images to a canvas with resizing and cropping</h6>
</div></figure>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Copying from a Canvas" class="calibre4"><div class="preface" id="copying_from_a_canvas">
<h2 class="calibre28">Copying from a Canvas</h2>

<p class="author1">You<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="copying from canvas" data-type="indexterm" id="idm45694667597432" class="calibre6"/> can also use a canvas as a source image for drawing to the same (or another) canvas. Just supply the canvas object’s name in place of an image object, and use all the remaining arguments in the same way you would with an image.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Adding Shadows" class="calibre4"><div class="preface" id="adding_shadows">
<h2 class="calibre28">Adding Shadows</h2>

<p class="author1">When<a contenteditable="false" data-primary="shadows, adding to canvas" data-type="indexterm" id="idm45694667593560" class="calibre6"/> you draw an image (or image section), or, indeed, anything else on the canvas, you can also place a shadow under it by setting one or more of the following properties:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">shadowOffsetX</code></dfn></dt>
	<dd class="calibre14">The horizontal offset in pixels by which the shadow should be shifted to the right (or to the left if the value is negative).</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">shadowOffsetY</code></dfn></dt>
	<dd class="calibre14">The vertical offset in pixels by which the shadow should be shifted down (or up if the value is negative).</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">shadowBlur</code></dfn></dt>
	<dd class="calibre14">The number of pixels over which to blur the shadow’s outline.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">shadowColor</code></dfn></dt>
	<dd class="calibre14">The base color to use for the shadow. If a blur is in use, this color will blend with the background in the blurred area.</dd>
</dl>

<p class="author1">These properties can apply to text and lines as well as solid images, as demonstrated in <a data-type="xref" href="#applying_shadows_when_drawing_on_the_can" class="calibre6">Example 26-21</a>, in which some text, an image, and an object created using a path all have shadows added to them. In <a data-type="xref" href="#shadows_under_different_types_of_drawing" class="calibre6">Figure 26-20</a>, you can see that the shadows intelligently flow around the visible portions of images, not just their rectangular <span class="keep-together">boundaries.</span></p>

<div data-type="example" id="applying_shadows_when_drawing_on_the_can" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-21. </span>Applying shadows when drawing on the canvas</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">myimage</code>     <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">myimage</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="s">'apple.png'</code>

<code class="n">orig</code>   <code class="o">=</code> <code class="mi">95</code>
<code class="n">points</code> <code class="o">=</code> <code class="mi">21</code>
<code class="n">dist</code>   <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="n">points</code> <code class="o">*</code> <code class="mi">2</code>
<code class="n">scale1</code> <code class="o">=</code> <code class="mi">75</code>
<code class="n">scale2</code> <code class="o">=</code> <code class="mi">50</code>

<code class="n">myimage</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">beginPath</code><code class="p">()</code>

  <code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="n">points</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="n">x</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="n">sin</code><code class="p">(</code><code class="n">j</code> <code class="o">*</code> <code class="n">dist</code><code class="p">)</code>
    <code class="n">y</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="n">cos</code><code class="p">(</code><code class="n">j</code> <code class="o">*</code> <code class="n">dist</code><code class="p">)</code>
    <code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="n">orig</code> <code class="o">+</code> <code class="n">x</code> <code class="o">*</code> <code class="n">scale1</code><code class="p">,</code> <code class="n">orig</code> <code class="o">+</code> <code class="n">y</code> <code class="o">*</code> <code class="n">scale1</code><code class="p">)</code>
    <code class="n">context</code><code class="p">.</code><code class="n">lineTo</code><code class="p">(</code><code class="n">orig</code> <code class="o">+</code> <code class="n">x</code> <code class="o">*</code> <code class="n">scale2</code><code class="p">,</code> <code class="n">orig</code> <code class="o">+</code> <code class="n">y</code> <code class="o">*</code> <code class="n">scale2</code><code class="p">)</code>
  <code class="p">}</code>

  <code class="n">context</code><code class="p">.</code><code class="n">closePath</code><code class="p">()</code>

  <code class="n">context</code><code class="p">.</code><code class="n">shadowOffsetX</code> <code class="o">=</code> <code class="mi">5</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowOffsetY</code> <code class="o">=</code> <code class="mi">5</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowBlur</code>    <code class="o">=</code> <code class="mi">6</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowColor</code>   <code class="o">=</code> <code class="s">'#444'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code>     <code class="o">=</code> <code class="s">'red'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">stroke</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fill</code><code class="p">()</code>

  <code class="n">context</code><code class="p">.</code><code class="n">shadowOffsetX</code> <code class="o">=</code> <code class="mi">2</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowOffsetY</code> <code class="o">=</code> <code class="mi">2</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowBlur</code>    <code class="o">=</code> <code class="mi">3</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowColor</code>   <code class="o">=</code> <code class="s">'yellow'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">font</code>          <code class="o">=</code> <code class="s">'bold 36pt Times'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">textBaseline</code>  <code class="o">=</code> <code class="s">'top'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code>     <code class="o">=</code> <code class="s">'green'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">fillText</code><code class="p">(</code><code class="s">'Sale now on!'</code><code class="p">,</code> <code class="mi">200</code><code class="p">,</code> <code class="mi">5</code><code class="p">)</code>

  <code class="n">context</code><code class="p">.</code><code class="n">shadowOffsetX</code> <code class="o">=</code> <code class="mi">3</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowOffsetY</code> <code class="o">=</code> <code class="mi">3</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowBlur</code>    <code class="o">=</code> <code class="mi">5</code>
  <code class="n">context</code><code class="p">.</code><code class="n">shadowColor</code>   <code class="o">=</code> <code class="s">'black'</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">245</code><code class="p">,</code> <code class="mi">45</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>

<figure class="calibre23"><div id="shadows_under_different_types_of_drawing" class="figure"><img alt="Shadows under different types of drawing objects" src="Images/pmj6_2620.png" class="calibre162"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-20. </span>Shadows under different types of drawing objects</h6>
</div></figure>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Editing at the Pixel Level" class="calibre4"><div class="preface" id="editing_at_the_pixel_level">
<h1 class="calibre11">Editing at the Pixel Level</h1>

<p class="author1">Not<a contenteditable="false" data-primary="" data-startref="CHimage24" data-type="indexterm" id="idm45694667571688" class="calibre6"/><a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="editing at pixel level" data-type="indexterm" id="CHpixe24" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="image24" data-type="indexterm" id="idm45694667236936" class="calibre6"/><a contenteditable="false" data-primary="images" data-secondary="editing at pixel level" data-type="indexterm" id="idm45694667235560" class="calibre6"/> only does the HTML5 canvas provide you with a powerful range of drawing methods, but it also lets you get your hands dirty and work under the hood directly at the pixel level with a trio of powerful methods.</p>

<section data-type="sect2" data-pdf-bookmark="The getImageData Method" class="calibre4"><div class="preface" id="getimagedata_method">
<h2 class="calibre28">The getImageData Method</h2>

<p class="author1">With the <code class="calibre15">getImageData</code> method, you<a contenteditable="false" data-primary="getImageData method (HTML5)" data-type="indexterm" id="idm45694667231416" class="calibre6"/> can grab a portion (or all) of a canvas so that you can alter the retrieved data in any way you like and then save it back or elsewhere in the canvas (or to another canvas).</p>

<p class="author1">To illustrate how this works, <a data-type="xref" href="#manipulating_image_data" class="calibre6">Example 26-22</a> first loads in a ready-made image and draws it onto a canvas. Then the canvas data is read back into an object called <code class="calibre15">idata</code>, where all the colors are averaged together to change each pixel to grayscale and then tweaked a little to shift each color toward sepia, as shown in <a data-type="xref" href="#converting_an_image_to_sepia_left_parent" class="calibre6">Figure 26-21</a>. The following section explains the <code class="calibre15">data</code> array of pixels and what happens when the value <code class="calibre15">50</code> is added to or subtracted from an element of the array.</p>

<div data-type="example" id="manipulating_image_data" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-22. </span>Manipulating image data</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">myimage</code>             <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">myimage</code><code class="p">.</code><code class="n">src</code>         <code class="o">=</code> <code class="s">'photo.jpg'</code>
<code class="n">myimage</code><code class="p">.</code><code class="n">crossOrigin</code> <code class="o">=</code> <code class="s">''</code>

<code class="n">myimage</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
  <code class="n">idata</code> <code class="o">=</code> <code class="n">context</code><code class="p">.</code><code class="n">getImageData</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="n">myimage</code><code class="p">.</code><code class="n">width</code><code class="p">,</code> <code class="n">myimage</code><code class="p">.</code><code class="n">height</code><code class="p">)</code>

  <code class="k">for</code> <code class="p">(</code><code class="n">y</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">y</code> <code class="o">&lt;</code> <code class="n">myimage</code><code class="p">.</code><code class="n">height</code> <code class="p">;</code> <code class="o">++</code><code class="n">y</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="n">pos</code> <code class="o">=</code> <code class="n">y</code> <code class="o">*</code> <code class="n">myimage</code><code class="p">.</code><code class="n">width</code> <code class="o">*</code> <code class="mi">4</code>

    <code class="k">for</code> <code class="p">(</code><code class="n">x</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">x</code> <code class="o">&lt;</code> <code class="n">myimage</code><code class="p">.</code><code class="n">width</code> <code class="p">;</code> <code class="o">++</code><code class="n">x</code><code class="p">)</code>
    <code class="p">{</code>
      <code class="n">average</code> <code class="o">=</code>
      <code class="p">(</code>
        <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code><code class="p">]</code>     <code class="o">+</code>
        <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code> <code class="o">+</code>
        <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">2</code><code class="p">]</code>
      <code class="p">)</code> <code class="o">/</code> <code class="mi">3</code>

      <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code><code class="p">]</code>     <code class="o">=</code> <code class="n">average</code> <code class="o">+</code> <code class="mi">50</code>
      <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code> <code class="o">=</code> <code class="n">average</code>
      <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">2</code><code class="p">]</code> <code class="o">=</code> <code class="n">average</code> <code class="o">-</code> <code class="mi">50</code>
      <code class="n">pos</code> <code class="o">+=</code> <code class="mi">4</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="n">context</code><code class="p">.</code><code class="n">putImageData</code><code class="p">(</code><code class="n">idata</code><code class="p">,</code> <code class="mi">320</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>

<figure class="calibre23"><div id="converting_an_image_to_sepia_left_parent" class="figure"><img alt="Converting an image to sepia (only a minor difference will be seen when this figure is viewed in gray scale)" src="Images/pmj6_2621.png" class="calibre163"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-21. </span>Converting an image to sepia (only a minor difference will be seen when this figure is viewed in grayscale)</h6>
</div></figure>

<section data-type="sect3" data-pdf-bookmark="The data array" class="calibre4"><div class="preface" id="data_array">
<h3 class="calibre43">The data array</h3>

<p class="author1">This image manipulation works thanks to the <code class="calibre15">data</code> array, which is a property of the <code class="calibre15">idata</code> object returned by the call to <code class="calibre15">getImageData</code>. This method returns an array containing all the pixel data for the selected area in its component parts of red, green, blue, and alpha transparency. Therefore, four items of data are used to store each colored pixel.</p>

<p class="author1">Many<a contenteditable="false" data-primary="cross-origin security" data-type="indexterm" id="idm45694666981960" class="calibre6"/><a contenteditable="false" data-primary="security issues" data-secondary="cross-origin security" data-type="indexterm" id="idm45694666980936" class="calibre6"/><a contenteditable="false" data-primary="crossOrigin attribute" data-type="indexterm" id="idm45694666979560" class="calibre6"/><a contenteditable="false" data-primary="AMPPS server" data-secondary="cross-origin security" data-type="indexterm" id="idm45694666978456" class="calibre6"/> recent browsers have adopted strict security measures to prevent cross-origin exploits, which is why we have to add the <code class="calibre15">crossOrigin</code> attribute with a value of the empty string (representing the default of <code class="calibre15">'anonymous'</code>) to the <code class="calibre15">myimage</code> object in this example, to expressly allow the image data to be read. For the same security reasons, the example will only work correctly when served from a web server (such as a server online or the AMPPS installation from <a data-type="xref" href="ch02.xhtml#setting_up_a_development_server" class="calibre6">Chapter 2</a>); it will not work correctly when just loaded in from a local filesystem.</p>

<p class="author1">All the data is stored sequentially in the <code class="calibre15">data</code> array, such that the value for red is followed by that for blue, then green, and then alpha; then, the next item in the array is the red value for the following pixel, and so on. So, you’ll have the following for the pixel at location (0, 0):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="c">// Red level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="c">// Green level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code> <code class="c">// Blue level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">3</code><code class="p">]</code> <code class="c">// Alpha level</code></pre>

<p class="author1">Location (1, 0) then follows, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">4</code><code class="p">]</code> <code class="c">// Red level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code> <code class="c">// Green level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">6</code><code class="p">]</code> <code class="c">// Blue level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">7</code><code class="p">]</code> <code class="c">// Alpha level</code></pre>

<p class="author1">In this image, everything continues in the same fashion until the rightmost pixel of the image in row 0—which is the 320th pixel, at location (319, 0)—is reached. At that point, the value 319 is multiplied by 4 (the number of items of data in each pixel) to arrive at the following array elements, which contain this pixel’s data:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1276</code><code class="p">]</code> <code class="c">// Red level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1277</code><code class="p">]</code> <code class="c">// Green level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1278</code><code class="p">]</code> <code class="c">// Blue level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1279</code><code class="p">]</code> <code class="c">// Alpha level</code></pre>

<p class="author1">This causes the data pointer to move all the way back to the first column of the image, but this time of row 1, at location (0, 1) which (because each row in this image is 320 pixels wide) is at an offset of (0 × 4) + (1 × 320 × 4), or 1,280:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1280</code><code class="p">]</code> <code class="c">// Red level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1281</code><code class="p">]</code> <code class="c">// Green level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1282</code><code class="p">]</code> <code class="c">// Blue level</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="mi">1283</code><code class="p">]</code> <code class="c">// Alpha level</code></pre>

<p class="author1">So, if the image data is stored in <code class="calibre15">idata</code>, the image width in <code class="calibre15">w</code>, and the pixel location to access in <code class="calibre15">x</code> and <code class="calibre15">y</code>, the key formulae to use when directly accessing image data are:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">red</code>   <code class="o">=</code> <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">x</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="n">y</code> <code class="o">*</code> <code class="n">w</code> <code class="o">*</code> <code class="mi">4</code>    <code class="p">]</code>
<code class="n">green</code> <code class="o">=</code> <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">x</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="n">y</code> <code class="o">*</code> <code class="n">w</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code>
<code class="n">blue</code>  <code class="o">=</code> <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">x</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="n">y</code> <code class="o">*</code> <code class="n">w</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="mi">2</code><code class="p">]</code>
<code class="n">alpha</code> <code class="o">=</code> <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">x</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="n">y</code> <code class="o">*</code> <code class="n">w</code> <code class="o">*</code> <code class="mi">4</code> <code class="o">+</code> <code class="mi">3</code><code class="p">]</code></pre>

<p class="author1">Using this knowledge, we create the sepia effect in <a data-type="xref" href="#drawing_and_filling_in_a_complex_path" class="calibre6">Figure 26-12</a> by taking just the red, blue, and green components of each pixel and averaging them, like this (where <code class="calibre15">pos</code> is a variable pointer to the location in the array of the current pixel):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">average</code> <code class="o">=</code>
<code class="p">(</code>
  <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code><code class="p">]</code>     <code class="o">+</code>
  <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code> <code class="o">+</code>
  <code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">2</code><code class="p">]</code>
<code class="p">)</code> <code class="o">/</code> <code class="mi">3</code></pre>

<p class="author1">With <code class="calibre15">average</code> now containing the average color value (which we attain by adding all the pixel values and dividing by 3), this value is written back to all colors of the pixel but with the red boosted by a value of <code class="calibre15">50</code> and the blue reduced by the same amount:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code><code class="p">]</code>     <code class="o">=</code> <code class="n">average</code> <code class="o">+</code> <code class="mi">50</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">1</code><code class="p">]</code> <code class="o">=</code> <code class="n">average</code>
<code class="n">idata</code><code class="p">.</code><code class="n">data</code><code class="p">[</code><code class="n">pos</code> <code class="o">+</code> <code class="mi">2</code><code class="p">]</code> <code class="o">=</code> <code class="n">average</code> <code class="o">-</code> <code class="mi">50</code></pre>

<p class="author1">The result is to increase the red and reduce the blue level of each pixel (of what would otherwise now become a monochrome image, if only the average value were written back to these colors), giving it a sepia cast.</p>
</div></section>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The putImageData Method" class="calibre4"><div class="preface" id="putimagedata_method">
<h2 class="calibre28">The putImageData Method</h2>

<p class="author1">When<a contenteditable="false" data-primary="putImageData method (HTML5)" data-type="indexterm" id="idm45694666497368" class="calibre6"/> you’ve modified the image data array to your requirements, all you need to do to write it to the canvas, as shown in the previous example, is call the <code class="calibre15">putImageData</code> method, passing it the <code class="calibre15">idata</code> object and the coordinates of the top-left corner at which it should appear. The call shown earlier places the modified copy of the image to the right of the original:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">putImageData</code><code class="p">(</code><code class="n">idata</code><code class="p">,</code> <code class="mi">320</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code></pre>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">If you wish to modify only part of a canvas, you don’t have to grab the entire canvas; just fetch a section containing the area in which you are interested. And neither do you have to write back image data to the location from where you got it; image data can be written to any part of a canvas.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The createImageData Method" class="calibre4"><div class="preface" id="createimagedata_method">
<h2 class="calibre28">The createImageData Method</h2>

<p class="author1">You<a contenteditable="false" data-primary="createImageData method (HTML5)" data-type="indexterm" id="idm45694666488184" class="calibre6"/> don’t have to create an object directly from a canvas; you can also create a new one with blank data by calling the <code class="calibre15">createImageData</code> method. The following example creates an object with a width of 320 and height of 240 pixels:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">idata</code> <code class="o">=</code> <code class="n">createImageData</code><code class="p">(</code><code class="mi">320</code><code class="p">,</code> <code class="mi">240</code><code class="p">)</code></pre>

<p class="author1">Alternatively, you can create a new object from an existing object, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">newimagedataobject</code> <code class="o">=</code> <code class="n">createImageData</code><code class="p">(</code><code class="n">imagedata</code><code class="p">)</code></pre>

<p class="author1">It’s then up to you how you add pixel data to these objects or otherwise modify them, how you paste them onto the canvas or create other objects from them, and so on.<a contenteditable="false" data-primary="" data-startref="CHpixe24" data-type="indexterm" id="idm45694666474600" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Advanced Graphical Effects" class="calibre4"><div class="preface" id="advanced_graphical_effects">
<h1 class="calibre11">Advanced Graphical Effects</h1>

<p class="author1">Among<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="graphical effects" data-type="indexterm" id="CHgraph24" class="calibre6"/><a contenteditable="false" data-primary="graphical effects" data-type="indexterm" id="grapheff24" class="calibre6"/><a contenteditable="false" data-primary="graphical effects" data-see="also canvas (HTML5)" data-type="indexterm" id="idm45694666471144" class="calibre6"/> the more advanced features available on the HTML5 canvas is the ability to assign various compositing and transparency effects, as well as to apply powerful transformations such as scaling, stretching, and rotating.</p>

<section data-type="sect2" data-pdf-bookmark="The globalCompositeOperation Property" class="calibre4"><div class="preface" id="globalcompositeoperation_property">
<h2 class="calibre28">The globalCompositeOperation Property</h2>

<p class="author1">There<a contenteditable="false" data-primary="globalCompositeOperation property (HTML5)" data-type="indexterm" id="idm45694666386024" class="calibre6"/> are 12 different methods available to fine-tune the way you place an object on the canvas, taking into account existing and future objects. These are called <em class="hyperlink">compositing</em> options, and they are applied like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">globalCompositeOperationProperty</code> <code class="o">=</code> <code class="s">'source-over'</code></pre>

<p class="author1">The compositing types are as follows:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">source-over</code></dfn></dt>
	<dd class="calibre14">The default. The source image is copied over the destination image.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">source-in</code></dfn></dt>
	<dd class="calibre14">Only parts of the source image that will appear within the destination are shown, and the destination image is removed. Any alpha transparency in the source image causes the destination under it to be removed.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">source-out</code></dfn></dt>
	<dd class="calibre14">Only parts of the source image that do not appear within the destination are shown, and the destination image is removed. Any alpha transparency in the source image causes the destination under it to be removed.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">source-atop</code></dfn></dt>
	<dd class="calibre14">The source image is displayed where it overlays the destination. The destination image is displayed where the destination image is opaque and the source image is transparent. Other regions are transparent.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">destination-over</code></dfn></dt>
	<dd class="calibre14">The source image is drawn under the destination image.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">destination-in</code></dfn></dt>
	<dd class="calibre14">The destination image displays where the source and destination image overlap but not in any areas of source image transparency. The source image does not display.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">destination-out</code></dfn></dt>
	<dd class="calibre14">Only those parts of the destination outside of the source image’s nontransparent sections are shown. The source image does not display.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">destination-atop</code></dfn></dt>
	<dd class="calibre14">The source image displays where the destination is not displayed. Where the destination and source overlap, the destination image is displayed. Any transparency in the source image prevents that area of the destination image being shown.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">lighter</code></dfn></dt>
	<dd class="calibre14">The sum of the source and destination is applied such that where they do not overlap, they display as normal; where they do overlap, the sum of both images is shown but lightened.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">darker</code></dfn></dt>
	<dd class="calibre14">The sum of the source and destination is applied such that where they do not overlap, they display as normal; where they do overlap, the sum of both images is shown but darkened.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">copy</code></dfn></dt>
	<dd class="calibre14">The source image is copied over the destination. Any transparent area of the source causes any destination that it overlaps to not display.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">xor</code></dfn></dt>
	<dd class="calibre14">Where the source and destination images do not overlap, they display as normal. Where they do overlap, their color values are exclusive-ored.</dd>
</dl>

<p class="author1"><a data-type="xref" href="#using_all_12_types_of_compositing_effect" class="calibre6">Example 26-23</a> illustrates the effect of all of these compositing types by creating 12 different canvases, each with two objects (a filled circle and the yin-yang image) offset from each other but overlapping.</p>

<div data-type="example" id="using_all_12_types_of_compositing_effect" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-23. </span>Using all 12 types of compositing effects</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">image</code>     <code class="o">=</code> <code class="k">new</code> <code class="n">Image</code><code class="p">()</code>
<code class="n">image</code><code class="p">.</code><code class="n">src</code> <code class="o">=</code> <code class="s">'image.png'</code>

<code class="n">image</code><code class="p">.</code><code class="n">onload</code> <code class="o">=</code> <code class="k">function</code><code class="p">()</code>
<code class="p">{</code>
  <code class="n">types</code> <code class="o">=</code>
  <code class="p">[</code>
    <code class="s">'source-over'</code><code class="p">,</code>     <code class="s">'source-in'</code><code class="p">,</code>        <code class="s">'source-out'</code><code class="p">,</code>
    <code class="s">'source-atop'</code><code class="p">,</code>     <code class="s">'destination-over'</code><code class="p">,</code> <code class="s">'destination-in'</code><code class="p">,</code>
    <code class="s">'destination-out'</code><code class="p">,</code> <code class="s">'destination-atop'</code><code class="p">,</code> <code class="s">'lighter'</code><code class="p">,</code>
    <code class="s">'darker'</code><code class="p">,</code>          <code class="s">'copy'</code><code class="p">,</code>             <code class="s">'xor'</code>
  <code class="p">]</code>

  <code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">12</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="n">canvas</code>               <code class="o">=</code> <code class="n">O</code><code class="p">(</code><code class="s">'c'</code> <code class="o">+</code> <code class="p">(</code><code class="n">j</code> <code class="o">+</code> <code class="mi">1</code><code class="p">))</code>
    <code class="n">context</code>              <code class="o">=</code> <code class="n">canvas</code><code class="p">.</code><code class="n">getContext</code><code class="p">(</code><code class="s">'2d'</code><code class="p">)</code>
    <code class="n">S</code><code class="p">(</code><code class="n">canvas</code><code class="p">).</code><code class="n">background</code> <code class="o">=</code> <code class="s">'lightblue'</code>
    <code class="n">context</code><code class="p">.</code><code class="n">fillStyle</code>    <code class="o">=</code> <code class="s">'red'</code>

    <code class="n">context</code><code class="p">.</code><code class="n">arc</code><code class="p">(</code><code class="mi">50</code><code class="p">,</code> <code class="mi">50</code><code class="p">,</code> <code class="mi">50</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">*</code> <code class="mi">2</code><code class="p">,</code> <code class="k">false</code><code class="p">)</code>
    <code class="n">context</code><code class="p">.</code><code class="n">fill</code><code class="p">()</code>
    <code class="n">context</code><code class="p">.</code><code class="n">globalCompositeOperation</code> <code class="o">=</code> <code class="n">types</code><code class="p">[</code><code class="n">j</code><code class="p">]</code>
    <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">image</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">As with some other examples in this chapter, this example (downloadable from the companion website) includes some HTML and/or CSS to enhance the display, which isn’t shown here because it’s not essential to the program’s operation.</p>
</div>

<p class="author1">This program uses a <code class="calibre15">for</code> loop to iterate through each compositing type, as stored in the array <code class="calibre15">types</code>. Each time around the loop, a new context is created on the next of the 12 canvas elements already created in some earlier HTML (not shown), with the IDs of <code class="calibre15">c1</code> through <code class="calibre15">c12</code>.</p>

<p class="author1">In each canvas, a 100-pixel-diameter red circle is first placed at the top left, and then the compositing type is selected and the yin-yang image is placed over the circle but offset to the right and down by 20 pixels. <a data-type="xref" href="#one2_compositing_effects_in_action" class="calibre6">Figure 26-22</a> shows the results of each type in action. As you can see, it’s possible to achieve a wide variety of effects.</p>

<figure class="calibre23"><div id="one2_compositing_effects_in_action" class="figure"><img alt="The 12 compositing effects in action" src="Images/pmj6_2622.png" class="calibre164"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-22. </span>The 12 compositing effects in action</h6>
</div></figure>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The globalAlpha Property" class="calibre4"><div class="preface" id="globalalpha_property">
<h2 class="calibre28">The globalAlpha Property</h2>

<p class="author1">When<a contenteditable="false" data-primary="globalAlpha property (HTML5)" data-type="indexterm" id="idm45694666173368" class="calibre6"/> drawing on the canvas, you can specify the amount of transparency to apply using the <code class="calibre15">globalAlpha</code> property, which supports values from <code class="calibre15">0</code> (fully transparent) to <code class="calibre15">1</code> (fully opaque). The following command sets the alpha to a value of <code class="calibre15">0.9</code>, such that future draw operations will be 90% opaque (or 10% transparent):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">globalAlpha</code> <code class="o">=</code> <code class="mi">0.9</code></pre>

<p class="author1">This property can be used with all other properties, including the compositing options.<a contenteditable="false" data-primary="" data-startref="CHgraph24" data-type="indexterm" id="idm45694666167080" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="grapheff24" data-type="indexterm" id="idm45694666165336" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Transformations" class="calibre4"><div class="preface" id="transformations-id00119">
<h1 class="calibre11">Transformations</h1>

<p class="author1">The<a contenteditable="false" data-primary="canvas (HTML5)" data-secondary="transformations" data-type="indexterm" id="CHtrans24" class="calibre6"/><a contenteditable="false" data-primary="transformations" data-secondary="in canvas" data-type="indexterm" id="TRcanvas24" class="calibre6"/> canvas supports four functions for applying transformations to elements when drawing them to the HTML5 canvas: <code class="calibre15">scale</code>, <code class="calibre15">rotate</code>, <code class="calibre15">translate</code>, and <code class="calibre15">transform</code>. They can be used alone or together to produce even more interesting effects.</p>

<section data-type="sect2" data-pdf-bookmark="The scale Method" class="calibre4"><div class="preface" id="scale_method">
<h2 class="calibre28">The scale Method</h2>

<p class="author1">You<a contenteditable="false" data-primary="scale method (HTML5)" data-type="indexterm" id="idm45694666153256" class="calibre6"/> can scale future drawing operations by first calling the <code class="calibre15">scale</code> method. This method takes horizontal and vertical scaling factors, which can be negative, zero, or positive.</p>

<p class="author1">In <a data-type="xref" href="#scaling_up_and_down_in_size" class="calibre6">Example 26-24</a>, the yin-yang image is drawn to the canvas at its original size of 100 × 100 pixels. Then scaling of three times horizontally and two times vertically is applied, and the <code class="calibre15">drawImage</code> function is called again to place the stretched image next to the original. Finally, scaling is reapplied with values of <code class="calibre15">0.33</code> and <code class="calibre15">0.5</code> to restore everything back to normal, and the image is once more drawn, this time below the original. <a data-type="xref" href="#scaling_an_image_up_and_then_down_again" class="calibre6">Figure 26-23</a> shows the result.</p>

<div data-type="example" id="scaling_up_and_down_in_size" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-24. </span>Scaling up and down in size</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">scale</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">0</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">scale</code><code class="p">(.</code><code class="mi">33</code><code class="p">,</code> <code class="p">.</code><code class="mi">5</code><code class="p">)</code>
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">100</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="scaling_an_image_up_and_then_down_again" class="figure"><img alt="Scaling an image up and then down again" src="Images/pmj6_2623.png" class="calibre165"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-23. </span>Scaling an image up and then down again</h6>
</div></figure>

<p class="author1">If you look carefully, you may notice that the copy image under the original is a little bit fuzzy due to the scaling up and then down.</p>

<p class="author1">By using negative values for one or more scaling parameters, you can reverse an element in either the horizontal or vertical direction (or both) at the same time as (or instead of) scaling. For example, the following flips the context to create a mirror image:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">scale</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code></pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The save and restore Methods" class="calibre4"><div class="preface" id="save_and_restore_methods">
<h2 class="calibre28">The save and restore Methods</h2>

<p class="author1">If<a contenteditable="false" data-primary="save method (HTML5)" data-type="indexterm" id="idm45694666093448" class="calibre6"/><a contenteditable="false" data-primary="restore method (HTML5)" data-type="indexterm" id="idm45694666092312" class="calibre6"/> you need to use several scaling operations on different drawing elements, not only can you introduce fuzziness into the results, but it can also be very time-consuming to calculate that a three-times upward scaling requires a <code class="calibre15">0.33</code> value to scale back down again (and a two-times upscale requires a value of <code class="calibre15">0.5</code> to reverse).</p>

<p class="author1">For this reason, you can call <code class="calibre15">save</code> to save the current context before issuing a <code class="calibre15">scale</code> call and later return scaling back to normal by issuing a <code class="calibre15">restore</code> call. Check out the following, which can replace the code in <a data-type="xref" href="#scaling_up_and_down_in_size" class="calibre6">Example 26-24</a>:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">save</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">scale</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">2</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">40</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre15">
</code><strong class="calibre31"><code class="nx1">context</code><code class="p1">.</code><code class="nx1">restore</code><code class="p1">(</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">100</code><code class="p">)</code></pre>

<p class="author1">The <code class="calibre15">save</code> and <code class="calibre15">restore</code> methods are very powerful because they don’t just apply to image scaling. In fact, they apply across all the following properties and can therefore be used at any time to save the current properties and then restore them later: <code class="calibre15">fillStyle</code>, <code class="calibre15">font</code>, <code class="calibre15">globalAlpha</code>, <code class="calibre15">globalCompositeOperation</code>, <code class="calibre15">lineCap</code>, <code class="calibre15">lineJoin</code>, <code class="calibre15">lineWidth</code>, <code class="calibre15">miterLimit</code>, <code class="calibre15">shadowBlur</code>, <code class="calibre15">shadowColor</code>, <code class="calibre15">shadowOffsetX</code>, <code class="calibre15">shadowOffsetY</code>, <span class="keep-together"><code class="calibre15">strokeStyle</code></span>, <code class="calibre15">textAlign</code>, and <code class="calibre15">textBaseline</code>. The properties of all four transformation methods are also managed by <code class="calibre15">save</code> and <code class="calibre15">restore</code>: <code class="calibre15">scale</code>, <code class="calibre15">rotate</code>, <code class="calibre15">translate</code>, and <code class="calibre15">transform</code>.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The rotate Method" class="calibre4"><div class="preface" id="rotate_method">
<h2 class="calibre28">The rotate Method</h2>

<p class="author1">Using<a contenteditable="false" data-primary="rotate method (HTML5)" data-type="indexterm" id="idm45694665856776" class="calibre6"/> the <code class="calibre15">rotate</code> method, you can choose the angle at which to apply an object (or any of the drawing methods) to the canvas. The angle is specified in radians, which are the same as 180 / π, or about 57 degrees, each.</p>

<p class="author1">Rotation takes place around the canvas origin, which, by default, is its top-left corner (but as you’ll see shortly, this can be changed). <a data-type="xref" href="#rotating_an_image" class="calibre6">Example 26-25</a> displays the yin-yang image four times, rotating each consecutive image by <code class="calibre15">Math.PI</code> / <code class="calibre15">25</code> radians.</p>

<div data-type="example" id="rotating_an_image" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-25. </span>Rotating an image</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="mi">20</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="mi">120</code> <code class="p">,</code> <code class="mi">20</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">rotate</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="mi">25</code><code class="p">)</code>
<code class="p">}</code></pre>
</div>

<p class="author1">As you can see in <a data-type="xref" href="#image_at_four_different_rotations" class="calibre6">Figure 26-24</a>, the result may not be quite what you expect, because the image hasn’t been rotated about itself. Rather, the rotations have taken place around the canvas origin at location (0, 0). What’s more, each new rotation has compounded the previous one. However, to correct for these things, you can always use the <code class="calibre15">translate</code> method in conjunction with the <code class="calibre15">save</code> and <code class="calibre15">restore</code> methods.</p>

<figure class="calibre23"><div id="image_at_four_different_rotations" class="figure"><img alt="An image at four different rotations" src="Images/pmj6_2624.png" class="calibre166"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-24. </span>An image at four different rotations</h6>
</div></figure>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">Radians are a sensible unit of measurement because there are π × 2 radians in a complete circle. So, π radians is a half-circle, π ÷ 2 radians is a quarter circle, π ÷ 2 × 3 (or π × 1.5) radians is three-quarters of a circle, and so on. To save having to remember the value of π, you can always refer to the value in <code class="calibre15">Math.PI</code>.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The translate Method" class="calibre4"><div class="preface" id="translate_method">
<h2 class="calibre28">The translate Method</h2>

<p class="author1">To<a contenteditable="false" data-primary="translate method (HTML5)" data-type="indexterm" id="idm45694665802072" class="calibre6"/> change the origin of a rotation, you can call the <code class="calibre15">translate</code> method to shift it to somewhere else. The destination can be anywhere inside (or outside) the canvas. Usually, you specify a point somewhere within the destination location of the object (typically its center).</p>

<p class="author1"><a data-type="xref" href="#rotating_objects_in_place" class="calibre6">Example 26-26</a> performs this translation prior to each call to <code class="calibre15">rotate</code>, now resulting in the effect that was probably intended by the previous example. Additionally, the <code class="calibre15">save</code> and <code class="calibre15">restore</code> methods are called before and after each operation to ensure that each rotation is applied independently, not compounded on the previous one.</p>

<div data-type="example" id="rotating_objects_in_place" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-26. </span>Rotating objects in place</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">w</code> <code class="o">=</code> <code class="n">myimage</code><code class="p">.</code><code class="n">width</code>
<code class="n">h</code> <code class="o">=</code> <code class="n">myimage</code><code class="p">.</code><code class="n">height</code>

<code class="k">for</code> <code class="p">(</code><code class="n">j</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">;</code> <code class="n">j</code> <code class="o">&lt;</code> <code class="mi">4</code> <code class="p">;</code> <code class="o">++</code><code class="n">j</code><code class="p">)</code>
<code class="p">{</code>
  <code class="n">context</code><code class="p">.</code><code class="n">save</code><code class="p">()</code>
  <code class="n">context</code><code class="p">.</code><code class="n">translate</code><code class="p">(</code><code class="mi">20</code> <code class="o">+</code> <code class="n">w</code> <code class="o">/</code> <code class="mi">2</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="p">(</code><code class="n">w</code> <code class="o">+</code> <code class="mi">20</code><code class="p">),</code> <code class="mi">20</code> <code class="o">+</code> <code class="n">h</code> <code class="o">/</code> <code class="mi">2</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">rotate</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="n">PI</code> <code class="o">/</code> <code class="mi">5</code> <code class="o">*</code> <code class="n">j</code><code class="p">)</code>
  <code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code> <code class="o">-</code><code class="p">(</code><code class="n">w</code> <code class="o">/</code> <code class="mi">2</code><code class="p">),</code> <code class="o">-</code><code class="p">(</code><code class="n">h</code> <code class="o">/</code> <code class="mi">2</code><code class="p">))</code>
  <code class="n">context</code><code class="p">.</code><code class="n">restore</code><code class="p">()</code>
<code class="p">}</code></pre>
</div>

<p class="author1">In this example, before each rotation the context is saved and the origin is translated to a point exactly in the center of where each image will be drawn. We then issue the rotation and draw the image up and to the left of the new origin by supplying negative values, such that its center matches the origin point. The result of this is shown in <a data-type="xref" href="Images/#rotating_images_in_place" class="calibre6">Figure 26-25</a>.</p>

<figure class="calibre23"><div id="rotating_images_in_place" class="figure"><img alt="Rotating images in place" src="Images/pmj6_2625.png" class="calibre167"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-25. </span>Rotating images in place</h6>
</div></figure>

<p class="author1">To recap: when you wish to rotate or transform (described next) an object in place, you should perform the following actions:</p>

<ol class="calibre25">
	<li class="calibre26">
	<p class="author1">Save the context.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Translate the canvas origin to the center of where the object is to be placed.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Issue the rotation or transformation instruction.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Draw the object with any drawing method supported, using a negative destination location point half the object’s width to the left and half its height upward.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Restore the context to revert the origin.</p>
	</li>
</ol>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The transform Method" class="calibre4"><div class="preface" id="transform_method">
<h2 class="calibre28">The transform Method</h2>

<p class="author1">When<a contenteditable="false" data-primary="transform method (HTML5)" data-type="indexterm" id="idm45694665647880" class="calibre6"/> you’ve exhausted all the other canvas features and still can’t manipulate objects in just the way you need, it’s time to turn to the <code class="calibre15">transform</code> method. With it, you can apply a transformation matrix to the objects you draw to the canvas, giving you a multitude of possibilities and powerful features that can combine scaling and rotating in a single instruction.</p>

<p class="author1">The transformation matrix used by this method is a 3 × 3 matrix of 9 values, but only 6 of these are supplied externally to the <code class="calibre15">transform</code> method. So, rather than explain how this matrix multiplication works, I only need to explain the effects of its six arguments, which, in order, are as follows (the order may be a little counterintuitive):</p>

<ol class="calibre25">
	<li class="calibre26">
	<p class="author1">Horizontal scale</p>
	</li>
	<li class="calibre26">
	<p class="author1">Horizontal skew</p>
	</li>
	<li class="calibre26">
	<p class="author1">Vertical skew</p>
	</li>
	<li class="calibre26">
	<p class="author1">Vertical scale</p>
	</li>
	<li class="calibre26">
	<p class="author1">Horizontal translate</p>
	</li>
	<li class="calibre26">
	<p class="author1">Vertical translate</p>
	</li>
</ol>

<p class="author1">You can apply these values in many ways—for example, by emulating the <code class="calibre15">scale</code> method from <a data-type="xref" href="#scaling_up_and_down_in_size" class="calibre6">Example 26-24</a> by replacing this call:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">scale</code><code class="p">(</code><code class="mi">3</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code></pre>

<p class="author1">with the following:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">transform</code><code class="p">(</code><strong class="calibre31"><code class="mi1">3</code></strong><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">2</code></strong><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code></pre>

<p class="author1">In the same way, you can replace this call from <a data-type="xref" href="#rotating_objects_in_place" class="calibre6">Example 26-26</a>:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">translate</code><code class="p">(</code><code class="mi">20</code> <code class="o">+</code> <code class="n">w</code> <code class="o">/</code> <code class="mi">2</code> <code class="o">+</code> <code class="n">j</code> <code class="o">*</code> <code class="p">(</code><code class="n">w</code> <code class="o">+</code> <code class="mi">20</code><code class="p">),</code> <code class="mi">20</code> <code class="o">+</code> <code class="n">h</code> <code class="o">/</code> <code class="mi">2</code><code class="p">)</code></pre>

<p class="author1">with the following:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">transform</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">20</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">w</code><code class="calibre17"> </code><code class="o1">/</code><code class="calibre17"> </code><code class="mi1">2</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">j</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="p1">(</code><code class="nx1">w</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="mi1">20</code><code class="p1">)</code></strong><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">20</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">h</code><code class="calibre17"> </code><code class="o1">/</code><code class="calibre17"> </code><code class="mi1">2</code></strong><code class="p">)</code></pre>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">Note how the horizontal and vertical scaling arguments are given values of <code class="calibre15">1</code> to ensure a 1:1 result, while the skew values are <code class="calibre15">0</code> to prevent the result from being skewed.</p>
</div>

<p class="author1">You could even combine the previous two lines of code to get a translation and scale at the same time, like this:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">transform</code><code class="p">(</code><strong class="calibre31"><code class="mi1">3</code></strong><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">2</code></strong><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">20</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">w</code><code class="calibre17"> </code><code class="o1">/</code><code class="calibre17"> </code><code class="mi1">2</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">j</code><code class="calibre17"> </code><code class="o1">*</code><code class="calibre17"> </code><code class="p1">(</code><code class="nx1">w</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="mi1">20</code><code class="p1">)</code></strong><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">20</code><code class="calibre17"> </code><code class="o1">+</code><code class="calibre17"> </code><code class="nx1">h</code><code class="calibre17"> </code><code class="o1">/</code><code class="calibre17"> </code><code class="mi1">2</code></strong><code class="p">)</code></pre>

<p class="author1">As you might expect, the skew arguments slant an element in the direction specified—for example, creating a rhombus from a square.</p>

<p class="author1">As another example of skew, <a data-type="xref" href="#creating_an_original_and_skewed_image" class="calibre6">Example 26-27</a> draws the yin-yang image on the canvas, followed by a skewed copy created with the <code class="calibre15">transform</code> method. The skew value can be any negative, zero, or positive amount, but I chose a horizontal value of <code class="calibre15">1</code>, which has skewed the bottom of the image by one image width to the right and pulled everything else along with it proportionally (see <a data-type="xref" href="#horizontally_skewing_an_object_to_the_ri" class="calibre6">Figure 26-26</a>).</p>

<div data-type="example" id="creating_an_original_and_skewed_image" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 26-27. </span>Creating an original and skewed image</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">transform</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">1</code></strong><code class="p">,</code><code class="calibre15"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre15">
</code><code class="n">context</code><code class="p">.</code><code class="n">drawImage</code><code class="p">(</code><code class="n">myimage</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">140</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">20</code><code class="p">)</code></pre>
</div>

<figure class="calibre23"><div id="horizontally_skewing_an_object_to_the_ri" class="figure"><img alt="Horizontally skewing an object to the right" src="Images/pmj6_2626.png" class="calibre168"/>
<h6 class="calibre24"><span class="keep-together">Figure 26-26. </span>Horizontally skewing an object to the right</h6>
</div></figure>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">You can even rotate an object with <code class="calibre15">transform</code> by supplying one negative and one opposite positive skew value. But beware: when you do this, you’ll modify the size of an element and will therefore also need to adjust the scale arguments at the same time. Plus, you’ll need to remember to translate the origin. Thus, I recommend sticking with the <code class="calibre15">rotate</code> method for this until you are fully experienced with using <code class="calibre15">transform</code>.</p>
</div>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The setTransform Method" class="calibre4"><div class="preface" id="settransform_method">
<h2 class="calibre28">The setTransform Method</h2>

<p class="author1">As<a contenteditable="false" data-primary="setTransform method (HTML5)" data-type="indexterm" id="idm45694665311496" class="calibre6"/> an alternative to using the <code class="calibre15">save</code> and <code class="calibre15">restore</code> methods, you can set an absolute transform, which has the effect of resetting the transformation matrix and then applying the supplied values. Use the <code class="calibre15">setTransform</code> method just like <code class="calibre15">transform</code>, as in this example (which applies a horizontal positive skew with the value <code class="calibre15">1</code>):</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="n">context</code><code class="p">.</code><code class="n">setTransform</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><strong class="calibre31"><code class="mi1">1</code></strong><code class="p">,</code><code class="calibre15"> </code><code class="mi">1</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">,</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code></pre>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">To learn more about transformation matrixes, see the <a href="https://tinyurl.com/transform-matrix" class="calibre6">Wikipedia article</a>.</p>
</div>

<p class="author1">The HTML5 canvas is a tremendous asset for web developers to make bigger, better, and more professional and compelling websites. In the following chapter, we’ll take a look at two other great HTML5 features: in-browser, plug-in-free audio and video.<a contenteditable="false" data-primary="" data-startref="CHtrans24" data-type="indexterm" id="idm45694665263672" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="TRcanvas24" data-type="indexterm" id="idm45694665262296" class="calibre6"/></p>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Questions" class="calibre4"><div class="preface" id="questions-id00121">
<h1 class="calibre11">Questions</h1>

<ol class="calibre25">
	<li class="calibre26">
	<p class="author1">How do you create a canvas element in HTML?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How do you give JavaScript access to a canvas element?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How do you start and finish the creation of a canvas path?</p>
	</li>
	<li class="calibre26">
	<p class="author1">What method can you use to extract data from a canvas into an image?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How can you create gradient fills of more than two colors?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How can you adjust the width of lines when drawing?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which method would you use to specify a section of a canvas such that future drawing takes place only within that area?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How can you draw a complex curve with two imaginary attractors?</p>
	</li>
	<li class="calibre26">
	<p class="author1">How many items of data per pixel are returned by the <code class="calibre15">getImageData</code> method?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Which two parameters to the <code class="calibre15">transform</code> method apply to scaling operations?</p>
	</li>
</ol>

<p class="author1">See <a data-type="xref" href="app01_split_025.xhtml#chapter_26_answers" class="calibre6">“Chapter 26 Answers”</a> in the <a data-type="xref" href="app01_split_000.xhtml#solutions_to_the_chapter_questions" class="calibre6">Appendix A</a> for the answers to these <span class="keep-together">questions</span>.</p>
</div></section>
</div></section></div></body></html>