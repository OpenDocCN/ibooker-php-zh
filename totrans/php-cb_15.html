<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xml:lang="en"
      lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>PHP Cookbook</title>
<link rel="stylesheet" type="text/css" href="override_v1.css"/>
<link rel="stylesheet" type="text/css" href="epub.css"/>
</head>
<body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 15. Packages and Extensions"><div class="chapter" id="chapter_extensions">
<h1><span class="label">Chapter 15. </span>Packages and Extensions</h1>


<p>PHP is a high-level language that uses dynamic typing and memory management to make software development easier for end users. Unfortunately, computers are not very good at handling high-level concepts, <a data-type="indexterm" data-primary="packages" id="idm45875139810000"></a><a data-type="indexterm" data-primary="extensions" id="idm45875139809296"></a>so any high-level system must itself be built atop lower-level building blocks. In the case of PHP, the entire system is written in and built atop C.</p>

<p>Since PHP is open source, you can download the entire source code for the language directly <a href="https://oreil.ly/Z1_lP">from GitHub</a>. Then you can build the language from source on your own system, make changes to it, or write your own native (C-level) extensions.</p>

<p>In any environment, you’ll need various other packages available in order to build PHP from source. On Ubuntu Linux, these are the packages:</p>
<dl>
<dt><code>pkg-config</code></dt>
<dd>
<p>A Linux package for <a data-type="indexterm" data-primary="pkg-config package" id="idm45875139804560"></a><a data-type="indexterm" data-primary="packages" data-secondary="pkg-config" id="idm45875139803824"></a><a data-type="indexterm" data-primary="Linux, pkg-config package" id="idm45875139802880"></a>returning information about installed libraries</p>
</dd>
<dt><code>build-essential</code></dt>
<dd>
<p>A meta-package <a data-type="indexterm" data-primary="build-essentials package" id="idm45875139800640"></a><a data-type="indexterm" data-primary="packages" data-secondary="build-essentials" id="idm45875139799936"></a>encompassing the GNU debugger, g++ compiler, and other tools for working with C/C++ projects</p>
</dd>
<dt><code>autoconf</code></dt>
<dd>
<p>Package of macros to <a data-type="indexterm" data-primary="packages" data-secondary="autoconf" id="idm45875139747936"></a><a data-type="indexterm" data-primary="autoconf package" id="idm45875139747056"></a>produce shell scripts that configure code packages</p>
</dd>
<dt><code>bison</code></dt>
<dd>
<p>A <a data-type="indexterm" data-primary="bison package" id="idm45875139744752"></a><a data-type="indexterm" data-primary="packages" data-secondary="bison" id="idm45875139744016"></a>general-purpose parser generator</p>
</dd>
<dt><code>re2c</code></dt>
<dd>
<p>A regular expression <a data-type="indexterm" data-primary="re2c package" id="idm45875139741536"></a><a data-type="indexterm" data-primary="packages" data-secondary="re2c" id="idm45875139740800"></a>compiler and open source lexer for C and C++</p>
</dd>
<dt><code>libxml2-dev</code></dt>
<dd>
<p>The C-level <a data-type="indexterm" data-primary="packages" data-secondary="libxml2-dev" id="idm45875139738256"></a><a data-type="indexterm" data-primary="libxml2-dev package" id="idm45875139737248"></a>development headers required for XML processing</p>
</dd>
<dt><code>libsqlite3-dev</code></dt>
<dd>
<p>The C-level <a data-type="indexterm" data-primary="packages" data-secondary="libsqlite3-dev" id="idm45875139734976"></a><a data-type="indexterm" data-primary="libsqlite3-dev" id="idm45875139733968"></a>development headers for SQLite and related bindings</p>
</dd>
</dl>

<p>You can install all of them with the <a data-type="indexterm" data-primary="packages" data-secondary="installing" id="idm45875139732720"></a>following <code>apt</code> command:</p>

<pre data-type="programlisting">$ sudo apt install -y pkg-config build-essential autoconf bison re2c \
                      libxml2-dev libsqlite3-dev</pre>

<p>Once dependencies are available, you use <a data-type="indexterm" data-primary="buildconf script" id="idm45875139729712"></a><a data-type="indexterm" data-primary="configure script" id="idm45875139729008"></a>the <code>buildconf</code> script to generate the configuration script, then <code>configure</code> itself will ready the build environment. <a href="https://oreil.ly/md2qt">Several options</a> can be passed directly to <code>configure</code> to control how the environment will be set up. <a data-type="xref" href="#php_configure_options">Table 15-1</a> lists some of the most useful.</p>
<table id="php_configure_options">
<caption><span class="label">Table 15-1. </span>PHP <code>configure</code> options</caption>
<thead>
<tr>
<th>Option flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>--enable-debug</code></p></td>
<td><p>Compile with debugging symbols. Useful for developing changes to core PHP or writing new extensions.</p></td>
</tr>
<tr>
<td><p><code>--enable-libgcc</code></p></td>
<td><p>Allow code to explicitly link against <code>libgcc</code>.</p></td>
</tr>
<tr>
<td><p><code>--enable-php-streams</code></p></td>
<td><p>Activate support for experimental PHP streams.</p></td>
</tr>
<tr>
<td><p><code>--enable-phpdbg</code></p></td>
<td><p>Enable the interactive <code>phpdbg</code> debugger.</p></td>
</tr>
<tr>
<td><p><code>--enable-zts</code></p></td>
<td><p>Enable thread safety.</p></td>
</tr>
<tr>
<td><p><code>--disable-short-tags</code></p></td>
<td><p>Disable PHP short tag support (e.g., <code>&lt;?</code>).</p></td>
</tr>
</tbody>
</table>

<p>Understanding how to build PHP itself isn’t a prerequisite for using it. In most environments, you can install a binary distribution directly from a standard package manager. On Ubuntu, for example, you can install PHP directly with the following:</p>

<pre data-type="programlisting" data-code-language="sh">$<code class="w"> </code>sudo<code class="w"> </code>apt<code class="w"> </code>install<code class="w"> </code>-y<code class="w"> </code>php<code class="w"></code></pre>

<p>Knowing how to build PHP from source, though, is important should you ever wish to change the behavior of the language, include a nonbundled extension, or write your own native module in the future.</p>








<section data-type="sect2" data-pdf-bookmark="Standard Modules"><div class="sect2" id="idm45875139690720">
<h2>Standard Modules</h2>

<p>By default, PHP uses its own extension <a data-type="indexterm" data-primary="extensions" data-secondary="modules" id="idm45875139706432"></a><a data-type="indexterm" data-primary="modules, extensions" id="idm45875139705456"></a>system to power much of the core functionality of the language. In addition to core modules, various extensions are bundled directly with PHP.<sup><a data-type="noteref" id="idm45875139704496-marker" href="ch15.html#idm45875139704496">1</a></sup> These include the following:</p>

<ul>
<li>
<p><a href="https://oreil.ly/QwfUv">BCMath</a> for arbitrary-<a data-type="indexterm" data-primary="extensions" data-secondary="BCMath" id="idm45875139685248"></a>precision mathematics</p>
</li>
<li>
<p><a href="https://oreil.ly/sktWY">FFI</a> (Foreign <a data-type="indexterm" data-primary="extensions" data-secondary="FFI (Foreign Function Interface)" id="idm45875139682688"></a><a data-type="indexterm" data-primary="FFI (Foreign Function Interface)" id="idm45875139681712"></a>Function Interface) for loading shared libraries and calling functions within them</p>
</li>
<li>
<p><a href="https://oreil.ly/BEsdu">PDO</a> (PHP Data Objects) for abstracting <a data-type="indexterm" data-primary="extensions" data-secondary="PDO (PHP Data Objects)" id="idm45875139679552"></a><a data-type="indexterm" data-primary="PDO (PHP Data Objects)" id="idm45875139678576"></a>various database interfaces</p>
</li>
<li>
<p><a href="https://oreil.ly/Zejtz">SQLite3</a> for <a data-type="indexterm" data-primary="SQLite3" id="idm45875139664128"></a><a data-type="indexterm" data-primary="extensions" data-secondary="SQLite3" id="idm45875139663520"></a>interacting directly with SQLite databases</p>
</li>
</ul>

<p>Standard modules are bundled with PHP and available for inclusion immediately through changes to your <em>php.ini</em> configuration. External extensions, like PDO support for Microsoft SQL Server, are also available but must be installed and activated separately. Tools like PECL, <a data-type="indexterm" data-primary="PECL (PHP Extension Community Library)" id="idm45875139661408"></a>discussed in <a data-type="xref" href="#native_php_extensions">Recipe 15.4</a>, make the installation of these modules straightforward for any environment.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Libraries/Composer"><div class="sect2" id="idm45875139659680">
<h2>Libraries/Composer</h2>

<p>In addition to native extensions to the <a data-type="indexterm" data-primary="Composer" id="idm45875139658096"></a>language, you can leverage <a href="https://getcomposer.org">Composer</a>, the most popular dependency manager for PHP. Any PHP project can (and likely <em>should</em>) be defined as a Composer module by including a <em>composer.json</em> file that describes the project and its structure. Including <a data-type="indexterm" data-primary="Composer" data-secondary="composer.json file" id="idm45875139655776"></a>such a file has two key advantages, even if you don’t leverage Composer to pull third-party code into your project:</p>

<ul>
<li>
<p>You (or another developer) can include your project as a dependency of another project. This makes your code portable and encourages the reuse of function and class definitions.</p>
</li>
<li>
<p>Once your project has a <em>composer.json</em> file, you can leverage Composer’s autoloading features to dynamically include classes and functions within your project without explicitly using <code>require()</code> to load them directly.</p>
</li>
</ul>

<p>The recipes in this chapter explain how to configure your project as a Composer package, as well as how to leverage Composer to find and include third-party libraries. You’ll also learn how to find and include native extensions to the language through PHP Extension Community Library (PECL) and PHP Extension and Application Repository (PEAR).</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="15.1 Defining a Composer Project"><div class="sect1" id="composer_definition">
<h1>15.1 Defining a Composer Project</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875139649184">
<h2>Problem</h2>

<p>You want to start a new project that <a data-type="indexterm" data-primary="Composer" data-secondary="project definition" id="cmpsjdf"></a>uses Composer to dynamically load code and dependencies.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875139646224">
<h2>Solution</h2>

<p>Use Composer’s <code>init</code> command at the command line <a data-type="indexterm" data-primary="Composer" data-secondary="composer.json file" data-tertiary="init command" id="cpsjf"></a><a data-type="indexterm" data-primary="composer.json file, init command" id="cpjsfcm"></a>to bootstrap a new project with a <em>composer.json</em> file. For example:</p>

<pre data-type="programlisting" data-code-language="sh">$<code class="w"> </code>composer<code class="w"> </code>init<code class="w"> </code>--name<code class="w"> </code>ericmann/cookbook<code class="w"> </code>--type<code class="w"> </code>project<code class="w"> </code>--license<code class="w"> </code>MIT<code class="w"></code></pre>

<p>After walking through the interactive prompts (requesting a description, author, minimum stability, etc.), you’ll be left with a well-defined <em>composer.json</em> for your project.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875139618704">
<h2>Discussion</h2>

<p>Composer works by defining information about your project in a JSON document and using that information to build out additional script loaders and integrations. A newly initialized project won’t have much detail in this document at all. The <em>composer.json</em> file generated by the <code>init</code> command in the Solution example will initially look like the following:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w"></code>
<code class="w">    </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"ericmann/cookbook"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"project"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"license"</code><code class="p">:</code><code class="w"> </code><code class="s2">"MIT"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"require"</code><code class="p">:</code><code class="w"> </code><code class="p">{}</code><code class="w"></code>
<code class="p">}</code><code class="w"></code></pre>

<p>This configuration file defines no dependencies, no additional scripts, and no autoloading. In order to be useful for something other than identifying the project and the license, you need to start adding to it. First, you need to define the autoloader to pull in your project code.</p>

<p>For the sake of this project, use the default namespace <code>Cookbook</code> and place all of your code in a directory called <em>src/</em> within the project. Then, update your <em>composer.json</em> to map that namespace to that directory as follows:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w"></code>
<code class="w">    </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"ericmann/cookbook"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"project"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"license"</code><code class="p">:</code><code class="w"> </code><code class="s2">"MIT"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"require"</code><code class="p">:</code><code class="w"> </code><code class="p">{},</code><code class="w"></code>
<code class="w">    </code><code class="nt">"autoload"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">        </code><code class="nt">"psr-4"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">            </code><code class="nt">"Cookbook\\"</code><code class="p">:</code><code class="w"> </code><code class="s2">"src/"</code><code class="w"></code>
<code class="w">        </code><code class="p">}</code><code class="w"></code>
<code class="w">    </code><code class="p">}</code><code class="w"></code>
<code class="p">}</code><code class="w"></code></pre>

<p>Once you’ve updated your Composer <a data-type="indexterm" data-primary="composer dumpautoload" id="idm45875139540832"></a>config, run <code>composer dumpautoload</code> at the command line to force Composer to reload the configuration and define the automated source mappings. Once that’s complete, Composer will have created a new <em>vendor/</em> directory in your project. It contains two critical components:</p>

<ul>
<li>
<p>An <em>autoload.php</em> script that you’ll <a data-type="indexterm" data-primary="Composer" data-secondary="autoload.php" id="idm45875139495392"></a><a data-type="indexterm" data-primary="autoload.php" id="idm45875139494384"></a>need to <code>require()</code> when you load your 
<span class="keep-together">application</span></p>
</li>
<li>
<p>A <em>composer</em> directory that <a data-type="indexterm" data-primary="Composer" data-secondary="composer directory" id="idm45875139456640"></a>contains Composer’s code loading routines to dynamically pull in your scripts</p>
</li>
</ul>

<p>To further illustrate how autoloading works, create two new files. First, create a file called <em>Hello.php</em> in the <em>src/</em> directory containing the <code>Hello</code> class defined in <a data-type="xref" href="#composer_hello_class_definition">Example 15-1</a>.</p>
<div id="composer_hello_class_definition" data-type="example">
<h5><span class="label">Example 15-1. </span>Simple class definition for Composer autoloading</h5>

<pre data-type="programlisting" data-code-language="php"><code class="o">&lt;?</code><code class="nx">php</code>
<code class="k">namespace</code> <code class="nx">Cookbook</code><code class="p">;</code>

<code class="k">class</code> <code class="nc">Hello</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">private</code> <code class="nx">string</code> <code class="nv">$greet</code><code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">greet</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s2">"Hello, </code><code class="si">{</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">greet</code><code class="si">}</code><code class="s2">!"</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre></div>

<p>Then, in the root of your project <a data-type="indexterm" data-primary="Composer" data-secondary="app.php file" id="idm45875139435408"></a>create an <em>app.php</em> file with the following contents to bootstrap the execution of the preceding snippet:</p>

<pre data-type="programlisting" data-code-language="php"><code class="o">&lt;?</code><code class="nx">php</code>

<code class="k">require_once</code> <code class="s1">'vendor/autoload.php'</code><code class="p">;</code>

<code class="nv">$intro</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Cookbook\Hello</code><code class="p">(</code><code class="s1">'world'</code><code class="p">);</code>

<code class="k">echo</code> <code class="nv">$intro</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code></pre>

<p>Finally, return to the command line. Since you’ve added a new class to the project, you need to run <code>composer dumpautoload</code> once again so Composer is aware of the class. Then, you can run <code>php app.php</code> to invoke the application directly and produce the following output:</p>

<pre data-type="programlisting" data-code-language="sh">$<code class="w"> </code>php<code class="w"> </code>app.php<code class="w"></code>
Hello,<code class="w"> </code>world!<code class="w"></code>
$<code class="w"></code></pre>

<p>Any class definitions you need for your project or application can be defined the same way. The base <code>Cookbook</code> namespace will always be the root of the <em>src/</em> directory. If you want to define a nested namespace for objects, say <code>Cookbook\Recipes</code>, then create a similarly named directory (e.g., <em>Recipes/</em>) within <em>src/</em> so Composer knows where to find your class definitions when they’re used later within the application.</p>

<p>Similarly, you can leverage Composer’s <code>require</code> command to import third-party dependencies into your application.<sup><a data-type="noteref" id="idm45875139396784-marker" href="ch15.html#idm45875139396784">2</a></sup> These dependencies will be loaded into your application at <a data-type="indexterm" data-primary="Composer" data-secondary="project definition" data-startref="cmpsjdf" id="idm45875139359168"></a><a data-type="indexterm" data-primary="Composer" data-secondary="composer.json file" data-tertiary="init command" data-startref="cpsjf" id="idm45875139357952"></a><a data-type="indexterm" data-primary="composer.json file, init command" data-startref="cpjsfcm" id="idm45875139356464"></a>runtime the same way your custom classes are.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875139618112">
<h2>See Also</h2>

<p>Composer documentation on the <a href="https://oreil.ly/6J29w"><code>init</code> command</a> and on <a href="https://oreil.ly/Buns1">PSR-4 autoloading</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="15.2 Finding Composer Packages"><div class="sect1" id="idm45875139352176">
<h1>15.2 Finding Composer Packages</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875139334512">
<h2>Problem</h2>

<p>You want to find a library to <a data-type="indexterm" data-primary="Composer" data-secondary="packages" data-tertiary="locating" id="cpsrkgsct"></a><a data-type="indexterm" data-primary="packages" data-secondary="Composer, locating" id="pckgpsct"></a>accomplish a particular task so you don’t need to spend time reinventing the wheel by writing your own implementation.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875139330064">
<h2>Solution</h2>

<p>Use the PHP Package Repository at <a href="https://packagist.org">Packagist</a> to find the appropriate library and use Composer to install it in your application.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875139327824">
<h2>Discussion</h2>

<p>Many developers find they spend the majority of their time reimplementing logic or systems they’ve built before. Different applications serve different purposes but often leverage the same basic building blocks and foundations in order to operate.</p>

<p>This is one of the key drivers behind paradigms like object-oriented programming, where you encapsulate the logic in your application within objects that can be individually manipulated, updated, or even reused. Instead of rewriting the same code over and over again, you encapsulate it within an object that can be reused within the application or even transported into your next project.<sup><a data-type="noteref" id="idm45875139325680-marker" href="ch15.html#idm45875139325680">3</a></sup></p>

<p>In PHP, these reusable code components <a data-type="indexterm" data-primary="code reuse" data-secondary="reusable components" id="idm45875139323904"></a>are often redistributed as standalone libraries that can be imported with Composer. Just as <a data-type="xref" href="#composer_definition">Recipe 15.1</a> demonstrated how to define a Composer project and automatically import your class and function definitions, the same system can be used to add third-party logic to your system as well.<sup><a data-type="noteref" id="idm45875139321888-marker" href="ch15.html#idm45875139321888">4</a></sup></p>

<p>First, identify the need of a particular operation or piece of logic. Assume, for example, your application needs to integrate <a data-type="indexterm" data-primary="TOTP (time-based one-time password) system" id="idm45875139319728"></a>with a time-based one-time password (TOTP) system like Google Authenticator. You’ll need a TOTP library to do so. To find it, 
<span class="keep-together">navigate</span> in your browser to <a href="https://packagist.org">packagist.org</a>, the PHP Package Repository. The home page will look somewhat like <a data-type="xref" href="#packagist_homepage">Figure 15-1</a> and prominently features a search bar prominently in the header.</p>

<figure><div id="packagist_homepage" class="figure">
<img src="assets/phpc_1501.png" alt="Packagist is a free distribution method for PHP packages installable via Composer" width="600" height="565"/>
<h6><span class="label">Figure 15-1. </span>Packagist is a free distribution method for PHP packages installable via Composer</h6>
</div></figure>

<p>Then search for the tool you need—in this case, TOTP. You’ll be rewarded with a list of available projects, sorted by popularity. You can further leverage the package type and various tags affixed to each library to pare your search results down to a handful of possible libraries.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Popularity on Packagist is defined <a data-type="indexterm" data-primary="Packagist" id="idm45875139313392"></a>by both package downloads and GitHub stars. It’s a good way to measure how frequently a project is being used in the wild but is by no means the only measure you should leverage. Many developers still copy and paste third-party code into their systems, so there are potentially millions of “downloads” not reflected in Packagist’s metrics. Likewise, merely being popular or widely used does not mean a package is secure or the right fit for your project. Take time to carefully review each potential library to ensure that it doesn’t introduce unnecessary risk into your application.</p>
</div>

<p>Further, if you know of a particular module author whose work you trust, you can search for that directly by adding their username to the search. For example, a search for <code>Eric Mann totp</code> will yield <a href="https://oreil.ly/7touz">a specific TOTP implementation</a> originally created by this book’s author.</p>

<p>Once you’ve identified and carefully audited <a data-type="indexterm" data-primary="Composer" data-secondary="packages" data-tertiary="locating" data-startref="cpsrkgsct" id="idm45875139310528"></a><a data-type="indexterm" data-primary="packages" data-secondary="Composer, locating" data-startref="pckgpsct" id="idm45875139309008"></a>available packages for extending your application, review <a data-type="xref" href="#installing_composer_packages">Recipe 15.3</a> for instructions on how to install and manage them.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875139327200">
<h2>See Also</h2>

<p><a href="https://packagist.org">Packagist.org</a>: the PHP Package Repository.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="15.3 Installing and Updating Composer Packages"><div class="sect1" id="installing_composer_packages">
<h1>15.3 Installing and Updating Composer Packages</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875139303136">
<h2>Problem</h2>

<p>You’ve discovered a package on Packagist you <a data-type="indexterm" data-primary="Composer" data-secondary="packages" data-tertiary="installing" id="cpsgfsl"></a><a data-type="indexterm" data-primary="Composer" data-secondary="packages" data-tertiary="updating" id="psrkgud"></a><a data-type="indexterm" data-primary="packages" data-secondary="updating" id="plgpdt"></a><a data-type="indexterm" data-primary="packages" data-secondary="installing" id="ckgstlg"></a>want to include in your project.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875139295920">
<h2>Solution</h2>

<p>Install the package via Composer (assume version 1.0) as follows:</p>

<pre data-type="programlisting" data-code-language="sh">composer<code class="w"> </code>require<code class="w"> </code><code class="s2">"vendor/package:1.0"</code><code class="w"></code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875139271408">
<h2>Discussion</h2>

<p>Composer works with two files <a data-type="indexterm" data-primary="Composer" data-secondary="composer.json file" id="cpscpsjf"></a><a data-type="indexterm" data-primary="Composer" data-secondary="composer.lock file" id="cpscmrck"></a>in your local filesystem: <em>composer.json</em> and <em>composer.lock</em>. The first is the one you define to describe your project, autoloading, and license. As a concrete example, the original <em>composer.json</em> file you defined in <a data-type="xref" href="#composer_definition">Recipe 15.1</a> is as follows:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w"></code>
<code class="w">    </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"ericmann/cookbook"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"project"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"license"</code><code class="p">:</code><code class="w"> </code><code class="s2">"MIT"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"require"</code><code class="p">:</code><code class="w"> </code><code class="p">{},</code><code class="w"></code>
<code class="w">    </code><code class="nt">"autoload"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">        </code><code class="nt">"psr-4"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">            </code><code class="nt">"Cookbook\\"</code><code class="p">:</code><code class="w"> </code><code class="s2">"src/"</code><code class="w"></code>
<code class="w">        </code><code class="p">}</code><code class="w"></code>
<code class="w">    </code><code class="p">}</code><code class="w"></code>
<code class="p">}</code><code class="w"></code></pre>

<p>Once you run the <code>require</code> statement from the Solution example, Composer <em>updates</em> your <em>composer.json</em> file to add the specified vendor dependency. Your file will now appear as follows:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w"></code>
<code class="w">    </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"ericmann/cookbook"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"project"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"license"</code><code class="p">:</code><code class="w"> </code><code class="s2">"MIT"</code><code class="p">,</code><code class="w"></code>
<code class="w">    </code><code class="nt">"require"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">        </code><code class="nt">"vendor/package"</code><code class="p">:</code><code class="w"> </code><code class="s2">"1.0"</code><code class="w"></code>
<code class="w">    </code><code class="p">},</code><code class="w"></code>
<code class="w">    </code><code class="nt">"autoload"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">        </code><code class="nt">"psr-4"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"></code>
<code class="w">            </code><code class="nt">"Cookbook\\"</code><code class="p">:</code><code class="w"> </code><code class="s2">"src/"</code><code class="w"></code>
<code class="w">        </code><code class="p">}</code><code class="w"></code>
<code class="w">    </code><code class="p">}</code><code class="w"></code>
<code class="p">}</code><code class="w"></code></pre>

<p>When you <code>require</code> a package, Composer does three things:</p>
<ol>
<li>
<p>It checks to make sure the package exists and grabs either the latest version (if no version was specified) or the version you ask for. It then updates <em>composer.json</em> to store the package in the <code>require</code> key.</p>
</li>
<li>
<p>By default, Composer then downloads and installs your package in the <em>vendor/</em> directory within your project. It also updates the autoloader script, so the package will be available to other code within your project immediately.</p>
</li>
<li>
<p>Composer also maintains a <code>composer.lock</code> file within your project that explicitly identifies which versions of which packages you have installed.</p>
</li>

</ol>

<p>In the Solution example, you explicitly specified version 1.0 of a package. If instead you had not specified a version, Composer would fetch the latest version available and use that in the <em>composer.json</em> file. If 1.0 is in fact the latest version, Composer would use <code>^1.0</code> as the version indicator, which would then install any potential maintenance versions down the road (like a 1.0.1 version). The <em>composer.lock</em> file keeps track of the <em>exact</em> version installed so even if you were to delete your entire <em>vendor/</em> directory, reinstalling packages via <code>composer install</code> will still fetch the same versions as before.</p>

<p>Composer will also endeavor to find the best version for your local environment. It does this by comparing the PHP version required for your environment (and used to run the tool) with those versions supported by the requested packages. Composer also attempts to reconcile any dependencies both explicitly declared by your project and implicitly imported through a transitive dependency declared elsewhere. Should the system fail to find a compatible version to include, it will report an error so you can manually reconcile the version numbers listed in your <em>composer.json</em> file.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Composer follows semantic versioning in its version constraints. A requirement of <code>^1.0</code> will only permit maintenance versions (e.g., 1.0.1, 1.0.2) to be installed. A greater-than constraint (e.g., <code>&gt;=1.0</code>) will install any stable version at or above version 1.0. Keeping track of how you define your version constraints is critical to prevent accidental import of breaking package changes introduced by major versions. For more background on how to define version constraints, reference the <a href="https://oreil.ly/gvoGC">Composer documentation</a>.</p>
</div>

<p>Packagist-hosted libraries with public code aren’t the only things you can include via Composer. In addition, you can point your system at either public or private projects hosted in version control systems like GitHub.</p>

<p>To add a GitHub repository to your project, first add a <code>repositories</code> key to <em>composer.json</em> so the system knows where to look. Then update your <code>require</code> key to pull in the project you need. Running <code>composer update</code> will then pull the package not from Packagist but directly from GitHub and include it in your project just like any other library.</p>

<p>For example, assume you want to use a particular TOTP library but have uncovered a minor bug. First, fork the GitHub repository to your own account. Then, create a branch in GitHub to hold your changes. Finally, update <em>composer.json</em> to point at your custom <a data-type="indexterm" data-primary="Composer" data-secondary="pull repository" id="idm45875139035488"></a>fork and branch, as illustrated in <a data-type="xref" href="#composer_pull_repository">Example 15-2</a>.</p>
<div id="composer_pull_repository" data-type="example">
<h5><span class="label">Example 15-2. </span>Use Composer to pull projects from GitHub repositories</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w">
    </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"ericmann/cookbook"</code><code class="p">,</code><code class="w">
    </code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"project"</code><code class="p">,</code><code class="w">
    </code><code class="nt">"license"</code><code class="p">:</code><code class="w"> </code><code class="s2">"MIT"</code><code class="p">,</code><code class="w">
    </code><code class="nt">"repositories"</code><code class="p">:</code><code class="w"> </code><code class="p">[</code><code class="w">
        </code><code class="p">{</code><code class="w">
            </code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"vcs"</code><code class="p">,</code><code class="w">
            </code><code class="nt">"url"</code><code class="p">:</code><code class="w"> </code><code class="s2">"\https://github.com/phpcookbookreader/package"</code><code class="w"> </code><a class="co" id="co_packages_and_extensions_CO1-1" href="#callout_packages_and_extensions_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code class="w">
        </code><code class="p">}</code><code class="w">
    </code><code class="p">],</code><code class="w">
    </code><code class="nt">"require"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w">
        </code><code class="nt">"vendor/package"</code><code class="p">:</code><code class="w"> </code><code class="s2">"dev-bugfix"</code><code class="w"> </code><a class="co" id="co_packages_and_extensions_CO1-2" href="#callout_packages_and_extensions_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code class="w">
    </code><code class="p">},</code><code class="w">
    </code><code class="nt">"minimum-stability"</code><code class="p">:</code><code class="w"> </code><code class="s2">"dev"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_packages_and_extensions_CO1-3" href="#callout_packages_and_extensions_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code class="w">
    </code><code class="nt">"autoload"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w">
        </code><code class="nt">"psr-4"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w">
            </code><code class="nt">"Cookbook\\"</code><code class="p">:</code><code class="w"> </code><code class="s2">"src/"</code><code class="w">
        </code><code class="p">}</code><code class="w">
    </code><code class="p">}</code><code class="w">
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_packages_and_extensions_CO1-1" href="#co_packages_and_extensions_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Ensure that the package you want to include is one you have access to. This repository can either be public or private. If it’s private, then you’ll need to expose a GitHub personal access token as an environment variable so Composer has the appropriate credentials to pull in the code.</p></dd>
<dt><a class="co" id="callout_packages_and_extensions_CO1-2" href="#co_packages_and_extensions_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Once the repository is defined, add a new branch specification to your <code>require</code> block. Since this is not a tagged or released version, prefix your branch name with <code>dev-</code> so Composer knows which branch to pull in.</p></dd>
<dt><a class="co" id="callout_packages_and_extensions_CO1-3" href="#co_packages_and_extensions_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>To include development branches in your project, you should call out the <a href="https://oreil.ly/U9iWR">minimum stability</a> required by the project as well to avoid any potential issues with the inclusion.</p></dd>
</dl></div>

<p>Whether a library enters your project as a public package, repository, or even as a <a href="https://oreil.ly/xEpJh">hardcoded ZIP artifact</a> is up to your development team. Regardless, <a data-type="indexterm" data-primary="Composer" data-secondary="packages" data-tertiary="installing" data-startref="cpsgfsl" id="idm45875138902768"></a><a data-type="indexterm" data-primary="Composer" data-secondary="packages" data-tertiary="updating" data-startref="psrkgud" id="idm45875138901248"></a><a data-type="indexterm" data-primary="packages" data-secondary="updating" data-startref="plgpdt" id="idm45875138899760"></a><a data-type="indexterm" data-primary="packages" data-secondary="installing" data-startref="ckgstlg" id="idm45875138898544"></a><a data-type="indexterm" data-primary="Composer" data-secondary="composer.json file" data-startref="cpscpsjf" id="idm45875138897328"></a><a data-type="indexterm" data-primary="Composer" data-secondary="composer.lock file" data-startref="cpscmrck" id="idm45875138896112"></a>any reusable package can be loaded via Composer with ease and exposed to the rest of your 
<span class="keep-together">application</span>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875139270816">
<h2>See Also</h2>

<p>Documentation on Composer’s <a href="https://oreil.ly/d32oK"><code>require</code> command</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="15.4 Installing Native PHP Extensions"><div class="sect1" id="native_php_extensions">
<h1>15.4 Installing Native PHP Extensions</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875138889920">
<h2>Problem</h2>

<p>You want to install a publicly <a data-type="indexterm" data-primary="extensions" data-secondary="native, installing" id="xtsvtl"></a><a data-type="indexterm" data-primary="native extensions, installing" id="ntvxtll"></a>available native extension for PHP, like the <a href="https://oreil.ly/Jppw-">APC User Cache (APCu)</a>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875138885328">
<h2>Solution</h2>

<p>Find the extension in <a data-type="indexterm" data-primary="PEAR" id="pera"></a><a data-type="indexterm" data-primary="PECL (PHP Extension Community Library)" id="pclphpxt"></a>the PECL repository and install it into the system by using PEAR. For example, install the APCu as follows:</p>

<pre data-type="programlisting" data-code-language="sh">$<code class="w"> </code>pecl<code class="w"> </code>install<code class="w"> </code>apcu<code class="w"></code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875138866320">
<h2>Discussion</h2>

<p>The PHP community uses two pieces of technology to distribute native extensions to the language itself: PEAR and PECL. The primary difference between them is the kind of package they’re used for.</p>

<p>PEAR itself can bundle just about anything—the packages it distributes are bundled as gzip-compressed TAR archives that are composed of PHP code. In this way, PEAR is similar to Composer and can be used for managing, installing, and updating additional PHP libraries used within your application.<sup><a data-type="noteref" id="idm45875138864368-marker" href="ch15.html#idm45875138864368">5</a></sup> PEAR packages are loaded differently than Composer ones, though, so take care if you choose to mix and match between the two package managers.</p>

<p>PECL is a library of native extensions to PHP written in C, the same base language as PHP itself. PECL uses PEAR to handle installation and management of extensions; the new functionality introduced through an extension is accessed the same ways as functions native to the language itself.</p>

<p>In reality, many PHP packages introduced in modern versions of the language began as PECL extensions that could be optionally installed by developers for testing and initial integrations. <a href="https://oreil.ly/QdyfM">The sodium encryption library</a>, for example, began as a PECL extension before being added to the core distribution of PHP as of version 7.2.<sup><a data-type="noteref" id="idm45875138876640-marker" href="ch15.html#idm45875138876640">6</a></sup></p>

<p>Certain databases (for example, <a href="https://oreil.ly/Xoh5_">MongoDB</a>), distribute their core drivers for PHP as native PECL extensions. Various networking, security, multimedia, and console manipulation libraries are also available. All are written in highly efficient C code and, thanks to PECL and bindings against PHP, behave as if they were a part of the language itself.</p>

<p>Unlike tools like Composer, which deliver userland PHP code, PECL delivers the raw C code directly to your environment. The <code>install</code> command will do the following:</p>
<ol>
<li>
<p>Download the extension source</p>
</li>
<li>
<p>Compile the source for your system, leveraging the local environment, its configuration, and the system architecture to ensure compatibility</p>
</li>
<li>
<p>Create a compiled <em>.so</em> file for the extension within the <a href="https://oreil.ly/KFNg9">extension directory</a> defined by your environment</p>
</li>

</ol>
<div data-type="tip"><h6>Tip</h6>
<p>While some extensions have appeared to be self-enabling, it’s highly likely you will need to modify your system’s <em>php.ini</em> file to explicitly include the extension. It’s a good idea to then restart your web server (Apache, NGINX, or similar) to ensure that PHP loads the new extension as expected.</p>
</div>

<p>On Linux systems, you might even want to leverage your system package manager to install a precompiled native extension. Installing APCu on an Ubuntu Linux system is usually as simple as this:</p>

<pre data-type="programlisting" data-code-language="sh">$<code class="w"> </code>sudo<code class="w"> </code>apt<code class="w"> </code>install<code class="w"> </code>php-apcu<code class="w"></code></pre>

<p>Whether you leverage PECL to build an extension directly or utilize a precompiled binary through a package manager, extending PHP is efficient and easy. These extensions expand the <a data-type="indexterm" data-primary="extensions" data-secondary="native, installing" data-startref="xtsvtl" id="idm45875138836624"></a><a data-type="indexterm" data-primary="native extensions, installing" data-startref="ntvxtll" id="idm45875138835536"></a><a data-type="indexterm" data-primary="PEAR" data-startref="pera" id="idm45875138834688"></a><a data-type="indexterm" data-primary="PECL (PHP Extension Community Library)" data-startref="pclphpxt" id="idm45875138830608"></a>functionality of the language and make your final applications significantly more useful.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875138865728">
<h2>See Also</h2>

<p>Documentation on the <a href="https://oreil.ly/28K08">PECL repository</a> and <a href="https://pear.php.net">PEAR extension packaging system</a>.</p>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45875139704496"><sup><a href="ch15.html#idm45875139704496-marker">1</a></sup> A full list of bundled and external extensions can be found in the <a href="https://oreil.ly/SEWGK">PHP Manual</a>.</p><p data-type="footnote" id="idm45875139396784"><sup><a href="ch15.html#idm45875139396784-marker">2</a></sup> For more on installing third-party libraries with Composer, see <a data-type="xref" href="#installing_composer_packages">Recipe 15.3</a>.</p><p data-type="footnote" id="idm45875139325680"><sup><a href="ch15.html#idm45875139325680-marker">3</a></sup> For a deeper discussion of object-oriented programming and code reuse, review <a data-type="xref" href="ch08.html#chapter_classes">Chapter 8</a>.</p><p data-type="footnote" id="idm45875139321888"><sup><a href="ch15.html#idm45875139321888-marker">4</a></sup> The actual <em>installation</em> of third-party Composer packages will be discussed in <a data-type="xref" href="#installing_composer_packages">Recipe 15.3</a>.</p><p data-type="footnote" id="idm45875138864368"><sup><a href="ch15.html#idm45875138864368-marker">5</a></sup> See <a data-type="xref" href="#installing_composer_packages">Recipe 15.3</a> for more on installing packages via Composer.</p><p data-type="footnote" id="idm45875138876640"><sup><a href="ch15.html#idm45875138876640-marker">6</a></sup> The sodium extension is discussed at length in <a data-type="xref" href="ch09.html#chapter_encryption">Chapter 9</a>.</p></div></div></section></div>
</div>
</body>
</html>