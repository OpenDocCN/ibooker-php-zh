<html><head></head><body><section data-pdf-bookmark="Chapter 3. Routing and Controllers" data-type="chapter" epub:type="chapter"><div class="chapter" id="routing">&#13;
<h1><span class="label">Chapter 3. </span>Routing and Controllers</h1>&#13;
&#13;
&#13;
<p>The<a data-primary="routing and controllers" data-secondary="introduction to" data-type="indexterm" id="RTintro01"/> essential function of any web application framework is to take requests from a user and deliver responses, usually via HTTP(S). This means defining an application’s routes is the first and most important project to tackle when learning a web framework; without routes, you have little to no ability to interact with the end user.</p>&#13;
&#13;
<p>In this chapter we will examine routes in Laravel; you’ll see how to define them, how to point them to the code they should execute, and how to use Laravel’s routing tools to handle a diverse array of routing needs.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Quick Introduction to MVC, the HTTP Verbs, and REST" data-type="sect1"><div class="sect1" id="id634">&#13;
<h1>A Quick Introduction to MVC, the HTTP Verbs, and REST</h1>&#13;
&#13;
<p>Most of what we’ll talk about in this chapter references how Model–View–Controller (MVC) applications are structured, and many of the examples we’ll be looking at use REST-ish route names and verbs, so let’s take a quick look at both.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="What Is MVC?" data-type="sect2"><div class="sect2" id="id382">&#13;
<h2>What Is MVC?</h2>&#13;
&#13;
<p>In<a data-primary="Model–View–Controller (MVC) applications" data-secondary="primary concepts of" data-type="indexterm" id="id784"/> MVC, you have three primary concepts:</p>&#13;
<dl>&#13;
<dt>model</dt>&#13;
<dd>&#13;
<p>Represents an individual database table (or a record from that table)—think “Company” or “Dog.”</p>&#13;
</dd>&#13;
<dt>view</dt>&#13;
<dd>&#13;
<p>Represents the template that outputs your data to the end user—​think “the login page template with this given set of HTML and CSS and JavaScript.”</p>&#13;
</dd>&#13;
<dt>controller</dt>&#13;
<dd>&#13;
<p>Like a traffic cop, takes HTTP requests from the browser, gets the right data out of the database and other storage mechanisms, validates user input, and eventually sends a response back to the user.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>In <a data-type="xref" href="#FIG301">Figure 3-1</a>, you can see that the end user will first interact with the controller by sending an HTTP request using their browser. The controller, in response to that request, may write data to and/or pull data from the model (database). The controller will then likely send data to a view, and then the view will be returned to the end user to display in their browser.</p>&#13;
&#13;
<figure><div class="figure" id="FIG301">&#13;
<img alt="A diagram of a Model, a View, and a Controller, together with the User, all with arrows pointing to each other" src="assets/lur3_0301.png"/>&#13;
<h6><span class="label">Figure 3-1. </span>A basic illustration of MVC</h6>&#13;
</div></figure>&#13;
&#13;
<p>We’ll cover some use cases for Laravel that don’t fit this relatively simplistic way of looking at application architecture, so don’t get hung up on MVC, but this will at least get you ready to approach the rest of this chapter as we talk about views and &#13;
<span class="keep-together">controllers</span>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The HTTP Verbs" data-type="sect2"><div class="sect2" id="id383">&#13;
<h2>The HTTP Verbs</h2>&#13;
&#13;
<p>the<a data-primary="HTTP verbs" data-secondary="list of common" data-type="indexterm" id="id785"/> most common HTTP verbs are <code>GET</code> and <code>POST</code>, followed by <code>PUT</code> and <code>DELETE</code>. There are also <code>HEAD</code>, <code>OPTIONS</code>, and <code>PATCH</code>, and two others that are pretty much never used in normal web development, <code>TRACE</code> and <code>CONNECT</code>.</p>&#13;
&#13;
<p>Here’s a quick rundown:</p>&#13;
<dl>&#13;
<dt><code>GET</code></dt>&#13;
<dd>&#13;
<p>Request a resource (or a list of resources).</p>&#13;
</dd>&#13;
<dt><code>HEAD</code></dt>&#13;
<dd>&#13;
<p>Ask for a headers-only version of the <code>GET</code> response.</p>&#13;
</dd>&#13;
<dt><code>POST</code></dt>&#13;
<dd>&#13;
<p>Create a resource.</p>&#13;
</dd>&#13;
<dt><code>PUT</code></dt>&#13;
<dd>&#13;
<p>Overwrite a resource.</p>&#13;
</dd>&#13;
<dt><code>PATCH</code></dt>&#13;
<dd>&#13;
<p>Modify a resource.</p>&#13;
</dd>&#13;
<dt><code>DELETE</code></dt>&#13;
<dd>&#13;
<p>Delete a resource.</p>&#13;
</dd>&#13;
<dt><code>OPTIONS</code></dt>&#13;
<dd>&#13;
<p>Ask the server which verbs are allowed at this URL.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#table0301">Table 3-1</a> shows the actions available on a resource controller (more on these in <a data-type="xref" href="#resource_controllers">“Resource Controllers”</a>). Each action expects you to call a specific URL pattern using a specific verb, so you can get a sense of what each verb is used for.</p>&#13;
<table id="table0301">&#13;
<caption><span class="label">Table 3-1. </span>The methods of Laravel’s resource controllers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Verb</th>&#13;
<th>URL</th>&#13;
<th>Controller method</th>&#13;
<th>Name</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>GET</code></p></td>&#13;
<td><p><code>tasks</code></p></td>&#13;
<td><p><code>index()</code></p></td>&#13;
<td><p><code>tasks.index</code></p></td>&#13;
<td><p>Show all tasks</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>GET</code></p></td>&#13;
<td><p><code>tasks/create</code></p></td>&#13;
<td><p><code>create()</code></p></td>&#13;
<td><p><code>tasks.create</code></p></td>&#13;
<td><p>Show the create task form</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>POST</code></p></td>&#13;
<td><p><code>tasks</code></p></td>&#13;
<td><p><code>store()</code></p></td>&#13;
<td><p><code>tasks.store</code></p></td>&#13;
<td><p>Accept form submission from the create task form</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>GET</code></p></td>&#13;
<td><p><code>tasks/{task}</code></p></td>&#13;
<td><p><code>show()</code></p></td>&#13;
<td><p><code>tasks.show</code></p></td>&#13;
<td><p>Show one task</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>GET</code></p></td>&#13;
<td><p><code>tasks/{task}/edit</code></p></td>&#13;
<td><p><code>edit()</code></p></td>&#13;
<td><p><code>tasks.edit</code></p></td>&#13;
<td><p>Edit one task</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>PUT/PATCH</code></p></td>&#13;
<td><p><code>tasks/{task}</code></p></td>&#13;
<td><p><code>update()</code></p></td>&#13;
<td><p><code>tasks.update</code></p></td>&#13;
<td><p>Accept form submission from the edit task form</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>DELETE</code></p></td>&#13;
<td><p><code>tasks/{task}</code></p></td>&#13;
<td><p><code>destroy()</code></p></td>&#13;
<td><p><code>tasks.destroy</code></p></td>&#13;
<td><p>Delete one task</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="What Is REST?" data-type="sect2"><div class="sect2" id="id18">&#13;
<h2>What Is REST?</h2>&#13;
&#13;
<p>We’ll<a data-primary="representational state transfer (REST)" data-secondary="introduction to" data-type="indexterm" id="id786"/> cover REST in greater detail in <a data-type="xref" href="ch13.html#intro_to_rest">“The Basics of REST-Like JSON APIs”</a>, but as a brief introduction, it’s an architectural style for building APIs. When we talk about REST in this book, we’ll mainly be referencing a few characteristics, such as:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Being structured around one primary resource at a time (e.g., <code>tasks</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Consisting of interactions with predictable URL structures using HTTP verbs (as seen in <a data-type="xref" href="#table0301">Table 3-1</a>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Returning JSON and often being requested with JSON</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>There’s more to it, but usually “RESTful” as it’ll be used in this book will mean “patterned after these URL-based structures so we can make predictable calls like <span class="keep-together"><code>GET /tasks/14/edit</code></span> for the edit page.” This is relevant (even when not building APIs) because Laravel’s routing structures are based around a REST-like structure, as you can see in <a data-type="xref" href="#table0301">Table 3-1</a>.</p>&#13;
&#13;
<p>REST-based APIs follow mainly this same structure, except they don’t have a <em>create</em> route or an <em>edit</em> route, since APIs just represent actions, not pages that prep for the actions.<a data-primary="" data-startref="RTintro01" data-type="indexterm" id="id787"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Definitions" data-type="sect1"><div class="sect1" id="id19">&#13;
<h1>Route Definitions</h1>&#13;
&#13;
<p>In<a data-primary="routing and controllers" data-secondary="route definitions" data-type="indexterm" id="RACrdef02"/> a Laravel application, you will define your web routes in <em>routes/web.php</em> and your API routes in <em>routes/api.php</em>. <em>Web routes</em> are those that will be visited by your end users; <em>API routes</em> are those for your API, if you have one. For now, we’ll primarily focus on the routes in <em>routes/web.php</em>.</p>&#13;
&#13;
<p>The simplest way to define a route is to match a path (e.g., <code>/</code>) with a closure, as seen in <a data-type="xref" href="#EX1X">Example 3-1</a>.</p>&#13;
<div data-type="example" id="EX1X">&#13;
<h5><span class="label">Example 3-1. </span>Basic route definition</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// routes/web.php</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="s1">'Hello, World!'</code><code class="p">;</code>&#13;
<code class="p">});</code></pre></div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id788">&#13;
<h1>What’s a Closure?</h1>&#13;
<p><em>Closures</em> are<a data-primary="closures" data-type="indexterm" id="id789"/><a data-primary="anonymous functions" data-type="indexterm" id="id790"/> PHP’s version of anonymous functions. A closure is a function that you can pass around as an object, assign to a variable, pass as a parameter to other functions and methods, or even serialize.</p>&#13;
</div></aside>&#13;
&#13;
<p>You’ve now defined that if anyone visits <code>/</code> (the root of your domain), Laravel’s router should run the closure defined there and return the result. Note that we <code>return</code> our content and don’t <code>echo</code> or <code>print</code> it.</p>&#13;
<div data-type="note" epub:type="note"><h1>A Quick Introduction to Middleware</h1>&#13;
<p>You<a data-primary="middleware" data-secondary="introduction to" data-type="indexterm" id="id791"/> might be wondering, “Why am I returning ‘Hello, World!’ instead of echoing it?”</p>&#13;
&#13;
<p>There are quite a few answers, but the simplest is that there are a lot of wrappers around Laravel’s request and response cycle, including something called <em>middleware</em>. When your route closure or controller method is done, it’s not time to send the output to the browser yet; returning the content allows it to continue flowing through the response stack and the middleware before it is returned to the user.</p>&#13;
</div>&#13;
&#13;
<p>Many simple websites could be defined entirely within the web routes file. With a few simple <code>GET</code> routes combined with some templates, as illustrated in <a data-type="xref" href="#EX30">Example 3-2</a>, you can serve a classic website easily.</p>&#13;
<div data-type="example" id="EX30">&#13;
<h5><span class="label">Example 3-2. </span>Sample website</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'welcome'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'about'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'about'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'products'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'products'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'services'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'services'</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h1>Static Calls</h1>&#13;
<p>If you have much experience developing with PHP, you might be surprised to see static calls on the <code>Route</code> class. This is not actually a static method per se, but rather a service location using Laravel’s facades, which we’ll cover in <a data-type="xref" href="ch11.html#the_container">Chapter 11</a>.</p>&#13;
&#13;
<p>If you prefer to avoid facades, you can accomplish these same definitions like this:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$router</code><code class="o">-&gt;</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="s1">'Hello, World!'</code><code class="p">;</code>&#13;
<code class="p">});</code></pre>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Verbs" data-type="sect2"><div class="sect2" id="id554">&#13;
<h2>Route Verbs</h2>&#13;
&#13;
<p>You<a data-primary="routing and controllers" data-secondary="route definitions" data-tertiary="route verbs" data-type="indexterm" id="id792"/> might’ve noticed that we’ve been using <code>Route::get()</code> in our route definitions. This means we’re telling Laravel to only match for these routes when the HTTP request uses the <code>GET</code> action. But what if it’s a form <code>POST</code>, or maybe some JavaScript sending <code>PUT</code> or <code>DELETE</code> requests? There are a few other options for methods to call on a route definition, as illustrated in <a data-type="xref" href="#EX31">Example 3-3</a>.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="EX31">&#13;
<h5><span class="label">Example 3-3. </span>Route verbs</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="s1">'Hello, World!'</code><code class="p">;</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// Handle someone sending a POST request to this route</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">put</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// Handle someone sending a PUT request to this route</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">delete</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// Handle someone sending a DELETE request to this route</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">any</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// Handle any verb request to this route</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">match</code><code class="p">([</code><code class="s1">'get'</code><code class="p">,</code> <code class="s1">'post'</code><code class="p">],</code> <code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// Handle GET or POST requests to this route</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Handling" data-type="sect2"><div class="sect2" id="id20">&#13;
<h2>Route Handling</h2>&#13;
&#13;
<p>As<a data-primary="routing and controllers" data-secondary="route definitions" data-tertiary="route handling" data-type="indexterm" id="id793"/> you’ve probably guessed, passing a closure to the route definition is not the only way to teach it how to resolve a route. Closures are quick and simple, but the larger your application gets, the clumsier it becomes to put all of your routing logic in one file. Additionally, applications using route closures can’t take advantage of Laravel’s route caching (more on that later), which can shave up to hundreds of milliseconds off of each request.</p>&#13;
&#13;
<p>The other common option is to pass a controller name and method as a string in place of the closure, as in <a data-type="xref" href="#EX32">Example 3-4</a>.</p>&#13;
<div data-type="example" id="EX32">&#13;
<h5><span class="label">Example 3-4. </span>Routes calling controller methods</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">use</code> <code class="nx">App\Http\Controllers\WelcomeController</code><code class="p">;</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="p">[</code><code class="nx">WelcomeController</code><code class="o">::</code><code class="na">class</code><code class="p">,</code> <code class="s1">'index'</code><code class="p">]);</code></pre></div>&#13;
&#13;
<p>This is telling Laravel to pass requests to that path to the <code>index()</code> method of the <span class="keep-together"><code>App\Http\Controllers\WelcomeController</code></span> controller. This method will be passed the same parameters and treated the same way as a closure you might’ve alternatively put in its place.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id794">&#13;
<h1>Laravel’s Controller/Method Reference Syntax</h1>&#13;
<p>Laravel<a data-primary="controller/method reference syntax" data-type="indexterm" id="id795"/><a data-primary="tuple syntax" data-type="indexterm" id="id796"/><a data-primary="callable array syntax" data-type="indexterm" id="id797"/> has a convention for how to refer to a particular method in a given controller: <code><em>[ControllerName::class, methodName]</em></code>, known as <em>tuple syntax</em> or <em>callable array syntax</em>. Sometimes this is just a casual communication convention, but it’s also used in real bindings, like in <a data-type="xref" href="#EX32">Example 3-4</a>. The first item on the array identifies the controller and the second the method.</p>&#13;
&#13;
<p>Laravel also supports an older “string” syntax (<code>Route::get('/', 'WelcomeController@index')</code>), and this is still a common way to describe a method in written &#13;
<span class="keep-together">communication</span>.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Parameters" data-type="sect2"><div class="sect2" id="id21">&#13;
<h2>Route Parameters</h2>&#13;
&#13;
<p>If<a data-primary="routing and controllers" data-secondary="route definitions" data-tertiary="route parameters" data-type="indexterm" id="id798"/> the route you’re defining has parameters—​segments in the URL structure that are variable—​it’s simple to define them in your route and pass them to your closure (see <a data-type="xref" href="#EX34">Example 3-5</a>).</p>&#13;
<div data-type="example" id="EX34">&#13;
<h5><span class="label">Example 3-5. </span>Route parameters</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id}/friends'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>You can also make your route parameters optional by including a question mark (<code>?</code>) after the parameter name, as illustrated in <a data-type="xref" href="#EX35">Example 3-6</a>. In this case, you should also provide a default value for the route’s corresponding variable.</p>&#13;
<div data-type="example" id="EX35">&#13;
<h5><span class="label">Example 3-6. </span>Optional route parameters</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id?}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code> <code class="o">=</code> <code class="s1">'fallbackId'</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>And you can use regular expressions (regexes) to define that a route should only match if a parameter meets particular requirements, as in <a data-type="xref" href="#EX36">Example 3-7</a>.</p>&#13;
<div data-type="example" id="EX36">&#13;
<h5><span class="label">Example 3-7. </span>Regular expression route constraints</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">where</code><code class="p">(</code><code class="s1">'id'</code><code class="p">,</code> <code class="s1">'[0-9]+'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{username}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$username</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">where</code><code class="p">(</code><code class="s1">'username'</code><code class="p">,</code> <code class="s1">'[A-Za-z]+'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'posts/{id}/{slug}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">,</code> <code class="nv">$slug</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">where</code><code class="p">([</code><code class="s1">'id'</code> <code class="o">=&gt;</code> <code class="s1">'[0-9]+'</code><code class="p">,</code> <code class="s1">'slug'</code> <code class="o">=&gt;</code> <code class="s1">'[A-Za-z]+'</code><code class="p">]);</code></pre></div>&#13;
&#13;
<p>As you’ve probably guessed, if you visit a path that matches a route string but the regex doesn’t match the parameter, it won’t be matched. Since routes are matched top to bottom, <code>users/abc</code> would skip the first closure in <a data-type="xref" href="#EX36">Example 3-7</a>, but it would be matched by the second closure, so it would get routed there. On the other hand, <code>posts/abc/123</code> wouldn’t match any of the closures, so it would return a 404 (Not Found) error.</p>&#13;
&#13;
<p>Laravel also offers convenience methods for common regular expression matching patterns, as you can see in <a data-type="xref" href="#EX36.5">Example 3-8</a>.</p>&#13;
<div data-type="example" id="EX36.5">&#13;
<h5><span class="label">Example 3-8. </span>Regular expression route constraint helpers</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id}/friends/{friendname}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">,</code> <code class="nv">$friendname</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">whereNumber</code><code class="p">(</code><code class="s1">'id'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">whereAlpha</code><code class="p">(</code><code class="s1">'friendname'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{name}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$name</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">whereAlphaNumeric</code><code class="p">(</code><code class="s1">'name'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">whereUuid</code><code class="p">(</code><code class="s1">'id'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">whereUlid</code><code class="p">(</code><code class="s1">'id'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'friends/types/{type}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$type</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">})</code><code class="o">-&gt;</code><code class="na">whereIn</code><code class="p">(</code><code class="s1">'type'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'acquaintance'</code><code class="p">,</code> <code class="s1">'bestie'</code><code class="p">,</code> <code class="s1">'frenemy'</code><code class="p">]);</code></pre></div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id799">&#13;
<h1>The Naming Relationship Between Route Parameters <br/>and Closure/Controller Method Parameters</h1>&#13;
<p>As<a data-primary="names and naming" data-secondary="route parameters and closure/controller method parameters" data-type="indexterm" id="id800"/><a data-primary="controller/method reference syntax" data-type="indexterm" id="id801"/> you can see in <a data-type="xref" href="#EX34">Example 3-5</a>, it’s most common to use the same names for your route parameters (<code>{id}</code>) and the method parameters they inject into your route definition (<code>function ($id)</code>). But is this necessary?</p>&#13;
&#13;
<p>Unless you’re using route model binding, discussed later in this chapter, no. The only thing that defines which route parameter matches with which method parameter is their order (left to right), as you can see here:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{userId}/comments/{commentId}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code>&#13;
    <code class="nv">$thisIsActuallyTheUserId</code><code class="p">,</code>&#13;
    <code class="nv">$thisIsReallyTheCommentId</code>&#13;
    <code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>That having been said, just because you <em>can</em> make them different doesn’t mean you <em>should</em>. I recommend keeping them the same for the sake of future developers, who could get tripped up by inconsistent naming.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Names" data-type="sect2"><div class="sect2" id="id22">&#13;
<h2>Route Names</h2>&#13;
&#13;
<p>The<a data-primary="routing and controllers" data-secondary="route definitions" data-tertiary="route names" data-type="indexterm" id="id802"/> simplest way to refer to these routes elsewhere in your application is just by their path. There’s a <code>url()</code> global helper to simplify that linking in your views, if you need it; see <a data-type="xref" href="#EX37">Example 3-9</a> for an example. The helper will prefix your route with the full domain of your site.</p>&#13;
<div data-type="example" id="EX37">&#13;
<h5><span class="label">Example 3-9. </span>The <code>url()</code> helper</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="o">&lt;</code><code class="nx">a</code> <code class="nx">href</code><code class="o">=</code><code class="s2">"&lt;?php echo url('/'); ?&gt;"</code><code class="o">&gt;</code>&#13;
<code class="c1">// Outputs &lt;a href="http://myapp.com/"&gt;</code></pre></div>&#13;
&#13;
<p>However, Laravel also allows you to name each route, which enables you to refer to it without explicitly referencing the URL. This is helpful because it means you can give simple nicknames to complex routes, and also because linking them by name means you don’t have to rewrite your frontend links if the paths change (see <a data-type="xref" href="#EX38">Example 3-10</a>).</p>&#13;
<div data-type="example" id="EX38">&#13;
<h5><span class="label">Example 3-10. </span>Defining route names</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// Defining a route with name() in routes/web.php:</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'members/{id}'</code><code class="p">,</code> <code class="p">[</code><code class="nx">\App\Http\Controller\MemberController</code><code class="o">::</code><code class="na">class</code><code class="p">,</code> <code class="s1">'show'</code><code class="p">])</code>&#13;
    <code class="o">-&gt;</code><code class="na">name</code><code class="p">(</code><code class="s1">'members.show'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Linking the route in a view using the route() helper:</code>&#13;
<code class="o">&lt;</code><code class="nx">a</code> <code class="nx">href</code><code class="o">=</code><code class="s2">"&lt;?php echo route('members.show', ['id' =&gt; 14]); ?&gt;"</code><code class="o">&gt;</code></pre></div>&#13;
&#13;
<p>This example illustrates a few new concepts. First, we’re using fluent route definition to add the name, by chaining the <code>name()</code> method after the <code>get()</code> method. This method allows us to name the route, giving it a short alias to make it easier to reference elsewhere.</p>&#13;
&#13;
<p>In our example, we’ve named this route <code>members.show</code>; <code><em>resourcePlural</em>.<em>action</em></code> is a common convention within Laravel for route and view names.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id803">&#13;
<h1>Route Naming Conventions</h1>&#13;
<p>You<a data-primary="names and naming" data-secondary="route naming conventions" data-type="indexterm" id="id804"/> can name your route anything you’d like, but the common convention is to use the plural of the resource name, then a period, then the action. So, here are the routes most common for a resource named <code>photo</code>:</p>&#13;
&#13;
<pre data-type="programlisting">photos.index&#13;
photos.create&#13;
photos.store&#13;
photos.show&#13;
photos.edit&#13;
photos.update&#13;
photos.destroy</pre>&#13;
&#13;
<p>To learn more about these conventions, see <a data-type="xref" href="#resource_controllers">“Resource Controllers”</a>.</p>&#13;
</div></aside>&#13;
&#13;
<p>This example also introduced the <code>route()</code> helper. Just like <code>url()</code>, it’s intended to be used in views to simplify linking to a named route. If the route has no parameters, you can simply pass the route name (<code>route('members.index')</code>) and receive a route string (<code>"http://myapp.com/members"</code>). If it has parameters, pass them as an array in the second parameter like we did in <a data-type="xref" href="#EX38">Example 3-10</a>.</p>&#13;
&#13;
<p>In general, I recommend using route names instead of paths to refer to your routes, and therefore using the <code>route()</code> helper instead of the <code>url()</code> helper. Sometimes it can get a bit clumsy—​for example, if you’re working with multiple subdomains—​but it provides an incredible level of flexibility to later change the application’s routing structure without major penalty.</p>&#13;
<aside class="less_space" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id805">&#13;
<h1>Passing Route Parameters to the route() Helper</h1>&#13;
<p>When<a data-primary="parameters" data-secondary="passing route parameters" data-type="indexterm" id="id806"/><a data-primary="route() helper" data-type="indexterm" id="id807"/><a data-primary="helpers" data-secondary="route() helper" data-type="indexterm" id="id808"/> your route has parameters (e.g., <code>users</code>/<em><code>id</code></em>), you need to define those parameters when you’re using the <code>route()</code> helper to generate a link to the route.</p>&#13;
&#13;
<p>There are a few different ways to pass these parameters. Let’s imagine a route defined as <code>users/<em><code>userId</code></em>/comments/<em><code>commentId</code></em></code>. If the user ID is <code>1</code> and the comment ID is <code>2</code>, let’s look at a few options we have available to us:</p>&#13;
&#13;
<p><strong>Option 1:</strong></p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">route</code><code class="p">(</code><code class="s1">'users.comments.show'</code><code class="p">,</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">])</code>&#13;
<code class="c1">// http://myapp.com/users/1/comments/2</code></pre>&#13;
&#13;
<p><strong>Option 2:</strong></p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">route</code><code class="p">(</code><code class="s1">'users.comments.show'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'userId'</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="s1">'commentId'</code> <code class="o">=&gt;</code> <code class="mi">2</code><code class="p">])</code>&#13;
<code class="c1">// http://myapp.com/users/1/comments/2</code></pre>&#13;
&#13;
<p class="pagebreak-before"><strong>Option 3:</strong></p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">route</code><code class="p">(</code><code class="s1">'users.comments.show'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'commentId'</code> <code class="o">=&gt;</code> <code class="mi">2</code><code class="p">,</code> <code class="s1">'userId'</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">])</code>&#13;
<code class="c1">// http://myapp.com/users/1/comments/2</code></pre>&#13;
&#13;
<p><strong>Option 4:</strong></p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">route</code><code class="p">(</code><code class="s1">'users.comments.show'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'userId'</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="s1">'commentId'</code> <code class="o">=&gt;</code> <code class="mi">2</code><code class="p">,</code> <code class="s1">'opt'</code> <code class="o">=&gt;</code> <code class="s1">'a'</code><code class="p">])</code>&#13;
<code class="c1">// http://myapp.com/users/1/comments/2?opt=a</code></pre>&#13;
&#13;
<p>As you can see, nonkeyed array values are assigned in order; keyed array values are matched with the route parameters matching their keys, and anything left over is added as a query parameter.<a data-primary="" data-startref="RACrdef02" data-type="indexterm" id="id809"/></p>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Groups" data-type="sect1"><div class="sect1" id="id384">&#13;
<h1>Route Groups</h1>&#13;
&#13;
<p>Often<a data-primary="routing and controllers" data-secondary="route groups" data-type="indexterm" id="RACgroups03"/> a group of routes shares a particular characteristic—a certain authentication requirement, a path prefix, or perhaps a controller namespace. Defining these shared characteristics again and again on each route not only seems tedious but also can muddy up the shape of your routes file and obscure some of the structures of <span class="keep-together">your application.</span></p>&#13;
&#13;
<p><em>Route groups</em> allow you to reduce this duplication by grouping several routes together and applying any shared configuration settings once to the entire group. Additionally, route groups are visual cues to future developers (and to your own brain) that these routes are grouped together.</p>&#13;
&#13;
<p>To group two or more routes together, you “surround” the route definitions with a route group, as shown in <a data-type="xref" href="#EX40">Example 3-11</a>. In reality, you’re actually passing a closure to the group definition and defining the grouped routes within that closure.</p>&#13;
<div data-type="example" id="EX40">&#13;
<h5><span class="label">Example 3-11. </span>Defining a route group</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'hello'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="s1">'Hello'</code><code class="p">;</code>&#13;
    <code class="p">});</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'world'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="s1">'World'</code><code class="p">;</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>By default, a route group doesn’t actually do anything. There’s no difference between using the group in <a data-type="xref" href="#EX40">Example 3-11</a> and separating a segment of your routes with code <span class="keep-together">comments.</span></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Middleware" data-type="sect2"><div class="sect2" id="id385">&#13;
<h2>Middleware</h2>&#13;
&#13;
<p>Probably<a data-primary="routing and controllers" data-secondary="route groups" data-tertiary="middleware" data-type="indexterm" id="id810"/><a data-primary="middleware" data-secondary="applying with route groups" data-type="indexterm" id="id811"/> the most common use for route groups is to apply middleware to a group of routes. You’ll learn more about middleware in <a data-type="xref" href="ch10.html#requests_and_responses">Chapter 10</a>, but, among other things, they’re what Laravel uses for authenticating users and restricting guest users from using certain parts of a site.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#EX41">Example 3-12</a>, we’re creating a route group around the <code>dashboard</code> and <code>account</code> views and applying the <code>auth</code> middleware to both. In this example, this means users have to be logged in to the application to view the dashboard or the account page.</p>&#13;
<div data-type="example" id="EX41">&#13;
<h5><span class="label">Example 3-12. </span>Restricting a group of routes to logged-in users only</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">middleware</code><code class="p">(</code><code class="s1">'auth'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'dashboard'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'dashboard'</code><code class="p">);</code>&#13;
    <code class="p">});</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'account'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'account'</code><code class="p">);</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Often, it’s clearer and more direct to attach middleware to your routes in the controller instead of at the route definition. You can do this by calling the <code>middleware()</code> method in the constructor of your controller. The string you pass to the <code>middleware()</code> method is the name of the middleware, and you can optionally chain modifier methods (<code>only()</code> and <code>except()</code>) to define which methods will receive that &#13;
<span class="keep-together">middleware</span>:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">class</code> <code class="nc">DashboardController</code> <code class="k">extends</code> <code class="nx">Controller</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">()</code>&#13;
    <code class="p">{</code>&#13;
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">middleware</code><code class="p">(</code><code class="s1">'auth'</code><code class="p">);</code>&#13;
&#13;
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">middleware</code><code class="p">(</code><code class="s1">'admin-auth'</code><code class="p">)</code>&#13;
            <code class="o">-&gt;</code><code class="na">only</code><code class="p">(</code><code class="s1">'editUsers'</code><code class="p">);</code>&#13;
&#13;
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">middleware</code><code class="p">(</code><code class="s1">'team-member'</code><code class="p">)</code>&#13;
            <code class="o">-&gt;</code><code class="na">except</code><code class="p">(</code><code class="s1">'editUsers'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Note that if you’re doing a lot of “only” and “except” customizations, that’s often a sign that you should break out a new controller for the exceptional routes.</p>&#13;
<aside class="less_space" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id812">&#13;
<h1>A Brief Introduction to Eloquent</h1>&#13;
<p>We’ll<a data-primary="Eloquent" data-secondary="introduction to" data-type="indexterm" id="id813"/> be covering Eloquent, database access, and Laravel’s query builder in depth in <a data-type="xref" href="ch05.html#database_and_eloquent">Chapter 5</a>, but there will be a few references between now and then that will make a basic understanding useful.</p>&#13;
&#13;
<p>Eloquent is Laravel’s ActiveRecord database object-relational mapper (ORM), which makes it easy to relate a <code>Post</code> class (model) to the <code>posts</code> database table and get all records with a call like <code>Post::all()</code>.</p>&#13;
&#13;
<p>The query builder is the tool that makes it possible to make calls like <code>Post::where('active', true)-&gt;get()</code> or even <code>DB::table('users')-&gt;all()</code>. You’re <em>building</em> a query by chaining methods one after another.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Path Prefixes" data-type="sect2"><div class="sect2" id="id23">&#13;
<h2>Path Prefixes</h2>&#13;
&#13;
<p>If<a data-primary="routing and controllers" data-secondary="route groups" data-tertiary="path prefixes" data-type="indexterm" id="id814"/><a data-primary="path prefixes" data-type="indexterm" id="id815"/> you have a group of routes that share a segment of their path—​for example, if your site’s dashboard is prefixed with <code>/dashboard</code>—you can use route groups to simplify this structure (see <a data-type="xref" href="#EX42">Example 3-13</a>).</p>&#13;
<div data-type="example" id="EX42">&#13;
<h5><span class="label">Example 3-13. </span>Prefixing a group of routes</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">prefix</code><code class="p">(</code><code class="s1">'dashboard'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="c1">// Handles the path /dashboard</code>&#13;
    <code class="p">});</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="c1">// Handles the path /dashboard/users</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Note that each prefixed group also has a <code>/</code> route that represents the root of the prefix—​in <a data-type="xref" href="#EX42">Example 3-13</a> that’s <code>/dashboard</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Subdomain Routing" data-type="sect2"><div class="sect2" id="id24">&#13;
<h2>Subdomain Routing</h2>&#13;
&#13;
<p>Subdomain routing<a data-primary="routing and controllers" data-secondary="route groups" data-tertiary="subdomain routing" data-type="indexterm" id="id816"/><a data-primary="subdomain routing" data-type="indexterm" id="id817"/> is the same as route prefixing, but it’s scoped by subdomain instead of route prefix. There are two primary uses for this. First, you may want to present different sections of the application (or entirely different applications) to different subdomains. <a data-type="xref" href="#EX43">Example 3-14</a> shows how you can achieve this.</p>&#13;
<div data-type="example" id="EX43">&#13;
<h5><span class="label">Example 3-14. </span>Subdomain routing</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">domain</code><code class="p">(</code><code class="s1">'api.myapp.com'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="c1">//</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Second, you might want to set part of the subdomain as a parameter, as illustrated in <a data-type="xref" href="#EX44">Example 3-15</a>. This is most often done in cases of multitenancy (think Slack or Harvest, where each company gets its own subdomain, like <em>tighten.slack.co</em>).</p>&#13;
<div data-type="example" id="EX44">&#13;
<h5><span class="label">Example 3-15. </span>Parameterized subdomain routing</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">domain</code><code class="p">(</code><code class="s1">'{account}.myapp.com'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$account</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="c1">//</code>&#13;
    <code class="p">});</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'users/{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$account</code><code class="p">,</code> <code class="nv">$id</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="c1">//</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Note that any parameters for the group get passed into the grouped routes’ methods as the first parameter(s).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Name Prefixes" data-type="sect2"><div class="sect2" id="id386">&#13;
<h2>Name Prefixes</h2>&#13;
&#13;
<p>It’s<a data-primary="routing and controllers" data-secondary="route groups" data-tertiary="name prefixes" data-type="indexterm" id="id818"/><a data-primary="names and naming" data-secondary="route name prefixes" data-type="indexterm" id="id819"/> common that route names will reflect the inheritance chain of path elements, so <code>users/comments/5</code> will be served by a route named <code>users.comments.show</code>. In this case, it’s common to use a route group around all of the routes that are beneath the <code>users.comments</code> resource.</p>&#13;
&#13;
<p>Just like we can prefix URL segments, we can also prefix strings to the route name. With route group name prefixes, we can define that every route within this group should have a given string prefixed to its name. In this context, we’re prefixing <code>"users."</code> to each route name, then <code>"comments."</code> (see <a data-type="xref" href="#EX46">Example 3-16</a>).</p>&#13;
<div data-type="example" id="EX46">&#13;
<h5><span class="label">Example 3-16. </span>Route group name prefixes</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">name</code><code class="p">(</code><code class="s1">'users.'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">prefix</code><code class="p">(</code><code class="s1">'users'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">name</code><code class="p">(</code><code class="s1">'comments.'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">prefix</code><code class="p">(</code><code class="s1">'comments'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
            <code class="c1">// ...</code>&#13;
        <code class="p">})</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">(</code><code class="s1">'show'</code><code class="p">);</code> <code class="c1">// Route named 'users.comments.show'</code>&#13;
&#13;
        <code class="nx">Route</code><code class="o">::</code><code class="na">destroy</code><code class="p">(</code><code class="s1">'{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{})</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">(</code><code class="s1">'destroy'</code><code class="p">);</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Group Controllers" data-type="sect2"><div class="sect2" id="id555">&#13;
<h2>Route Group Controllers</h2>&#13;
&#13;
<p>When<a data-primary="routing and controllers" data-secondary="route groups" data-tertiary="route group controllers" data-type="indexterm" id="id820"/> you’re grouping routes that are served by the same controller, such as when we’re showing, editing, and deleting users, for example, we can use the route group <code>controller()</code> method, as shown in <a data-type="xref" href="#EX45">Example 3-17</a>, to avoid having to define the full tuple for every route.</p>&#13;
<div data-type="example" id="EX45">&#13;
<h5><span class="label">Example 3-17. </span>Route group controllers</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">use</code> <code class="nx">App\Http\Controllers\UserController</code><code class="p">;</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">controller</code><code class="p">(</code><code class="nx">UserController</code><code class="o">::</code><code class="na">class</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">group</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="s1">'index'</code><code class="p">);</code>&#13;
    <code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'{id}'</code><code class="p">,</code> <code class="s1">'show'</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fallback Routes" data-type="sect2"><div class="sect2" id="id25">&#13;
<h2>Fallback Routes</h2>&#13;
&#13;
<p>In<a data-primary="routing and controllers" data-secondary="route groups" data-tertiary="fallback routes" data-type="indexterm" id="id821"/><a data-primary="fallback routes" data-type="indexterm" id="id822"/> Laravel you can define a “fallback route” (which you need to define at the end of your routes file) to catch all unmatched<a data-primary="" data-startref="RACgroups03" data-type="indexterm" id="id823"/> requests:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">fallback</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">});</code></pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Signed Routes" data-type="sect1"><div class="sect1" id="id26">&#13;
<h1>Signed Routes</h1>&#13;
&#13;
<p>Many<a data-primary="routing and controllers" data-secondary="signed routes" data-type="indexterm" id="id824"/><a data-primary="signed routes" data-type="indexterm" id="id825"/> applications regularly send notifications about one-off actions (resetting a password, accepting an invitation, etc.) and provide simple links to take those actions. Let’s imagine sending an email confirming the recipient was willing to be added to a mailing list.</p>&#13;
&#13;
<p>There are three ways to send that link:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Make that URL public and hope no one else discovers the approval URL or modifies their own approval URL to approve someone else.</p>&#13;
</li>&#13;
<li>&#13;
<p>Put the action behind authentication, link to the action, and require the user to log in if they’re not logged in yet (which, in this case, may be impossible, as many mailing list recipients likely won’t be users with accounts).</p>&#13;
</li>&#13;
<li>&#13;
<p>“Sign” the link so that it uniquely proves that the user received the link from your email, without them having to log in—something like <em>http://myapp.com/invitations/5816/yes?signature=030ab0ef6a8237bd86a8b8</em>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>One<a data-primary="Uniform Resource Locators (URLs)" data-secondary="signed URLs" data-type="indexterm" id="id826"/> simple way to accomplish the last option is to use a feature called <em>signed URLs</em>, which makes it easy to build a signature authentication system for sending out authenticated links. These links are composed of the normal route link with a &#13;
<span class="keep-together">“signature”</span> appended that proves that the URL has not been changed since it was sent (and therefore that no one has modified the URL to access someone else’s information).</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Signing a Route" data-type="sect2"><div class="sect2" id="id635">&#13;
<h2>Signing a Route</h2>&#13;
&#13;
<p>To build a signed URL to access a given route, the route must have a name:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'invitations/{invitation}/{answer}'</code><code class="p">,</code> <code class="nx">InvitationController</code><code class="o">::</code><code class="na">class</code><code class="p">)</code>&#13;
    <code class="o">-&gt;</code><code class="na">name</code><code class="p">(</code><code class="s1">'invitations'</code><code class="p">);</code></pre>&#13;
&#13;
<p>To generate a normal link to this route you would use the <code>route()</code> helper, as we’ve already covered, but you could also use the <code>URL</code> facade to do the same thing: <code>URL::route('invitations', ['invitation' =&gt; 12345, 'answer' =&gt; 'yes'])</code>. To generate a <em>signed</em> link to this route, simply use the <code>signedRoute()</code> method instead. And if you want to generate a signed route with an expiration, use <code>temporarySignedRoute()</code>:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// Generate a normal link</code>&#13;
<code class="nx">URL</code><code class="o">::</code><code class="na">route</code><code class="p">(</code><code class="s1">'invitations'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'invitation'</code> <code class="o">=&gt;</code> <code class="mi">12345</code><code class="p">,</code> <code class="s1">'answer'</code> <code class="o">=&gt;</code> <code class="s1">'yes'</code><code class="p">]);</code>&#13;
&#13;
<code class="c1">// Generate a signed link</code>&#13;
<code class="nx">URL</code><code class="o">::</code><code class="na">signedRoute</code><code class="p">(</code><code class="s1">'invitations'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'invitation'</code> <code class="o">=&gt;</code> <code class="mi">12345</code><code class="p">,</code> <code class="s1">'answer'</code> <code class="o">=&gt;</code> <code class="s1">'yes'</code><code class="p">]);</code>&#13;
&#13;
<code class="c1">// Generate an expiring (temporary) signed link</code>&#13;
<code class="nx">URL</code><code class="o">::</code><code class="na">temporarySignedRoute</code><code class="p">(</code>&#13;
    <code class="s1">'invitations'</code><code class="p">,</code>&#13;
    <code class="nx">now</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">addHours</code><code class="p">(</code><code class="mi">4</code><code class="p">),</code>&#13;
    <code class="p">[</code><code class="s1">'invitation'</code> <code class="o">=&gt;</code> <code class="mi">12345</code><code class="p">,</code> <code class="s1">'answer'</code> <code class="o">=&gt;</code> <code class="s1">'yes'</code><code class="p">]</code>&#13;
<code class="p">);</code></pre>&#13;
<div data-type="tip"><h1>Using the now() Helper</h1>&#13;
<p>Laravel offers a <code>now()</code> helper that’s the equivalent of <code>Carbon::now()</code>; it returns a Carbon object representative of today, right at this second.</p>&#13;
&#13;
<p>Carbon is a datetime library that’s included with Laravel.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Modifying Routes to Allow Signed Links" data-type="sect2"><div class="sect2" id="id27">&#13;
<h2>Modifying Routes to Allow Signed Links</h2>&#13;
&#13;
<p>Now<a data-primary="signed links" data-type="indexterm" id="id827"/> that you’ve generated a link to your signed route, you need to protect against any unsigned access. The easiest option is to apply the <code>signed</code> middleware:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'invitations/{invitation}/{answer}'</code><code class="p">,</code> <code class="nx">InvitationController</code><code class="o">::</code><code class="na">class</code><code class="p">)</code>&#13;
    <code class="o">-&gt;</code><code class="na">name</code><code class="p">(</code><code class="s1">'invitations'</code><code class="p">)</code>&#13;
    <code class="o">-&gt;</code><code class="na">middleware</code><code class="p">(</code><code class="s1">'signed'</code><code class="p">);</code></pre>&#13;
&#13;
<p>If you’d prefer, you can manually validate using the <code>hasValidSignature()</code> method on the <code>Request</code> object instead of using the <code>signed</code> middleware:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">class</code> <code class="nc">InvitationController</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__invoke</code><code class="p">(</code><code class="nx">Invitation</code> <code class="nv">$invitation</code><code class="p">,</code> <code class="nv">$answer</code><code class="p">,</code> <code class="nx">Request</code> <code class="nv">$request</code><code class="p">)</code>&#13;
    <code class="p">{</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="o">!</code> <code class="nv">$request</code><code class="o">-&gt;</code><code class="na">hasValidSignature</code><code class="p">())</code> <code class="p">{</code>&#13;
            <code class="nx">abort</code><code class="p">(</code><code class="mi">403</code><code class="p">);</code>&#13;
        <code class="p">}</code>&#13;
&#13;
        <code class="c1">//</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Views" data-type="sect1"><div class="sect1" id="id387">&#13;
<h1>Views</h1>&#13;
&#13;
<p>In<a data-primary="routing and controllers" data-secondary="views" data-type="indexterm" id="id828"/><a data-primary="views" data-secondary="in MVC applications" data-secondary-sortas="MCV applications" data-type="indexterm" id="id829"/><a data-primary="Model–View–Controller (MVC) applications" data-secondary="views" data-type="indexterm" id="id830"/> a few of the route closures we’ve looked at so far, we’ve seen something along the lines of <code>return view('account')</code>. What’s going on here?</p>&#13;
&#13;
<p>In the MVC pattern (<a data-type="xref" href="#FIG301">Figure 3-1</a>), <em>views</em> (or templates) are files that describe what some particular output should look like. You might have views that output JSON or XML or email, but the most common views in a web framework output HTML.</p>&#13;
&#13;
<p>In Laravel, there are two view formats you can use out of the box: plain PHP and Blade templates (see <a data-type="xref" href="ch04.html#blade_templating">Chapter 4</a>). The difference is in the filename: <em>about.php</em> will <span class="keep-together">be rendered</span> with the PHP engine, and <em>about.blade.php</em> will be rendered with the Blade engine.</p>&#13;
<div data-type="note" epub:type="note"><h1>Three Ways to Load a View</h1>&#13;
<p>There are three ways to return a view. For now, just concern yourself with <code>view()</code>, but if you ever see <code>View::make()</code>, it’s the same thing, or you could inject <code>Illuminate\View\ViewFactory</code> if you prefer.</p>&#13;
</div>&#13;
&#13;
<p>Once you’ve “loaded” a view with the <code>view()</code> helper, you have the option to simply return it (as in <a data-type="xref" href="#EX47">Example 3-18</a>), which will work fine if the view doesn’t rely on any variables from <span class="keep-together">the controller.</span></p>&#13;
<div data-type="example" id="EX47">&#13;
<h5><span class="label">Example 3-18. </span>Simple <code>view()</code> usage</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
   <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'home'</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>This code looks for a view in <em>resources/views/home.blade.php</em> or <em>resources/views/home.php</em> and loads its contents and parses any inline PHP or control structures until you have just the view’s output. Once you return it, it’s passed on to the rest of the response stack and eventually returned to the user.</p>&#13;
&#13;
<p>But what if you need to pass in variables? Take a look at <a data-type="xref" href="#EX48">Example 3-19</a>.</p>&#13;
<div data-type="example" id="EX48">&#13;
<h5><span class="label">Example 3-19. </span>Passing variables to views</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'tasks.index'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">with</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">,</code> <code class="nx">Task</code><code class="o">::</code><code class="na">all</code><code class="p">());</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>This closure loads the <em>resources/views/tasks/index.blade.php</em> or <em>resources/views/tasks/index.php</em> view and passes it a single variable named <code>tasks</code>, which contains the result of the <code>Task::all()</code> method. <code>Task::all()</code> is an Eloquent database query you’ll learn about in <a data-type="xref" href="ch05.html#database_and_eloquent">Chapter 5</a>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Returning Simple Routes Directly with Route::view()" data-type="sect2"><div class="sect2" id="id28">&#13;
<h2>Returning Simple Routes Directly with Route::view()</h2>&#13;
&#13;
<p>Because<a data-primary="route::view()" data-type="indexterm" id="id831"/> it’s so common for a route to just return a view with no custom data, Laravel allows you to define a route as a “view” route without even passing the route definition a closure or a controller/method reference, as you can see in <a data-type="xref" href="#route_view">Example 3-20</a>.</p>&#13;
<div data-type="example" id="route_view">&#13;
<h5><span class="label">Example 3-20. </span><code>Route::view()</code></h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// Returns resources/views/welcome.blade.php</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">view</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="s1">'welcome'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Passing simple data to Route::view()</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">view</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="s1">'welcome'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'User'</code> <code class="o">=&gt;</code> <code class="s1">'Michael'</code><code class="p">]);</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using View Composers to Share Variables with Every View" data-type="sect2"><div class="sect2" id="id388">&#13;
<h2>Using View Composers to Share Variables with Every View</h2>&#13;
&#13;
<p>Sometimes<a data-primary="variables" data-secondary="sharing with every view" data-type="indexterm" id="id832"/> it can become a hassle to pass the same variables over and over. There may be a variable that you want accessible to every view in the site or to a certain class of views or a certain included subview—​for example, all views related to tasks or the header partial.</p>&#13;
&#13;
<p>It’s possible to share certain variables with every template or just certain templates, like in the following code:</p>&#13;
&#13;
<pre data-code-language="python" data-type="programlisting"><code class="n">view</code><code class="p">()</code><code class="o">-&gt;</code><code class="n">share</code><code class="p">(</code><code class="s1">'variableName'</code><code class="p">,</code> <code class="s1">'variableValue'</code><code class="p">);</code></pre>&#13;
&#13;
<p>To learn more, check out <a data-type="xref" href="ch04.html#view-comp-serv">“View Composers and Service Injection”</a>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Controllers" data-type="sect1"><div class="sect1" id="id29">&#13;
<h1>Controllers</h1>&#13;
&#13;
<p>I’ve<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="purpose of" data-type="indexterm" id="id833"/> mentioned controllers a few times, but until now, most of the examples have shown route closures. In the MVC pattern, controllers are essentially classes that organize the logic of one or more routes together in one place. Controllers tend to group similar routes together, especially if your application is structured in a<a data-primary="CRUD (create, read, update, and delete)" data-type="indexterm" id="id834"/><a data-primary="create, read, update, delete (CRUD)" data-type="indexterm" id="id835"/> traditionally CRUD-like format; in this case, a controller might handle all the actions that can be performed on a particular resource.</p>&#13;
<div data-type="note" epub:type="note"><h1>What is CRUD?</h1>&#13;
<p>CRUD stands for <em>create</em>, <em>read</em>, <em>update</em>, <em>delete</em>, which are the four primary operations that web applications most commonly provide on a resource. For example, you can create a new blog post, you can read that post, you can update it, or you can delete it.</p>&#13;
</div>&#13;
&#13;
<p>It<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="best use of" data-type="indexterm" id="id836"/> may be tempting to cram all of the application’s logic into the controllers, but &#13;
<span class="keep-together">it’s better</span> to think of controllers as the traffic cops that route HTTP requests &#13;
<span class="keep-together">around your</span> application. Since there are other ways requests can come into your application—cron jobs, Artisan command-line calls, queue jobs, etc.—it’s wise to not rely on controllers for much behavior. This means a controller’s primary job is to &#13;
<span class="keep-together">capture</span> the intent of an HTTP request and pass it on to the rest of the application.</p>&#13;
&#13;
<p>So, let’s<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="creating" data-type="indexterm" id="id837"/> create a controller. One easy way to do this is with an Artisan command, so from the command line, run the following:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">php<code class="w"> </code>artisan<code class="w"> </code>make:controller<code class="w"> </code>TaskController<code class="w"/></pre>&#13;
<div data-type="note" epub:type="note"><h1>Artisan and Artisan Generators</h1>&#13;
<p>Laravel comes bundled with a command-line tool called Artisan. Artisan can be used to run migrations, create users and other <span class="keep-together">database</span> records manually, and perform many other manual, one-time tasks.</p>&#13;
&#13;
<p>Under<a data-primary="Artisan" data-secondary="generating skeleton files" data-type="indexterm" id="id838"/><a data-primary="skeleton files, generating" data-type="indexterm" id="id839"/> the <code>make</code> namespace, Artisan provides tools for generating skeleton files for a variety of system files. That’s what allows us to run <code>php artisan make:controller</code>.</p>&#13;
&#13;
<p>To learn more about this and other Artisan features, see <a data-type="xref" href="ch08.html#artisan_and_tinker">Chapter 8</a>.</p>&#13;
</div>&#13;
&#13;
<p>This will create a new file named <em>TaskController.php</em> in <em>app/Http/Controllers</em>, with the contents shown in <a data-type="xref" href="#EX52">Example 3-21</a>.</p>&#13;
<div data-type="example" id="EX52">&#13;
<h5><span class="label">Example 3-21. </span>Default generated controller</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="o">&lt;?</code><code class="nx">php</code>&#13;
&#13;
<code class="k">namespace</code> <code class="nx">App\Http\Controllers</code><code class="p">;</code>&#13;
&#13;
<code class="k">use</code> <code class="nx">Illuminate\Http\Request</code><code class="p">;</code>&#13;
&#13;
<code class="k">class</code> <code class="nc">TaskController</code> <code class="k">extends</code> <code class="nx">Controller</code>&#13;
<code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>Modify this file as shown in <a data-type="xref" href="#EX53">Example 3-22</a>, creating a new public method called <code>index()</code>. We’ll just return some text there.</p>&#13;
<div data-type="example" id="EX53">&#13;
<h5><span class="label">Example 3-22. </span>Simple controller example</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="o">&lt;?</code><code class="nx">php</code>&#13;
&#13;
<code class="k">namespace</code> <code class="nx">App\Http\Controllers</code><code class="p">;</code>&#13;
&#13;
<code class="k">class</code> <code class="nc">TaskController</code> <code class="k">extends</code> <code class="nx">Controller</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="nf">index</code><code class="p">()</code>&#13;
    <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="s1">'Hello, World!'</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>Then, like we learned before, we’ll hook up a route to it, as shown in <a data-type="xref" href="#EX54">Example 3-23</a>.</p>&#13;
<div data-type="example" id="EX54">&#13;
<h5><span class="label">Example 3-23. </span>Route for the simple controller</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// routes/web.php</code>&#13;
<code class="o">&lt;?</code><code class="nx">php</code>&#13;
&#13;
<code class="k">use</code> <code class="nx">Illuminate\Support\Facades\Route</code><code class="p">;</code>&#13;
<code class="k">use</code> <code class="nx">App\Http\Controllers\TaskController</code><code class="p">;</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="p">[</code><code class="nx">TaskController</code><code class="o">::</code><code class="na">class</code><code class="p">,</code> <code class="s1">'index'</code><code class="p">]);</code></pre></div>&#13;
&#13;
<p>That’s it. Visit the <code>/</code> route and you’ll see the words “Hello, World!”</p>&#13;
&#13;
<p>The most common use of a controller method, then, will be something like <a data-type="xref" href="#EX55">Example 3-24</a>, which provides the same functionality as our route closure in <a data-type="xref" href="#EX48">Example 3-19</a>.</p>&#13;
<div data-type="example" id="EX55">&#13;
<h5><span class="label">Example 3-24. </span>Common controller method example</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// TaskController.php</code>&#13;
<code class="o">...</code>&#13;
<code class="k">public</code> <code class="k">function</code> <code class="nf">index</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'tasks.index'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">with</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">,</code> <code class="nx">Task</code><code class="o">::</code><code class="na">all</code><code class="p">());</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>This controller method loads the <em>resources/views/tasks/index.blade.php</em> or <em>resources/views/tasks/index.php</em> view and passes it a single variable named <code>tasks</code>, which contains the result of the <code>Task::all()</code> Eloquent method.</p>&#13;
<div data-type="tip"><h1>Generating Resource Controllers</h1>&#13;
<p>If<a data-primary="resource controllers" data-secondary="generating" data-type="indexterm" id="id840"/> you want to create a resource controller with autogenerated methods for all the basic resource routes like <code>create()</code> and <code>update()</code>, you can pass<a data-primary="--resource flag" data-type="indexterm" id="id841"/> the <span class="keep-together"><code>--resource</code></span> flag when using <code>php artisan make:controller</code>:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">php<code class="w"> </code>artisan<code class="w"> </code>make:controller<code class="w"> </code>TaskController<code class="w"> </code>--resource<code class="w"/></pre>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Getting User Input" data-type="sect2"><div class="sect2" id="id30">&#13;
<h2>Getting User Input</h2>&#13;
&#13;
<p>The<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="getting user input" data-type="indexterm" id="id842"/><a data-primary="user input, gaining" data-type="indexterm" id="id843"/> second most common action to perform in a controller method is to take input from the user and act on it. That introduces a few new concepts, so let’s take a look at a bit of sample code and walk through the new pieces.</p>&#13;
&#13;
<p>First, let’s bind our route; see <a data-type="xref" href="#EX56">Example 3-25</a>.</p>&#13;
<div data-type="example" id="EX56">&#13;
<h5><span class="label">Example 3-25. </span>Binding basic form actions</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// routes/web.php</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'tasks/create'</code><code class="p">,</code> <code class="p">[</code><code class="nx">TaskController</code><code class="o">::</code><code class="na">class</code><code class="p">,</code> <code class="s1">'create'</code><code class="p">]);</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">,</code> <code class="p">[</code><code class="nx">TaskController</code><code class="o">::</code><code class="na">class</code><code class="p">,</code> <code class="s1">'store'</code><code class="p">]);</code></pre></div>&#13;
&#13;
<p>Notice that we’re binding the <code>GET</code> action of <code>tasks/create</code> (which shows a form for creating a new task) and the <code>POST</code> action of <code>tasks</code> (which is where our form will <code>POST</code> to when we’re creating a new task). We can assume the <code>create()</code> method in our controller just shows a form, so let’s look at the <code>store()</code> method in <a data-type="xref" href="#EX57">Example 3-26</a>.</p>&#13;
<div data-type="example" id="EX57">&#13;
<h5><span class="label">Example 3-26. </span>Common form input controller method</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// TaskController.php</code>&#13;
<code class="o">...</code>&#13;
<code class="k">public</code> <code class="k">function</code> <code class="nf">store</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="nx">Task</code><code class="o">::</code><code class="na">create</code><code class="p">(</code><code class="nx">request</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">only</code><code class="p">([</code><code class="s1">'title'</code><code class="p">,</code> <code class="s1">'description'</code><code class="p">]));</code>&#13;
&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>This example makes use of Eloquent models and the <code>redirect()</code> functionality, and we’ll talk about them more later, but for now let’s talk quickly about how we’re getting our data here.</p>&#13;
&#13;
<p>We’re using the <code>request()</code> helper to represent the HTTP request (more on that later) and using its <code>only()</code> method to pull just the <code>title</code> and <code>description</code> fields the user submitted.</p>&#13;
&#13;
<p>We’re then passing that data into the <code>create()</code> method of our <code>Task</code> model, which creates a new instance of the <code>Task</code> with <code>title</code> set to the passed-in title and <code>description</code> set to the passed-in description. Finally, we redirect back to the page that shows all tasks.</p>&#13;
&#13;
<p>There are a few layers of abstraction at work here, which we’ll cover in a second, but know that the data coming from the <code>only()</code> method comes from the same pool of data all common methods used on the <code>Request</code> object draw from, including <code>all()</code> and <code>get()</code>. The set of data each of these methods is pulling from represents all user-provided data, whether from query parameters or <code>POST</code> values. So, our user filled out two fields on the “add task” page: “title” and “description.”</p>&#13;
&#13;
<p>To break down the abstraction a bit, <code>request()-&gt;only()</code> takes an associative array of input names and returns them:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">request</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">only</code><code class="p">([</code><code class="s1">'title'</code><code class="p">,</code> <code class="s1">'description'</code><code class="p">]);</code>&#13;
<code class="c1">// returns:</code>&#13;
<code class="p">[</code>&#13;
    <code class="s1">'title'</code> <code class="o">=&gt;</code> <code class="s1">'Whatever title the user typed on the previous page'</code><code class="p">,</code>&#13;
    <code class="s1">'description'</code> <code class="o">=&gt;</code> <code class="s1">'Whatever description the user typed on the previous page'</code><code class="p">,</code>&#13;
<code class="p">]</code></pre>&#13;
&#13;
<p>And <code>Task::create()</code> takes an associative array and creates a new task from it:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Task</code><code class="o">::</code><code class="na">create</code><code class="p">([</code>&#13;
    <code class="s1">'title'</code> <code class="o">=&gt;</code> <code class="s1">'Buy milk'</code><code class="p">,</code>&#13;
    <code class="s1">'description'</code> <code class="o">=&gt;</code> <code class="s1">'Remember to check the expiration date this time, Norbert!'</code><code class="p">,</code>&#13;
<code class="p">]);</code></pre>&#13;
&#13;
<p>Combining them together creates a task with just the user-provided “title” and “description” fields.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Injecting Dependencies into Controllers" data-type="sect2"><div class="sect2" id="id31">&#13;
<h2>Injecting Dependencies into Controllers</h2>&#13;
&#13;
<p>Laravel’s facades<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="injecting dependencies into" data-type="indexterm" id="id844"/> and global helpers present a simple interface to the most useful classes in Laravel’s codebase. You can get information about the current request and user input, the session, caches, and much more.</p>&#13;
&#13;
<p>But if you prefer to inject your dependencies, or if you want to use a service that doesn’t have a facade or a helper, you’ll need to find some way to bring instances of these classes into your controller.</p>&#13;
&#13;
<p>This is our first exposure to Laravel’s service container. For now, if this is unfamiliar, you can think about it as a little bit of Laravel magic; or, if you want to know more about how it’s actually functioning, you can skip ahead to <a data-type="xref" href="ch11.html#the_container">Chapter 11</a>.</p>&#13;
&#13;
<p>All controller methods (including the constructors) are resolved out of Laravel’s container, which means anything you typehint that the container knows how to resolve will be automatically injected.</p>&#13;
<div data-type="note" epub:type="note"><h1>Typehints in PHP</h1>&#13;
<p><em>Typehinting</em> in PHP means putting the name of a class or interface in front of a variable in a method signature:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="nx">Logger</code> <code class="nv">$logger</code><code class="p">)</code> <code class="p">{}</code></pre>&#13;
&#13;
<p>This<a data-primary="typehints" data-type="indexterm" id="id845"/><a data-primary="Request objects" data-secondary="typehinting" data-type="indexterm" id="id846"/> typehint is telling PHP that whatever is passed into the method <em>must</em> be of type <code>Logger</code>, which could be either an interface or a class.</p>&#13;
</div>&#13;
&#13;
<p>As a nice example, what if you’d prefer having an instance of the <code>Request</code> object instead of using the global helper? Just typehint <code>Illuminate\Http\Request</code> in your method parameters, like in <a data-type="xref" href="#EX58">Example 3-27</a>.</p>&#13;
<div data-type="example" id="EX58">&#13;
<h5><span class="label">Example 3-27. </span>Controller method injection via typehinting</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// TaskController.php</code>&#13;
<code class="o">...</code>&#13;
<code class="k">public</code> <code class="k">function</code> <code class="nf">store</code><code class="p">(</code><code class="nx">\Illuminate\Http\Request</code> <code class="nv">$request</code><code class="p">)</code>&#13;
<code class="p">{</code>&#13;
    <code class="nx">Task</code><code class="o">::</code><code class="na">create</code><code class="p">(</code><code class="nv">$request</code><code class="o">-&gt;</code><code class="na">only</code><code class="p">([</code><code class="s1">'title'</code><code class="p">,</code> <code class="s1">'description'</code><code class="p">]));</code>&#13;
&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>So, you’ve defined a parameter that must be passed into the <code>store()</code> method. And since you typehinted it, and since Laravel knows how to resolve that class name, you’re going to have the <code>Request</code> object ready for you to use in your method with no work on your part. No explicit binding, no anything else—​it’s just there as the <code>$request</code> variable.</p>&#13;
&#13;
<p>And, as you can tell from comparing Examples <a href="#EX57">3-26</a> and <a href="#EX58">3-27</a>, the <code>request()</code> helper and the <code>Request</code> object behave exactly the same.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Resource Controllers" data-type="sect2"><div class="sect2" id="resource_controllers">&#13;
<h2>Resource Controllers</h2>&#13;
&#13;
<p>Sometimes<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="resource controllers" data-type="indexterm" id="id847"/><a data-primary="resource controllers" data-secondary="building" data-type="indexterm" id="id848"/> naming the methods in your controllers can be the hardest part of writing a controller. Thankfully, Laravel has some conventions for all of the routes of a traditional REST/CRUD controller (called a <em>resource controller</em> in Laravel); additionally, it comes with a generator out of the box and a convenience route definition that allows you to bind an entire resource controller at once.</p>&#13;
&#13;
<p>To see the methods that Laravel expects for a resource controller, let’s generate a new controller from the<a data-primary="--resource flag" data-type="indexterm" id="id849"/> command line:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">php<code class="w"> </code>artisan<code class="w"> </code>make:controller<code class="w"> </code>MySampleResourceController<code class="w"> </code>--resource<code class="w"/></pre>&#13;
&#13;
<p>Now open <em>app/Http/Controllers/MySampleResourceController.php</em>. You’ll see it comes prefilled with quite a few methods. Let’s walk through what each represents. We’ll use a <code>Task</code> as an example.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The methods of Laravel’s resource controllers" data-type="sect3"><div class="sect3" id="id636">&#13;
<h3>The methods of Laravel’s resource controllers</h3>&#13;
&#13;
<p>Remember the table from earlier? <a data-type="xref" href="#table0301">Table 3-1</a> shows the HTTP verb, the URL, the controller method name, and the name for each of these default methods that are generated in Laravel’s resource controllers.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Binding a resource controller" data-type="sect3"><div class="sect3" id="id33">&#13;
<h3>Binding a resource controller</h3>&#13;
&#13;
<p>So, we’ve seen that these are the conventional route names to use in Laravel, and also that it’s easy to generate a resource controller with methods for each of these default routes. Thankfully, you don’t have to generate routes for each of these controller methods by hand, if you don’t want to. There’s a trick for that, called <em>resource controller binding</em>. Take a look at <a data-type="xref" href="#EX59">Example 3-28</a>.</p>&#13;
<div data-type="example" id="EX59">&#13;
<h5><span class="label">Example 3-28. </span>Resource controller binding</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// routes/web.php</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">resource</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">,</code> <code class="nx">TaskController</code><code class="o">::</code><code class="na">class</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>This will automatically bind all of the routes listed in <a data-type="xref" href="#table0301">Table 3-1</a> for this resource to the appropriate method names on the specified controller. It’ll also name these routes appropriately; for example, the <code>index()</code> method on the <code>tasks</code> resource controller will be named <code>tasks.index</code>.</p>&#13;
<div data-type="tip"><h1>artisan route:list</h1>&#13;
<p>If<a data-primary="Artisan" data-secondary="listing available routes" data-type="indexterm" id="id850"/> you ever find yourself in a situation where you’re wondering what routes your current application has available, there’s a tool for that: from the command line, run <code>php artisan route:list</code> and you’ll get a listing of all of the available routes. I<a data-primary="--exclude-vendor flag" data-type="indexterm" id="id851"/> prefer <code>php artisan route:list --exclude-vendor</code> so I don’t see all the weird routes my dependencies register in order for them to operate (see <a data-type="xref" href="#FIG301X">Figure 3-2</a>).</p>&#13;
</div>&#13;
&#13;
<figure class="no-frame"><div class="figure" id="FIG301X">&#13;
<img alt="lur3 0302" src="assets/lur3_0302.png"/>&#13;
<h6><span class="label">Figure 3-2. </span>artisan route:list</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="API Resource Controllers" data-type="sect2"><div class="sect2" id="id34">&#13;
<h2>API Resource Controllers</h2>&#13;
&#13;
<p>When<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="API resource controllers" data-type="indexterm" id="id852"/><a data-primary="resource controllers" data-secondary="API resource controllers" data-type="indexterm" id="id853"/><a data-primary="APIs (application programming interfaces)" data-secondary="API resources" data-tertiary="resource controllers" data-type="indexterm" id="id854"/> you’re working with RESTful APIs, the list of potential actions on a resource is not the same as it is with an HTML resource controller. For example, you can send a <code>POST</code> request to an API to create a resource, but you can’t really “show a create form” in an API.</p>&#13;
&#13;
<p>To generate an <em>API resource controller</em>, which is a controller that has the same structure as a resource controller except it excludes the <em>create</em> and <em>edit</em> actions, pass<a data-primary="--api flag" data-type="indexterm" id="id855"/> the &#13;
<span class="keep-together"><code>--api</code></span> flag when creating a controller:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">php<code class="w"> </code>artisan<code class="w"> </code>make:controller<code class="w"> </code>MySampleResourceController<code class="w"> </code>--api<code class="w"/></pre>&#13;
&#13;
<p>To bind an API resource controller, use the <code>apiResource()</code> method instead of the <code>resource()</code> method, as shown in <a data-type="xref" href="#EX60">Example 3-29</a>.</p>&#13;
<div data-type="example" id="EX60">&#13;
<h5><span class="label">Example 3-29. </span>API resource controller binding</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// routes/web.php</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">apiResource</code><code class="p">(</code><code class="s1">'tasks'</code><code class="p">,</code> <code class="nx">TaskController</code><code class="o">::</code><code class="na">class</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Single Action Controllers" data-type="sect2"><div class="sect2" id="id35">&#13;
<h2>Single Action Controllers</h2>&#13;
&#13;
<p>There<a data-primary="routing and controllers" data-secondary="controllers" data-tertiary="single action controllers" data-type="indexterm" id="id856"/><a data-primary="single action controllers" data-type="indexterm" id="id857"/> will be times in your applications when a controller should only service a single route. You may find yourself wondering how to name the controller method for that route. Thankfully, you can point a single route at a single controller without concerning yourself with naming the one method.</p>&#13;
&#13;
<p>As you may already know, the <code>__invoke()</code> method is a PHP magic method that allows you to “invoke” an instance of a class, treating it like a function and calling it. This is the tool Laravel’s <em>single action controllers</em> use to allow you to point a route to a single controller, as you can see in <a data-type="xref" href="#EX61">Example 3-30</a>.</p>&#13;
<div data-type="example" id="EX61">&#13;
<h5><span class="label">Example 3-30. </span>Using the <code>__invoke()</code> method</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// \App\Http\Controllers\UpdateUserAvatar.php</code>&#13;
<code class="k">public</code> <code class="k">function</code> <code class="fm">__invoke</code><code class="p">(</code><code class="nx">User</code> <code class="nv">$user</code><code class="p">)</code>&#13;
<code class="p">{</code>&#13;
    <code class="c1">// Update the user's avatar image</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// routes/web.php</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'users/{user}/update-avatar'</code><code class="p">,</code> <code class="nx">UpdateUserAvatar</code><code class="o">::</code><code class="na">class</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Model Binding" data-type="sect1"><div class="sect1" id="id389">&#13;
<h1>Route Model Binding</h1>&#13;
&#13;
<p>One<a data-primary="routing and controllers" data-secondary="route model binding" data-type="indexterm" id="RACbind03"/> of the most common routing patterns is that the first line of any controller method tries to find the resource with the given ID, like in <a data-type="xref" href="#EX62">Example 3-31</a>.</p>&#13;
<div data-type="example" id="EX62">&#13;
<h5><span class="label">Example 3-31. </span>Getting a resource for each route</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'conferences/{id}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nv">$id</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nv">$conference</code> <code class="o">=</code> <code class="nx">Conference</code><code class="o">::</code><code class="na">findOrFail</code><code class="p">(</code><code class="nv">$id</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Laravel provides a feature that simplifies this pattern called <em>route model binding</em>. This allows you to define that a particular parameter name (e.g., <code>{conference}</code>) will indicate to the route resolver that it should look up an Eloquent database record with that ID and then pass it in as the parameter <em>instead</em> of just passing the ID.</p>&#13;
&#13;
<p>There are two kinds of route model binding: implicit and custom (or explicit).</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Implicit Route Model Binding" data-type="sect2"><div class="sect2" id="id36">&#13;
<h2>Implicit Route Model Binding</h2>&#13;
&#13;
<p>The<a data-primary="implicit route model binding" data-type="indexterm" id="id858"/> simplest way to use route model binding is to name your route parameter something unique to that model (e.g., name it <code>$conference</code> instead of <code>$id</code>), then typehint that parameter in the closure/controller method and use the same variable name there. It’s easier to show than to describe, so take a look at <a data-type="xref" href="#EX75">Example 3-32</a>.</p>&#13;
<div data-type="example" id="EX75">&#13;
<h5><span class="label">Example 3-32. </span>Using an implicit route model binding</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'conferences/{conference}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nx">Conference</code> <code class="nv">$conference</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'conferences.show'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">with</code><code class="p">(</code><code class="s1">'conference'</code><code class="p">,</code> <code class="nv">$conference</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Because the route parameter (<code>{conference}</code>) is the same as the method parameter (<code>$conference</code>), and the method parameter is typehinted with a <code>Conference</code> model (<code>Conference $conference</code>), Laravel sees this as a route model binding. Every time this route is visited, the application will assume that whatever is passed into the URL in place of <code>{conference}</code> is an ID that should be used to look up a <code>Conference</code>, <span class="keep-together">and then</span> that resulting model instance will be passed in to your closure or controller method.</p>&#13;
<div data-type="note" epub:type="note"><h1>Customizing the Route Key for an Eloquent Model</h1>&#13;
<p>Any<a data-primary="Eloquent" data-secondary="customizing route keys" data-type="indexterm" id="id859"/><a data-primary="route keys" data-secondary="customizing for Eloquent models" data-type="indexterm" id="id860"/> time an Eloquent model is looked up via a URL segment (usually because of route model binding), the default column Eloquent will look it up by is its primary key (ID).</p>&#13;
&#13;
<p>To change the column your Eloquent model uses for URL lookups in all your routes, add a method to your model named <code>getRouteKeyName()</code>:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">public</code> <code class="k">function</code> <code class="nf">getRouteKeyName</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">return</code> <code class="s1">'slug'</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Now, a URL like <code>conferences/{conference}</code> will expect to get an entry from the slug column instead of the ID and will perform its lookups accordingly.</p>&#13;
</div>&#13;
<div data-type="note" epub:type="note"><h1>Customizing the Route Key in a Specific Route</h1>&#13;
<p>In<a data-primary="route keys" data-secondary="customizing on specific routes" data-type="indexterm" id="id861"/> Laravel, you can also change the route key on a specific route instead of globally by appending a colon and the column name in the route definition:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code>&#13;
    <code class="s1">'conferences/{conference:slug}'</code><code class="p">,</code>&#13;
    <code class="k">function</code> <code class="p">(</code><code class="nx">Conference</code> <code class="nv">$conference</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'conferences.show'</code><code class="p">)</code>&#13;
            <code class="o">-&gt;</code><code class="na">with</code><code class="p">(</code><code class="s1">'conference'</code><code class="p">,</code> <code class="nv">$conference</code><code class="p">);</code>&#13;
    <code class="p">});</code></pre>&#13;
</div>&#13;
&#13;
<p>If you have two dynamic segments in your URL (for example: <code>organizers/{organizer}/conferences/{conference:slug</code>), Laravel will automatically attempt to scope the second model’s queries to only those related to the first. So it’ll check the <code>Organizer</code> model for a <code>conferences</code> relationship, and if it exists, only return Conferences that are associated with the <code>Organizer</code> found by the first segment.</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">use</code> <code class="nx">App\Models\Conference</code><code class="p">;</code>&#13;
<code class="k">use</code> <code class="nx">App\Models\Organizer</code><code class="p">;</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code>&#13;
    <code class="s1">'organizers/{organizer}/conferences/{conference:slug}'</code><code class="p">,</code>&#13;
    <code class="k">function</code> <code class="p">(</code><code class="nx">Organizer</code> <code class="nv">$organizer</code><code class="p">,</code> <code class="nx">Conference</code> <code class="nv">$conference</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="nv">$conference</code><code class="p">;</code>&#13;
    <code class="p">});</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Custom Route Model Binding" data-type="sect2"><div class="sect2" id="id37">&#13;
<h2>Custom Route Model Binding</h2>&#13;
&#13;
<p>To<a data-primary="route model bindings, customizing" data-type="indexterm" id="id862"/> manually configure route model bindings, add a line like the one in <a data-type="xref" href="#EX63">Example 3-33</a> to the <code>boot()</code> method in <code>App\Providers\RouteServiceProvider</code>.</p>&#13;
<div data-type="example" id="EX63">&#13;
<h5><span class="label">Example 3-33. </span>Adding a route model binding</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting">    <code class="k">public</code> <code class="k">function</code> <code class="nf">boot</code><code class="p">()</code>&#13;
    <code class="p">{</code>&#13;
        <code class="c1">// Perform the binding</code>&#13;
        <code class="nx">Route</code><code class="o">::</code><code class="na">model</code><code class="p">(</code><code class="s1">'event'</code><code class="p">,</code> <code class="nx">Conference</code><code class="o">::</code><code class="na">class</code><code class="p">);</code>&#13;
    <code class="p">}</code></pre></div>&#13;
&#13;
<p>You’ve now specified that whenever a route has a parameter in its definition named <code>{event}</code>, as demonstrated in <a data-type="xref" href="#EX64">Example 3-34</a>, the route resolver will return an instance of the <code>Conference</code> class with the ID of that<a data-primary="" data-startref="RACbind03" data-type="indexterm" id="id863"/> URL parameter.</p>&#13;
<div data-type="example" id="EX64">&#13;
<h5><span class="label">Example 3-34. </span>Using an explicit route model binding</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'events/{event}'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nx">Conference</code> <code class="nv">$event</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'events.show'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">with</code><code class="p">(</code><code class="s1">'event'</code><code class="p">,</code> <code class="nv">$event</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Route Caching" data-type="sect1"><div class="sect1" id="id390">&#13;
<h1>Route Caching</h1>&#13;
&#13;
<p>If<a data-primary="routing and controllers" data-secondary="route caching" data-type="indexterm" id="id864"/><a data-primary="caching" data-secondary="route caching" data-type="indexterm" id="id865"/> you’re looking to squeeze every millisecond out of your load time, you may want to take a look at <em>route caching</em>. One of the pieces of Laravel’s bootstrap that can take anywhere from a few dozen to a few hundred milliseconds is parsing the <em>routes/*</em> files, and route caching speeds up this process dramatically.</p>&#13;
&#13;
<p>To cache your routes file, you need to be using all controller, redirect, view, and resource routes (no route closures). If your app isn’t using any route closures, you can run <code>php artisan route:cache</code> and Laravel will <span class="keep-together">serialize</span> the results of your <em>routes/*</em> files. If you want to delete the cache, run <code>php artisan route:clear</code>.</p>&#13;
&#13;
<p>Here’s the drawback: Laravel will now match routes against that cached file instead of your actual <em>routes/*</em> files. You can make endless changes to your routes files, and they won’t take effect until you run <code>route:cache</code> again. This means you’ll have to recache every time you make a change, which introduces a lot of potential for confusion.</p>&#13;
&#13;
<p>Here’s what I would recommend instead: since Git ignores the route cache file by default anyway, consider only using route caching on your production server, and run the <code>php artisan route:cache</code> command every time you deploy new code (whether via a Git post-deploy hook, a Forge deploy command, or as a part of whatever other deployment system you use). This way, you won’t have confusing local development issues, but your remote environment will still benefit from route caching.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Form Method Spoofing" data-type="sect1"><div class="sect1" id="id38">&#13;
<h1>Form Method Spoofing</h1>&#13;
&#13;
<p>Sometimes<a data-primary="routing and controllers" data-secondary="form method spoofing" data-type="indexterm" id="id866"/><a data-primary="form method spoofing" data-type="indexterm" id="id867"/> you need to manually define which HTTP verb a form should send as. HTML forms only allow for <code>GET</code> or <code>POST</code>, so if you want any other sort of verb, you’ll need to specify that yourself.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="HTTP Verbs in Laravel" data-type="sect2"><div class="sect2" id="id391">&#13;
<h2>HTTP Verbs in Laravel</h2>&#13;
&#13;
<p>As<a data-primary="HTTP verbs" data-secondary="form method spoofing" data-type="indexterm" id="id868"/> we’ve seen already, you can define which verbs a route will match in the route definition using <code>Route::get()</code>, <code>Route::post()</code>, <code>Route::any()</code>, or <code>Route::match()</code>. You can also match with <code>Route::patch()</code>, <code>Route::put()</code>, and <code>Route::delete()</code>.</p>&#13;
&#13;
<p>But how does one send a request other than <code>GET</code> with a web browser? First, the <code>method</code> attribute in an HTML form determines its HTTP verb: if your form has a <code>method</code> of <code>"GET"</code>, it will submit via query parameters and a <code>GET</code> method; if the form has a <code>method</code> of <code>"POST"</code>, it will submit via the post body and a <code>POST</code> method.</p>&#13;
&#13;
<p>JavaScript frameworks make it easy to send other requests, like <code>DELETE</code> and <code>PATCH</code>. But if you find yourself needing to submit HTML forms in Laravel with verbs other than <code>GET</code> or <code>POST</code>, you’ll need to use <em>form method spoofing</em>, which means spoofing the HTTP method in an HTML form.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="HTTP Method Spoofing in HTML Forms" data-type="sect2"><div class="sect2" id="id637">&#13;
<h2>HTTP Method Spoofing in HTML Forms</h2>&#13;
&#13;
<p>To inform Laravel that the form you’re currently submitting should be treated as something other than a <code>POST</code>, add a hidden variable named <code>_method</code> with the value of <code>"PUT"</code>, <code>"PATCH"</code>, or <code>"DELETE"</code>, and Laravel will match and route that form submission as if it were actually a request with that verb.</p>&#13;
&#13;
<p>The form in <a data-type="xref" href="#EX65">Example 3-35</a>, since it’s passing Laravel the method of <code>"DELETE"</code>, will match routes defined with <code>Route::delete()</code>, but not those with <code>Route::post()</code>.</p>&#13;
<div data-type="example" id="EX65">&#13;
<h5><span class="label">Example 3-35. </span>Form method spoofing</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="s">"/tasks/5"</code> <code class="na">method</code><code class="o">=</code><code class="s">"POST"</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"hidden"</code> <code class="na">name</code><code class="o">=</code><code class="s">"_method"</code> <code class="na">value</code><code class="o">=</code><code class="s">"DELETE"</code><code class="p">&gt;</code>&#13;
    <code class="cm">&lt;!-- or: --&gt;</code>&#13;
    @method('DELETE')&#13;
<code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="CSRF Protection" data-type="sect1"><div class="sect1" id="id39">&#13;
<h1>CSRF Protection</h1>&#13;
&#13;
<p>If<a data-primary="routing and controllers" data-secondary="CSRF protection" data-type="indexterm" id="id869"/><a data-primary="cross-site request forgery (CSRF)" data-type="indexterm" id="id870"/> you’ve tried to submit a form in a Laravel application already, including the one in <a data-type="xref" href="#EX65">Example 3-35</a>, you’ve likely run into the dreaded <code>TokenMismatchException</code>.</p>&#13;
&#13;
<p>By default, all routes in Laravel except “read-only” routes (those using <code>GET</code>, <code>HEAD</code>, or <code>OPTIONS</code>) are protected against cross-site request forgery (CSRF) attacks by requiring a token, in the form of an input named <code>_token</code>, to be passed along with each request. This token is generated at the start of every session, and every non–read-only route compares the submitted <code>_token</code> against the session token.</p>&#13;
<div data-type="note" epub:type="note"><h1>What is CSRF?</h1>&#13;
<p>A <em>cross-site request forgery</em> is when one website pretends to be another. The goal is for someone to hijack your users’ access to your website by submitting forms from <em>their</em> website to <em>your</em> website via the logged-in user’s browser.</p>&#13;
&#13;
<p>The best way around CSRF attacks is to protect all inbound &#13;
<span class="keep-together">routes—</span><code>POST</code>, <code>DELETE</code>, etc.—with a token, which Laravel does out of the box.</p>&#13;
</div>&#13;
&#13;
<p>You have two options for getting around this CSRF error. The first, and preferred, method is to add the <code>_token</code> input to each of your submissions. In HTML forms, there’s a simple way to do it, as you can see in <a data-type="xref" href="#EX66">Example 3-36</a>.</p>&#13;
<div data-type="example" id="EX66">&#13;
<h5><span class="label">Example 3-36. </span>CSRF tokens</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="s">"/tasks/5"</code> <code class="na">method</code><code class="o">=</code><code class="s">"POST"</code><code class="p">&gt;</code>&#13;
    @csrf&#13;
<code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>In JavaScript applications, it takes a bit more work, but not much. The most common solution for sites using JavaScript frameworks is to store the token on every page in a <code>&lt;meta&gt;</code> tag like this one:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">meta</code> <code class="na">name</code><code class="o">=</code><code class="s">"csrf-token"</code> <code class="na">content</code><code class="o">=</code><code class="s">"&lt;?php echo csrf_token(); ?&gt;"</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Storing the token in a <code>&lt;meta&gt;</code> tag makes it easy to bind it to the correct HTTP header, which you can do once globally for all requests from your JavaScript framework, like in <a data-type="xref" href="#EX67">Example 3-37</a>.</p>&#13;
<div data-type="example" id="EX67">&#13;
<h5><span class="label">Example 3-37. </span>Globally binding a header for CSRF</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// In jQuery:</code>&#13;
<code class="nx">$</code><code class="p">.</code><code class="nx">ajaxSetup</code><code class="p">({</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
        <code class="s1">'X-CSRF-TOKEN'</code><code class="o">:</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'meta[name="csrf-token"]'</code><code class="p">).</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'content'</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// With Axios: it automatically retrieves it from a cookie. Nothing to do!</code></pre></div>&#13;
&#13;
<p>Laravel will check the <code>X-CSRF-TOKEN</code> (and <code>X-XSRF-TOKEN</code>, which Axios and other JavaScript frameworks like Angular use) on every request, and valid tokens passed there will mark the CSRF protection as satisfied.</p>&#13;
<div data-type="tip"><h1>Binding CSRF Tokens with Vue Resource</h1>&#13;
<p>Bootstrapping<a data-primary="Vue Resource" data-type="indexterm" id="id871"/> the CSRF token into Vue Resource looks a bit different than it does for Laravel; see the <a href="https://oreil.ly/YT0Nb">Vue Resource docs</a> for &#13;
<span class="keep-together">examples</span>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Redirects" data-type="sect1"><div class="sect1" id="routing_redirects">&#13;
<h1>Redirects</h1>&#13;
&#13;
<p>So<a data-primary="routing and controllers" data-secondary="redirects" data-type="indexterm" id="RACredir03"/> far, the only things we’ve explicitly talked about returning from a controller method or route definition have been views. But there are a few other structures we can return to give the browser instructions on how to behave.</p>&#13;
&#13;
<p>First, let’s cover the <em>redirect</em>. You’ve<a data-primary="routing and controllers" data-secondary="redirects" data-tertiary="generating" data-type="indexterm" id="id872"/> already seen a few of these in other examples. There are two common ways to generate a redirect; we’ll use the <code>redirect()</code> global helper here, but you may prefer the facade. Both create an instance of <code>Illuminate\Http\RedirectResponse</code>, perform some convenience methods on it, and then return it. You can also do this manually, but you’ll have to do a little more work yourself. Take a look at <a data-type="xref" href="#EX68">Example 3-38</a> to see a few ways you can return a redirect.</p>&#13;
<div data-type="example" id="EX68">&#13;
<h5><span class="label">Example 3-38. </span>Different ways to return a redirect</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// Using the global helper to generate a redirect response</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect-with-helper'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">to</code><code class="p">(</code><code class="s1">'login'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// Using the global helper shortcut</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect-with-helper-shortcut'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'login'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// Using the facade to generate a redirect response</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect-with-facade'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">Redirect</code><code class="o">::</code><code class="na">to</code><code class="p">(</code><code class="s1">'login'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// Using the Route::redirect shortcut</code>&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">redirect</code><code class="p">(</code><code class="s1">'redirect-by-route'</code><code class="p">,</code> <code class="s1">'login'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Note that the <code>redirect()</code> helper exposes the same methods as the <code>Redirect</code> facade, but it also has a shortcut; if you pass parameters directly to the helper instead of chaining methods after it, it’s a shortcut to the <code>to()</code> redirect method.</p>&#13;
&#13;
<p>Also note that the (optional) third parameter for the <code>Route::redirect()</code> route helper can be the status code (e.g., 302) for your redirect.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="redirect()-&gt;to()" data-type="sect2"><div class="sect2" id="id556">&#13;
<h2>redirect()-&gt;to()</h2>&#13;
&#13;
<p>The<a data-primary="routing and controllers" data-secondary="redirects" data-tertiary="redirect()-&gt;to()" data-type="indexterm" id="id873"/> method signature for the <code>to()</code> method for redirects looks like this:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">function</code> <code class="nf">to</code><code class="p">(</code><code class="nv">$to</code> <code class="o">=</code> <code class="k">null</code><code class="p">,</code> <code class="nv">$status</code> <code class="o">=</code> <code class="mi">302</code><code class="p">,</code> <code class="nv">$headers</code> <code class="o">=</code> <code class="p">[],</code> <code class="nv">$secure</code> <code class="o">=</code> <code class="k">null</code><code class="p">)</code></pre>&#13;
&#13;
<p><code>$to</code> is a valid internal path, <code>$status</code> is the HTTP status (defaulting to <code>302</code>), <code>$headers</code> allows you to define which HTTP headers to send along with your redirect, and <code>$secure</code> allows you to override the default choice of <code>http</code> versus <code>https</code> (which is normally set based on your current request URL). <a data-type="xref" href="#EX76">Example 3-39</a> shows an example of its use.</p>&#13;
<div data-type="example" id="EX76">&#13;
<h5><span class="label">Example 3-39. </span><code>redirect()-&gt;to()</code></h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">to</code><code class="p">(</code><code class="s1">'home'</code><code class="p">);</code>&#13;
&#13;
    <code class="c1">// Or same, using the shortcut:</code>&#13;
&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'home'</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="redirect()-&gt;route()" data-type="sect2"><div class="sect2" id="id557">&#13;
<h2>redirect()-&gt;route()</h2>&#13;
&#13;
<p>The <code>route()</code> method<a data-primary="routing and controllers" data-secondary="redirects" data-tertiary="redirect()-&gt;route()" data-type="indexterm" id="id874"/> is the same as the <code>to()</code> method, but rather than pointing to a particular path, it points to a particular route name (see <a data-type="xref" href="#EX69">Example 3-40</a>).</p>&#13;
<div data-type="example" id="EX69">&#13;
<h5><span class="label">Example 3-40. </span><code>redirect()-&gt;route()</code></h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">route</code><code class="p">(</code><code class="s1">'conferences.index'</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Note that since some route names require parameters, its parameter order is a little different. <code>route()</code> has an optional second parameter for the route parameters:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">function</code> <code class="nf">route</code><code class="p">(</code><code class="nv">$to</code> <code class="o">=</code> <code class="k">null</code><code class="p">,</code> <code class="nv">$parameters</code> <code class="o">=</code> <code class="p">[],</code> <code class="nv">$status</code> <code class="o">=</code> <code class="mi">302</code><code class="p">,</code> <code class="nv">$headers</code> <code class="o">=</code> <code class="p">[])</code></pre>&#13;
&#13;
<p>So, using it might look a little like <a data-type="xref" href="#EX70">Example 3-41</a>.</p>&#13;
<div data-type="example" id="EX70">&#13;
<h5><span class="label">Example 3-41. </span><code>redirect()-&gt;route()</code> with parameters</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">to_route</code><code class="p">(</code><code class="s1">'conferences.show'</code><code class="p">,</code> <code class="p">[</code>&#13;
        <code class="s1">'conference'</code> <code class="o">=&gt;</code> <code class="mi">99</code><code class="p">,</code>&#13;
    <code class="p">];</code>&#13;
<code class="p">});</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h1>Redirect to_route() Helper</h1>&#13;
<p>You can use the <code>to_route()</code> helper as an alias for the <code>redirect()-&gt;route()</code> method. The signature for both is the same:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">to_route</code><code class="p">(</code><code class="s1">'conferences.show'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'conference'</code> <code class="o">=&gt;</code> <code class="mi">99</code><code class="p">]);</code>&#13;
<code class="p">});</code></pre>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="redirect()-&gt;back()" data-type="sect2"><div class="sect2" id="id558">&#13;
<h2>redirect()-&gt;back()</h2>&#13;
&#13;
<p>Because<a data-primary="routing and controllers" data-secondary="redirects" data-tertiary="redirect()-&gt;back()" data-type="indexterm" id="id875"/> of some of the built-in conveniences of Laravel’s session implementation, your application will always have knowledge of what the user’s previously visited page was. That opens up the opportunity for a <code>redirect()-&gt;back()</code> redirect, which simply redirects the user to whatever page they came from. There’s also a global shortcut for this: <code>back()</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Other Redirect Methods" data-type="sect2"><div class="sect2" id="id559">&#13;
<h2>Other Redirect Methods</h2>&#13;
&#13;
<p>The<a data-primary="routing and controllers" data-secondary="redirects" data-tertiary="less common methods for" data-type="indexterm" id="id876"/> redirect service provides other methods that are less commonly used, but still available:</p>&#13;
<dl>&#13;
<dt><code>refresh()</code></dt>&#13;
<dd>&#13;
<p>Redirects to the same page the user is currently on.</p>&#13;
</dd>&#13;
<dt><code>away()</code></dt>&#13;
<dd>&#13;
<p>Allows for redirecting to an external URL without the default URL validation.</p>&#13;
</dd>&#13;
<dt><code>secure()</code></dt>&#13;
<dd>&#13;
<p>Like <code>to()</code> with the <code>secure</code> parameter set to <code>"true"</code>.</p>&#13;
</dd>&#13;
<dt><code>action()</code></dt>&#13;
<dd>&#13;
<p>Allows you to link to a controller and method in one of two ways: as a string (<code>redirect()-&gt;action('MyController@myMethod')</code>) or as a tuple (<code>r⁠e⁠d⁠i⁠r⁠e⁠c⁠t⁠(⁠)​\-⁠&gt;⁠a⁠c⁠t⁠i⁠o⁠n⁠([MyController::class, 'myMethod'])</code>).</p>&#13;
</dd>&#13;
<dt><code>guest()</code></dt>&#13;
<dd>&#13;
<p>Used internally by the authentication system (discussed in <a data-type="xref" href="ch09.html#user_authentication_and_authorization">Chapter 9</a>); when a user visits a route they’re not authenticated for, this captures the “intended” route and then redirects the user (usually to a login page).</p>&#13;
</dd>&#13;
<dt><code>intended()</code></dt>&#13;
<dd>&#13;
<p>Also used internally by the authentication system; after a successful authentication, this grabs the “intended” URL stored by the <code>guest()</code> method and redirects the user there.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="redirect()-&gt;with()" data-type="sect2"><div class="sect2" id="id40">&#13;
<h2>redirect()-&gt;with()</h2>&#13;
&#13;
<p>While<a data-primary="routing and controllers" data-secondary="redirects" data-tertiary="redirect()-&gt;with()" data-type="indexterm" id="id877"/> it is structured similarly to the other methods you can call on <code>redirect()</code>, <code>with()</code> is different in that it doesn’t define where you’re redirecting to, but what data you’re passing along with the redirect. When you’re redirecting users to different pages, you often want to pass certain data along with them. You could manually flash the data to the session, but Laravel has some convenience methods to help you with that.</p>&#13;
&#13;
<p>Most commonly, you can pass along either an array of keys and values or a single key and value using <code>with()</code>, like in <a data-type="xref" href="#EX71">Example 3-42</a>. This saves your <code>with()</code> data to the session just for the next page load.</p>&#13;
<div data-type="example" id="EX71">&#13;
<h5><span class="label">Example 3-42. </span>Redirect with data</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect-with-key-value'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'dashboard'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">with</code><code class="p">(</code><code class="s1">'error'</code><code class="p">,</code> <code class="k">true</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'redirect-with-array'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'dashboard'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">with</code><code class="p">([</code><code class="s1">'error'</code> <code class="o">=&gt;</code> <code class="k">true</code><code class="p">,</code> <code class="s1">'message'</code> <code class="o">=&gt;</code> <code class="s1">'Whoops!'</code><code class="p">]);</code>&#13;
<code class="p">});</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h1>Chaining Methods on Redirects</h1>&#13;
<p>As<a data-primary="fluent interfaces" data-secondary="chaining methods on redirects" data-type="indexterm" id="id878"/> with many other facades, most calls to the <code>Redirect</code> facade can accept fluent method chains, like the <code>with()</code> calls in <a data-type="xref" href="#EX71">Example 3-42</a>. You’ll learn more about fluency in <a data-type="xref" href="ch05.html#fluent">“What Is a Fluent Interface?”</a>.</p>&#13;
</div>&#13;
&#13;
<p>You can also use <code>withInput()</code>, as in <a data-type="xref" href="#EX72">Example 3-43</a>, to redirect with the user’s form input flashed; this is most common in the case of a validation error, where you want to send the user back to the form they just came from.</p>&#13;
<div data-type="example" id="EX72">&#13;
<h5><span class="label">Example 3-43. </span>Redirect with form input</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'form'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">view</code><code class="p">(</code><code class="s1">'form'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'form'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">redirect</code><code class="p">(</code><code class="s1">'form'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">withInput</code><code class="p">()</code>&#13;
        <code class="o">-&gt;</code><code class="na">with</code><code class="p">([</code><code class="s1">'error'</code> <code class="o">=&gt;</code> <code class="k">true</code><code class="p">,</code> <code class="s1">'message'</code> <code class="o">=&gt;</code> <code class="s1">'Whoops!'</code><code class="p">]);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>The easiest way to get the flashed input that was passed with <code>withInput()</code> is using the <code>old()</code> helper, which can be used to get all old input (<code>old()</code>) or just the value for a particular key, as shown in the following example, with the second parameter as the default if there is no old value. You’ll commonly see this in views, which allows this HTML to be used both on the “create” and the “edit” view for this form:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">input</code> <code class="na">name</code><code class="o">=</code><code class="s">"username"</code> <code class="na">value</code><code class="o">=</code><code class="s">"&lt;?=</code>&#13;
<code class="s">    old('username', 'Default username instructions here');</code>&#13;
<code class="s">?&gt;"</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Speaking of validation, there is also a useful method for passing errors along with a redirect response: <code>withErrors()</code>. You can pass it any “provider” of errors, which may be an error string, an array of errors, or, most commonly, an instance of the Illuminate <code>Validator</code>, which we’ll cover in <a data-type="xref" href="ch10.html#requests_and_responses">Chapter 10</a>. <a data-type="xref" href="#EX73">Example 3-44</a> shows an example of its use.</p>&#13;
<div data-type="example" id="EX73">&#13;
<h5><span class="label">Example 3-44. </span>Redirect with errors</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'form'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nx">Illuminate\Http\Request</code> <code class="nv">$request</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nv">$validator</code> <code class="o">=</code> <code class="nx">Validator</code><code class="o">::</code><code class="na">make</code><code class="p">(</code><code class="nv">$request</code><code class="o">-&gt;</code><code class="na">all</code><code class="p">(),</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">validationRules</code><code class="p">);</code>&#13;
&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nv">$validator</code><code class="o">-&gt;</code><code class="na">fails</code><code class="p">())</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="nx">back</code><code class="p">()</code>&#13;
            <code class="o">-&gt;</code><code class="na">withErrors</code><code class="p">(</code><code class="nv">$validator</code><code class="p">)</code>&#13;
            <code class="o">-&gt;</code><code class="na">withInput</code><code class="p">();</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p><code>withErrors()</code> automatically shares an <code>$errors</code> variable with the views of the page it’s redirecting to, for you to handle however you’d like.</p>&#13;
<div data-type="tip"><h1>The validate() Method on Requests</h1>&#13;
<p>Don’t like how <a data-type="xref" href="#EX73">Example 3-44</a> looks? There’s a simple and powerful tool that will make it easy for you to clean up that code. Read<a data-primary="" data-startref="RACredir03" data-type="indexterm" id="id879"/> more in <a data-type="xref" href="ch07.html#validation_on_request">“validate() on the Request Object”</a>.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Aborting the Request" data-type="sect1"><div class="sect1" id="id41">&#13;
<h1>Aborting the Request</h1>&#13;
&#13;
<p>Aside<a data-primary="routing and controllers" data-secondary="aborting requests" data-type="indexterm" id="id880"/><a data-primary="requests, aborting" data-type="indexterm" id="id881"/> from returning views and redirects, the most common way to exit a route is to abort. There are a few globally available methods (<code>abort()</code>, <code>abort_if()</code>, and <code>abort_unless()</code>), which optionally take HTTP status codes, a message, and a headers array as parameters.</p>&#13;
&#13;
<p>As <a data-type="xref" href="#EX74">Example 3-45</a> shows, <code>abort_if()</code> and <code>abort_unless()</code> take a first parameter that is evaluated for its truthiness and perform the abort depending on the result.</p>&#13;
<div data-type="example" id="EX74">&#13;
<h5><span class="label">Example 3-45. </span>403 Forbidden aborts</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">post</code><code class="p">(</code><code class="s1">'something-you-cant-do'</code><code class="p">,</code> <code class="k">function</code> <code class="p">(</code><code class="nx">Illuminate\Http\Request</code> <code class="nv">$request</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">abort</code><code class="p">(</code><code class="mi">403</code><code class="p">,</code> <code class="s1">'You cannot do that!'</code><code class="p">);</code>&#13;
    <code class="nx">abort_unless</code><code class="p">(</code><code class="nv">$request</code><code class="o">-&gt;</code><code class="na">has</code><code class="p">(</code><code class="s1">'magicToken'</code><code class="p">),</code> <code class="mi">403</code><code class="p">);</code>&#13;
    <code class="nx">abort_if</code><code class="p">(</code><code class="nv">$request</code><code class="o">-&gt;</code><code class="na">user</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">isBanned</code><code class="p">,</code> <code class="mi">403</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Custom Responses" data-type="sect1"><div class="sect1" id="id42">&#13;
<h1>Custom Responses</h1>&#13;
&#13;
<p>There<a data-primary="routing and controllers" data-secondary="custom responses" data-type="indexterm" id="id882"/><a data-primary="responses, custom" data-type="indexterm" id="id883"/> are a few other options available for us to return, so let’s go over the most common responses after views, redirects, and aborts. Just like with redirects, you can run these methods on either the <code>response()</code> helper or the <code>Response</code> facade.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="response()-&gt;make()" data-type="sect2"><div class="sect2" id="id638">&#13;
<h2>response()-&gt;make()</h2>&#13;
&#13;
<p>If you want to create an HTTP response manually, just pass your data into the first parameter of <code>response()-&gt;make()</code>: for example, <code>return response()-&gt;make(<em>Hello, World!</em>)</code>. Once again, the second parameter is the HTTP status code and the third is your headers.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="response()-&gt;json() and -&gt;jsonp()" data-type="sect2"><div class="sect2" id="id639">&#13;
<h2>response()-&gt;json() and -&gt;jsonp()</h2>&#13;
&#13;
<p>To create a JSON-encoded HTTP response manually, pass your JSON-able content (arrays, collections, or whatever else) to the <code>json()</code> method: for example <code>return response()-&gt;json(User::all())</code>. It’s just like <code>make()</code>, except it <code>json_encode</code>s your content and sets the appropriate headers.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="response()-&gt;download(), -&gt;streamDownload(), and -&gt;file()" data-type="sect2"><div class="sect2" id="id640">&#13;
<h2>response()-&gt;download(), -&gt;streamDownload(), and -&gt;file()</h2>&#13;
&#13;
<p>To send a file for the end user to download, pass either an <code>SplFileInfo</code> instance or a string filename to <code>download()</code>, with an optional second parameter of the download filename: for example, <code>return response()-&gt;download('file501751.pdf', 'myFile.pdf')</code>, which would send a file that’s at <em>file501751.pdf</em> and rename it, as it’s sent, to <em>myFile.pdf</em>.</p>&#13;
&#13;
<p>To display the same file in the browser (if it’s a PDF or an image or something else <span class="keep-together">the browser</span> can handle), use <code>response()-&gt;file()</code> instead, which takes the same parameters as <code>response-&gt;download()</code>.</p>&#13;
&#13;
<p>If you want to make some content from an external service available as a download without having to write it directly to your server’s disk, you can stream the download using <code>response()-&gt;streamDownload()</code>. This method expects as parameters a closure that echoes a string, a filename, and optionally an array of headers; see <a data-type="xref" href="#EX78">Example 3-46</a>.</p>&#13;
<div data-type="example" id="EX78">&#13;
<h5><span class="label">Example 3-46. </span>Streaming downloads from external servers</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">return</code> <code class="nx">response</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">streamDownload</code><code class="p">(</code><code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">echo</code> <code class="nx">DocumentService</code><code class="o">::</code><code class="na">file</code><code class="p">(</code><code class="s1">'myFile'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">getContent</code><code class="p">();</code>&#13;
<code class="p">},</code> <code class="s1">'myFile.pdf'</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Testing" data-type="sect1"><div class="sect1" id="id393">&#13;
<h1>Testing</h1>&#13;
&#13;
<p>In<a data-primary="testing" data-secondary="routing and controllers" data-type="indexterm" id="id884"/><a data-primary="routing and controllers" data-secondary="testing" data-type="indexterm" id="id885"/> some other communities the idea of unit-testing controller methods is common, but within Laravel (and most of the PHP community) it’s typical to rely on <em>application testing</em> to test the functionality of routes.</p>&#13;
&#13;
<p>For example, to verify that a <code>POST</code> route works correctly, we can write a test like <a data-type="xref" href="#EX80">Example 3-47</a>.</p>&#13;
<div data-type="example" id="EX80">&#13;
<h5><span class="label">Example 3-47. </span>Writing a simple <code>POST</code> route test</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// tests/Feature/AssignmentTest.php</code>&#13;
<code class="k">public</code> <code class="k">function</code> <code class="nf">test_post_creates_new_assignment</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">post</code><code class="p">(</code><code class="s1">'/assignments'</code><code class="p">,</code> <code class="p">[</code>&#13;
        <code class="s1">'title'</code> <code class="o">=&gt;</code> <code class="s1">'My great assignment'</code><code class="p">,</code>&#13;
    <code class="p">]);</code>&#13;
&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">assertDatabaseHas</code><code class="p">(</code><code class="s1">'assignments'</code><code class="p">,</code> <code class="p">[</code>&#13;
        <code class="s1">'title'</code> <code class="o">=&gt;</code> <code class="s1">'My great assignment'</code><code class="p">,</code>&#13;
    <code class="p">]);</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>Did we directly call the controller methods? No. But we ensured that the goal of this route—to receive a <code>POST</code> and save its important information to the database—<span class="keep-together">was met.</span></p>&#13;
&#13;
<p>You can also use similar syntax to visit a route and verify that certain text shows up on the page, or that clicking certain buttons does certain things (see <a data-type="xref" href="#EX75X">Example 3-48</a>).</p>&#13;
<div data-type="example" id="EX75X">&#13;
<h5><span class="label">Example 3-48. </span>Writing a simple <code>GET</code> route test</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// AssignmentTest.php</code>&#13;
<code class="k">public</code> <code class="k">function</code> <code class="nf">test_list_page_shows_all_assignments</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="nv">$assignment</code> <code class="o">=</code> <code class="nx">Assignment</code><code class="o">::</code><code class="na">create</code><code class="p">([</code>&#13;
        <code class="s1">'title'</code> <code class="o">=&gt;</code> <code class="s1">'My great assignment'</code><code class="p">,</code>&#13;
    <code class="p">]);</code>&#13;
&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">get</code><code class="p">(</code><code class="s1">'/assignments'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">assertSee</code><code class="p">(</code><code class="s1">'My great assignment'</code><code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="TL;DR" data-type="sect1"><div class="sect1" id="id394">&#13;
<h1>TL;DR</h1>&#13;
&#13;
<p>Laravel’s routes<a data-primary="routing and controllers" data-secondary="overview of" data-type="indexterm" id="id886"/> are defined in <em>routes/web.php</em> and <em>routes/api.php</em>. You can define the expected path for each route, which segments are static and which are parameters, which HTTP verbs can access the route, and how to resolve it. You can also attach middleware to routes, group them, and give them names.</p>&#13;
&#13;
<p>What is returned from the route closure or controller method dictates how Laravel responds to the user. If it’s a string or a view, it’s presented to the user; if it’s other sorts of data, it’s converted to JSON and presented to the user; and if it’s a redirect, it forces a redirect.</p>&#13;
&#13;
<p>Laravel provides a series of tools and conveniences to simplify common routing-related tasks and structures. These include resource controllers, route model binding, and form method spoofing.</p>&#13;
</div></section>&#13;
</div></section></body></html>