<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xml:lang="en"
      lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>PHP Cookbook</title>
<link rel="stylesheet" type="text/css" href="override_v1.css"/>
<link rel="stylesheet" type="text/css" href="epub.css"/>
</head>
<body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. Classes and Objects"><div class="chapter" id="chapter_classes">
<h1><span class="label">Chapter 8. </span>Classes and Objects</h1>


<p>The earliest versions of PHP didn’t support class definition or object orientation. PHP 4 was the first real attempt at an object interface.<sup><a data-type="noteref" id="idm45875158208880-marker" href="ch08.html#idm45875158208880">1</a></sup> It wasn’t until PHP 5, though, that developers had the complex object interfaces they know and use today.</p>

<p>Classes are defined using the <code>class</code> keyword followed by a full description of the constants, properties, and <a data-type="indexterm" data-primary="classes" id="idm45875158206912"></a><a data-type="indexterm" data-primary="class keyword" id="idm45875158206208"></a><a data-type="indexterm" data-primary="keywords" data-secondary="class" id="idm45875158205536"></a>methods inherent to the class. <a data-type="xref" href="#basic_php_class">Example 8-1</a> introduces a basic class construct in PHP, complete with a scoped constant value, a property, and callable <a data-type="indexterm" data-primary="classes" data-secondary="properties" id="idm45875158171984"></a><a data-type="indexterm" data-primary="classes" data-secondary="methods" id="idm45875158171040"></a><a data-type="indexterm" data-primary="properties" id="idm45875158170096"></a><a data-type="indexterm" data-primary="methods" id="idm45875158169424"></a>methods.</p>
<div id="basic_php_class" data-type="example">
<h5><span class="label">Example 8-1. </span>Basic PHP class with properties and methods</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Foo</code>
<code class="p">{</code>
    <code class="k">const</code> <code class="no">SOME_CONSTANT</code> <code class="o">=</code> <code class="mi">42</code><code class="p">;</code>

    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$hello</code> <code class="o">=</code> <code class="s1">'hello'</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">string</code> <code class="nv">$world</code> <code class="o">=</code> <code class="s1">'world'</code><code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">greet</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="nb">sprintf</code><code class="p">(</code><code class="s1">'%s %s'</code><code class="p">,</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">hello</code><code class="p">,</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">world</code><code class="p">);</code>
    <code class="p">}</code>
<code class="p">}</code></pre></div>

<p>An object can be instantiated with the <code>new</code> keyword <a data-type="indexterm" data-primary="objects" data-secondary="instantiation" id="idm45875158131248"></a><a data-type="indexterm" data-primary="new keyword" id="idm45875158130400"></a><a data-type="indexterm" data-primary="keywords" data-secondary="new" id="idm45875158129728"></a>and the name of the class; instantiation looks somewhat like a function call. Any parameters passed into this 
<span class="keep-together">instantiation</span> are transparently passed into the class constructor (the <code>__construct()</code> method) to define <a data-type="indexterm" data-primary="_construct() method" data-primary-sortas="construct() method" id="idm45875158127456"></a>the object’s initial state. <a data-type="xref" href="#basic_php_class_instantiation">Example 8-2</a> illustrates how the class definition from <a data-type="xref" href="#basic_php_class">Example 8-1</a> could be instantiated either with or without default property values.</p>
<div id="basic_php_class_instantiation" data-type="example">
<h5><span class="label">Example 8-2. </span>Instantiating a basic PHP class</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$first</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Foo</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO1-1" href="#callout_classes_and_objects_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$second</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Foo</code><code class="p">(</code><code class="s1">'universe'</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO1-2" href="#callout_classes_and_objects_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>

</code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">greet</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO1-3" href="#callout_classes_and_objects_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nv">$second</code><code class="o">-&gt;</code><code class="na">greet</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO1-4" href="#callout_classes_and_objects_CO1-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>

</code><code class="k">echo</code><code> </code><code class="nx">Foo</code><code class="o">::</code><code class="na">SOME_CONSTANT</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO1-5" href="#callout_classes_and_objects_CO1-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO1-1" href="#co_classes_and_objects_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Instantiating an object without passing a parameter will still invoke the constructor but will leverage its default parameters. If no defaults are provided in the function signature, this would result in an error.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO1-2" href="#co_classes_and_objects_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Passing a parameter during instantiation will provide this parameter to the 
<span class="keep-together">constructor</span>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO1-3" href="#co_classes_and_objects_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This prints <code>hello world</code> by using the constructor’s defaults.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO1-4" href="#co_classes_and_objects_CO1-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This prints <code>hello universe</code> to the console.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO1-5" href="#co_classes_and_objects_CO1-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Constants are referenced directly from the class name. This will print a literal <code>42</code> to the console.</p></dd>
</dl></div>

<p>Constructors and properties are covered in Recipes <a data-type="xref" data-xrefstyle="select:labelnumber" href="#object_instantiation">8.1</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#constructors_with_defaults">8.2</a>.</p>








<section data-type="sect2" data-pdf-bookmark="Procedural Programming"><div class="sect2" id="idm45875157972512">
<h2>Procedural Programming</h2>

<p>Most developers’ first experience with <a data-type="indexterm" data-primary="procedural programming" id="idm45875157971184"></a>PHP is through its more procedural interfaces. Example routines, simple scripts, tutorials—all of these typically leverage functions and variables defined within the global scope. This isn’t a bad thing, but it does limit the flexibility of the programs you can produce.</p>

<p>Procedural programming often results in stateless applications. There is little to no ability to keep track of what’s happened before between function calls, so you pass some reference to the application’s state throughout your code. Again, this isn’t necessarily a bad thing. The only drawback is that <em>complex</em> applications become difficult to analyze or understand.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Object-Oriented Programming"><div class="sect2" id="idm45875157969296">
<h2>Object-Oriented Programming</h2>

<p>An alternative paradigm is to leverage <a data-type="indexterm" data-primary="object-oriented programming" id="objrgm"></a>objects as containers of state. A common practical example is to consider objects as ways to define <em>things</em>. A car is an object. So is a bus. And a bicycle. They are discrete <em>things</em> that have characteristics (such as color, number of wheels, and type of drive) and capabilities (such as go, stop, and turn).</p>

<p>In the programming world, this is among the easiest ways to describe objects. In PHP, you create objects by <a data-type="indexterm" data-primary="classes" data-secondary="defining" id="idm45875157965040"></a>first defining a <code>class</code> to describe the type of object. A class describes the properties (characteristics) and methods (capabilities) that an object of that type will have.</p>

<p>Like things in the real world, objects in a programming space can inherit from more primitive type descriptions. A car, bus, and bicycle are all types of vehicles, so they can all descend from a specific type. <a data-type="xref" href="#php_class_abstraction">Example 8-3</a> demonstrates <a data-type="indexterm" data-primary="class abstraction" id="idm45875157962272"></a>how PHP might construct that kind of object inheritance.</p>
<div id="php_class_abstraction" data-type="example">
<h5><span class="label">Example 8-3. </span>Class abstraction in PHP</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">abstract</code> <code class="k">class</code> <code class="nc">Vehicle</code>
<code class="p">{</code>
    <code class="k">abstract</code> <code class="k">public</code> <code class="k">function</code> <code class="nf">go</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code><code class="p">;</code>

    <code class="k">abstract</code> <code class="k">public</code> <code class="k">function</code> <code class="nf">stop</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code><code class="p">;</code>

    <code class="k">abstract</code> <code class="k">public</code> <code class="k">function</code> <code class="nf">turn</code><code class="p">(</code><code class="nx">Direction</code> <code class="nv">$direction</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code><code class="p">;</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Car</code> <code class="k">extends</code> <code class="nx">Vehicle</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$wheels</code> <code class="o">=</code> <code class="mi">4</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$driveType</code> <code class="o">=</code> <code class="s1">'gas'</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">Color</code> <code class="nv">$color</code><code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">go</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">stop</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">turn</code><code class="p">(</code><code class="nx">Direction</code> <code class="nv">$direction</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Bus</code> <code class="k">extends</code> <code class="nx">Vehicle</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$wheels</code> <code class="o">=</code> <code class="mi">4</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$driveType</code> <code class="o">=</code> <code class="s1">'diesel'</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">Color</code> <code class="nv">$color</code><code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">go</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">stop</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">turn</code><code class="p">(</code><code class="nx">Direction</code> <code class="nv">$direction</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Bicycle</code> <code class="k">extends</code> <code class="nx">Vehicle</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$wheels</code> <code class="o">=</code> <code class="mi">2</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$driveType</code> <code class="o">=</code> <code class="s1">'direct'</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">Color</code> <code class="nv">$color</code><code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">go</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">stop</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">turn</code><code class="p">(</code><code class="nx">Direction</code> <code class="nv">$direction</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// ...</code>
    <code class="p">}</code>
<code class="p">}</code></pre></div>

<p>Instantiating an object creates a typed variable that represents both an initial state and methods for manipulating <a data-type="indexterm" data-primary="objects" data-secondary="inheritance" id="idm45875157599696"></a><a data-type="indexterm" data-primary="inheritance" id="idm45875157598848"></a>that state. Object <em>inheritance</em> presents the possibility to use one or more types as alternatives to one another in other code. <a data-type="xref" href="#interchangeable_classes">Example 8-4</a> 
<span class="keep-together">illustrates</span> how the three types of vehicles introduced in <a data-type="xref" href="#basic_php_class_instantiation">Example 8-2</a> could be used interchangeably because of inheritance.</p>
<div id="interchangeable_classes" data-type="example">
<h5><span class="label">Example 8-4. </span>Classes with similar inheritance can be used interchangeably</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">function</code><code> </code><code class="nf">commute</code><code class="p">(</code><code class="nx">Vehicle</code><code> </code><code class="nv">$vehicle</code><code class="p">)</code><code> </code><a class="co" id="co_classes_and_objects_CO2-1" href="#callout_classes_and_objects_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="c1">// ...
</code><code class="p">}</code><code>

</code><code class="k">function</code><code> </code><code class="nf">exercise</code><code class="p">(</code><code class="nx">Bicycle</code><code> </code><code class="nv">$vehicle</code><code class="p">)</code><code> </code><a class="co" id="co_classes_and_objects_CO2-2" href="#callout_classes_and_objects_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="c1">// ...
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO2-1" href="#co_classes_and_objects_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>All three of the vehicle subtypes can <a data-type="indexterm" data-primary="Vehicle class" id="idm45875157853440"></a><a data-type="indexterm" data-primary="classes" data-secondary="Vehicle" id="idm45875157852736"></a>be used as valid replacements for <code>Vehicle</code> in function calls. This means you could commute by bus, car, or bicycle, and any choice would be equally valid.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO2-2" href="#co_classes_and_objects_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>At times you might need to be more precise and use a child type directly. Neither <code>Bus</code> nor <code>Car</code> nor any other <a data-type="indexterm" data-primary="object-oriented programming" data-startref="objrgm" id="idm45875157847488"></a>subclass of the <code>Vehicle</code> class will be valid for exercise besides a <code>Bicycle</code>.</p></dd>
</dl></div>

<p>Class inheritance is covered at a deeper level by Recipes <a data-type="xref" data-xrefstyle="select:labelnumber" href="#class_inheritance">8.6</a>, <a data-type="xref" data-xrefstyle="select:labelnumber" href="#class_interfaces">8.7</a>, and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#class_abstraction">8.8</a>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Multiparadigm Languages"><div class="sect2" id="idm45875157818176">
<h2>Multiparadigm Languages</h2>

<p>PHP is considered a <em>multiparadigm</em> language, <a data-type="indexterm" data-primary="multiparadigm languages" id="mpdgmg"></a>as you can write code following either of the preceding paradigms. A valid PHP program can be purely procedural. Or it can be strictly focused on object definitions and custom classes. The program could ultimately use a mix of both paradigms.</p>

<p>The open source WordPress content <a data-type="indexterm" data-primary="WordPress CMS (content management system)" id="idm45875157814608"></a>management system (CMS) is one of the most popular PHP projects on the internet.<sup><a data-type="noteref" id="idm45875157813808-marker" href="ch08.html#idm45875157813808">2</a></sup> It’s coded to heavily leverage objects for common abstractions like database objects or remote requests. However, WordPress also stems from a long history of procedural programming—much of the codebase is still heavily influenced by that style. WordPress is a key example not just of the success of PHP itself, but of the flexibility of the language’s support for multiple paradigms.</p>

<p>There is no single right answer for how an application should be assembled. Most are hybrids of approaches that benefit from PHP’s strong support of multiple paradigms. Even in a majority-procedural application, though, you will still likely see a handful of objects as that’s how the language’s standard library <a href="https://oreil.ly/krXrW">implements much of its 
<span class="keep-together">functionality</span></a>.</p>

<p><a data-type="xref" href="ch06.html#chapter_datetime">Chapter 6</a> illustrated the use of both the functional and object-oriented interfaces for PHP’s date system. Error handling, which is covered more in <a data-type="xref" href="ch13.html#chapter_debugging">Chapter 13</a>, heavily leverages internal <code>Exception</code> and <code>Error</code> classes. The <code>yield</code> keyword in an otherwise procedural implementation automatically creates instances of the <code>Generator</code> class.</p>

<p>Even if you never define a class in your program directly, the chances are good that you will leverage one defined either <a data-type="indexterm" data-primary="multiparadigm languages" data-startref="mpdgmg" id="idm45875157806528"></a>by PHP itself or by a third-party library your program requires.<sup><a data-type="noteref" id="idm45875157805424-marker" href="ch08.html#idm45875157805424">3</a></sup></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Visibility"><div class="sect2" id="property_and_method_visibility">
<h2>Visibility</h2>

<p>Classes also introduce the concept of <em>visibility</em> into PHP. Properties, methods, and even constants <a data-type="indexterm" data-primary="classes" data-secondary="visibility and" id="clvsbt"></a><a data-type="indexterm" data-primary="visibility, classes and" id="vsbtycs"></a>can be defined with an optional visibility modifier to change their level of access from other parts of the application. Anything <a data-type="indexterm" data-primary="public classes" id="idm45875157799200"></a><a data-type="indexterm" data-primary="classes" data-secondary="public" id="idm45875157798528"></a><a data-type="indexterm" data-primary="protected classes" id="idm45875157797584"></a><a data-type="indexterm" data-primary="classes" data-secondary="protected" id="idm45875157796912"></a>declared <code>public</code> is accessible to any other class or function in your application. Both methods and properties can be declared <code>protected</code>, making them accessible only to an instance of either the class itself or classes that descend from it. Finally, the <code>private</code> declaration means a member of the class can be accessed only by instances of that class itself.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>By default, anything not explicitly scoped to be private or protected is automatically public, so you might see some developers skip declaring member visibility entirely.</p>
</div>

<p>While member visibility can be directly overridden via reflection,<sup><a data-type="noteref" id="idm45875157792800-marker" href="ch08.html#idm45875157792800">4</a></sup> it’s typically a sound way to clarify which parts of a class’s interface are intended to be used by other code elements. <a data-type="xref" href="#intro_visibility_demonstration">Example 8-5</a> illustrates how each visibility modifier can be leveraged to build a complex application.</p>
<div id="intro_visibility_demonstration" data-type="example">
<h5><span class="label">Example 8-5. </span>Class member visibility overview</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code>    </code><code class="nx">string</code><code> </code><code class="nv">$name</code><code>  </code><code class="o">=</code><code> </code><code class="s1">'Bob'</code><code class="p">;</code><code>
    </code><code class="k">public</code><code>    </code><code class="nx">string</code><code> </code><code class="nv">$city</code><code>  </code><code class="o">=</code><code> </code><code class="s1">'Portland'</code><code class="p">;</code><code>
    </code><code class="k">protected</code><code> </code><code class="nx">int</code><code>    </code><code class="nv">$year</code><code>  </code><code class="o">=</code><code> </code><code class="mi">2023</code><code class="p">;</code><code>
    </code><code class="k">private</code><code>   </code><code class="nx">float</code><code>  </code><code class="nv">$value</code><code> </code><code class="o">=</code><code> </code><code class="mf">42.9</code><code class="p">;</code><code>

    </code><code class="k">function</code><code> </code><code class="nf">hello</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'hello'</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">world</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'world'</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">protected</code><code> </code><code class="k">function</code><code> </code><code class="nf">universe</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'universe'</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">private</code><code> </code><code class="k">function</code><code> </code><code class="nf">abyss</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'the void'</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">B</code><code> </code><code class="k">extends</code><code> </code><code class="nx">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getName</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getCity</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">city</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getYear</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">int</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">year</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getValue</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">float</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">value</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$first</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">B</code><code class="p">;</code><code>
</code><code class="k">echo</code><code> </code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-1" href="#callout_classes_and_objects_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="k">echo</code><code> </code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">getCity</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-2" href="#callout_classes_and_objects_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="k">echo</code><code> </code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">getYear</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-3" href="#callout_classes_and_objects_CO3-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="k">echo</code><code> </code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">getValue</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-4" href="#callout_classes_and_objects_CO3-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>

</code><code class="nv">$second</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">A</code><code class="p">;</code><code>
</code><code class="k">echo</code><code> </code><code class="nv">$second</code><code class="o">-&gt;</code><code class="na">hello</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-5" href="#callout_classes_and_objects_CO3-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="k">echo</code><code> </code><code class="nv">$second</code><code class="o">-&gt;</code><code class="na">world</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-6" href="#callout_classes_and_objects_CO3-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a><code>
</code><code class="k">echo</code><code> </code><code class="nv">$second</code><code class="o">-&gt;</code><code class="na">universe</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-7" href="#callout_classes_and_objects_CO3-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a><code>
</code><code class="k">echo</code><code> </code><code class="nv">$second</code><code class="o">-&gt;</code><code class="na">abyss</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO3-8" href="#callout_classes_and_objects_CO3-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO3-1" href="#co_classes_and_objects_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Prints <code>Bob</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-2" href="#co_classes_and_objects_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Prints <code>Portland</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-3" href="#co_classes_and_objects_CO3-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Prints <code>2023</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-4" href="#co_classes_and_objects_CO3-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Returns a <code>Warning</code> as the <code>::$value</code> property is private and inaccessible.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-5" href="#co_classes_and_objects_CO3-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Prints <code>hello</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-6" href="#co_classes_and_objects_CO3-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Prints <code>world</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-7" href="#co_classes_and_objects_CO3-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Throws an <code>Error</code> as the <code>::universe()</code> method is protected and inaccessible outside the class instance.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO3-8" href="#co_classes_and_objects_CO3-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>This line would not even execute because of the error thrown on the previous line. If the previous line did <em>not</em> throw an error, this one would, as the <code>::abyss()</code> method is private and inaccessible outside the class instance.</p></dd>
</dl></div>

<p>The following recipes further illustrate the <a data-type="indexterm" data-primary="classes" data-secondary="visibility and" data-startref="clvsbt" id="idm45875157262656"></a><a data-type="indexterm" data-primary="visibility, classes and" data-startref="vsbtycs" id="idm45875157261440"></a>preceding concepts and cover some of the most common use cases and implementations of objects in PHP.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.1 Instantiating Objects from Custom Classes"><div class="sect1" id="object_instantiation">
<h1>8.1 Instantiating Objects from Custom Classes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875157258640">
<h2>Problem</h2>

<p>You want to define a custom class <a data-type="indexterm" data-primary="objects" data-secondary="instantiation" data-tertiary="custom classes" id="bjttstc"></a><a data-type="indexterm" data-primary="classes" data-secondary="custom, object instantiation" id="clssstmbj"></a>and create a new object instance from it.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875157254176">
<h2>Solution</h2>

<p>Define the class and its properties <a data-type="indexterm" data-primary="class keyword" id="idm45875157252880"></a><a data-type="indexterm" data-primary="keywords" data-secondary="class" id="idm45875157252176"></a>and methods with the <code>class</code> keyword, then use <code>new</code> to create an instance of it as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Pet</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$name</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$species</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$happiness</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">,</code> <code class="nx">string</code> <code class="nv">$species</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code> <code class="o">=</code> <code class="nv">$name</code><code class="p">;</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">species</code> <code class="o">=</code> <code class="nv">$species</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">pet</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">happiness</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$dog</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Pet</code><code class="p">(</code><code class="s1">'Fido'</code><code class="p">,</code> <code class="s1">'golden retriever'</code><code class="p">);</code>
<code class="nv">$dog</code><code class="o">-&gt;</code><code class="na">pet</code><code class="p">();</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875156953904">
<h2>Discussion</h2>

<p>The Solution example illustrates several key characteristics of objects:</p>

<ul>
<li>
<p>Objects can have properties that define the internal state of the object itself.</p>
</li>
<li>
<p>These objects can have specific visibility. In the Solution example, objects are 
<span class="keep-together"><code>public</code></span>, meaning they can be accessed by any code within the application.<sup><a data-type="noteref" id="idm45875157450624-marker" href="ch08.html#idm45875157450624">5</a></sup></p>
</li>
<li>
<p>The magic <code>::__construct()</code> method can <a data-type="indexterm" data-primary="_construct() method" data-primary-sortas="construct() method" id="idm45875157441056"></a>accept parameters only when the object is first instantiated. These parameters can be used to define the initial state of the object.</p>
</li>
<li>
<p>Methods can have visibility similar to the properties of the object.</p>
</li>
</ul>

<p>This particular version of class definition is the default many developers have been using since PHP 5, when true object-oriented primitives were first introduced. However, <a data-type="xref" href="#constructor_promotion">Example 8-6</a> demonstrates a newer and simpler way to define a simple object like the one in the Solution example. Rather than independently declaring <a data-type="indexterm" data-primary="constructor promotion" id="idm45875157437424"></a>and then directly assigning the properties that carry the object’s state, PHP 8 (and later) allows for defining everything within the constructor itself.</p>
<div id="constructor_promotion" data-type="example">
<h5><span class="label">Example 8-6. </span>Constructor promotion in PHP 8</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Pet</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$happiness</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code>
        <code class="k">public</code> <code class="nx">string</code> <code class="nv">$name</code><code class="p">,</code>
        <code class="k">public</code> <code class="nx">string</code> <code class="nv">$species</code>
    <code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">pet</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">happiness</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$dog</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Pet</code><code class="p">(</code><code class="s1">'Fido'</code><code class="p">,</code> <code class="s1">'golden retriever'</code><code class="p">);</code>
<code class="nv">$dog</code><code class="o">-&gt;</code><code class="na">pet</code><code class="p">();</code></pre></div>

<p>The Solution example and <a data-type="xref" href="#constructor_promotion">Example 8-6</a> are functionally equivalent and will result in objects of the same internal structure being created at runtime. PHP’s ability to promote constructor arguments to object properties, however, dramatically reduces the amount of repetitive code you need to type while defining a class.</p>

<p>Each constructor argument also permits the same types of visibility (<code>public</code>/<code>pro⁠tected</code>/<code>private</code>) that object properties do.<sup><a data-type="noteref" id="idm45875157386544-marker" href="ch08.html#idm45875157386544">6</a></sup> The shorthand syntax means you don’t need to declare properties, then define parameters, then map the <a data-type="indexterm" data-primary="objects" data-secondary="instantiation" data-tertiary="custom classes" data-startref="bjttstc" id="idm45875157384864"></a><a data-type="indexterm" data-primary="classes" data-secondary="custom, object instantiation" data-startref="clssstmbj" id="idm45875157383408"></a>parameters onto those properties upon object instantiation.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875157382096">
<h2>See Also</h2>

<p>Documentation on <a href="https://oreil.ly/TfrNb">classes and objects</a> and the <a href="https://oreil.ly/nzD0s">original RFC on constructor 
<span class="keep-together">promotion</span></a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.2 Constructing Objects to Define Defaults"><div class="sect1" id="constructors_with_defaults">
<h1>8.2 Constructing Objects to Define Defaults</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875157338944">
<h2>Problem</h2>

<p>You want to define default values for your <a data-type="indexterm" data-primary="objects" data-secondary="properties" data-tertiary="default values" id="objpptv"></a><a data-type="indexterm" data-primary="properties" data-secondary="objects, default values" id="ppbjdv"></a>object’s properties.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875157334496">
<h2>Solution</h2>

<p>Define default values for the constructor’s arguments as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Example</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code>
        <code class="k">public</code> <code class="nx">string</code> <code class="nv">$someString</code> <code class="o">=</code> <code class="s1">'default'</code><code class="p">,</code>
        <code class="k">public</code> <code class="nx">int</code>    <code class="nv">$someNumber</code> <code class="o">=</code> <code class="mi">5</code>
    <code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code>

<code class="nv">$first</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Example</code><code class="p">;</code>
<code class="nv">$second</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Example</code><code class="p">(</code><code class="s1">'overridden'</code><code class="p">);</code>
<code class="nv">$third</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Example</code><code class="p">(</code><code class="s1">'hitchhiker'</code><code class="p">,</code> <code class="mi">42</code><code class="p">);</code>
<code class="nv">$fourth</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Example</code><code class="p">(</code><code class="nx">someNumber</code><code class="o">:</code> <code class="mi">10</code><code class="p">);</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875156918080">
<h2>Discussion</h2>

<p>The constructor function within a class definition behaves more or less like any other function in PHP, except it does not return a value. You can define default arguments similarly to how you would with a standard function. You can even reference the names of the constructor arguments to accept default values for <em>some</em> parameters while defining others later in the function signature.</p>

<p>The Solution example explicitly defines the class properties by using constructor promotion for brevity, but the older-style verbose constructor definition is equally valid as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Example</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$someString</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$someNumber</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code>
        <code class="nx">string</code> <code class="nv">$someString</code> <code class="o">=</code> <code class="s1">'default'</code><code class="p">,</code>
        <code class="nx">int</code>    <code class="nv">$someNumber</code> <code class="o">=</code> <code class="mi">5</code>
    <code class="p">)</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">someString</code> <code class="o">=</code> <code class="nv">$someString</code><code class="p">;</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">someNumber</code> <code class="o">=</code> <code class="nv">$someNumber</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre>

<p>Similarly, if <em>not</em> using constructor promotion, you can initialize object properties directly by assigning a default value when they’re defined. When doing so, you would usually leave those parameters off the constructor and manipulate them elsewhere in the program, as shown in the following example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Example</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">string</code> <code class="nv">$someString</code> <code class="o">=</code> <code class="s1">'default'</code><code class="p">;</code>
    <code class="k">public</code> <code class="nx">int</code> <code class="nv">$someNumber</code> <code class="o">=</code> <code class="mi">5</code><code class="p">;</code>
<code class="p">}</code>

<code class="nv">$test</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Example</code><code class="p">;</code>
<code class="nv">$test</code><code class="o">-&gt;</code><code class="na">someString</code> <code class="o">=</code> <code class="s1">'overridden'</code><code class="p">;</code>
<code class="nv">$test</code><code class="o">-&gt;</code><code class="na">someNumber</code> <code class="o">=</code> <code class="mi">42</code><code class="p">;</code></pre>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>As will be discussed in <a data-type="xref" href="#read_only_properties">Recipe 8.3</a>, you cannot initialize a <code>readonly</code> class property directly with a default. This is equivalent to a class constant, and the syntax is therefore disallowed.</p>
</div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875156793584">
<h2>See Also</h2>

<p><a data-type="xref" href="ch03.html#function_default_parameters">Recipe 3.2</a> for more on <a data-type="indexterm" data-primary="objects" data-secondary="properties" data-tertiary="default values" data-startref="objpptv" id="idm45875156791584"></a><a data-type="indexterm" data-primary="properties" data-secondary="objects, default values" data-startref="ppbjdv" id="idm45875156790064"></a>default function parameters, <a data-type="xref" href="ch03.html#named_function_parameters">Recipe 3.3</a> for named function parameters, and documentation on <a href="https://oreil.ly/WJvYY">constructors and destructors</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.3 Defining Read-Only Properties in a Class"><div class="sect1" id="read_only_properties">
<h1>8.3 Defining Read-Only Properties in a Class</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875156715744">
<h2>Problem</h2>

<p>You want to define your class in such <a data-type="indexterm" data-primary="classes" data-secondary="properties" data-tertiary="read-only" id="lspptrdy"></a><a data-type="indexterm" data-primary="properties" data-secondary="classes, read-only" id="pprcssry"></a><a data-type="indexterm" data-primary="read-only properties, classes" id="plyppls"></a>a way that properties defined at instantiation cannot be changed after the object exists.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875156710272">
<h2>Solution</h2>

<p>Use the <code>readonly</code> keyword on a <a data-type="indexterm" data-primary="readonly keyword" id="idm45875156708288"></a><a data-type="indexterm" data-primary="keywords" data-secondary="readonly" id="idm45875156707552"></a>typed property:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Book</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="nx">readonly</code> <code class="nx">string</code> <code class="nv">$title</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$title</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">title</code> <code class="o">=</code> <code class="nv">$title</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$book</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Book</code><code class="p">(</code><code class="s1">'PHP Cookbook'</code><code class="p">);</code></pre>

<p>If using constructor promotion, place the keyword along with the property type within the constructor:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Book</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="k">public</code> <code class="nx">readonly</code> <code class="nx">string</code> <code class="nv">$title</code><code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code>

<code class="nv">$book</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Book</code><code class="p">(</code><code class="s1">'PHP Cookbook'</code><code class="p">);</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875156635792">
<h2>Discussion</h2>

<p>The <code>readonly</code> keyword was introduced in PHP 8.1 and was aimed at reducing the need for more verbose workarounds originally required to achieve the same functionality. With this keyword, a property can only be initialized with a value <em>once</em>, and only while the object is being instantiated.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Read-only properties cannot have a default value. This would make them functionally equivalent to class constants, which already exist, so the functionality is unavailable and the syntax is unsupported. Promoted constructor properties can, however, leverage default values within the argument definition as these are evaluated at runtime.</p>
</div>

<p>The keyword is also valid only for typed properties. Types are typically optional in PHP (except when strict typing is being used<sup><a data-type="noteref" id="idm45875156595712-marker" href="ch08.html#idm45875156595712">7</a></sup>) to aid in flexibility, so it’s possible a property on your class <em>can’t</em> be set to one or another type. In those instances, use the <code>mixed</code> type instead so you can set a read-only property without other type constraints.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>At the time of this writing, read-only declarations are <em>not</em> supported on static properties.</p>
</div>

<p>As a read-only property can only be instantiated once, it cannot be unset or modified by other subsequent code. All of the code in <a data-type="xref" href="#erroneous_readonly_modification">Example 8-7</a> will result in the throwing of an <code>Error</code> exception.</p>
<div id="erroneous_readonly_modification" data-type="example">
<h5><span class="label">Example 8-7. </span>Erroneous attempts to modify a read-only property</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">Example</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="nx">readonly</code><code> </code><code class="nx">string</code><code> </code><code class="nv">$prop</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Second</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="k">public</code><code> </code><code class="nx">readonly</code><code> </code><code class="nx">int</code><code> </code><code class="nv">$count</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">)</code><code> </code><code class="p">{}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$first</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Example</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO4-1" href="#callout_classes_and_objects_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">prop</code><code> </code><code class="o">=</code><code> </code><code class="s1">'test'</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO4-2" href="#callout_classes_and_objects_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>

</code><code class="nv">$test</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Second</code><code class="p">;</code><code>
</code><code class="nv">$test</code><code class="o">-&gt;</code><code class="na">count</code><code> </code><code class="o">+=</code><code> </code><code class="mi">1</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO4-3" href="#callout_classes_and_objects_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nv">$test</code><code class="o">-&gt;</code><code class="na">count</code><code class="o">++</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO4-4" href="#callout_classes_and_objects_CO4-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="o">++</code><code class="nv">$test</code><code class="o">-&gt;</code><code class="na">count</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO4-5" href="#callout_classes_and_objects_CO4-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="nb">unset</code><code class="p">(</code><code class="nv">$test</code><code class="o">-&gt;</code><code class="na">count</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO4-6" href="#callout_classes_and_objects_CO4-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO4-1" href="#co_classes_and_objects_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The <code>Example</code> object will have an uninitialized <code>::$prop</code> property that cannot be accessed (accessing a property before initialization throws an <code>Error</code> exception).</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO4-2" href="#co_classes_and_objects_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>As the object is already instantiated, attempting to write to a read-only property throws an <code>Error</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO4-3" href="#co_classes_and_objects_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The <code>::$count</code> property is read-only, so you cannot assign a new value to it without an <code>Error</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO4-4" href="#co_classes_and_objects_CO4-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>As the <code>::$count</code> property is read-only, you cannot increment it directly.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO4-5" href="#co_classes_and_objects_CO4-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>You cannot increment in either direction with a read-only property.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO4-6" href="#co_classes_and_objects_CO4-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>You cannot unset a read-only property.</p></dd>
</dl></div>

<p>The properties within a class can, however, be other classes themselves. In those situations, a read-only declaration on the property means that property cannot be overwritten or unset, but has no impact on the properties of the child class. For example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">First</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="k">public</code><code> </code><code class="nx">readonly</code><code> </code><code class="nx">Second</code><code> </code><code class="nv">$inner</code><code class="p">)</code><code> </code><code class="p">{}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Second</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="k">public</code><code> </code><code class="nx">int</code><code> </code><code class="nv">$counter</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">)</code><code> </code><code class="p">{}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$test</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">First</code><code class="p">(</code><code class="k">new</code><code> </code><code class="nx">Second</code><code class="p">);</code><code>
</code><code class="nv">$test</code><code class="o">-&gt;</code><code class="na">inner</code><code class="o">-&gt;</code><code class="na">counter</code><code> </code><code class="o">+=</code><code> </code><code class="mi">1</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO5-1" href="#callout_classes_and_objects_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

</code><code class="nv">$test</code><code class="o">-&gt;</code><code class="na">inner</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Second</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO5-2" href="#callout_classes_and_objects_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO5-1" href="#co_classes_and_objects_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The increment of the internal counter will succeed as the <code>::$counter</code> property is itself not declared as read-only.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO5-2" href="#co_classes_and_objects_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The <code>::$inner</code> property is read-only and <a data-type="indexterm" data-primary="classes" data-secondary="properties" data-tertiary="read-only" data-startref="lspptrdy" id="idm45875156355504"></a><a data-type="indexterm" data-primary="properties" data-secondary="classes, read-only" data-startref="pprcssry" id="idm45875156353984"></a><a data-type="indexterm" data-primary="read-only properties, classes" data-startref="plyppls" id="idm45875156352768"></a>cannot be overridden. Attempts to do so result in an <code>Error</code> exception.</p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875156616800">
<h2>See Also</h2>

<p>Documentation on <a href="https://oreil.ly/P-AwN">read-only properties</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.4 Deconstructing Objects to Clean Up After the Object 
Is No Longer Needed"><div class="sect1" id="idm45875156312480">
<h1>8.4 Deconstructing Objects to Clean Up After the Object 
<span class="keep-together">Is No Longer Needed</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875156310736">
<h2>Problem</h2>

<p>Your class definition wraps an expensive <a data-type="indexterm" data-primary="objects" data-secondary="cleanup" id="bjccup"></a>resource that must be carefully cleaned up when the object goes out of scope.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875156307776">
<h2>Solution</h2>

<p>Define a class destructor to clean up after the object is removed from memory as 
<span class="keep-together">follows</span>:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">DatabaseHandler</code>
<code class="p">{</code>
    <code class="c1">// ...</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__destruct</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="nx">dbo_close</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">dbh</code><code class="p">);</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875156297376">
<h2>Discussion</h2>

<p>When an object falls out of scope, PHP will automatically garbage-collect any memory or other resources that object used to represent. There might be times, however, when you want to force a specific action when that object goes out of scope. This might be releasing a database handle, as with the Solution example. It could be explicitly logging <a data-type="indexterm" data-primary="destructors, temporary files" id="idm45875156287184"></a><a data-type="indexterm" data-primary="files" data-secondary="temporary" data-tertiary="destructors" id="idm45875156286512"></a><a data-type="indexterm" data-primary="temporary files" data-secondary="destructor" id="idm45875156285296"></a>an event to a file. Or perhaps <em>deleting</em> a temporary file from the system, as shown in <a data-type="xref" href="#destruct_delete_temp_file">Example 8-8</a>.</p>
<div id="destruct_delete_temp_file" data-type="example">
<h5><span class="label">Example 8-8. </span>Removing a temporary file in a destructor</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">TempLogger</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">private</code><code> </code><code class="nx">string</code><code> </code><code class="nv">$filename</code><code class="p">;</code><code>
    </code><code class="k">private</code><code> </code><code class="nx">mixed</code><code>  </code><code class="nv">$handle</code><code class="p">;</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$name</code><code class="p">)</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code> </code><code class="o">=</code><code> </code><code class="nb">sprintf</code><code class="p">(</code><code class="s1">'tmp_%s_%s.tmp'</code><code class="p">,</code><code> </code><code class="nv">$name</code><code class="p">,</code><code> </code><code class="nb">time</code><code class="p">());</code><code>
        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">handle</code><code> </code><code class="o">=</code><code> </code><code class="nb">fopen</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="p">,</code><code> </code><code class="s1">'w'</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">writeLog</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$line</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nb">fwrite</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">handle</code><code class="p">,</code><code> </code><code class="nv">$line</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getLogs</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">Generator</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nv">$handle</code><code> </code><code class="o">=</code><code> </code><code class="nb">fopen</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="p">,</code><code> </code><code class="s1">'r'</code><code class="p">);</code><code>
        </code><code class="k">while</code><code class="p">((</code><code class="nv">$buffer</code><code> </code><code class="o">=</code><code> </code><code class="nb">fgets</code><code class="p">(</code><code class="nv">$handle</code><code class="p">,</code><code> </code><code class="mi">4096</code><code class="p">))</code><code> </code><code class="o">!==</code><code> </code><code class="k">false</code><code class="p">)</code><code> </code><code class="p">{</code><code>
            </code><code class="k">yield</code><code> </code><code class="nv">$buffer</code><code class="p">;</code><code>
        </code><code class="p">}</code><code>
        </code><code class="nb">fclose</code><code class="p">(</code><code class="nv">$handle</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__destruct</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nb">fclose</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">handle</code><code class="p">);</code><code>
        </code><code class="nb">unlink</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$logger</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">TempLogger</code><code class="p">(</code><code class="s1">'test'</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO6-1" href="#callout_classes_and_objects_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">writeLog</code><code class="p">(</code><code class="s1">'This is a test'</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO6-2" href="#callout_classes_and_objects_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">writeLog</code><code class="p">(</code><code class="s1">'And another'</code><code class="p">);</code><code>

</code><code class="k">foreach</code><code class="p">(</code><code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">getLogs</code><code class="p">()</code><code> </code><code class="k">as</code><code> </code><code class="nv">$log</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_classes_and_objects_CO6-3" href="#callout_classes_and_objects_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="nv">$log</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nb">unset</code><code class="p">(</code><code class="nv">$logger</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO6-4" href="#callout_classes_and_objects_CO6-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO6-1" href="#co_classes_and_objects_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The object will automatically create a file in the current directory with a name similar to <em>tmp_test_1650837172.tmp</em>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO6-2" href="#co_classes_and_objects_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Every new log entry is written as a new line in the temporary log file.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO6-3" href="#co_classes_and_objects_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Accessing the logs will create a second handle on the same file, but for reading. The object exposes this handle through a generator that enumerates over every line in the file.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO6-4" href="#co_classes_and_objects_CO6-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>When the logger is removed from scope (or explicitly unset), the destructor will close the open file handle and automatically delete the file as well.</p></dd>
</dl></div>

<p>This more sophisticated example demonstrates both how a destructor would be written and how it would be invoked. PHP will look for a <code>::__destruct()</code> method on any object when it goes out of scope and will invoke it at that point in time. This destructor  explicitly dereferences the object by calling <code>unset()</code> to remove it from the program. You could just as easily have set the variable referencing the object to <code>null</code> with the same result.</p>

<p>Unlike object constructors, destructors do not accept any parameters. If your object needs to act on any external state while cleaning up after itself, be sure that state is referenced through a property on the object itself. Otherwise, you will not have access to that <a data-type="indexterm" data-primary="objects" data-secondary="cleanup" data-startref="bjccup" id="idm45875156235232"></a>information.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875156233712">
<h2>See Also</h2>

<p>Documentation on <a href="https://oreil.ly/fJMGM">constructors and destructors</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.5 Using Magic Methods to Provide Dynamic Properties"><div class="sect1" id="idm45875156231408">
<h1>8.5 Using Magic Methods to Provide Dynamic Properties</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875156230128">
<h2>Problem</h2>

<p>You want to define a custom <a data-type="indexterm" data-primary="dynamic properties, magic methods" id="dyppgt"></a><a data-type="indexterm" data-primary="properties" data-secondary="dynamic, magic  methods" id="ppdymmmg"></a><a data-type="indexterm" data-primary="Magical class" id="mgclcl"></a>class without predefining the properties it supports.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875156225264">
<h2>Solution</h2>

<p>Use magic getters and setters to <a data-type="indexterm" data-primary="getters, dynamic properties and" id="idm45875156223968"></a><a data-type="indexterm" data-primary="setters, dynamic properties and" id="idm45875156223200"></a>handle dynamically defined properties as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Magical</code>
<code class="p">{</code>
    <code class="k">private</code> <code class="k">array</code> <code class="nv">$_data</code> <code class="o">=</code> <code class="p">[];</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__get</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">)</code><code class="o">:</code> <code class="nx">mixed</code>
    <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nb">isset</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">]))</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">];</code>
        <code class="p">}</code>

        <code class="k">throw</code> <code class="k">new</code> <code class="nx">Error</code><code class="p">(</code><code class="nb">sprintf</code><code class="p">(</code><code class="s1">'Property `%s` is not defined'</code><code class="p">,</code> <code class="nv">$name</code><code class="p">));</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__set</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">,</code> <code class="nx">mixed</code> <code class="nv">$value</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">]</code> <code class="o">=</code> <code class="nv">$value</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$first</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Magical</code><code class="p">;</code>
<code class="nv">$first</code><code class="o">-&gt;</code><code class="na">custom</code> <code class="o">=</code> <code class="s1">'hello'</code><code class="p">;</code>
<code class="nv">$first</code><code class="o">-&gt;</code><code class="na">another</code> <code class="o">=</code> <code class="s1">'world'</code><code class="p">;</code>

<code class="k">echo</code> <code class="nv">$first</code><code class="o">-&gt;</code><code class="na">custom</code> <code class="o">.</code> <code class="s1">' '</code> <code class="o">.</code> <code class="nv">$first</code><code class="o">-&gt;</code><code class="na">another</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>

<code class="k">echo</code> <code class="nv">$first</code><code class="o">-&gt;</code><code class="na">unknown</code><code class="p">;</code> <code class="c1">// Error</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875156198016">
<h2>Discussion</h2>

<p>When you reference a property on an object that does not exist, PHP falls back on a set of <em>magic methods</em> to fill in the blanks on implementation. The getter is used automatically when attempting to reference a property, while the corresponding setter is used when assigning a value to a property.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Property overloading by way of magic methods only works on instantiated objects. It does not work on the static class definition.</p>
</div>

<p>Internally, you then control the behavior of getting and setting data in its entirety. The Solution example stores its data in a private associative array. You can further flesh out this example by fully implementing magic methods for handling <code>isset()</code> and <code>unset()</code>. <a data-type="xref" href="#full_magic_method_example">Example 8-9</a> demonstrates how magic methods can be used to fully replicate a standard class definition, but without the need to predeclare all properties.</p>
<div id="full_magic_method_example" data-type="example">
<h5><span class="label">Example 8-9. </span>Full object definition with magic methods</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Basic</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code>
        <code class="k">public</code> <code class="nx">string</code> <code class="nv">$word</code><code class="p">,</code>
        <code class="k">public</code> <code class="nx">int</code> <code class="nv">$number</code>
    <code class="p">)</code> <code class="p">{}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Magic</code>
<code class="p">{</code>
    <code class="k">private</code> <code class="k">array</code> <code class="nv">$_data</code> <code class="o">=</code> <code class="p">[];</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__get</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">)</code><code class="o">:</code> <code class="nx">mixed</code>
    <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nb">isset</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">]))</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">];</code>
        <code class="p">}</code>

        <code class="k">throw</code> <code class="k">new</code> <code class="nx">Error</code><code class="p">(</code><code class="nb">sprintf</code><code class="p">(</code><code class="s1">'Property `%s` is not defined'</code><code class="p">,</code> <code class="nv">$name</code><code class="p">));</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__set</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">,</code> <code class="nx">mixed</code> <code class="nv">$value</code><code class="p">)</code>
    <code class="p">{</code>
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">]</code> <code class="o">=</code> <code class="nv">$value</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__isset</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="nb">array_key_exists</code><code class="p">(</code><code class="nv">$name</code><code class="p">,</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">);</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="fm">__unset</code><code class="p">(</code><code class="nx">string</code> <code class="nv">$name</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="nb">unset</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_data</code><code class="p">[</code><code class="nv">$name</code><code class="p">]);</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$basic</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Basic</code><code class="p">(</code><code class="s1">'test'</code><code class="p">,</code> <code class="mi">22</code><code class="p">);</code>

<code class="nv">$magic</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Magic</code><code class="p">;</code>
<code class="nv">$magic</code><code class="o">-&gt;</code><code class="na">word</code> <code class="o">=</code> <code class="s1">'test'</code><code class="p">;</code>
<code class="nv">$magic</code><code class="o">-&gt;</code><code class="na">number</code> <code class="o">=</code> <code class="mi">22</code><code class="p">;</code></pre></div>

<p>In <a data-type="xref" href="#full_magic_method_example">Example 8-9</a>, the two objects are functionally equivalent if and only if the only dynamic properties used on a <code>Magic</code> instance are those already defined by <code>Basic</code>. This dynamic nature is what makes the approach so valuable even if the class definitions are painfully verbose. You might choose to wrap a remote API in a class implementing magic methods in order to expose that API’s data to your <a data-type="indexterm" data-primary="dynamic properties, magic methods" data-startref="dyppgt" id="idm45875155486144"></a><a data-type="indexterm" data-primary="properties" data-secondary="dynamic, magic  methods" data-startref="ppdymmmg" id="idm45875155802128"></a><a data-type="indexterm" data-primary="Magical class" data-startref="mgclcl" id="idm45875155800912"></a>application in an object-oriented manner.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875155799840">
<h2>See Also</h2>

<p>Documentation on <a href="https://oreil.ly/1ZtlE">magic methods</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.6 Extending Classes to Define Additional Functionality"><div class="sect1" id="class_inheritance">
<h1>8.6 Extending Classes to Define Additional Functionality</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875155796016">
<h2>Problem</h2>

<p>You want to define a class that adds <a data-type="indexterm" data-primary="classes" data-secondary="functionality, adding" id="clssftly"></a><a data-type="indexterm" data-primary="extends keyword" id="xtdskyw"></a><a data-type="indexterm" data-primary="keywords" data-secondary="extends" id="kywxtd"></a>functionality to an existing class definition.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875155681920">
<h2>Solution</h2>

<p>Use the <code>extends</code> keyword to define additional methods or override existing functionality as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">A</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">hello</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'hello'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">B</code> <code class="k">extends</code> <code class="nx">A</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">world</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'world'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">B</code><code class="p">();</code>
<code class="k">echo</code> <code class="s2">"</code><code class="si">{</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">hello</code><code class="p">()</code><code class="si">}</code><code class="s2"> </code><code class="si">{</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">world</code><code class="p">()</code><code class="si">}</code><code class="s2">"</code><code class="p">;</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875155563776">
<h2>Discussion</h2>

<p>Object inheritance is a common concept for any high-level language; it’s a way you build new objects on top <a data-type="indexterm" data-primary="objects" data-secondary="inheritance" id="idm45875155656448"></a><a data-type="indexterm" data-primary="inheritance" data-secondary="objects" id="idm45875155655472"></a>of other, often simpler object definitions. The Solution example illustrates how a class can <em>inherit</em> method definitions from a parent class, which is the core functionality of PHP’s inheritance model.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>PHP does not support inheriting from <a data-type="indexterm" data-primary="traits" id="idm45875155652784"></a>multiple parent classes. To pull in code implementations from multiple sources, PHP leverages <em>traits</em>, which are covered by <a data-type="xref" href="#classes_traits">Recipe 8.13</a>.</p>
</div>

<p>In fact, a child class inherits every public and protected method, property, and constant from its parent class (the class it’s extending). Private methods, properties, and constants are <em>never</em> inherited by a child class.<sup><a data-type="noteref" id="idm45875155649632-marker" href="ch08.html#idm45875155649632">8</a></sup></p>

<p>A child class can also override its parent’s implementation of a particular method. In practice, you would do this to change the internal logic of a particular method, but the method signature exposed by the child class must match that defined by the parent. <a data-type="xref" href="#child_overrides">Example 8-10</a> demonstrates how a child class would override <a data-type="indexterm" data-primary="parent methods, implementation override" id="idm45875155647056"></a>its parent’s implementation of a method.</p>
<div id="child_overrides" data-type="example">
<h5><span class="label">Example 8-10. </span>Overriding a parent method implementation</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">greet</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$name</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'Good morning, '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$name</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">B</code><code> </code><code class="k">extends</code><code> </code><code class="nx">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">greet</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$name</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'Howdy, '</code><code> </code><code class="o">.</code><code> </code><code class="nv">$name</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$first</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">A</code><code class="p">();</code><code>
</code><code class="k">echo</code><code> </code><code class="nv">$first</code><code class="o">-&gt;</code><code class="na">greet</code><code class="p">(</code><code class="s1">'Alice'</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO7-1" href="#callout_classes_and_objects_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

</code><code class="nv">$second</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">B</code><code class="p">();</code><code>
</code><code class="k">echo</code><code> </code><code class="nv">$second</code><code class="o">-&gt;</code><code class="na">greet</code><code class="p">(</code><code class="s1">'Bob'</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO7-2" href="#callout_classes_and_objects_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO7-1" href="#co_classes_and_objects_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Prints <code>Good morning, Alice</code></p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO7-2" href="#co_classes_and_objects_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Prints <code>Howdy, Bob</code></p></dd>
</dl></div>

<p>An overridden child method does not lose all sense of the parent’s implementation, though. Inside a class, you reference the <code>$this</code> variable to refer to that particular instance of the object. Likewise, you can reference the <code>parent</code> keyword to refer to the parent implementation of a function. For example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">A</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">hello</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'hello'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">B</code> <code class="k">extends</code> <code class="nx">A</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">hello</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="k">parent</code><code class="o">::</code><code class="na">hello</code><code class="p">()</code> <code class="o">.</code> <code class="s1">' world'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">B</code><code class="p">();</code>
<code class="k">echo</code> <code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">hello</code><code class="p">();</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875155320752">
<h2>See Also</h2>

<p>Documentation and <a data-type="indexterm" data-primary="classes" data-secondary="functionality, adding" data-startref="clssftly" id="idm45875155153136"></a><a data-type="indexterm" data-primary="extends keyword" data-startref="xtdskyw" id="idm45875155151888"></a><a data-type="indexterm" data-primary="keywords" data-secondary="extends" data-startref="kywxtd" id="idm45875155150944"></a>discussion of PHP’s <a href="https://oreil.ly/nsAM3">object inheritance model</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.7 Forcing Classes to Exhibit Specific Behavior"><div class="sect1" id="class_interfaces">
<h1>8.7 Forcing Classes to Exhibit Specific Behavior</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875155293504">
<h2>Problem</h2>

<p>You want to define the methods on a <a data-type="indexterm" data-primary="classes" data-secondary="forcing behavior" id="clsssfcbh"></a><a data-type="indexterm" data-primary="forcing class behavior" id="frccbhv"></a>class that will be used elsewhere in your application while leaving the actual method implementations up to someone else.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875155289600">
<h2>Solution</h2>

<p>Define an object interface and leverage that interface in your application as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">interface</code> <code class="nx">ArtifactRepository</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">create</code><code class="p">(</code><code class="nx">Artifact</code> <code class="nv">$artifact</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code><code class="p">;</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">get</code><code class="p">(</code><code class="nx">int</code> <code class="nv">$artifactId</code><code class="p">)</code><code class="o">:</code> <code class="o">?</code><code class="nx">Artifact</code><code class="p">;</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">getAll</code><code class="p">()</code><code class="o">:</code> <code class="k">array</code><code class="p">;</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">update</code><code class="p">(</code><code class="nx">Artifact</code> <code class="nv">$artifact</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code><code class="p">;</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">delete</code><code class="p">(</code><code class="nx">int</code> <code class="nv">$artifactId</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code><code class="p">;</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Museum</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code>
        <code class="k">protected</code> <code class="nx">ArtifactRepository</code> <code class="nv">$repository</code>
    <code class="p">)</code> <code class="p">{}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">enumerateArtifacts</code><code class="p">()</code><code class="o">:</code> <code class="nx">Generator</code>
    <code class="p">{</code>
        <code class="k">foreach</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">repository</code><code class="o">-&gt;</code><code class="na">getAll</code><code class="p">()</code> <code class="k">as</code> <code class="nv">$artifact</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">yield</code> <code class="nv">$artifact</code><code class="p">;</code>
        <code class="p">}</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875155284400">
<h2>Discussion</h2>

<p>An interface looks similar to <a data-type="indexterm" data-primary="methods" data-secondary="signatures" id="idm45875155226704"></a><a data-type="indexterm" data-primary="signatures" id="idm45875155225840"></a>a class definition, except it only defines the <em>signatures</em> of specific methods rather than their implementations. The interface does, however, define a type that can be used elsewhere in your application—so long as a class directly implements a given interface, an instance of that class can be used as if it were the same type as the interface itself.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>There are several situations in which you might have two classes that implement the same methods and expose the same signatures to your application. However, unless these classes <a data-type="indexterm" data-primary="implements keyword" id="idm45875155223648"></a><a data-type="indexterm" data-primary="keywords" data-secondary="implements" id="idm45875155222944"></a>explicitly implement the same interface (as evidenced by the <code>implements</code> keyword), they cannot be used interchangeably in a strictly typed application.</p>
</div>

<p>An implementation must use the <code>implements</code> keyword to tell the PHP compiler what’s going on. The Solution example illustrates how an interface is defined and how another part of the code can leverage that interface. <a data-type="xref" href="#interface_implementation">Example 8-11</a> demonstrates how the <code>ArtifactRepository</code> interface might be implemented using an in-memory array for data storage.</p>
<div id="interface_implementation" data-type="example">
<h5><span class="label">Example 8-11. </span>Explicit interface implementation</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">MemoryRepository</code> <code class="k">implements</code> <code class="nx">ArtifactRepository</code>
<code class="p">{</code>
    <code class="k">private</code> <code class="k">array</code> <code class="nv">$_collection</code> <code class="o">=</code> <code class="p">[];</code>

    <code class="k">private</code> <code class="k">function</code> <code class="nf">nextKey</code><code class="p">()</code><code class="o">:</code> <code class="nx">int</code>
    <code class="p">{</code>
        <code class="nv">$keys</code> <code class="o">=</code> <code class="nb">array_keys</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">);</code>
        <code class="nv">$max</code> <code class="o">=</code> <code class="nb">array_reduce</code><code class="p">(</code><code class="nv">$keys</code><code class="p">,</code> <code class="k">function</code><code class="p">(</code><code class="nv">$c</code><code class="p">,</code> <code class="nv">$i</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nb">max</code><code class="p">(</code><code class="nv">$c</code><code class="p">,</code> <code class="nv">$i</code><code class="p">);</code>
        <code class="p">},</code> <code class="mi">0</code><code class="p">);</code>

        <code class="k">return</code> <code class="nv">$max</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">create</code><code class="p">(</code><code class="nx">Artifact</code> <code class="nv">$artifact</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
    <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nv">$artifact</code><code class="o">-&gt;</code><code class="na">id</code> <code class="o">===</code> <code class="k">null</code><code class="p">)</code> <code class="p">{</code>
            <code class="nv">$artifact</code><code class="o">-&gt;</code><code class="na">id</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">nextKey</code><code class="p">();</code>
        <code class="p">}</code>

        <code class="k">if</code> <code class="p">(</code><code class="nb">array_key_exists</code><code class="p">(</code><code class="nv">$artifact</code><code class="o">-&gt;</code><code class="na">id</code><code class="p">,</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">))</code> <code class="p">{</code>
            <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">[</code><code class="nv">$artifact</code><code class="o">-&gt;</code><code class="na">id</code><code class="p">]</code> <code class="o">=</code> <code class="nv">$artifact</code><code class="p">;</code>
        <code class="k">return</code> <code class="k">true</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">get</code><code class="p">(</code><code class="nx">int</code> <code class="nv">$artifactId</code><code class="p">)</code><code class="o">:</code> <code class="o">?</code><code class="nx">Artifact</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">[</code><code class="nv">$artifactId</code><code class="p">]</code> <code class="o">??</code> <code class="k">null</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">getAll</code><code class="p">()</code><code class="o">:</code> <code class="k">array</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="nb">array_values</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">);</code>
    <code class="p">}</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">update</code><code class="p">(</code><code class="nx">Artifact</code> <code class="nv">$artifact</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
    <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nb">array_key_exists</code><code class="p">(</code><code class="nv">$artifact</code><code class="o">-&gt;</code><code class="na">id</code><code class="p">,</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">))</code> <code class="p">{</code>
            <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">[</code><code class="nv">$artifact</code><code class="o">-&gt;</code><code class="na">id</code><code class="p">]</code> <code class="o">=</code> <code class="nv">$artifact</code><code class="p">;</code>
            <code class="k">return</code> <code class="k">true</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">delete</code><code class="p">(</code><code class="nx">int</code> <code class="nv">$artifactId</code><code class="p">)</code><code class="o">:</code> <code class="nx">bool</code>
    <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nb">array_key_exists</code><code class="p">(</code><code class="nv">$artifactId</code><code class="p">,</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">))</code> <code class="p">{</code>
            <code class="nb">unset</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">_collection</code><code class="p">[</code><code class="nv">$artifactId</code><code class="p">]);</code>
            <code class="k">return</code> <code class="k">true</code><code class="p">;</code>
        <code class="p">}</code>

        <code class="k">return</code> <code class="k">false</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre></div>

<p>Throughout your application, any method can declare a type on a parameter by using the interface itself. The Solution example’s <code>Museum</code> class takes a concrete implementation of the <code>ArtifactRepository</code> as its only parameter. This class can then operate knowing what the exposed API of the repository will look like. The code doesn’t care <em>how</em> each method is implemented, only that it matches the interface’s defined signature exactly.</p>

<p>A class definition can implement many different interfaces at once. This allows for a complex object to be used in different situations by different pieces of code. Note that, if two or more interfaces define the same method name, their defined signatures must be identical, as illustrated by <a data-type="xref" href="#multiple_interface_inheritance">Example 8-12</a>.</p>
<div id="multiple_interface_inheritance" data-type="example">
<h5><span class="label">Example 8-12. </span>Implementing multiple interfaces at once</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">interface</code><code> </code><code class="nx">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">int</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">interface</code><code> </code><code class="nx">B</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">int</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">interface</code><code> </code><code class="nx">C</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">First</code><code> </code><code class="k">implements</code><code> </code><code class="nx">A</code><code class="p">,</code><code> </code><code class="nx">B</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">int</code><code> </code><a class="co" id="co_classes_and_objects_CO8-1" href="#callout_classes_and_objects_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="mi">1</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Second</code><code> </code><code class="k">implements</code><code> </code><code class="nx">A</code><code class="p">,</code><code> </code><code class="nx">C</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">int</code><code class="o">|</code><code class="nx">string</code><code> </code><a class="co" id="co_classes_and_objects_CO8-2" href="#callout_classes_and_objects_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="s1">'nope'</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO8-1" href="#co_classes_and_objects_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>As both <code>A</code> and <code>B</code> define the same method signature, this implementation is valid.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO8-2" href="#co_classes_and_objects_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Since <code>A</code> and <code>C</code> define different return types, there is no way, even with union types, to define a class that implements both interfaces. Attempting to do so causes a fatal error.</p></dd>
</dl></div>

<p>Remember also that interfaces look somewhat like classes so, like classes, they can be extended.<sup><a data-type="noteref" id="idm45875154877776-marker" href="ch08.html#idm45875154877776">9</a></sup> This is done through the same <code>extends</code> keyword and results in an interface that is a composition of two or more interfaces, as demonstrated in <a data-type="xref" href="#composite_interfaces">Example 8-13</a>.</p>
<div id="composite_interfaces" data-type="example">
<h5><span class="label">Example 8-13. </span>Composite interfaces</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">interface</code><code> </code><code class="nx">A</code><code> </code><a class="co" id="co_classes_and_objects_CO9-1" href="#callout_classes_and_objects_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">interface</code><code> </code><code class="nx">B</code><code> </code><code class="k">extends</code><code> </code><code class="nx">A</code><code> </code><a class="co" id="co_classes_and_objects_CO9-2" href="#callout_classes_and_objects_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">bar</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">C</code><code> </code><code class="k">implements</code><code> </code><code class="nx">B</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">foo</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// ... actual implementation
</code><code>    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">bar</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// ... actual implementation
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO9-1" href="#co_classes_and_objects_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Any class implementing <code>A</code> must define the <code>foo()</code> method.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO9-2" href="#co_classes_and_objects_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Any class implementing <code>B</code> must <a data-type="indexterm" data-primary="classes" data-secondary="forcing behavior" data-startref="clsssfcbh" id="idm45875154558176"></a><a data-type="indexterm" data-primary="forcing class behavior" data-startref="frccbhv" id="idm45875154556896"></a>implement both <code>bar()</code> and <code>foo()</code> from <code>A</code>.</p></dd>
</dl></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875155283808">
<h2>See Also</h2>

<p>Documentation on <a href="https://oreil.ly/A8hkg">object interfaces</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.8 Creating Abstract Base Classes"><div class="sect1" id="class_abstraction">
<h1>8.8 Creating Abstract Base Classes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875154515184">
<h2>Problem</h2>

<p>You want a class to <a data-type="indexterm" data-primary="abstract base classes" id="absbscl"></a><a data-type="indexterm" data-primary="base classes, abstract" id="bslssbst"></a><a data-type="indexterm" data-primary="classes" data-secondary="abstract base classes" id="clabbscl"></a>implement a specific interface but also want to define some other specific functionality.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875154510352">
<h2>Solution</h2>

<p>Rather than implementing an interface, define an abstract base class that can be extended as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">abstract</code><code> </code><code class="k">class</code><code> </code><code class="nc">Base</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">abstract</code><code> </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getData</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code class="p">;</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">printData</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">echo</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">getData</code><code class="p">();</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Concrete</code><code> </code><code class="k">extends</code><code> </code><code class="nx">Base</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getData</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nb">bin2hex</code><code class="p">(</code><code class="nb">random_bytes</code><code class="p">(</code><code class="mi">16</code><code class="p">));</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$instance</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Concrete</code><code class="p">;</code><code>
</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">printData</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO10-1" href="#callout_classes_and_objects_CO10-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO10-1" href="#co_classes_and_objects_CO10-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Prints something like <code>6ec2aff42d5904e0ccef15536d8548dc</code></p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875154438672">
<h2>Discussion</h2>

<p>An abstract class looks somewhat like an interface and a regular class definition smashed together. It has some unimplemented methods living alongside concrete implementations. As with an interface, you cannot instantiate an abstract class directly—you have to extend it first and implement any abstract methods it defines. As with a class, however, you will automatically have access to any public or protected members of the base class in the child implementation.<sup><a data-type="noteref" id="idm45875154437296-marker" href="ch08.html#idm45875154437296">10</a></sup></p>

<p>One key difference between interfaces and abstract classes is that the latter can bundle properties and method definitions with it. Abstract classes are, in fact, classes that are merely incomplete implementations. An interface cannot have properties—it merely defines the functional interface with which any implementing object must comply.</p>

<p>Another difference is that you can implement multiple interfaces simultaneously, but you can only extend one class at a time. This limitation alone helps characterize when you would leverage an abstract base class versus an interface—but you can also mix and match both!</p>

<p>It’s also possible for an abstract class to define <em>private</em> members (which are not inherited by any child class) that are otherwise leveraged by accessible methods, as illustrated by the following:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">abstract</code><code> </code><code class="k">class</code><code> </code><code class="nc">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">private</code><code> </code><code class="nx">string</code><code> </code><code class="nv">$data</code><code> </code><code class="o">=</code><code> </code><code class="s1">'this is a secret'</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO11-1" href="#callout_classes_and_objects_CO11-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="k">abstract</code><code> </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">viewData</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code class="p">;</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getData</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">data</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO11-2" href="#callout_classes_and_objects_CO11-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">B</code><code> </code><code class="k">extends</code><code> </code><code class="nx">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">viewData</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">echo</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">getData</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO11-3" href="#callout_classes_and_objects_CO11-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$instance</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">B</code><code class="p">();</code><code>
</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">viewData</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO11-4" href="#callout_classes_and_objects_CO11-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO11-1" href="#co_classes_and_objects_CO11-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>By making your data private, it is only accessible within the context of <code>A</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO11-2" href="#co_classes_and_objects_CO11-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>As <code>::getData()</code> is itself defined by <code>A</code>, the <code>$data</code> property is still accessible.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO11-3" href="#co_classes_and_objects_CO11-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Though <code>::viewData()</code> is defined in the scope of <code>B</code>, it is accessing a public method from the scope of <code>A</code>. No code in <code>B</code> would have direct access to <code>A</code>’s private 
<span class="keep-together">members</span>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO11-4" href="#co_classes_and_objects_CO11-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This will print <code>this is a secret</code> to the <a data-type="indexterm" data-primary="abstract base classes" data-startref="absbscl" id="idm45875154258352"></a><a data-type="indexterm" data-primary="base classes, abstract" data-startref="bslssbst" id="idm45875154257344"></a><a data-type="indexterm" data-primary="classes" data-secondary="abstract base classes" data-startref="clabbscl" id="idm45875154256400"></a>console.</p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875154254928">
<h2>See Also</h2>

<p>Documentation and discussion of <a href="https://oreil.ly/FMkcT">class abstraction</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.9 Preventing Changes to Classes and Methods"><div class="sect1" id="idm45875154252720">
<h1>8.9 Preventing Changes to Classes and Methods</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875154251536">
<h2>Problem</h2>

<p>You want to prevent anyone from <a data-type="indexterm" data-primary="classes" data-secondary="preventing changes" id="clsvgc"></a><a data-type="indexterm" data-primary="final keyword" id="fnlkyw"></a><a data-type="indexterm" data-primary="keywords" data-secondary="final" id="kywdfn"></a><a data-type="indexterm" data-primary="classes" data-secondary="extension prevention" id="clsxtsb"></a>modifying the implementation of your class or extending it with a child class.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875154245200">
<h2>Solution</h2>

<p>Use the <code>final</code> keyword to indicate that a class is not extensible, as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">final</code> <code class="k">class</code> <code class="nc">Immutable</code>
<code class="p">{</code>
    <code class="c1">// Class definition</code>
<code class="p">}</code></pre>

<p>Or use the <code>final</code> keyword to mark a particular method as unchangeable, as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Mutable</code>
<code class="p">{</code>
    <code class="k">final</code> <code class="k">public</code> <code class="k">function</code> <code class="nf">fixed</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="c1">// Method definition</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875154197472">
<h2>Discussion</h2>

<p>The <code>final</code> keyword is a way to explicitly <em>prevent</em> object extension like the mechanisms discussed in the previous two recipes. It’s useful when you want to ensure that a specific implementation of a method or an entire class is used throughout a codebase.</p>

<p>Marking a method as <code>final</code> means that any class extensions are incapable of overriding that method’s implementation. The following example will throw a fatal error due to the <code>Child</code> class’s attempt to override a <code>final</code> method in the <code>Base</code> class:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Base</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">safe</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="s1">'safe() inside Base class'</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">final</code> <code class="k">public</code> <code class="k">function</code> <code class="nf">unsafe</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="s1">'unsafe() inside Base class'</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Child</code> <code class="k">extends</code> <code class="nx">Base</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">safe</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="s1">'safe() inside Child class'</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">unsafe</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="s1">'unsafe() inside Child class'</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre>

<p>In the preceding example, merely omitting the definition of <code>unsafe()</code> from the child class will allow the code to execute as expected. If, however, you wanted to prevent any class from extending the base class, you could add the <code>final</code> keyword to the class definition itself as follows:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">final</code> <code class="k">class</code> <code class="nc">Base</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">safe</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="s1">'safe() inside Base class'</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">unsafe</code><code class="p">()</code>
    <code class="p">{</code>
        <code class="k">echo</code> <code class="s1">'unsafe() inside Base class'</code> <code class="o">.</code> <code class="nx">PHP_EOL</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre>

<p>The only time you should leverage <code>final</code> in your code is when overriding a specific method or class implementation will break your application. This is somewhat rare in practice but is useful when creating a flexible interface. A specific example would be when your application introduces an interface as well as concrete implementations of that interface.<sup><a data-type="noteref" id="idm45875154091840-marker" href="ch08.html#idm45875154091840">11</a></sup> Your API would then be constructed to accept any valid interface implementation, but you might want to prevent subclassing your own concrete implementations (again because doing so might break your application). <a data-type="xref" href="#interfaces_and_concrete_classes">Example 8-14</a> demonstrates how these dependencies might be constructed in a real application.</p>
<div id="interfaces_and_concrete_classes" data-type="example">
<h5><span class="label">Example 8-14. </span>Interfaces and concrete classes</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">interface</code><code> </code><code class="nx">DataAbstraction</code><code> </code><a class="co" id="co_classes_and_objects_CO12-1" href="#callout_classes_and_objects_CO12-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">save</code><code class="p">();</code><code>
</code><code class="p">}</code><code>

</code><code class="k">final</code><code> </code><code class="k">class</code><code> </code><code class="nc">DBImplementation</code><code> </code><code class="k">implements</code><code> </code><code class="nx">DataAbstraction</code><code> </code><a class="co" id="co_classes_and_objects_CO12-2" href="#callout_classes_and_objects_CO12-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$databaseConnection</code><code class="p">)</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// Connect to a database
</code><code>    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">save</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// Save some data
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">final</code><code> </code><code class="k">class</code><code> </code><code class="nc">FileImplementation</code><code> </code><code class="k">implements</code><code> </code><code class="nx">DataAbstraction</code><code> </code><a class="co" id="co_classes_and_objects_CO12-3" href="#callout_classes_and_objects_CO12-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$filename</code><code class="p">)</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// Open a file for writing
</code><code>    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">save</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// Write to the file
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Application</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code>
        </code><code class="k">protected</code><code> </code><code class="nx">DataAbstraction</code><code> </code><code class="nv">$datalayer</code><code> </code><a class="co" id="co_classes_and_objects_CO12-4" href="#callout_classes_and_objects_CO12-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>
    </code><code class="p">)</code><code> </code><code class="p">{}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO12-1" href="#co_classes_and_objects_CO12-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The application describes an interface that any data abstraction layer must 
<span class="keep-together">implement</span>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO12-2" href="#co_classes_and_objects_CO12-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>One concrete implementation stores data explicitly in a database.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO12-3" href="#co_classes_and_objects_CO12-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Another implementation uses flat files for data storage.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO12-4" href="#co_classes_and_objects_CO12-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The application doesn’t care what implementation you use so long as it implements the base interface. You can use either the provided (<code>final</code>) classes or define your own implementation.</p></dd>
</dl></div>

<p>In some situations, you might come across a <code>final</code> class you need to extend anyway. In those cases, the only means at your disposal are to leverage a decorator. A <em>decorator</em> is a class <a data-type="indexterm" data-primary="classes" data-secondary="decorators" id="idm45875153866192"></a><a data-type="indexterm" data-primary="decorators" id="idm45875153865344"></a>that takes another class as a constructor property and “decorates” its methods with additional functionality.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In some circumstances, decorators will not allow you to sidestep the <code>final</code> nature of a class. This happens if type hinting and strict typing require an instance of that exact class be passed to a function or another object within the application.</p>
</div>

<p>Assume, for example, that a library in your application defines a <code>Note</code> class that implements a <code>::publish()</code> method that publishes a given piece of data to social media (say, Twitter). You want this method to <em>also</em> produce a static PDF artifact of the given data and would normally extend the class itself, as shown in <a data-type="xref" href="#final_extending_regular_class">Example 8-15</a>.</p>
<div id="final_extending_regular_class" data-type="example">
<h5><span class="label">Example 8-15. </span>Typical class extension without the <code>final</code> keyword</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">Note</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">publish</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// Publish the note's data to Twitter ...
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">StaticNote</code><code> </code><code class="k">extends</code><code> </code><code class="nx">Note</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">publish</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">parent</code><code class="o">::</code><code class="na">publish</code><code class="p">();</code><code>

        </code><code class="c1">// Also produce a static PDF of the note's data ...
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$note</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">StaticNote</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO13-1" href="#callout_classes_and_objects_CO13-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$note</code><code class="o">-&gt;</code><code class="na">publish</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO13-2" href="#callout_classes_and_objects_CO13-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO13-1" href="#co_classes_and_objects_CO13-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Rather than instantiating a <code>Note</code> object, you can instantiate a <code>StaticNote</code> directly.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO13-2" href="#co_classes_and_objects_CO13-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>When you call the object’s <code>::publish()</code> method, <em>both</em> class definitions are used.</p></dd>
</dl></div>

<p>If the <code>Note</code> class is instead <code>final</code>, you will be unable to extend the class directly. <a data-type="xref" href="#final_decorating_class">Example 8-16</a> demonstrates how a new class can be created that <em>decorates</em> the <code>Note</code> class and indirectly extends its functionality.</p>
<div id="final_decorating_class" data-type="example">
<h5><span class="label">Example 8-16. </span>Customizing hte behavior of a <code>final</code> class with a decorator</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">final</code><code> </code><code class="k">class</code><code> </code><code class="nc">Note</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">publish</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// Publish the note's data to Twitter ...
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">final</code><code> </code><code class="k">class</code><code> </code><code class="nc">StaticNote</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="k">private</code><code> </code><code class="nx">Note</code><code> </code><code class="nv">$note</code><code class="p">)</code><code> </code><code class="p">{}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">publish</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">note</code><code class="o">-&gt;</code><code class="na">publish</code><code class="p">();</code><code>

        </code><code class="c1">// Also produce a static PDF of the note's data ...
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$note</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">StaticNote</code><code class="p">(</code><code class="k">new</code><code> </code><code class="nx">Note</code><code class="p">());</code><code> </code><a class="co" id="co_classes_and_objects_CO14-1" href="#callout_classes_and_objects_CO14-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$note</code><code class="o">-&gt;</code><code class="na">publish</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO14-2" href="#callout_classes_and_objects_CO14-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO14-1" href="#co_classes_and_objects_CO14-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Rather than instantiating <code>StaticNote</code> directly, you use this class to <em>wrap</em> (or <em>decorate</em>) a regular <code>Note</code> instance.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO14-2" href="#co_classes_and_objects_CO14-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>When you call the object’s <code>::publish()</code> method, <em>both</em> class <a data-type="indexterm" data-primary="classes" data-secondary="preventing changes" data-startref="clsvgc" id="idm45875153693872"></a><a data-type="indexterm" data-primary="final keyword" data-startref="fnlkyw" id="idm45875153692592"></a><a data-type="indexterm" data-primary="keywords" data-secondary="final" data-startref="kywdfn" id="idm45875153691648"></a><a data-type="indexterm" data-primary="classes" data-secondary="extension prevention" data-startref="clsxtsb" id="idm45875153655136"></a>definitions are used.</p></dd>
</dl></div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875153653408">
<h2>See Also</h2>

<p>Documentation on the <a href="https://oreil.ly/k2ZGz"><code>final</code> keyword</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.10 Cloning Objects"><div class="sect1" id="idm45875153650848">
<h1>8.10 Cloning Objects</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875153649632">
<h2>Problem</h2>

<p>You want to create a distinct <a data-type="indexterm" data-primary="objects" data-secondary="cloning" id="bjccln"></a><a data-type="indexterm" data-primary="cloning" data-secondary="objects" id="cngbjc"></a><a data-type="indexterm" data-primary="clone keyword" id="clnkyw"></a><a data-type="indexterm" data-primary="keywords" data-secondary="clone" id="kywdcln"></a>copy of an object.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875153643264">
<h2>Solution</h2>

<p>Use the <code>clone</code> keyword to create a second copy of the object—for example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$dolly</code> <code class="o">=</code> <code class="k">clone</code> <code class="nv">$roslin</code><code class="p">;</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875153637872">
<h2>Discussion</h2>

<p>By default, PHP will copy objects <em>by reference</em> when assigned to a new variable. This reference means the new variable literally points to the same object in memory. <a data-type="xref" href="#obj_copy_by_reference">Example 8-17</a> illustrates how, even though it might appear that you’ve created a copy of an object, you’re really dealing with just two references to the same data.</p>
<div id="obj_copy_by_reference" data-type="example">
<h5><span class="label">Example 8-17. </span>The assignment operator copies an object by reference</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$obj1</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">object</code><code class="p">)</code><code> </code><code class="p">[</code><code> </code><a class="co" id="co_classes_and_objects_CO15-1" href="#callout_classes_and_objects_CO15-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="s1">'propertyOne'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s1">'some'</code><code class="p">,</code><code>
    </code><code class="s1">'propertyTwo'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s1">'data'</code><code class="p">,</code><code>
</code><code class="p">];</code><code>
</code><code class="nv">$obj2</code><code> </code><code class="o">=</code><code> </code><code class="nv">$obj1</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO15-2" href="#callout_classes_and_objects_CO15-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>

</code><code class="nv">$obj2</code><code class="o">-&gt;</code><code class="na">propertyTwo</code><code> </code><code class="o">=</code><code> </code><code class="s1">'changed'</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO15-3" href="#callout_classes_and_objects_CO15-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>

</code><code class="nb">var_dump</code><code class="p">(</code><code class="nv">$obj1</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO15-4" href="#callout_classes_and_objects_CO15-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="nb">var_dump</code><code class="p">(</code><code class="nv">$obj2</code><code class="p">);</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO15-1" href="#co_classes_and_objects_CO15-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This particular syntax is shorthand, valid as of PHP 5.4, that dynamically converts a new associative array to an instance of the built-in <code>stdClass</code> class.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO15-2" href="#co_classes_and_objects_CO15-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Attempt to copy the first object to a new instance by using the assignment 
<span class="keep-together">operator</span>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO15-3" href="#co_classes_and_objects_CO15-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Make a change to the internal state of the “copied” object.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO15-4" href="#co_classes_and_objects_CO15-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Inspecting the original object shows that its internal state has changed. Both <code>$obj1</code> and <code>$obj2</code> point to the same space in memory; you merely copied a reference to the object, not the object itself!</p></dd>
</dl></div>

<p>Rather than copy an object reference, the <code>clone</code> keyword copies an object to a new variable <em>by value</em>. This means all of the properties are copied to a new instance of the same class that has all of the methods of the original object as well. <a data-type="xref" href="#obj_copy_by_value">Example 8-18</a> illustrates how the two objects are now entirely decoupled.</p>
<div id="obj_copy_by_value" data-type="example">
<h5><span class="label">Example 8-18. </span>The <code>clone</code> keyword copies an object by value</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$obj1</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">object</code><code class="p">)</code><code> </code><code class="p">[</code><code>
    </code><code class="s1">'propertyOne'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s1">'some'</code><code class="p">,</code><code>
    </code><code class="s1">'propertyTwo'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s1">'data'</code><code class="p">,</code><code>
</code><code class="p">];</code><code>
</code><code class="nv">$obj2</code><code> </code><code class="o">=</code><code> </code><code class="k">clone</code><code> </code><code class="nv">$obj1</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO16-1" href="#callout_classes_and_objects_CO16-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

</code><code class="nv">$obj2</code><code class="o">-&gt;</code><code class="na">propertyTwo</code><code> </code><code class="o">=</code><code> </code><code class="s1">'changed'</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO16-2" href="#callout_classes_and_objects_CO16-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>

</code><code class="nb">var_dump</code><code class="p">(</code><code class="nv">$obj1</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO16-3" href="#callout_classes_and_objects_CO16-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nb">var_dump</code><code class="p">(</code><code class="nv">$obj2</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO16-4" href="#callout_classes_and_objects_CO16-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO16-1" href="#co_classes_and_objects_CO16-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Rather than use strict assignment, leverage the <code>clone</code> keyword to create a by-value copy of the object.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO16-2" href="#co_classes_and_objects_CO16-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Again make a change to the internal state of the copy.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO16-3" href="#co_classes_and_objects_CO16-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Inspecting the state of the original object shows no changes.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO16-4" href="#co_classes_and_objects_CO16-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The cloned and changed object, however, illustrates the property modification made earlier.</p></dd>
</dl></div>

<p>An important caveat here is to understand that, as <a data-type="indexterm" data-primary="cloning" data-secondary="shallow clones" id="idm45875153424544"></a><a data-type="indexterm" data-primary="shallow clones" id="idm45875153423664"></a>used in the preceding examples, <code>clone</code> is a <em>shallow clone</em> of the data. The operation does not traverse down into more complex properties like nested objects. Even with proper <code>clone</code> usage, it is possible to be left with two different variables referencing the same object in memory. <a data-type="xref" href="#obj_nested_clone_reference">Example 8-19</a> illustrates what happens if the object to be copied contains a more complex object itself.</p>
<div id="obj_nested_clone_reference" data-type="example">
<h5><span class="label">Example 8-19. </span>Shallow clones of complex data structures</h5>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$child</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">object</code><code class="p">)</code><code> </code><code class="p">[</code><code>
    </code><code class="s1">'name'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s1">'child'</code><code class="p">,</code><code>
</code><code class="p">];</code><code>
</code><code class="nv">$parent</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">object</code><code class="p">)</code><code> </code><code class="p">[</code><code>
    </code><code class="s1">'name'</code><code>  </code><code class="o">=&gt;</code><code> </code><code class="s1">'parent'</code><code class="p">,</code><code>
    </code><code class="s1">'child'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nv">$child</code><code>
</code><code class="p">];</code><code>

</code><code class="nv">$clone</code><code> </code><code class="o">=</code><code> </code><code class="k">clone</code><code> </code><code class="nv">$parent</code><code class="p">;</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code> </code><code class="o">===</code><code> </code><code class="nv">$clone</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_classes_and_objects_CO17-1" href="#callout_classes_and_objects_CO17-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and clone are the same object!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code> </code><code class="o">==</code><code> </code><code class="nv">$clone</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_classes_and_objects_CO17-2" href="#callout_classes_and_objects_CO17-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and clone have the same data!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code class="o">-&gt;</code><code class="na">child</code><code> </code><code class="o">===</code><code> </code><code class="nv">$clone</code><code class="o">-&gt;</code><code class="na">child</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_classes_and_objects_CO17-3" href="#callout_classes_and_objects_CO17-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and the clone have the same child!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO17-1" href="#co_classes_and_objects_CO17-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>When comparing objects, strict comparison only resolves as <code>true</code> when the statements on either side of the comparison reference the same object. In this case, you’ve properly cloned your object and created an entirely new instance, so this comparison is <code>false</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO17-2" href="#co_classes_and_objects_CO17-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Loose type comparison between objects resolves as <code>true</code> when the <em>values</em> on either side of the operator are the same, even between discrete instances. This statement evaluates to <code>true</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO17-3" href="#co_classes_and_objects_CO17-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Since <code>clone</code> is a shallow operation, the <code>::$child</code> property on both of your objects points to the same child object in memory. This statement evaluates to <code>true</code>!</p></dd>
</dl></div>

<p>To support a deeper clone, the class being cloned must implement a <code>__clone()</code> magic method that tells PHP what to do when leveraging <code>clone</code>. If this method exists, PHP will invoke it automatically when closing an instance of the class. <a data-type="xref" href="#obj_nested_deep_clone">Example 8-20</a> shows exactly how this might work while still working with dynamic classes.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>It is not possible to dynamically define methods on instances of <code>stdClass</code>. If you want to support deep cloning of objects in your application, you must either define a class directly or leverage an <a data-type="indexterm" data-primary="cloning" data-secondary="deep cloning" id="idm45875153265648"></a><a data-type="indexterm" data-primary="deep cloning" id="idm45875153264800"></a>anonymous class, as illustrated by <a data-type="xref" href="#obj_nested_deep_clone">Example 8-20</a>.</p>
</div>
<div id="obj_nested_deep_clone" data-type="example">
<h5><span class="label">Example 8-20. </span>Deep cloning of objects</h5>

<pre data-type="programlisting" data-code-language="php">
<code>$parent = </code><code class="k">new class</code><code> </code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="nx">string</code><code> </code><code class="nv">$name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'parent'</code><code class="p">;</code><code>
    </code><code class="k">public</code><code> </code><code class="k">stdClass</code><code> </code><code class="nv">$child</code><code class="p">;</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__clone</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">child</code><code> </code><code class="o">=</code><code> </code><code class="k">clone</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">child</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">};</code><code>
</code><code class="nv">$parent</code><code class="o">-&gt;</code><code class="na">child</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">object</code><code class="p">)</code><code> </code><code class="p">[</code><code>
    </code><code class="s1">'name'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s1">'child'</code><code>
</code><code class="p">];</code><code>

</code><code class="nv">$clone</code><code> </code><code class="o">=</code><code> </code><code class="k">clone</code><code> </code><code class="nv">$parent</code><code class="p">;</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code> </code><code class="o">===</code><code> </code><code class="nv">$clone</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_chapter_title_CO1-1" href="#callout_chapter_title_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and clone are the same object!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code> </code><code class="o">==</code><code> </code><code class="nv">$clone</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_chapter_title_CO1-2" href="#callout_chapter_title_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and clone have the same data!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code class="o">-&gt;</code><code class="na">child</code><code> </code><code class="o">===</code><code> </code><code class="nv">$clone</code><code class="o">-&gt;</code><code class="na">child</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_chapter_title_CO1-3" href="#callout_chapter_title_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and the clone have the same child!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$parent</code><code class="o">-&gt;</code><code class="na">child</code><code> </code><code class="o">==</code><code> </code><code class="nv">$clone</code><code class="o">-&gt;</code><code class="na">child</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" id="co_chapter_title_CO1-4" href="#callout_chapter_title_CO1-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>
    </code><code class="k">echo</code><code> </code><code class="s1">'The parent and the clone have the same child data!'</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_chapter_title_CO1-1" href="#co_chapter_title_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The objects are different references; therefore, this evaluates to <code>false</code>.</p></dd>
<dt><a class="co" id="callout_chapter_title_CO1-2" href="#co_chapter_title_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The parent and clone objects have the same data, so this evaluates to <code>true</code>.</p></dd>
<dt><a class="co" id="callout_chapter_title_CO1-3" href="#co_chapter_title_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The <code>::$child</code> properties were also cloned internally, so the properties reference different object instances. This evaluates to <code>false</code>.</p></dd>
<dt><a class="co" id="callout_chapter_title_CO1-4" href="#co_chapter_title_CO1-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Both <code>::$child</code> properties contain the same data, so this evaluates to <code>true</code>.</p></dd>
</dl>
</div>

<p>In most applications, you will generally be working with custom class definitions and not anonymous classes. In that case, you can still implement the magic <code>__clone()</code> method to instruct PHP on <a data-type="indexterm" data-primary="objects" data-secondary="cloning" data-startref="bjccln" id="idm45875153158928"></a><a data-type="indexterm" data-primary="cloning" data-secondary="objects" data-startref="cngbjc" id="idm45875153157680"></a><a data-type="indexterm" data-primary="clone keyword" data-startref="clnkyw" id="idm45875153156464"></a><a data-type="indexterm" data-primary="keywords" data-secondary="clone" data-startref="kywdcln" id="idm45875153155520"></a>how to clone the more complex properties of your object where necessary.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875153637280">
<h2>See Also</h2>

<p>Documentation on the <a href="https://oreil.ly/LqOE2"><code>clone</code> keyword</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.11 Defining Static Properties and Methods"><div class="sect1" id="idm45875153151424">
<h1>8.11 Defining Static Properties and Methods</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875153150208">
<h2>Problem</h2>

<p>You want to define a method or property on a <a data-type="indexterm" data-primary="properties" data-secondary="static" id="ppstc"></a><a data-type="indexterm" data-primary="methods" data-secondary="static" id="mthdstt"></a><a data-type="indexterm" data-primary="static properties" id="sttppt"></a><a data-type="indexterm" data-primary="static methods" id="sttcmthd"></a>class that is available to all instances of that class.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875153144016">
<h2>Solution</h2>

<p>Use the <code>static</code> keyword to define <a data-type="indexterm" data-primary="static keyword" id="sttkyw"></a><a data-type="indexterm" data-primary="keywords" data-secondary="static" id="kywdstt"></a>properties or methods that can be accessed outside an object instance—for example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Foo</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">static</code> <code class="nx">int</code> <code class="nv">$counter</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

    <code class="k">public</code> <code class="k">static</code> <code class="k">function</code> <code class="nf">increment</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>
    <code class="p">{</code>
        <code class="nx">self</code><code class="o">::</code><code class="nv">$counter</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875153093360">
<h2>Discussion</h2>

<p>Static members of a class are accessible to any part of your code (assuming proper levels of visibility) directly from the class definition, whether or not an instance of that class exists as an object. Static properties are useful since they behave more or less like global variables but are scoped to a specific class definition. <a data-type="xref" href="#static_properties_vs_globals">Example 8-21</a> illustrates the difference in invoking a global variable versus a static class property in another function.</p>
<div id="static_properties_vs_globals" data-type="example">
<h5><span class="label">Example 8-21. </span>Static properties versus global variables</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">Foo</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">static</code><code> </code><code class="nx">string</code><code> </code><code class="nv">$name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Foo'</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$bar</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Bar'</code><code class="p">;</code><code>

</code><code class="k">function</code><code> </code><code class="nf">demonstration</code><code class="p">()</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">global</code><code> </code><code class="nv">$bar</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO18-1" href="#callout_classes_and_objects_CO18-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="k">echo</code><code> </code><code class="nx">Foo</code><code class="o">::</code><code class="nv">$name</code><code> </code><code class="o">.</code><code> </code><code class="nv">$bar</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO18-2" href="#callout_classes_and_objects_CO18-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO18-1" href="#co_classes_and_objects_CO18-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>To access a global variable within another scope, you must explicitly refer to the global scope. Given that you can have separate variables in a narrower scope that match the names of global variables, this can become potentially confusing in practice.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO18-2" href="#co_classes_and_objects_CO18-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>A class-scoped property, however, can be accessed directly based on the name of the class itself.</p></dd>
</dl></div>

<p>More usefully, static methods provide ways to invoke utility functionality bound to a class prior to instantiating an object of that class directly. One common example is when constructing value objects that should represent serialized data where it would be difficult to construct an object from scratch directly.</p>

<p><a data-type="xref" href="#static_method_instantiation">Example 8-22</a> demonstrates a class that does not allow for direct instantiation. Instead, you must create an instance by unserializing some fixed data. The constructor is inaccessible outside of the class’s interior scope, so a static method is the only means of creating an object.</p>
<div id="static_method_instantiation" data-type="example" class="pagebreak-before">
<h5><span class="label">Example 8-22. </span>Static method object instantiation</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">BinaryString</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">private</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="k">private</code><code> </code><code class="nx">string</code><code> </code><code class="nv">$bits</code><code class="p">)</code><code> </code><code class="p">{}</code><code> </code><a class="co" id="co_classes_and_objects_CO19-1" href="#callout_classes_and_objects_CO19-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="k">public</code><code> </code><code class="k">static</code><code> </code><code class="k">function</code><code> </code><code class="nf">fromHex</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$hex</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">self</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nx">self</code><code class="p">(</code><code class="nb">hex2bin</code><code class="p">(</code><code class="nv">$hex</code><code class="p">));</code><code> </code><a class="co" id="co_classes_and_objects_CO19-2" href="#callout_classes_and_objects_CO19-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">static</code><code> </code><code class="k">function</code><code> </code><code class="nf">fromBase64</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$b64</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">self</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nx">self</code><code class="p">(</code><code class="nb">base64_decode</code><code class="p">(</code><code class="nv">$b64</code><code class="p">));</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__toString</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">string</code><code> </code><a class="co" id="co_classes_and_objects_CO19-3" href="#callout_classes_and_objects_CO19-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nb">bin2hex</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">bits</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$rawData</code><code> </code><code class="o">=</code><code> </code><code class="s1">'48656c6c6f20776f726c6421'</code><code class="p">;</code><code>
</code><code class="nv">$binary</code><code> </code><code class="o">=</code><code> </code><code class="nx">BinaryString</code><code class="o">::</code><code class="na">fromHex</code><code class="p">(</code><code class="nv">$rawData</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO19-4" href="#callout_classes_and_objects_CO19-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO19-1" href="#co_classes_and_objects_CO19-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>A private constructor can be accessed only from within the class itself.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO19-2" href="#co_classes_and_objects_CO19-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Within a static method, you can still create a new object instance by leveraging the special <code>self</code> keyword to refer to the class. This permits you to access your private constructor.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO19-3" href="#co_classes_and_objects_CO19-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The magic <code>__toString()</code> method is invoked whenever PHP tries to coerce an object into a string directly (i.e., when you try to <code>echo</code> it to the console).</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO19-4" href="#co_classes_and_objects_CO19-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Rather than creating an object with the <code>new</code> keyword, leverage a purpose-built static deserialization method.</p></dd>
</dl></div>

<p>Both static methods and properties are subject to the same visibility constraints as their nonstatic peers. Note that marking either as <code>private</code> means they can only be referenced by one another or by nonstatic methods within the class itself.</p>

<p>As static methods and properties aren’t tied directly to an object instance, you can’t use regular object-bound accessors to reach them. Instead, leverage the class name directly and the scope resolution operator (a double colon, or <code>::</code>)—for example, <code>Foo::$bar</code> for properties or <code>Foo::bar()</code> for methods. Within the class definition itself, you can leverage <code>self</code> as a shorthand for the class name or <code>parent</code> as a shorthand for the parent class name (if using inheritance).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you have access to an object instance of the class, you can use that object’s name rather than the class name to access its static members as well. For example, you can use <code>$foo::bar()</code> to access the static <code>bar()</code> method on the class definition for the object named <code>$foo</code>. While this works, it can make it more difficult for other developers to understand what class definition you’re working with, so this <a data-type="indexterm" data-primary="properties" data-secondary="static" data-startref="ppstc" id="idm45875152838592"></a><a data-type="indexterm" data-primary="methods" data-secondary="static" data-startref="mthdstt" id="idm45875152837344"></a><a data-type="indexterm" data-primary="static properties" data-startref="sttppt" id="idm45875152836128"></a><a data-type="indexterm" data-primary="static methods" data-startref="sttcmthd" id="idm45875152835184"></a><a data-type="indexterm" data-primary="static keyword" data-startref="sttkyw" id="idm45875152834240"></a><a data-type="indexterm" data-primary="keywords" data-secondary="static" data-startref="kywdstt" id="idm45875152833296"></a>syntax should be used sparingly if at all.</p>
</div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875152831824">
<h2>See Also</h2>

<p>Documentation on the <a href="https://oreil.ly/tlxjn"><code>static</code> keyword</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.12 Introspecting Private Properties or Methods 
Within an Object"><div class="sect1" id="classes_reflection">
<h1>8.12 Introspecting Private Properties or Methods 
<span class="keep-together">Within an Object</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875152827280">
<h2>Problem</h2>

<p>You want to enumerate the <a data-type="indexterm" data-primary="objects" data-secondary="properties" data-tertiary="private" id="btpppv"></a><a data-type="indexterm" data-primary="objects" data-secondary="methods, private" id="btmtrv"></a><a data-type="indexterm" data-primary="properties" data-secondary="private" id="pppv"></a><a data-type="indexterm" data-primary="methods" data-secondary="private" id="thdsprv"></a>properties or methods of an object and leverage its private members.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875152820400">
<h2>Solution</h2>

<p>Use PHP’s Reflection API to enumerate <a data-type="indexterm" data-primary="Reflection API" id="rfctapi"></a>properties and methods. For example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="nv">$reflected</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">ReflectionClass</code><code class="p">(</code><code class="s1">'SuperSecretClass'</code><code class="p">);</code><code>

</code><code class="nv">$methods</code><code> </code><code class="o">=</code><code> </code><code class="nv">$reflected</code><code class="o">-&gt;</code><code class="na">getMethods</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO20-1" href="#callout_classes_and_objects_CO20-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$properties</code><code> </code><code class="o">=</code><code> </code><code class="nv">$reflected</code><code class="o">-&gt;</code><code class="na">getProperties</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO20-2" href="#callout_classes_and_objects_CO20-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875152792512">
<h2>Discussion</h2>

<p>PHP’s Reflection API grants developers vast power to inspect all elements of their application. You can enumerate methods, properties, constants, function arguments, and more. You can also ignore the privacy afforded to each at will and directly invoke private methods on objects. <a data-type="xref" href="#reflection_privacy">Example 8-23</a> illustrates how an explicitly private method can be invoked directly with the Reflection API.</p>
<div id="reflection_privacy" data-type="example">
<h5><span class="label">Example 8-23. </span>Using Reflection to violate class privacy</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">Foo</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">private</code><code> </code><code class="nx">int</code><code> </code><code class="nv">$counter</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO20-3" href="#callout_classes_and_objects_CO20-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">increment</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">counter</code><code> </code><code class="o">+=</code><code> </code><code class="mi">1</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">getCount</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">int</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">counter</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$instance</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Foo</code><code class="p">;</code><code>
</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">increment</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO20-4" href="#callout_classes_and_objects_CO20-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">increment</code><code class="p">();</code><code> </code><a class="co" id="co_classes_and_objects_CO20-5" href="#callout_classes_and_objects_CO20-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a><code>

</code><code class="k">echo</code><code> </code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">getCount</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO20-6" href="#callout_classes_and_objects_CO20-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a><code>

</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">counter</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO20-7" href="#callout_classes_and_objects_CO20-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a><code>

</code><code class="nv">$reflectionClass</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">ReflectionClass</code><code class="p">(</code><code class="s1">'Foo'</code><code class="p">);</code><code>
</code><code class="nv">$reflectionClass</code><code class="o">-&gt;</code><code class="na">getProperty</code><code class="p">(</code><code class="s1">'counter'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">setValue</code><code class="p">(</code><code class="nv">$instance</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">);</code><code> </code><a class="co" id="co_classes_and_objects_CO20-8" href="#callout_classes_and_objects_CO20-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a><code>

</code><code class="k">echo</code><code> </code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">getCount</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="nx">PHP_EOL</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO20-9" href="#callout_classes_and_objects_CO20-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO20-1" href="#co_classes_and_objects_CO20-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The example class has a single, private property to maintain an internal counter.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO20-2" href="#co_classes_and_objects_CO20-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>You want to increment the counter a bit past its default. Now it’s <code>1</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO20-3" href="#co_classes_and_objects_CO20-5"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>An additional increment sets the counter to <code>2</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO20-4" href="#co_classes_and_objects_CO20-6"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>At this point, printing out the counter’s state will confirm it’s <code>2</code>.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO20-5" href="#co_classes_and_objects_CO20-7"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Attempting to interact with the counter <em>directly</em> will result in a thrown <code>Error</code>, as the property is private.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO20-6" href="#co_classes_and_objects_CO20-8"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Through reflection, you can interact with object members regardless of their privacy setting.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO20-7" href="#co_classes_and_objects_CO20-9"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Now you demonstrate the counter was truly reset to <code>0</code>.</p></dd>
</dl></div>

<p>Reflection is a truly powerful way to get around visibility modifiers in the API exposed by a class. However, its use in a production application likely points to a poorly constructed interface or system. If your code needs access to a private member of a class, either that member should be public to begin with or you need to create an appropriate accessor method.</p>

<p>The only legitimate use of Reflection is in inspecting and modifying the internal state of an object. In an application, this behavior should be limited to the class’s exposed API. In <em>testing</em>, however, it might be necessary to modify an object’s state between test runs in ways the API doesn’t support during regular operation.<sup><a data-type="noteref" id="idm45875152569072-marker" href="ch08.html#idm45875152569072">12</a></sup> Those rare circumstances might require resetting internal counters or invoking otherwise private cleanup methods housed within the class. It’s then that Reflection proves its utility.</p>

<p>In regular application development, though, Reflection paired with functional calls like <a href="https://oreil.ly/HXVwr"><code>var_dump()</code></a> helps to disambiguate the internal operation of classes defined in imported vendor code. It might prove useful to introspect serialized objects or third-party integrations, but take care not to ship this <a data-type="indexterm" data-primary="objects" data-secondary="properties" data-tertiary="private" data-startref="btpppv" id="idm45875152566144"></a><a data-type="indexterm" data-primary="objects" data-secondary="methods, private" data-startref="btmtrv" id="idm45875152564656"></a><a data-type="indexterm" data-primary="properties" data-secondary="private" data-startref="pppv" id="idm45875152563440"></a><a data-type="indexterm" data-primary="methods" data-secondary="private" data-startref="thdsprv" id="idm45875152562224"></a><a data-type="indexterm" data-primary="Reflection API" data-startref="rfctapi" id="idm45875152561008"></a>kind of introspection to production.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875152559808">
<h2>See Also</h2>

<p>Overview of PHP’s <a href="https://oreil.ly/C49RP">Reflection API</a>.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="8.13 Reusing Arbitrary Code Between Classes"><div class="sect1" id="classes_traits">
<h1>8.13 Reusing Arbitrary Code Between Classes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45875152556080">
<h2>Problem</h2>

<p>You want to share a particular <a data-type="indexterm" data-primary="classes" data-secondary="code reuse" id="clcdrs"></a><a data-type="indexterm" data-primary="code reuse" id="cdrser"></a>piece of functionality between multiple classes without leveraging a class extension.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45875152552176">
<h2>Solution</h2>

<p>Import a Trait <a data-type="indexterm" data-primary="traits, importing" id="trtsmpt"></a><a data-type="indexterm" data-primary="use statement" id="usttmn"></a>with a <code>use</code> statement—for example:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><code class="nx">Logger</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">log</code><code class="p">(</code><code class="nx">string</code><code> </code><code class="nv">$message</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">void</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nb">error_log</code><code class="p">(</code><code class="nv">$message</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Account</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">use</code><code> </code><code class="nx">Logger</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO21-1" href="#callout_classes_and_objects_CO21-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="fm">__construct</code><code class="p">(</code><code class="k">public</code><code> </code><code class="nx">int</code><code> </code><code class="nv">$accountNumber</code><code class="p">)</code><code>
    </code><code class="p">{</code><code>
        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">log</code><code class="p">(</code><code class="s2">"</code><code class="s2">Created account </code><code class="si">{</code><code class="nv">$accountNumber</code><code class="si">}</code><code class="s2">.</code><code class="s2">"</code><code class="p">);</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">User</code><code> </code><code class="k">extends</code><code> </code><code class="nx">Person</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">use</code><code> </code><code class="nx">Logger</code><code class="p">;</code><code> </code><a class="co" id="co_classes_and_objects_CO21-2" href="#callout_classes_and_objects_CO21-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>

    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">authenticate</code><code class="p">()</code><code class="o">:</code><code> </code><code class="nx">bool</code><code>
    </code><code class="p">{</code><code>
        </code><code class="c1">// ...
</code><code>        </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">log</code><code class="p">(</code><code class="s2">"</code><code class="s2">User </code><code class="si">{</code><code class="nv">$userId</code><code class="si">}</code><code class="s2"> logged in.</code><code class="s2">"</code><code class="p">);</code><code>
        </code><code class="c1">// ...
</code><code>    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO21-1" href="#co_classes_and_objects_CO21-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The <code>Account</code> class imports the logging functionality from your <code>Logger</code> trait and can use its methods as if they were native to its own definition.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO21-2" href="#co_classes_and_objects_CO21-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Likewise, the <code>User</code> class has native-level access to <code>Logger</code>’s methods, even though it extends a base <code>Person</code> class with additional functionality.</p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45875152449712">
<h2>Discussion</h2>

<p>As discussed in <a data-type="xref" href="#class_inheritance">Recipe 8.6</a>, a class in PHP can descend from at most one other class. This is referred <a data-type="indexterm" data-primary="inheritance" data-secondary="single inheritance" id="idm45875152447152"></a><a data-type="indexterm" data-primary="single inheritance" id="idm45875152402432"></a>to as <em>single inheritance</em> and is a characteristic of languages other than PHP as well. Luckily, PHP exposes an additional mechanism for code reuse called <em>Traits</em>. Traits allow for the encapsulation of some functionality in a separate class-like definition that can be easily imported without breaking single inheritance.</p>

<p>A Trait looks somewhat like a class but cannot be instantiated directly. Instead, the methods defined by a Trait are imported into another class definition by the <code>use</code> statement. This permits code reuse between classes that do not share an inheritance tree.</p>

<p>Traits empower you to define common methods (with differing method visibility) and properties that are shared between definitions. You can also override the default visibility from a Trait in the class that imports it. <a data-type="xref" href="#trait_visibility_override">Example 8-24</a> shows how an otherwise public method defined in a Trait can be imported as a protected or even private method in another class.</p>
<div id="trait_visibility_override" data-type="example">
<h5><span class="label">Example 8-24. </span>Overriding the visibility of methods defined in a Trait</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><code class="nx">Foo</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">bar</code><code class="p">()</code><code>
    </code><code class="p">{</code><code>
        </code><code class="k">echo</code><code> </code><code class="s1">'Hello World!'</code><code class="p">;</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">A</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">use</code><code> </code><code class="nx">Foo</code><code> </code><code class="p">{</code><code> </code><code class="nx">bar</code><code> </code><code class="k">as</code><code> </code><code class="k">protected</code><code class="p">;</code><code> </code><code class="p">}</code><code> </code><a class="co" id="co_classes_and_objects_CO22-1" href="#callout_classes_and_objects_CO22-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">B</code><code>
</code><code class="p">{</code><code>
    </code><code class="k">use</code><code> </code><code class="nx">Foo</code><code> </code><code class="p">{</code><code> </code><code class="nx">bar</code><code> </code><code class="k">as</code><code> </code><code class="k">private</code><code class="p">;</code><code> </code><code class="p">}</code><code> </code><a class="co" id="co_classes_and_objects_CO22-2" href="#callout_classes_and_objects_CO22-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_classes_and_objects_CO22-1" href="#co_classes_and_objects_CO22-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This syntax will import every method defined in <code>Foo</code> but will explicitly make its <code>::bar()</code> method protected within the scope of class <code>A</code>. This means only instances of class <code>A</code> (or its descendants) will be able to invoke the method.</p></dd>
<dt><a class="co" id="callout_classes_and_objects_CO22-2" href="#co_classes_and_objects_CO22-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Likewise, class <code>B</code> changes the visibility of its imported <code>::foo()</code> method to private so only instances of <code>B</code> can access that method directly.</p></dd>
</dl></div>

<p>Traits can be composed together as deeply as you want, meaning a Trait can <code>use</code> another Trait just as easily as a class can. Likewise, there is no limit to the number of Traits that can be imported either by other Traits or by class definitions.</p>

<p>If the class importing a Trait (or multiple Traits) defines a method also named in the Trait, then the class’s version takes precedence and is used by default. <a data-type="xref" href="#trait_precedence">Example 8-25</a> illustrates how this precedence works by default.</p>
<div id="trait_precedence" data-type="example">
<h5><span class="label">Example 8-25. </span>Method precedence in Traits</h5>

<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code> <code class="nx">Foo</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">bar</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'FooBar'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Bar</code>
<code class="p">{</code>
    <code class="k">use</code> <code class="nx">Foo</code><code class="p">;</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">bar</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'BarFoo'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Bar</code><code class="p">;</code>
<code class="k">echo</code> <code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">bar</code><code class="p">();</code> <code class="c1">// BarFoo</code></pre></div>

<p>In some circumstances, you might import <a data-type="indexterm" data-primary="traits, importing" data-startref="trtsmpt" id="idm45875152277680"></a><a data-type="indexterm" data-primary="use statement" data-startref="usttmn" id="idm45875152256672"></a>multiple Traits that all define the same method. In those situations, you can explicitly identify which version of a method you want to leverage in your final class when you define your <code>use</code> statement as 
<span class="keep-together">follows</span>:</p>

<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code> <code class="nx">A</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">hello</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'Hello'</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">public</code> <code class="k">function</code> <code class="nf">world</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'Universe'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">trait</code> <code class="nx">B</code>
<code class="p">{</code>
    <code class="k">public</code> <code class="k">function</code> <code class="nf">world</code><code class="p">()</code><code class="o">:</code> <code class="nx">string</code>
    <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'World'</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Demonstration</code>
<code class="p">{</code>
    <code class="k">use</code> <code class="nx">A</code><code class="p">,</code> <code class="nx">B</code> <code class="p">{</code>
        <code class="nx">B</code><code class="o">::</code><code class="na">world</code> <code class="nx">insteadof</code> <code class="nx">A</code><code class="p">;</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$instance</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Demonstration</code><code class="p">;</code>
<code class="k">echo</code> <code class="s2">"</code><code class="si">{</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">hello</code><code class="p">()</code><code class="si">}</code><code class="s2"> </code><code class="si">{</code><code class="nv">$instance</code><code class="o">-&gt;</code><code class="na">world</code><code class="p">()</code><code class="si">}</code><code class="s2">!"</code><code class="p">;</code> <code class="c1">// Hello World!</code></pre>

<p>Like class definitions, Traits can also define properties or even static members. They provide an efficient means by which you can abstract operational logic definitions into reusable code <a data-type="indexterm" data-primary="classes" data-secondary="code reuse" data-startref="clcdrs" id="idm45875152135648"></a><a data-type="indexterm" data-primary="code reuse" data-startref="cdrser" id="idm45875152192400"></a>blocks and share that logic between classes in your application.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45875152449120">
<h2>See Also</h2>

<p>Documentation on <a href="https://oreil.ly/syk0E">Traits</a>.</p>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45875158208880"><sup><a href="ch08.html#idm45875158208880-marker">1</a></sup> PHP 3 included some primitive object functionality, but the language wasn’t really considered object-oriented by most developers until the delivery of 4.0.</p><p data-type="footnote" id="idm45875157813808"><sup><a href="ch08.html#idm45875157813808-marker">2</a></sup> At the time of this writing, WordPress was used to power <a href="https://oreil.ly/tEaN8">43% of all websites</a>.</p><p data-type="footnote" id="idm45875157805424"><sup><a href="ch08.html#idm45875157805424-marker">3</a></sup> Libraries and extensions are discussed at length in <a data-type="xref" href="ch15.html#chapter_extensions">Chapter 15</a>.</p><p data-type="footnote" id="idm45875157792800"><sup><a href="ch08.html#idm45875157792800-marker">4</a></sup> See <a data-type="xref" href="#classes_reflection">Recipe 8.12</a> for more on the Reflection API.</p><p data-type="footnote" id="idm45875157450624"><sup><a href="ch08.html#idm45875157450624-marker">5</a></sup> Review <a data-type="xref" href="#property_and_method_visibility">“Visibility”</a> for more background on visibility within classes.</p><p data-type="footnote" id="idm45875157386544"><sup><a href="ch08.html#idm45875157386544-marker">6</a></sup> See <a data-type="xref" href="#read_only_properties">Recipe 8.3</a> for details on how these properties could further be made read-only.</p><p data-type="footnote" id="idm45875156595712"><sup><a href="ch08.html#idm45875156595712-marker">7</a></sup> See <a data-type="xref" href="ch03.html#argument_and_return_typing">Recipe 3.4</a> for more on strict type enforcement.</p><p data-type="footnote" id="idm45875155649632"><sup><a href="ch08.html#idm45875155649632-marker">8</a></sup> For more on property and method visibility, review <a data-type="xref" href="#property_and_method_visibility">“Visibility”</a>.</p><p data-type="footnote" id="idm45875154877776"><sup><a href="ch08.html#idm45875154877776-marker">9</a></sup> Review <a data-type="xref" href="#class_inheritance">Recipe 8.6</a> for more on class inheritance and extension.</p><p data-type="footnote" id="idm45875154437296"><sup><a href="ch08.html#idm45875154437296-marker">10</a></sup> See <a data-type="xref" href="#class_inheritance">Recipe 8.6</a> for more on class inheritance.</p><p data-type="footnote" id="idm45875154091840"><sup><a href="ch08.html#idm45875154091840-marker">11</a></sup> See <a data-type="xref" href="#class_interfaces">Recipe 8.7</a> for more on interfaces.</p><p data-type="footnote" id="idm45875152569072"><sup><a href="ch08.html#idm45875152569072-marker">12</a></sup> Both testing and debugging are discussed at length in <a data-type="xref" href="ch13.html#chapter_debugging">Chapter 13</a>.</p></div></div></section></div>
</div>
</body>
</html>