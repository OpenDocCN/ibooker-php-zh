<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. Web Techniques"><div class="chapter" id="web_techniques">
<h1><span class="label">Chapter 8. </span>Web Techniques</h1>
<p>PHP was designed as a web-scripting language and, although it is possible to use it in purely command-line and GUI scripts, the web accounts for the vast majority of PHP uses. A dynamic website may have forms, sessions, and sometimes redirection, and this chapter explains how to implement those elements in PHP. You’ll learn how PHP provides access to form parameters and uploaded files, how to send cookies and redirect the browser, how to use PHP sessions, and more.</p>
<section data-type="sect1" data-pdf-bookmark="HTTP Basics"><div class="sect1" id="http_basics">
<h1>HTTP Basics</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="basics" id="ix_http_basics_ch8"/>The web runs on HTTP, or Hypertext Transfer Protocol. This protocol governs how web browsers request files from web servers and how the servers send the files back. To understand the various techniques we’ll show you in this chapter, you need to have a basic understanding of HTTP. <a contenteditable="false" data-type="indexterm" data-primary="Wong, Clinton (author)" data-secondary="HTTP Pocket Reference (O'Reilly)" id="idm45922769505432"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP Pocket Reference (O'Reilly)" id="idm45922769504216"/>For a more thorough discussion of HTTP, see the <a class="orm:hideurl" href="http://oreil.ly/HTTP_PocketRef"><em>HTTP Pocket Reference</em></a> (O’Reilly) by Clinton Wong.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="response, HTTP and web server" id="idm45922769501864"/><a contenteditable="false" data-type="indexterm" data-primary="web server" data-secondary="HTTP requests sent to" id="idm45922769500888"/>When a web browser requests a web page, it sends an HTTP request message to a web server. The request message always includes some header information, and it sometimes also includes a body. The web server responds with a reply message, which always includes header information and usually contains a body. The first line of an HTTP request looks like this:</p>
<pre data-type="programlisting">GET /index.html HTTP/1.1</pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="headers, HTTP" data-secondary="request headers" id="idm45922769498296"/>This line specifies an HTTP command, called a <a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="methods" id="idm45922769496728"/><em>method</em>, followed by the address of a document and the version of the HTTP protocol being used. In this case, the request is using the <a contenteditable="false" data-type="indexterm" data-primary="methods, HTTP" data-secondary="GET method" id="idm45922769494984"/><a contenteditable="false" data-type="indexterm" data-primary="GET method, HTTP" id="idm45922769493768"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="methods" id="idm45922769492792"/><code>GET</code> method to ask for the <em>index.html</em> document using HTTP 1.1. After this initial line, the request can contain optional header information that gives the server additional data about the request.</p>
<p class="pagebreak-before">For example:</p>
<pre data-type="programlisting">User-Agent: Mozilla/5.0 (Windows 2000; U) Opera 6.0 [en]
Accept: image/gif, image/jpeg, text/*, */*</pre>
<p>The <code>User-Agent</code> header provides information about the web browser, while the <a contenteditable="false" data-type="indexterm" data-primary="Accept header" id="idm45922769488632"/><code>Accept</code> header specifies the MIME types that the browser accepts. After any headers, the request contains a blank line to indicate the end of the header section. The request can also contain additional data, if that is appropriate for the method being used (e.g., with the <code>POST</code> method, as we’ll discuss shortly). If the request doesn’t contain any data, it ends with a blank line.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="web server" data-secondary="HTTP response sent from" id="idm45922769486216"/><a contenteditable="false" data-type="indexterm" data-primary="headers, HTTP" data-secondary="response headers" id="idm45922769485000"/>The web server receives the request, processes it, and sends a response. The first line of an HTTP response looks like this:</p>
<pre data-type="programlisting">HTTP/1.1 200 OK</pre>
<p>This line specifies the protocol version, a status code, and a description of that code. In this case, the status code is <code>200</code>, meaning that the request was successful (hence the description <code>OK</code>). After the status line, the response contains headers that give the client additional information about the response. For example:</p>
<pre data-type="programlisting">Date: Sat, 29 June 2019 14:07:50 GMT
Server: Apache/2.2.14 (Ubuntu)
Content-Type: text/html
Content-Length: 1845</pre>
<p>The <a contenteditable="false" data-type="indexterm" data-primary="Server header" id="idm45922769480312"/><code>Server</code> header provides information about the web server software, while the <a contenteditable="false" data-type="indexterm" data-primary="Content-Type header" id="idm45922769478952"/><code>Content-Type</code> header specifies the MIME type of the data included in the response. After the headers, the response contains a blank line, followed by the requested data if the request was successful.</p>
<p>The two most common HTTP methods are <code>GET</code> and <code>POST</code>. The <code>GET</code> method is designed for retrieving information, such as a document, an image, or the results of a database query, from the server. The <a contenteditable="false" data-type="indexterm" data-primary="methods, HTTP" data-secondary="POST method" id="idm45922769475288"/><code>POST</code> method is meant for posting information, such as a credit card number or information to be stored in a database, to the server. The <code>GET</code> method is what a web browser uses when the user types in a URL or clicks on a link. When the user submits a form, either the <code>GET</code> or <code>POST</code> method can be used, as specified by the <code>method</code> attribute of the <code>form</code> tag. We’ll discuss the <code>GET</code> and <code>POST</code> methods in more detail in the section “Processing Forms”.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_basics_ch8" id="idm45922769470712"/></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Variables"><div class="sect1" id="variables-id00046">
<h1>Variables</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="web server" data-secondary="variables for" id="idm45922769468264"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="variables for" id="idm45922769466824"/><a contenteditable="false" data-type="indexterm" data-primary="variables" data-secondary="for HTTP" data-secondary-sortas="HTTP" id="idm45922769465608"/>Server configuration and request information—including form parameters and cookies—are accessible in three different ways from your PHP scripts. Collectively, this information is referred to as <a contenteditable="false" data-type="indexterm" data-primary="EGPCS (environment, GET, POST, cookies, server)" id="idm45922769463816"/><em>EGPCS</em> (short for <em>environment</em>, <code>GET</code>, <code>POST</code>, <em>cookies</em>, and <em>server</em>).</p>
<p>PHP creates six global arrays that contain the EGPCS information:</p>
<dl>
<dt><code>$_ENV</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="entities" data-secondary="$_ENV array" id="idm45922769458456"/>Contains the values of any environment variables, where the keys of the array are the names of the environment variables.</dd>
<dt><code>$_GET</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="$_GET array" id="idm45922769455944"/>Contains any parameters that are part of a <code>GET</code> request, where the keys of the array are the names of the form parameters.</dd>
<dt><code>$_COOKIE</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="$_COOKIE array" id="idm45922769453432"/>Contains any cookie values passed as part of the request, where the keys of the array are the names of the cookies.</dd>
<dt><code>$_POST</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="$_POST array" id="idm45922769451208"/>Contains any parameters that are part of a <code>POST</code> request, where the keys of the array are the names of the form parameters.</dd>
<dt><code>$_SERVER</code></dt>
<dd>Contains useful information about the web server, as described in the next <span class="keep-together">section.</span></dd>
<dt><code>$_FILES</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="$_FILES array" id="idm45922769447080"/>Contains information about any uploaded files.</dd>
</dl>
<p>These variables are not only global, but also visible from within function definitions. The <a contenteditable="false" data-type="indexterm" data-primary="$_REQUEST array" id="idm45922769445416"/><code>$_REQUEST</code> array is created by PHP automatically and contains the elements of the <code>$_GET</code>, <code>$_POST</code>, and <code>$_COOKIE</code> arrays all in one array variable.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Server Information"><div class="sect1" id="server_information">
<h1>Server Information</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="$_SERVER array" id="ix_server_array_ch8"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="server information" id="ix_http_server_info"/><a contenteditable="false" data-type="indexterm" data-primary="web server" data-secondary="information from ($_SERVER)" id="ix_webserver_info_ch8"/>The <code>$_SERVER</code> array contains a lot of useful information from the web server, much of which comes from the environment variables required in the <a href="http://bit.ly/Vw912h">Common Gateway Interface (CGI) specification</a>). Here is a complete list of the <code>$_SERVER</code> entries that come from CGI, including some example values:</p>
<dl>
<dt><code>PHP_SELF</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="PHP_SELF element, $_SERVER array" id="idm45922769432392"/>The name of the current script, relative to the document root (e.g., <code>/store/cart.php</code>). You have already seen this used in some of the sample code in earlier chapters. This variable is useful when creating self-referencing scripts, as we’ll see later.</dd>
<dt><code>SERVER_SOFTWARE</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="SERVER_SOFTWARE element, $_SERVER array" id="idm45922769429608"/>A string that identifies the server (e.g., <code>"Apache/1.3.33 (Unix) mod_perl/1.26 PHP/5.0.4"</code>).</dd>
<dt><code>SERVER_NAME</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="SERVER_NAME element, $_SERVER array" id="idm45922769427000"/>The hostname, DNS alias, or IP address for self-referencing URLs (e.g., <code>www.</code><span class="keep-together"><code>example.com</code></span>).</dd>
<dt><code>GATEWAY_INTERFACE</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="GATEWAY_INTERFACE element, $_SERVER array" id="idm45922769423608"/>The version of the CGI standard being followed (e.g., <code>CGI/1.1</code>).</dd>
<dt><code>SERVER_PROTOCOL</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="SERVER_PROTOCOL element, $_SERVER array" id="idm45922769420968"/>The name and revision of the request protocol (e.g., <code>HTTP/1.1</code>).</dd>
<dt><code>SERVER_PORT</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="SERVER_PORT element, $_SERVER array" id="idm45922769418392"/>The server port number to which the request was sent (e.g., <code>80</code>).</dd>
<dt><code>REQUEST_METHOD</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="REQUEST_METHOD element, $_SERVER array" id="idm45922769415800"/>The method the client used to fetch the document (e.g., <code>GET</code>).</dd>
<dt><code>PATH_INFO</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="PATH_INFO element, $_SERVER array" id="idm45922769413208"/>Extra path elements given by the client (e.g., <code>/list/users</code>).</dd>
<dt><code>PATH_TRANSLATED</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="PATH_TRANSLATED element, $_SERVER array" id="idm45922769410632"/>The value of <code>PATH_INFO</code>, translated by the server into a filename (e.g., <code>/home/httpd/htdocs/list/users</code>).</dd>
<dt><code>SCRIPT_NAME</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="SCRIPT_NAME element, $_SERVER array" id="idm45922769407640"/>The URL path to the current page, which is useful for self-referencing scripts (e.g., <code>/~me/menu.php</code>).</dd>
<dt><code>QUERY_STRING</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="QUERY_STRING element, $_SERVER array" id="idm45922769405128"/>Everything after the <code>?</code> in the URL (e.g., <code>name=Fred+age=35</code>).</dd>
<dt><code>REMOTE_HOST</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="REMOTE_HOST element, $_SERVER array" id="idm45922769402136"/>The hostname of the machine that requested this page (e.g., <code>http://dialup-192-168-0-1.example.com</code>). If there’s no DNS for the machine, this is blank and <code>REMOTE_ADDR</code> is the only information given.</dd>
<dt><code>REMOTE_ADDR</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="REMOTE_ADDR element, $_SERVER array" id="idm45922769399112"/>A string containing the IP address of the machine that requested this page (e.g., <code>"192.168.0.250"</code>).</dd>
<dt><code>AUTH_TYPE</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="AUTH_TYPE element, $_SERVER array" id="idm45922769396504"/>The authentication method used to protect the page, if the page is password-protected (e.g., <code>basic</code>).</dd>
<dt><code>REMOTE_USER</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="REMOTE_USER element, $_SERVER array" id="idm45922769393880"/>The username with which the client authenticated, if the page is password-protected (e.g., <code>fred</code>). Note that there’s no way to find out what password was used.</dd>
</dl>
<p>The Apache server also creates entries in the <code>$_SERVER</code> array for each <a contenteditable="false" data-type="indexterm" data-primary="headers, HTTP" data-secondary="request headers" id="idm45922769391464"/>HTTP header in the request. For each key, the header name is converted to uppercase, hyphens (<code>-</code>) are turned into underscores (<code>_</code>), and the string <code>"HTTP_"</code> is prepended. For example, the entry for the <a contenteditable="false" data-type="indexterm" data-primary="User-Agent header" id="idm45922769388472"/><code>User-Agent</code> header has the key <code>"HTTP_USER_AGENT"</code>. The two most common and useful headers are:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_webserver_info_ch8" id="idm45922769386440"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_sessions" id="idm45922769385064"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_server_info" id="idm45922769383688"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_server_array_ch8" id="idm45922769382312"/></p>
<dl>
<dt><code>HTTP_USER_AGENT</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="HTTP_USER_AGENT element, $_SERVER array" id="idm45922769379784"/>The string the browser used to identify itself (e.g., <code>"Mozilla/5.0 (Windows 2000; U) Opera 6.0 [en]"</code>).</dd>
<dt><code>HTTP_REFERER</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="HTTP_REFERER element, $_SERVER array" id="idm45922769377176"/>The page the browser said it came from to get to the current page (e.g., <code>http://www.example.com/last_page.html</code>).</dd>
</dl>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Processing Forms"><div class="sect1" id="processing_forms">
<h1>Processing Forms</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="forms" id="ix_forms_ch8"/>It’s easy to process forms with PHP, as the form parameters are available in the <a contenteditable="false" data-type="indexterm" data-primary="$_GET array" id="idm45922769371896"/><code>$_GET</code> and <a contenteditable="false" data-type="indexterm" data-primary="$_POST array" id="idm45922769370376"/><code>$_POST</code> arrays. This section describes some tricks and techniques that will make it even easier.</p>
<section data-type="sect2" data-pdf-bookmark="Methods"><div class="sect2" id="methods">
<h2>Methods</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="methods for" id="idm45922769366776"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="methods" id="idm45922769365176"/><a contenteditable="false" data-type="indexterm" data-primary="methods, HTTP" data-secondary="POST method" id="idm45922769363832"/>As we already discussed, there are two HTTP methods that a client can use to pass form data to the server: <code>GET</code> and <code>POST</code>. The method that a particular form uses is specified with the <code>method</code> attribute to the <code>form</code> tag. In theory, methods are case-insensitive in HTML, but in practice some broken browsers require the method name to be in all uppercase.<a contenteditable="false" data-type="indexterm" data-primary="? (question mark)" data-secondary="preceding query string in GET request" id="idm45922769360232"/></p>
<p><a contenteditable="false" data-type="indexterm" data-primary="query string" id="idm45922769358760"/><a contenteditable="false" data-type="indexterm" data-primary="question mark (?)" data-secondary="preceding query string in GET request" id="idm45922769357624"/>A <code>GET</code> request encodes the form parameters in the URL in a <em>query string</em>, which is indicated by the text that follows the <code>?</code>:</p>
<pre data-type="programlisting" data-code-language="php"><code class="o">/</code><code class="nx">path</code><code class="o">/</code><code class="nx">to</code><code class="o">/</code><code class="nx">chunkify</code><code class="o">.</code><code class="nx">php</code><code class="o">?</code><code class="nx">word</code><code class="o">=</code><code class="nx">despicable</code><code class="o">&amp;</code><code class="nx">length</code><code class="o">=</code><code class="mi">3</code></pre>
<p>A <code>POST</code> request passes the form parameters in the body of the HTTP request, leaving the URL untouched.</p>
<p>The most visible difference between <a contenteditable="false" data-type="indexterm" data-primary="GET method, HTTP" id="idm45922769344504"/><code>GET</code> and <code>POST</code> is the URL line. Because all of a form’s parameters are encoded in the URL with a <a contenteditable="false" data-type="indexterm" data-primary="methods, HTTP" data-secondary="GET method" id="idm45922769342600"/><code>GET</code> request, users can bookmark <code>GET</code> queries. They cannot do this with <code>POST</code> requests, however.</p>
<p>The biggest difference between <code>GET</code> and <a contenteditable="false" data-type="indexterm" data-primary="methods, HTTP" data-secondary="POST method" id="idm45922769331640"/><a contenteditable="false" data-type="indexterm" data-primary="POST method, HTTP" id="idm45922769330232"/><code>POST</code> requests, however, is far subtler. The HTTP specification says that <code>GET</code> requests are <a contenteditable="false" data-type="indexterm" data-primary="idempotence" id="idm45922769328296"/><em>idempotent</em>—that is, one <code>GET</code> request for a particular URL, including form parameters, is the same as two or more requests for that URL. Thus, web browsers can cache the response pages for <code>GET</code> requests, because the response page doesn’t change regardless of how many times the page is loaded. Because of idempotence, <code>GET</code> requests should be used only for queries such as splitting a word into smaller chunks or multiplying numbers, where the response page is never going to change.</p>
<p><code>POST</code> requests are not idempotent. This means that they cannot be cached, and the server is contacted every time the page is displayed. You’ve probably seen your web browser prompt you with “Repost form data?” before displaying or reloading certain pages. This makes <code>POST</code> requests the appropriate choice for queries whose response pages may change over time—for example, displaying the contents of a shopping cart or the current messages in a bulletin board.</p>
<p>That said, idempotence is often ignored in the real world. Browser caches are generally so poorly implemented, and the Reload button so easy to hit, that programmers tend to use <code>GET</code> and <code>POST</code> simply based on whether they want the query parameters shown in the URL or not. What you need to remember is that <code>GET</code> requests should not be used for any actions that cause a change in the server, such as placing an order or updating a database.</p>
<p>The type of method that was used to request a PHP page is available through <a contenteditable="false" data-type="indexterm" data-primary="REQUEST_METHOD element, $_SERVER array" id="idm45922769320904"/><code>$_SERVER['REQUEST_METHOD']</code>. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">if</code> <code class="p">(</code><code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'REQUEST_METHOD'</code><code class="p">]</code> <code class="o">==</code> <code class="s1">'GET'</code><code class="p">)</code> <code class="p">{</code>
 <code class="c1">// handle a GET request</code>
<code class="p">}</code>
<code class="k">else</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="s2">"You may only GET this page."</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Parameters"><div class="sect2" id="parameters">
<h2>Parameters</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="parameters" data-secondary="form" id="ix_parameters_forms"/><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="parameters" id="ix_forms_parameters"/>Use the <code>$_POST</code>, <code>$_GET</code>, and <code>$_FILES</code> arrays to access form parameters from your PHP code. The keys are the parameter names, and the values are the values of those parameters. Because periods are legal in HTML field names but not in PHP variable names, periods in field names are converted to underscores (<code>_</code>) in the array.</p>
<p><a data-type="xref" href="#example_eight_onedot_the_chunkify_form">Example 8-1</a> shows an HTML form that chunkifies a string supplied by the user. The form contains two fields: one for the string (parameter name <code>word</code>) and one for the size of chunks to produce (parameter name <code>number</code>).</p>
<div data-type="example" id="example_eight_onedot_the_chunkify_form">
<h5><span class="label">Example 8-1. </span>The chunkify form (chunkify.html)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
 <code class="nt">&lt;head&gt;&lt;title&gt;</code>Chunkify Form<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>

 <code class="nt">&lt;body&gt;</code>
 <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"chunkify.php"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
 Enter a word: <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"word"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>

 How long should the chunks be?
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"number"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Chunkify!"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;/form&gt;</code>
<code class="nt">&lt;/body&gt;</code>

<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p><a data-type="xref" href="#example_eight_twodot_the_chunkify_scrip">Example 8-2</a> lists the PHP script, <em>chunkify.php</em>, to which the form in <a data-type="xref" href="#example_eight_onedot_the_chunkify_form">Example 8-1</a> submits. The script copies the parameter values into variables and uses them.</p>
<div data-type="example" id="example_eight_twodot_the_chunkify_scrip">
<h5><span class="label">Example 8-2. </span>The chunkify script (chunkify.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code>
<code class="nv">$word</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'word'</code><code class="p">];</code>
<code class="nv">$number</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'number'</code><code class="p">];</code>

<code class="nv">$chunks</code> <code class="o">=</code> <code class="nb">ceil</code><code class="p">(</code><code class="nb">strlen</code><code class="p">(</code><code class="nv">$word</code><code class="p">)</code> <code class="o">/</code> <code class="nv">$number</code><code class="p">);</code>

<code class="k">echo</code> <code class="s2">"The </code><code class="si">{</code><code class="nv">$number</code><code class="si">}</code><code class="s2">-letter chunks of '</code><code class="si">{</code><code class="nv">$word</code><code class="si">}</code><code class="s2">' are:&lt;br /&gt;</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code>

<code class="k">for</code> <code class="p">(</code><code class="nv">$i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$i</code> <code class="o">&lt;</code> <code class="nv">$chunks</code><code class="p">;</code> <code class="nv">$i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$chunk</code> <code class="o">=</code> <code class="nb">substr</code><code class="p">(</code><code class="nv">$word</code><code class="p">,</code> <code class="nv">$i</code> <code class="o">*</code> <code class="nv">$number</code><code class="p">,</code> <code class="nv">$number</code><code class="p">);</code>
 <code class="nb">printf</code><code class="p">(</code><code class="s2">"%d: %s&lt;br /&gt;</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$i</code> <code class="o">+</code> <code class="mi">1</code><code class="p">,</code> <code class="nv">$chunk</code><code class="p">);</code>
<code class="p">}</code>
<code class="cp">?&gt;</code></pre>
</div>
<p><a data-type="xref" href="#the_chunkify_form_and_its_output">Figure 8-1</a> shows both the chunkify form and the resulting output.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_parameters" id="idm45922769099512"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_parameters_forms" id="idm45922769098376"/></p>
<figure><div id="the_chunkify_form_and_its_output" class="figure">
<img src="Images/php4_0801.png" alt="The chunkify form and its output" width="1002" height="519"/>
<h6><span class="label">Figure 8-1. </span>The chunkify form and its output</h6>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Self-Processing Pages"><div class="sect2" id="self_processing_pages">
<h2>Self-Processing Pages</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="self-processing forms" id="idm45922769093208"/><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="self-processing" id="ix_forms_self-process"/>One PHP page can be used to both generate a form and subsequently process it. If the page shown in <a data-type="xref" href="#example_eight_threedot_a_self_processin">Example 8-3</a> is requested with the <code>GET</code> method, it prints a form that accepts a Fahrenheit temperature. If called with the <code>POST</code> method, however, the page calculates and displays the corresponding Celsius temperature.</p>
<div data-type="example" id="example_eight_threedot_a_self_processin">
<h5><span class="label">Example 8-3. </span>A self-processing temperature conversion page (temp.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Temperature Conversion<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="cp">&lt;?php</code> <code class="k">if</code> <code class="p">(</code><code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'REQUEST_METHOD'</code><code class="p">]</code> <code class="o">==</code> <code class="s1">'GET'</code><code class="p">)</code> <code class="p">{</code> <code class="cp">?&gt;</code>
 <code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">]</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
 Fahrenheit temperature:
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"fahrenheit"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Convert to Celsius!"</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;/form&gt;</code>

<code class="cp">&lt;?php</code> <code class="p">}</code>
<code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'REQUEST_METHOD'</code><code class="p">]</code> <code class="o">==</code> <code class="s1">'POST'</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$fahrenheit</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'fahrenheit'</code><code class="p">];</code>
 <code class="nv">$celsius</code> <code class="o">=</code> <code class="p">(</code><code class="nv">$fahrenheit</code> <code class="o">-</code> <code class="mi">32</code><code class="p">)</code> <code class="o">*</code> <code class="mi">5</code> <code class="o">/</code> <code class="mi">9</code><code class="p">;</code>

 <code class="nb">printf</code><code class="p">(</code><code class="s2">"%.2fF is %.2fC"</code><code class="p">,</code> <code class="nv">$fahrenheit</code><code class="p">,</code> <code class="nv">$celsius</code><code class="p">);</code>
<code class="p">}</code>
<code class="k">else</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="s2">"This script only works with GET and POST requests."</code><code class="p">);</code>
<code class="p">}</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p><a data-type="xref" href="#the_temperature_conversion_page_and_its">Figure 8-2</a> shows the temperature-conversion page and the resulting output.</p>
<figure><div id="the_temperature_conversion_page_and_its" class="figure">
<img src="Images/php4_0802.png" alt="The temperature-conversion page and its output" width="616" height="412"/>
<h6><span class="label">Figure 8-2. </span>The temperature-conversion page and its output</h6>
</div></figure>
<p>Another way for a script to decide whether to display a form or process it is to see whether or not one of the parameters has been supplied. This lets you write a self-processing page that uses the <code>GET</code> method to submit values. <a data-type="xref" href="#example_eight_fourdot_temperature_conve">Example 8-4</a> shows a new version of the temperature-conversion page that submits parameters using a <code>GET</code> request. This page uses the presence or absence of parameters to determine what to do.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_self-process" id="idm45922768826728"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_self-process_forms" id="idm45922768825352"/></p>
<div data-type="example" id="example_eight_fourdot_temperature_conve">
<h5><span class="label">Example 8-4. </span>Temperature conversion using the GET method (temp2.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;</code>
<code class="nt">&lt;title&gt;</code>Temperature Conversion<code class="nt">&lt;/title&gt;</code>
<code class="nt">&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>
<code class="cp">&lt;?php</code>
<code class="k">if</code> <code class="p">(</code><code class="nb">isset</code> <code class="p">(</code> <code class="nv">$_GET</code> <code class="p">[</code><code class="s1">'fahrenheit'</code><code class="p">]</code> <code class="p">))</code> <code class="p">{</code>
 <code class="nv">$fahrenheit</code> <code class="o">=</code> <code class="nv">$_GET</code> <code class="p">[</code><code class="s1">'fahrenheit'</code><code class="p">];</code>
<code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
 <code class="nv">$fahrenheit</code> <code class="o">=</code> <code class="k">null</code><code class="p">;</code>
<code class="p">}</code>
<code class="k">if</code> <code class="p">(</code><code class="nb">is_null</code> <code class="p">(</code> <code class="nv">$fahrenheit</code> <code class="p">))</code> <code class="p">{</code>
 <code class="cp">?&gt;</code>
<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"GET"</code><code class="nt">&gt;</code>
 Fahrenheit temperature: <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"fahrenheit"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Convert to Celsius!"</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;/form&gt;</code>
<code class="cp">&lt;?php</code>
<code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
 <code class="nv">$celsius</code> <code class="o">=</code> <code class="p">(</code><code class="nv">$fahrenheit</code> <code class="o">-</code> <code class="mi">32</code><code class="p">)</code> <code class="o">*</code> <code class="mi">5</code> <code class="o">/</code> <code class="mi">9</code><code class="p">;</code>
 <code class="nb">printf</code> <code class="p">(</code> <code class="s2">"%.2fF is %.2fC"</code><code class="p">,</code> <code class="nv">$fahrenheit</code><code class="p">,</code> <code class="nv">$celsius</code> <code class="p">);</code>
<code class="p">}</code>
<code class="cp">?&gt;</code>
<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>In <a data-type="xref" href="#example_eight_fourdot_temperature_conve">Example 8-4</a>, we copy the form parameter value into <code>$fahrenheit</code>. If we weren’t given that parameter, <code>$fahrenheit</code> contains <code>NULL</code>, so we could use <code>is_null()</code> to test whether we should display the form or process the form data.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sticky Forms"><div class="sect2" id="sticky_forms">
<h2>Sticky Forms</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="sticky forms" id="idm45922768653288"/><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="sticky forms" id="idm45922768652184"/>Many websites use a technique known as <em>sticky forms</em>, in which the results of a query are accompanied by a search form whose default values are those of the previous query. For instance, if you search Google for “Programming PHP,” the top of the results page contains another search box, which already contains “Programming PHP.” To refine your search to “Programming PHP from O’Reilly,” you can simply add the extra keywords.</p>
<p>This sticky behavior is easy to implement. <a data-type="xref" href="#example_eight_fivedot_temperature_conve">Example 8-5</a> shows our temperature-conversion script from <a data-type="xref" href="#example_eight_fourdot_temperature_conve">Example 8-4</a>, with the form made sticky. The basic technique is to use the submitted form value as the default value when creating the HTML field.</p>
<div data-type="example" id="example_eight_fivedot_temperature_conve">
<h5><span class="label">Example 8-5. </span>Temperature conversion with a sticky form (sticky_form.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Temperature Conversion<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>
<code class="cp">&lt;?php</code> <code class="nv">$fahrenheit</code> <code class="o">=</code> <code class="nv">$_GET</code><code class="p">[</code><code class="s1">'fahrenheit'</code><code class="p">];</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"GET"</code><code class="nt">&gt;</code>
 Fahrenheit temperature:
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"fahrenheit"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$fahrenheit</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Convert to Celsius!"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code>

<code class="cp">&lt;?php</code> <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">is_null</code><code class="p">(</code><code class="nv">$fahrenheit</code><code class="p">))</code> <code class="p">{</code>
 <code class="nv">$celsius</code> <code class="o">=</code> <code class="p">(</code><code class="nv">$fahrenheit</code> <code class="o">-</code> <code class="mi">32</code><code class="p">)</code> <code class="o">*</code> <code class="mi">5</code> <code class="o">/</code> <code class="mi">9</code><code class="p">;</code>
 <code class="nb">printf</code><code class="p">(</code><code class="s2">"%.2fF is %.2fC"</code><code class="p">,</code> <code class="nv">$fahrenheit</code><code class="p">,</code> <code class="nv">$celsius</code><code class="p">);</code>
<code class="p">}</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Multivalued Parameters"><div class="sect2" id="multivalued_parameters">
<h2>Multivalued Parameters</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="multivalued parameters, forms" id="ix_multi-value_param_forms"/><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="multivalued parameters for" id="ix_forms_multi-value_param"/>HTML selection lists, created with the <code>select</code> tag, can allow multiple selections. To ensure that PHP recognizes the multiple values that the browser passes to a form-processing script, you need to use square brackets, <code>[]</code>, after the name of the field in the HTML form. For example:</p>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"languages[]"</code><code class="nt">&gt;</code>

 <code class="nt">&lt;option</code> <code class="na">name=</code><code class="s">"c"</code><code class="nt">&gt;</code>C<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">name=</code><code class="s">"c++"</code><code class="nt">&gt;</code>C++<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">name=</code><code class="s">"php"</code><code class="nt">&gt;</code>PHP<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">name=</code><code class="s">"perl"</code><code class="nt">&gt;</code>Perl<code class="nt">&lt;/option&gt;</code>
<code class="nt">&lt;/select&gt;</code></pre>
<p>Now, when the user submits the form, <code>$_GET['languages']</code> contains an array instead of a simple string. This array contains the values that were selected by the user.</p>
<p><a data-type="xref" href="#example_eight_sixdot_multiple_selection">Example 8-6</a> illustrates multiple selections of values within an HTML selection list. The form provides the user with a set of personality attributes. When the user submits the form, it returns a (not very interesting) description of the user’s personality.</p>
<div data-type="example" id="example_eight_sixdot_multiple_selection">
<h5><span class="label">Example 8-6. </span>Multiple selection values with a select box (select_array.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Personality<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"GET"</code><code class="nt">&gt;</code>
 Select your personality attributes:<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">multiple</code><code class="nt">&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"perky"</code><code class="nt">&gt;</code>Perky<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"morose"</code><code class="nt">&gt;</code>Morose<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"thinking"</code><code class="nt">&gt;</code>Thinking<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"feeling"</code><code class="nt">&gt;</code>Feeling<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"thrifty"</code><code class="nt">&gt;</code>Spend-thrift<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"shopper"</code><code class="nt">&gt;</code>Shopper<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;/select&gt;&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">name=</code><code class="s">"s"</code> <code class="na">value=</code><code class="s">"Record my personality!"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code>
<code class="cp">&lt;?php</code> <code class="k">if</code> <code class="p">(</code><code class="nb">array_key_exists</code><code class="p">(</code><code class="s1">'s'</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">))</code> <code class="p">{</code>
 <code class="nv">$description</code> <code class="o">=</code> <code class="nb">join</code><code class="p">(</code><code class="s1">' '</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">[</code><code class="s1">'attributes'</code><code class="p">]);</code>
 <code class="k">echo</code> <code class="s2">"You have a </code><code class="si">{</code><code class="nv">$description</code><code class="si">}</code><code class="s2"> personality."</code><code class="p">;</code>
<code class="p">}</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>In <a data-type="xref" href="#example_eight_sixdot_multiple_selection">Example 8-6</a>, the submit button has a name, <code>"s"</code>. We check for the presence of this parameter value to see whether we have to produce a personality description. <a data-type="xref" href="#multiple_selection_page_and_its_output">Figure 8-3</a> shows the multiple-selection page and the resulting output.</p>
<figure><div id="multiple_selection_page_and_its_output" class="figure">
<img src="Images/php4_0803.png" alt="Multiple-selection page and its output" width="308" height="294"/>
<h6><span class="label">Figure 8-3. </span>Multiple-selection page and its output</h6>
</div></figure>
<p>The same technique applies for any form field where multiple values can be returned. <a data-type="xref" href="#example_eight_sevendot_multiple_selecti">Example 8-7</a> shows a revised version of our personality form that is rewritten to use checkboxes instead of a select box. Notice that only the HTML has changed—the code to process the form doesn’t need to know whether the multiple values came from checkboxes or a select box.</p>
<div data-type="example" id="example_eight_sevendot_multiple_selecti">
<h5><span class="label">Example 8-7. </span>Multiple selection values in checkboxes (checkbox_array.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Personality<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"GET"</code><code class="nt">&gt;</code>
 Select your personality attributes:<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"perky"</code> <code class="nt">/&gt;</code> Perky<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"morose"</code> <code class="nt">/&gt;</code> Morose<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"thinking"</code> <code class="nt">/&gt;</code> Thinking<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"feeling"</code> <code class="nt">/&gt;</code> Feeling<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"thrifty"</code> <code class="nt">/&gt;</code>Spend-thrift<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"shopper"</code> <code class="nt">/&gt;</code> Shopper<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">name=</code><code class="s">"s"</code> <code class="na">value=</code><code class="s">"Record my personality!"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code>
<code class="cp">&lt;?php</code> <code class="k">if</code> <code class="p">(</code><code class="nb">array_key_exists</code><code class="p">(</code><code class="s1">'s'</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">))</code> <code class="p">{</code>
 <code class="nv">$description</code> <code class="o">=</code> <code class="nb">join</code> <code class="p">(</code><code class="s1">' '</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">[</code><code class="s1">'attributes'</code><code class="p">]);</code>
 <code class="k">echo</code> <code class="s2">"You have a </code><code class="si">{</code><code class="nv">$description</code><code class="si">}</code><code class="s2"> personality."</code><code class="p">;</code>
<code class="p">}</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sticky Multivalued Parameters"><div class="sect2" id="sticky_multivalued_parameters">
<h2>Sticky Multivalued Parameters</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="sticky forms" id="ix_sticky_forms"/><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="sticky forms" id="ix_forms_sticky"/>So now you’re probably wondering, <em>Can I make multiple-selection form elements sticky?</em> You can, but it isn’t easy. You’ll need to check whether each possible value in the form was one of the submitted values. For example:</p>
<pre data-type="programlisting" data-code-language="html+php">Perky: <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"attributes[]"</code> <code class="na">value=</code><code class="s">"perky"</code>
<code class="cp">&lt;?php</code>
<code class="k">if</code> <code class="p">(</code><code class="nb">is_array</code><code class="p">(</code><code class="nv">$_GET</code><code class="p">[</code><code class="s1">'attributes'</code><code class="p">])</code> <code class="o">&amp;&amp;</code> <code class="nb">in_array</code><code class="p">(</code><code class="s1">'perky'</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">[</code><code class="s1">'attributes'</code><code class="p">]))</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"checked"</code><code class="p">;</code>
<code class="p">}</code> <code class="cp">?&gt;</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code></pre>
<p>You could use this technique for each checkbox, but that’s repetitive and error-prone. At this point, it’s easier to write a function to generate the HTML for the possible values and work from a copy of the submitted parameters. <a data-type="xref" href="#example_eight_eightdot_sticky_multivalu">Example 8-8</a> shows a new version of the multiple-selection checkboxes, with the form made sticky. Although this form looks just like the one in <a data-type="xref" href="#example_eight_sevendot_multiple_selecti">Example 8-7</a>, behind the scenes there are substantial changes to the way the form is generated.</p>
<div data-type="example" id="example_eight_eightdot_sticky_multivalu">
<h5><span class="label">Example 8-8. </span>Sticky multivalued checkboxes (checkbox_array2.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Personality<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>
<code class="cp">&lt;?php</code> <code class="c1">// fetch form values, if any</code>
<code class="nv">$attrs</code> <code class="o">=</code> <code class="nv">$_GET</code><code class="p">[</code><code class="s1">'attributes'</code><code class="p">];</code>

<code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">is_array</code><code class="p">(</code><code class="nv">$attrs</code><code class="p">))</code> <code class="p">{</code>
 <code class="nv">$attrs</code> <code class="o">=</code> <code class="k">array</code><code class="p">();</code>
<code class="p">}</code>

<code class="c1">// create HTML for identically named checkboxes</code>

<code class="k">function</code> <code class="nf">makeCheckboxes</code><code class="p">(</code><code class="nv">$name</code><code class="p">,</code> <code class="nv">$query</code><code class="p">,</code> <code class="nv">$options</code><code class="p">)</code>
<code class="p">{</code>
 <code class="k">foreach</code> <code class="p">(</code><code class="nv">$options</code> <code class="k">as</code> <code class="nv">$value</code> <code class="o">=&gt;</code> <code class="nv">$label</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$checked</code> <code class="o">=</code> <code class="nb">in_array</code><code class="p">(</code><code class="nv">$value</code><code class="p">,</code> <code class="nv">$query</code><code class="p">)</code> <code class="o">?</code> <code class="s2">"checked"</code> <code class="o">:</code> <code class="s1">''</code><code class="p">;</code>

 <code class="k">echo</code> <code class="s2">"&lt;input type=</code><code class="se">\"</code><code class="s2">checkbox</code><code class="se">\"</code><code class="s2"> name=</code><code class="se">\"</code><code class="si">{</code><code class="nv">$name</code><code class="si">}</code><code class="se">\"</code><code class="s2"/>
<code class="s2"> value=</code><code class="se">\"</code><code class="si">{</code><code class="nv">$value</code><code class="si">}</code><code class="se">\"</code><code class="s2"> </code><code class="si">{</code><code class="nv">$checked</code><code class="si">}</code><code class="s2"> /&gt;"</code><code class="p">;</code>
 <code class="k">echo</code> <code class="s2">"</code><code class="si">{</code><code class="nv">$label</code><code class="si">}</code><code class="s2">&lt;br /&gt;</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="c1">// the list of values and labels for the checkboxes</code>
<code class="nv">$personalityAttributes</code> <code class="o">=</code> <code class="k">array</code><code class="p">(</code>
 <code class="s1">'perky'</code> <code class="o">=&gt;</code> <code class="s2">"Perky"</code><code class="p">,</code>
 <code class="s1">'morose'</code> <code class="o">=&gt;</code> <code class="s2">"Morose"</code><code class="p">,</code>
 <code class="s1">'thinking'</code> <code class="o">=&gt;</code> <code class="s2">"Thinking"</code><code class="p">,</code>
 <code class="s1">'feeling'</code> <code class="o">=&gt;</code> <code class="s2">"Feeling"</code><code class="p">,</code>
 <code class="s1">'thrifty'</code> <code class="o">=&gt;</code> <code class="s2">"Spend-thrift"</code><code class="p">,</code>
 <code class="s1">'prodigal'</code> <code class="o">=&gt;</code> <code class="s2">"Shopper"</code>
<code class="p">);</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"GET"</code><code class="nt">&gt;</code>
 Select your personality attributes:<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
 <code class="cp">&lt;?php</code> <code class="nx">makeCheckboxes</code><code class="p">(</code><code class="s1">'attributes[]'</code><code class="p">,</code> <code class="nv">$attrs</code><code class="p">,</code> <code class="nv">$personalityAttributes</code><code class="p">);</code> <code class="cp">?&gt;</code><code class="nt">&lt;br</code> <code class="nt">/&gt;</code>

 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">name=</code><code class="s">"s"</code> <code class="na">value=</code><code class="s">"Record my personality!"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code>

<code class="cp">&lt;?php</code> <code class="k">if</code> <code class="p">(</code><code class="nb">array_key_exists</code><code class="p">(</code><code class="s1">'s'</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">))</code> <code class="p">{</code>
 <code class="nv">$description</code> <code class="o">=</code> <code class="nb">join</code> <code class="p">(</code><code class="s1">' '</code><code class="p">,</code> <code class="nv">$_GET</code><code class="p">[</code><code class="s1">'attributes'</code><code class="p">]);</code>
 <code class="k">echo</code> <code class="s2">"You have a </code><code class="si">{</code><code class="nv">$description</code><code class="si">}</code><code class="s2"> personality."</code><code class="p">;</code>
<code class="p">}</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>The heart of this code is the <code>makeCheckboxes()</code> function. It takes three arguments: the name for the group of checkboxes, the array of on-by-default values, and the array that maps values to descriptions. The list of options for the checkboxes is in the <code>$personalityAttributes</code> array.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_multi-value_param" id="idm45922767991528"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_multi-value_param_forms" id="idm45922767863368"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_sticky" id="idm45922767862008"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_sticky_forms" id="idm45922767860632"/></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="File Uploads"><div class="sect2" id="file_uploads">
<h2>File Uploads</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="file uploads" id="ix_file_upload_forms"/><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="file uploads in" id="ix_forms_file_upload"/>To handle file uploads (supported in most modern browsers), use the <code>$_FILES</code> array. Using the various authentication and file upload functions, you can control who is allowed to upload files and what to do with those files once they’re on your system. Security concerns to take note of are described in <a data-type="xref" href="ch14.xhtml#security">Chapter 14</a>.</p>
<p>The following code displays a form that allows file uploads to the same page:</p>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;form</code> <code class="na">enctype=</code><code class="s">"multipart/form-data"</code>
 <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"hidden"</code> <code class="na">name=</code><code class="s">"MAX_FILE_SIZE"</code> <code class="na">value=</code><code class="s">"10240"</code><code class="nt">&gt;</code>
 File name: <code class="nt">&lt;input</code> <code class="na">name=</code><code class="s">"toProcess"</code> <code class="na">type=</code><code class="s">"file"</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Upload"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code></pre>
<p>The biggest problem with file uploads is the risk of getting a file that is too large to process. PHP has two ways of preventing this: a hard limit and a soft limit. <a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="upload_max_filesize option" id="idm45922767836840"/><a contenteditable="false" data-type="indexterm" data-primary="upload_max_filesize option, php.ini file" id="idm45922767835624"/>The <code>upload_max_filesize</code> option in <em>php.ini</em> gives a hard upper limit on the size of uploaded files (it is set to 2 MB by default). If your form submits a parameter called <a contenteditable="false" data-type="indexterm" data-primary="MAX_FILE_SIZE parameter" id="idm45922767833352"/><code>MAX_FILE_SIZE</code> before any file field parameters, PHP uses that value as the soft upper limit. For instance, in the previous example, the upper limit is set to 10 KB. PHP ignores attempts to set <code>MAX_FILE_SIZE</code> to a value larger than <code>upload_max_filesize</code>.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="form tag, method attribute" id="idm45922767830616"/><a contenteditable="false" data-type="indexterm" data-primary="method attribute, form tag" id="idm45922767829544"/>Also, notice that the form tag takes an <code>enctype</code> attribute with the value <code>"multipart/form-data"</code>.</p>
<p>Each element in <code>$_FILES</code> is itself an array, giving information about the uploaded file. The keys are:</p>
<dl>
<dt><code>name</code></dt>
<dd>The name of the uploaded file as supplied by the browser. It’s difficult to make meaningful use of this, as the client machine may have different filename conventions than the web server (e.g., a file path of <em>D:\PHOTOS\ME.JPG</em> from a client machine running Windows would be meaningless to a web server running Unix).</dd>
<dt><code>type</code></dt>
<dd>The MIME type of the uploaded file as guessed at by the client.</dd>
<dt><code>size</code></dt>
<dd>The size of the uploaded file (in bytes). If the user attempted to upload a file that was too large, the size would be reported as 0.</dd>
<dt><code>tmp_name</code></dt>
<dd>The name of the temporary file on the server that holds the uploaded file. If the user attempted to upload a file that was too large, the name is given as <code>"none"</code>.</dd>
</dl>
<p>The correct way to test whether a file was successfully uploaded is to use the function <code>is_uploaded_file()</code>, as follows:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">if</code> <code class="p">(</code><code class="nb">is_uploaded_file</code><code class="p">(</code><code class="nv">$_FILES</code><code class="p">[</code><code class="s1">'toProcess'</code><code class="p">][</code><code class="s1">'tmp_name'</code><code class="p">]))</code> <code class="p">{</code>
 <code class="c1">// successfully uploaded</code>
<code class="p">}</code></pre>
<p>Files are stored in the server’s default temporary files directory, which is specified in <a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="upload_tmp_dir option" id="idm45922767587256"/><a contenteditable="false" data-type="indexterm" data-primary="upload_tmp_dir option, php.ini file" id="idm45922767586040"/><em>php.ini</em> with the <code>upload_tmp_dir</code> option. To move a file, use the <code>move_</code><span class="keep-together"><code>uploaded</code></span><code>_file()</code> function:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">move_uploaded_file</code><code class="p">(</code><code class="nv">$_FILES</code><code class="p">[</code><code class="s1">'toProcess'</code><code class="p">][</code><code class="s1">'tmp_name'</code><code class="p">],</code> <code class="s2">"path/to/put/file/</code><code class="si">{</code><code class="nv">$file</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code></pre>
<p>The call to <a contenteditable="false" data-type="indexterm" data-primary="move_uploaded_file function" id="idm45922767791416"/><code>move_uploaded_file()</code> automatically checks whether it was an uploaded file. When a script finishes, any files uploaded to that script are deleted from the temporary directory.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_file_upload" id="idm45922767789992"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_file_upload_forms" id="idm45922767767480"/></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Form Validation"><div class="sect2" id="form_validation">
<h2>Form Validation</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="forms" data-secondary="validating" id="ix_forms_validate"/>When you allow users to input data, you typically need to validate that data before using it or storing it for later use. There are several strategies available for validating data. The first is JavaScript on the client side. However, since the user can choose to turn JavaScript off, or may even be using a browser that doesn’t support it, this cannot be the only validation you do.</p>
<p>A more secure choice is to use PHP to do the validation. <a data-type="xref" href="#example_eight_ninedot_form_validation_l">Example 8-9</a> shows a self-processing page with a form. The page allows the user to input a media item; three of the form elements—the name, media type, and filename—are required. If the user neglects to give a value to any of them, the page is presented anew with a message detailing what’s wrong. Any form fields the user already filled out are set to the values originally entered. Finally, as an additional clue to the user, the text of the submit button changes from “Create” to “Continue” when the user is correcting the form.</p>
<div data-type="example" id="example_eight_ninedot_form_validation_l">
<h5><span class="label">Example 8-9. </span>Form validation (data_validation.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code>
<code class="nv">$name</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'name'</code><code class="p">];</code>
<code class="nv">$mediaType</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'media_type'</code><code class="p">];</code>
<code class="nv">$filename</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'filename'</code><code class="p">];</code>
<code class="nv">$caption</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'caption'</code><code class="p">];</code>
<code class="nv">$status</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'status'</code><code class="p">];</code>

<code class="nv">$tried</code> <code class="o">=</code> <code class="p">(</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'tried'</code><code class="p">]</code> <code class="o">==</code> <code class="s1">'yes'</code><code class="p">);</code>

<code class="k">if</code> <code class="p">(</code><code class="nv">$tried</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$validated</code> <code class="o">=</code> <code class="p">(</code><code class="o">!</code><code class="k">empty</code><code class="p">(</code><code class="nv">$name</code><code class="p">)</code> <code class="o">&amp;&amp;</code> <code class="o">!</code><code class="k">empty</code><code class="p">(</code><code class="nv">$mediaType</code><code class="p">)</code> <code class="o">&amp;&amp;</code> <code class="o">!</code><code class="k">empty</code><code class="p">(</code><code class="nv">$filename</code><code class="p">));</code>

 <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nv">$validated</code><code class="p">)</code> <code class="p">{</code> <code class="cp">?&gt;</code>
 <code class="nt">&lt;p&gt;</code>The name, media type, and filename are required fields. Please fill
 them out to continue.<code class="nt">&lt;/p&gt;</code>
 <code class="cp">&lt;?php</code> <code class="p">}</code>
<code class="p">}</code>

<code class="k">if</code> <code class="p">(</code><code class="nv">$tried</code> <code class="o">&amp;&amp;</code> <code class="nv">$validated</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;p&gt;The item has been created.&lt;/p&gt;"</code><code class="p">;</code>
<code class="p">}</code>

<code class="c1">// was this type of media selected? print "selected" if so</code>
<code class="k">function</code> <code class="nf">mediaSelected</code><code class="p">(</code><code class="nv">$type</code><code class="p">)</code>
<code class="p">{</code>
 <code class="k">global</code> <code class="nv">$mediaType</code><code class="p">;</code>

 <code class="k">if</code> <code class="p">(</code><code class="nv">$mediaType</code> <code class="o">==</code> <code class="nv">$type</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"selected"</code><code class="p">;</code> <code class="p">}</code>
<code class="p">}</code> <code class="cp">?&gt;</code>

<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
 Name: <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$name</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>

 Status: <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"checkbox"</code> <code class="na">name=</code><code class="s">"status"</code> <code class="na">value=</code><code class="s">"active"</code>
 <code class="cp">&lt;?php</code> <code class="k">if</code> <code class="p">(</code><code class="nv">$status</code> <code class="o">==</code> <code class="s2">"active"</code><code class="p">)</code> <code class="p">{</code> <code class="k">echo</code> <code class="s2">"checked"</code><code class="p">;</code> <code class="p">}</code> <code class="cp">?&gt;</code> <code class="nt">/&gt;</code> Active<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>

 Media: <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"media_type"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">""</code><code class="nt">&gt;</code>Choose one<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"picture"</code> <code class="cp">&lt;?php</code> <code class="nx">mediaSelected</code><code class="p">(</code><code class="s2">"picture"</code><code class="p">);</code> <code class="cp">?&gt;</code> <code class="nt">/&gt;</code>Picture<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"audio"</code> <code class="cp">&lt;?php</code> <code class="nx">mediaSelected</code><code class="p">(</code><code class="s2">"audio"</code><code class="p">);</code> <code class="cp">?&gt;</code> <code class="nt">/&gt;</code>Audio<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"movie"</code> <code class="cp">&lt;?php</code> <code class="nx">mediaSelected</code><code class="p">(</code><code class="s2">"movie"</code><code class="p">);</code> <code class="cp">?&gt;</code> <code class="nt">/&gt;</code>Movie<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;/select&gt;&lt;br</code> <code class="nt">/&gt;</code>

 File: <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">name=</code><code class="s">"filename"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$filename</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="nt">/&gt;&lt;br</code> <code class="nt">/&gt;</code>

 Caption: <code class="nt">&lt;textarea</code> <code class="na">name=</code><code class="s">"caption"</code><code class="nt">&gt;</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$caption</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="nt">&lt;/textarea&gt;&lt;br</code> <code class="nt">/&gt;</code>

 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"hidden"</code> <code class="na">name=</code><code class="s">"tried"</code> <code class="na">value=</code><code class="s">"yes"</code> <code class="nt">/&gt;</code>
 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$tried</code> <code class="o">?</code> <code class="s2">"Continue"</code> <code class="o">:</code> <code class="s2">"Create"</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code></pre>
</div>
<p>In this case, the validation is simply a check that a value was supplied. We set <code>$validated</code> to be <code>true</code> only if <code>$name</code>, <code>$type</code>, and <code>$filename</code> are all nonempty. Other possible validations include checking that an email address is valid or checking that the supplied filename is local and exists.</p>
<p>For example, to validate an age field to ensure that it contains a non-negative integer, use this code:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$age</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'age'</code><code class="p">];</code>
<code class="nv">$validAge</code> <code class="o">=</code> <code class="nb">strspn</code><code class="p">(</code><code class="nv">$age</code><code class="p">,</code> <code class="s2">"1234567890"</code><code class="p">)</code> <code class="o">==</code> <code class="nb">strlen</code><code class="p">(</code><code class="nv">$age</code><code class="p">);</code></pre>
<p>The call to <a contenteditable="false" data-type="indexterm" data-primary="strspn function" id="idm45922767370840"/><code>strspn()</code> finds the number of digits at the start of the string. In a non-negative integer, the whole string should be composed of digits, so it’s a valid age if the entire string is made of digits. We could also have done this check with a regular expression:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$validAge</code> <code class="o">=</code> <code class="nb">preg_match</code><code class="p">(</code><code class="s1">'/^\d+$/'</code><code class="p">,</code> <code class="nv">$age</code><code class="p">);</code></pre>
<p>Validating email addresses is a nigh-impossible task. There’s no way to take a string and see whether it corresponds to a valid email address. However, you can catch typos by requiring the user to enter the email address twice (into two different fields). You can also prevent people from entering email addresses like <em>me</em> or <em>me@aol</em> by requiring an at sign (@) and a period somewhere after it, and for bonus points you can check for domains to which you don’t want to send mail (e.g., <em><a href="http://whitehouse.gov">whitehouse.gov</a></em>, or a competitor site). For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$email1</code> <code class="o">=</code> <code class="nb">strtolower</code><code class="p">(</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'email1'</code><code class="p">]);</code>
<code class="nv">$email2</code> <code class="o">=</code> <code class="nb">strtolower</code><code class="p">(</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'email2'</code><code class="p">]);</code>

<code class="k">if</code> <code class="p">(</code><code class="nv">$email1</code> <code class="o">!==</code> <code class="nv">$email2</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="s2">"The email addresses didn't match"</code><code class="p">);</code>
<code class="p">}</code>

<code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">preg_match</code><code class="p">(</code><code class="s1">'/@.+\..+$/'</code><code class="p">,</code> <code class="nv">$email1</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="s2">"The email address is malformed"</code><code class="p">);</code>
<code class="p">}</code>

<code class="k">if</code> <code class="p">(</code><code class="nb">strpos</code><code class="p">(</code><code class="nv">$email1</code><code class="p">,</code> <code class="s2">"whitehouse.gov"</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="s2">"I will not send mail to the White House"</code><code class="p">);</code>
<code class="p">}</code></pre>
<p>Field validation is basically string manipulation. In this example, we’ve used regular expressions and string functions to ensure that the string provided by the user is the type of string we expect.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_ch8" id="idm45922767355624"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_forms_validate" id="idm45922767222584"/></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Setting Response Headers"><div class="sect1" id="setting_response_headers">
<h1>Setting Response Headers</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="headers, HTTP" data-secondary="response headers" id="ix_headers_http_response"/><a contenteditable="false" data-type="indexterm" data-primary="response, HTTP and web server" id="ix_response_http_server"/><a contenteditable="false" data-type="indexterm" data-primary="web server" data-secondary="HTTP response sent from" id="ix_webserver_response_headers"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="server response headers" id="ix_http_response_headers"/>As we’ve already discussed, the HTTP response that a server sends back to a client contains headers that identify the type of content in the body of the response, the server that sent the response, how many bytes are in the body, when the response was sent, and so on. PHP and Apache normally take care of the headers for you (identifying the document as HTML, calculating the length of the HTML page, etc.). Most web applications never need to set headers themselves. However, if you want to send back something that’s not HTML, set the expiration time for a page, redirect the client’s browser, or generate a specific HTTP error, you’ll need to use the <a contenteditable="false" data-type="indexterm" data-primary="header function" id="idm45922767212344"/><code>header()</code> function.</p>
<p>The only catch to setting headers is that you must do so before any of the body is generated. This means that all calls to <code>header()</code> (or <code>setcookie()</code>, if you’re setting cookies) must happen at the very top of your file, even before the <code>&lt;html&gt;</code> tag. For example:</p>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code> <code class="nb">header</code><code class="p">(</code><code class="s2">"Content-Type: text/plain"</code><code class="p">);</code> <code class="cp">?&gt;</code>
Date: today
From: fred
To: barney
Subject: hands off!

My lunchbox is mine and mine alone. Get your own,
you filthy scrounger!</pre>
<p>Attempting to set headers after the document has started results in this warning:</p>
<pre data-type="programlisting"><strong>Warning: Cannot add header information - headers already sent</strong></pre>
<p>You can instead use an output buffer; see <code>ob_start()</code>, <code>ob_end_flush()</code>, and related functions for more information on using output buffers.</p>
<section data-type="sect2" data-pdf-bookmark="Different Content Types"><div class="sect2" id="different_content_types">
<h2>Different Content Types</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="Content-Type header" id="idm45922767200072"/>The <code>Content-Type</code> header identifies the type of document being returned. Ordinarily this is <code>"text/html"</code>, indicating an HTML document, but there are other useful document types. For example, <code>"text/plain"</code> forces the browser to treat the page as plain text. This type is like an automatic “view source,” and it is useful when debugging.</p>
<p>In <a data-type="xref" href="ch10.xhtml#graphic">Chapter 10</a> and <a data-type="xref" href="ch11.xhtml#pdf">Chapter 11</a>, we’ll make heavy use of the <code>Content-Type</code> header as we generate documents that are actually graphic images and Adobe PDF files.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Redirections"><div class="sect2" id="redirections">
<h2>Redirections</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="redirection" id="idm45922767205672"/><a contenteditable="false" data-type="indexterm" data-primary="URLs" data-secondary="redirecting" id="idm45922767204568"/>To send the browser to a new URL, known as a <em>redirection</em>, you set the <a contenteditable="false" data-type="indexterm" data-primary="Location header" id="idm45922767319720"/><code>Location</code> header. Generally, you’ll also exit immediately afterward, so the script doesn’t bother generating and outputting the remainder of the code listing:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">header</code><code class="p">(</code><code class="s2">"Location: http://www.example.com/elsewhere.html"</code><code class="p">);</code>
<code class="k">exit</code><code class="p">();</code></pre>
<p>When you provide a partial URL (e.g., <code>/elsewhere.html</code>), the web server handles this redirection internally. This is only rarely useful, as the browser generally won’t learn that it isn’t getting the page it requested. If there are relative URLs in the new document, the browser interprets those URLs as being relative to the requested document, rather than to the document that was ultimately sent. In general, you’ll want to redirect to an absolute URL.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Expiration"><div class="sect2" id="expiration">
<h2>Expiration</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="expiration of web documents" id="idm45922767311384"/><a contenteditable="false" data-type="indexterm" data-primary="web pages" data-secondary="expiration of" id="idm45922767310312"/><a contenteditable="false" data-type="indexterm" data-primary="caching" data-secondary="web caching" id="idm45922767287432"/><a contenteditable="false" data-type="indexterm" data-primary="web caching" id="idm45922767286056"/>A server can explicitly inform the browser, and any proxy caches that might be between the server and browser, of a specific date and time for the document to expire. Proxy and browser caches can hold the document until that time or expire it earlier. Repeated reloads of a cached document do not contact the server. However, an attempt to fetch an expired document does contact the server.</p>
<p>To set the expiration time of a document, use the <a contenteditable="false" data-type="indexterm" data-primary="Expires header" id="idm45922767182888"/><code>Expires</code> header:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">header</code><code class="p">(</code><code class="s2">"Expires: Tue, 02 Jul 2019 05:30:00 GMT"</code><code class="p">);</code></pre>
<p>To force a document to expire three hours from the time the page was generated, use <code>time()</code> and <code>gmstrftime()</code> to generate the expiration date string:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$now</code> <code class="o">=</code> <code class="nb">time</code><code class="p">();</code>
<code class="nv">$then</code> <code class="o">=</code> <code class="nb">gmstrftime</code><code class="p">(</code><code class="s2">"%a, %d %b %Y %H:%M:%S GMT"</code><code class="p">,</code> <code class="nv">$now</code> <code class="o">+</code> <code class="mi">60</code> <code class="o">*</code> <code class="mi">60</code> <code class="o">*</code> <code class="mi">3</code><code class="p">);</code>

<code class="nb">header</code><code class="p">(</code><code class="s2">"Expires: </code><code class="si">{</code><code class="nv">$then</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code></pre>
<p>To indicate that a document “never” expires, use the time a year from now:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$now</code> <code class="o">=</code> <code class="nb">time</code><code class="p">();</code>
<code class="nv">$then</code> <code class="o">=</code> <code class="nb">gmstrftime</code><code class="p">(</code><code class="s2">"%a, %d %b %Y %H:%M:%S GMT"</code><code class="p">,</code> <code class="nv">$now</code> <code class="o">+</code> <code class="mi">365</code> <code class="o">*</code> <code class="mi">86440</code><code class="p">);</code>

<code class="nb">header</code><code class="p">(</code><code class="s2">"Expires: </code><code class="si">{</code><code class="nv">$then</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code></pre>
<p>To mark a document as expired, use the current time or a time in the past:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$then</code> <code class="o">=</code> <code class="nb">gmstrftime</code><code class="p">(</code><code class="s2">"%a, %d %b %Y %H:%M:%S GMT"</code><code class="p">);</code>

<code class="nb">header</code><code class="p">(</code><code class="s2">"Expires: </code><code class="si">{</code><code class="nv">$then</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code></pre>
<p>This is the best way to prevent a browser or proxy cache from storing your document:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">header</code><code class="p">(</code><code class="s2">"Expires: Mon, 26 Jul 1997 05:00:00 GMT"</code><code class="p">);</code>
<code class="nb">header</code><code class="p">(</code><code class="s2">"Last-Modified: "</code> <code class="o">.</code> <code class="nb">gmdate</code><code class="p">(</code><code class="s2">"D, d M Y H:i:s"</code><code class="p">)</code> <code class="o">.</code> <code class="s2">" GMT"</code><code class="p">);</code>
<code class="nb">header</code><code class="p">(</code><code class="s2">"Cache-Control: no-store, no-cache, must-revalidate"</code><code class="p">);</code>
<code class="nb">header</code><code class="p">(</code><code class="s2">"Cache-Control: post-check=0, pre-check=0"</code><code class="p">,</code> <code class="k">false</code><code class="p">);</code>
<code class="nb">header</code><code class="p">(</code><code class="s2">"Pragma: no-cache"</code><code class="p">);</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="Web Caching (O'Reilly)" id="idm45922766880824"/><a contenteditable="false" data-type="indexterm" data-primary="Wessels, Duane (author)" data-secondary="Web Caching (O'Reilly)" id="idm45922766824792"/>For more information on controlling the behavior of browser and web caches, see Chapter 6 of <a class="orm:hideurl" href="http://bit.ly/Web_Caching"><em>Web Caching</em></a> (O’Reilly) by Duane Wessels .</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Authentication"><div class="sect2" id="authentication">
<h2>Authentication</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="authentication" id="idm45922766820280"/><a contenteditable="false" data-type="indexterm" data-primary="authentication, HTTP" id="idm45922766818712"/>HTTP authentication works through request headers and response statuses. A browser can send a username and password (the <em>credentials</em>) in the request headers. If the credentials aren’t sent or aren’t satisfactory, the server sends a “401 Unauthorized” response and identifies the <em>realm</em> of authentication (a string such as <code>"Mary's</code> <span class="keep-together"><code>Pictures"</code></span> or <code>"Your Shopping Cart"</code>) via the <a contenteditable="false" data-type="indexterm" data-primary="WWW-Authenticate header" id="idm45922766798248"/><code>WWW-Authenticate</code> header. This typically pops up an “Enter username and password for . . .” dialog box on the browser, and the page is then re-requested with the updated credentials in the header.</p>
<p>To handle authentication in PHP, check the username and password (the <code>PHP_AUTH_USER</code> and <code>PHP_AUTH_PW</code> items of <code>$_SERVER</code>) and call <code>header()</code> to set the realm and send a “401 Unauthorized” response:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">header</code><code class="p">(</code><code class="s1">'WWW-Authenticate: Basic realm="Top Secret Files"'</code><code class="p">);</code>
<code class="nb">header</code><code class="p">(</code><code class="s2">"HTTP/1.0 401 Unauthorized"</code><code class="p">);</code></pre>
<p>You can do anything you want to authenticate the username and password; for example, you could consult a database, read a file of valid users, or consult a Microsoft domain server.</p>
<p>This example checks to make sure that the password is the username reversed (not the most secure authentication method, to be sure!):</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$authOK</code> <code class="o">=</code> <code class="k">false</code><code class="p">;</code>

<code class="nv">$user</code> <code class="o">=</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_AUTH_USER'</code><code class="p">];</code>
<code class="nv">$password</code> <code class="o">=</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_AUTH_PW'</code><code class="p">];</code>

<code class="k">if</code> <code class="p">(</code><code class="nb">isset</code><code class="p">(</code><code class="nv">$user</code><code class="p">)</code> <code class="o">&amp;&amp;</code> <code class="nb">isset</code><code class="p">(</code><code class="nv">$password</code><code class="p">)</code> <code class="o">&amp;&amp;</code> <code class="nv">$user</code> <code class="o">===</code> <code class="nb">strrev</code><code class="p">(</code><code class="nv">$password</code><code class="p">))</code> <code class="p">{</code>
 <code class="nv">$authOK</code> <code class="o">=</code> <code class="k">true</code><code class="p">;</code>
<code class="p">}</code>

<code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nv">$authOK</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">header</code><code class="p">(</code><code class="s1">'WWW-Authenticate: Basic realm="Top Secret Files"'</code><code class="p">);</code>
 <code class="nb">header</code><code class="p">(</code><code class="s1">'HTTP/1.0 401 Unauthorized'</code><code class="p">);</code>

 <code class="c1">// anything else printed here is only seen if the client hits "Cancel"</code>
 <code class="k">exit</code><code class="p">;</code>
<code class="p">}</code>

<code class="o">&lt;!--</code> <code class="nx">your</code> <code class="nx">password</code><code class="o">-</code><code class="k">protected</code> <code class="nx">document</code> <code class="nx">goes</code> <code class="nx">here</code> <code class="o">--&gt;</code></pre>
<p>If you’re protecting more than one page, put the preceding code into a separate file and include it at the top of every protected page.</p>
<p>If your host is using the CGI version of PHP rather than an Apache module, these variables cannot be set and you’ll need to use some other form of authentication—for example, by gathering the username and password through an HTML form.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_response_headers" id="idm45922766784632"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_webserver_response_headers" id="idm45922766673320"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_response_http_server" id="idm45922766671976"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_headers_http_response" id="idm45922766670600"/></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Maintaining State"><div class="sect1" id="maintaining_state">
<h1>Maintaining State</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="web server" data-secondary="maintaining state" id="ix_webserver_maintain_state"/><a contenteditable="false" data-type="indexterm" data-primary="state, maintaining between server and  HTTP" id="ix_maintain_state_http"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="maintaining state" id="ix_http_maintain_state"/>HTTP is a <em>stateless</em> protocol, which means that once a web server completes a client’s request for a web page, the connection between the two goes away. In other words, there is no way for a server to recognize that a sequence of requests all originate from the same client.</p>
<p>State is useful, though. You can’t build a shopping-cart application, for example, if you can’t keep track of a sequence of requests from a single user. You need to know when a user adds items to the cart or removes them, and what’s in the cart when the user decides to check out.</p>
<p>To get around the web’s lack of state, programmers have come up with many tricks to track state information between requests (also known as <em>session tracking</em>). One such technique is to use hidden form fields to pass around information. PHP treats hidden form fields just like normal form fields, so the values are available in the <code>$_GET</code> and <code>$_POST</code> arrays. Using hidden form fields, you can pass around the entire contents of a shopping cart. However, it’s more common to assign each user a unique identifier and pass the ID around using a single hidden form field. While hidden form fields work in all browsers, they work only for a sequence of dynamically generated forms, so they aren’t as generally useful as some other techniques.</p>
<p>Another technique is URL rewriting, where every local URL on which the user might click is dynamically modified to include extra information. This extra information is often specified as a parameter in the URL. For example, if you assign every user a unique ID, you might include that ID in all URLs, as follows:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nx">http</code><code class="o">://</code><code class="nx">www</code><code class="o">.</code><code class="nx">example</code><code class="o">.</code><code class="nx">com</code><code class="o">/</code><code class="nx">catalog</code><code class="o">.</code><code class="nx">php</code><code class="o">?</code><code class="nx">userid</code><code class="o">=</code><code class="mi">123</code></pre>
<p>If you make sure to dynamically modify all local links to include a user ID, you can now keep track of individual users in your application. URL rewriting works for all dynamically generated documents, not just forms, but actually performing the rewriting can be tedious.</p>
<p>The third and most widespread technique for maintaining state is to use cookies. A <em>cookie</em> is a bit of information that the server can give to a client. On every subsequent request the client will give that information back to the server, thus identifying itself. Cookies are useful for retaining information through repeated visits by a browser, but they’re not without their own problems. The main issue is that most browsers allow users to disable cookies. So any application that uses cookies for state maintenance needs to use another technique as a fallback mechanism. We’ll discuss cookies in more detail shortly.</p>
<p>The best way to maintain state with PHP is to use the built-in session-tracking system. This system lets you create persistent variables that are accessible from different pages of your application, as well as in different visits to the site by the same user. Behind the scenes, PHP’s session-tracking mechanism uses cookies (or URLs) to elegantly solve most problems that require state, taking care of all the details for you. We’ll cover PHP’s session-tracking system in detail later in this chapter.</p>
<section data-type="sect2" data-pdf-bookmark="Cookies"><div class="sect2" id="cookies">
<h2>Cookies</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="cookies" id="ix_cookies_http"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="cookies with" id="ix_http_cookies"/>A cookie is basically a string that contains several fields. A server can send one or more cookies to a browser in the headers of a response. Some of the cookie’s fields indicate the pages for which the browser should send the cookie as part of the request. The <code>value</code> field of the cookie is the payload—servers can store any data they like there (within limits), such as a unique code identifying the user, preferences, and the like.</p>
<p>Use the <a contenteditable="false" data-type="indexterm" data-primary="set cookie function" id="idm45922766622568"/><code>setcookie()</code> function to send a cookie to the browser:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">setcookie</code><code class="p">(</code><em><code class="nx">name</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">value</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">expires</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">path</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">domain</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">secure</code></em><code> </code><code class="p">[,</code><code> 
</code><em><code class="nx">httponly</code></em><code> </code><code class="p">]]]]]]);</code></pre>
<p>This function creates the cookie string from the given arguments and creates a <code>Cookie</code> header with that string as its value. Because cookies are sent as headers in the response, <code>setcookie()</code> must be called before any of the body of the document is sent. The parameters of <code>setcookie()</code> are:</p>
<dl>
<dt><em>name</em></dt>
<dd>A unique name for a particular cookie. You can have multiple cookies with different names and attributes. The name must not contain whitespace or <span class="keep-together">semicolons.</span></dd>
<dt><em>value</em></dt>
<dd>The arbitrary string value attached to this cookie. The original Netscape specification limited the total size of a cookie (including name, expiration date, and other information) to 4 KB, so while there’s no specific limit on the size of a cookie value, it probably can’t be much larger than 3.5 KB.</dd>
<dt><em>expires</em></dt>
<dd>The expiration date for this cookie. If no expiration date is specified, the browser saves the cookie in memory and not on disk. When the browser exits, the cookie disappears. The expiration date is specified as the number of seconds since midnight, January 1, 1970 (GMT). For example, pass <code>time() + 60 * 60 * 2</code> to expire the cookie in two hours’ time.</dd>
<dt><em>path</em></dt>
<dd>The browser will return the cookie only for URLs below this path. The default is the directory in which the current page resides. For example, if <em>/store/front/cart.php</em> sets a cookie and doesn’t specify a path, the cookie will be sent back to the server for all pages whose URL path starts with <em>/store/front/</em>.</dd>
<dt><em>domain</em></dt>
<dd>The browser will return the cookie only for URLs within this domain. The default is the server hostname.</dd>
<dt><em>secure</em></dt>
<dd>The browser will transmit the cookie only over <em>https</em> connections. The default is <code>false</code>, meaning that it’s OK to send the cookie over insecure connections.</dd>
<dt><em>httponly</em></dt>
<dd>If this parameter is set to <code>TRUE</code>, the cookie will be available only via the HTTP protocol, and thus inaccessible via other means like JavaScript. Whether this allows for a more secure cookie is still up for debate, so use this parameter cautiously and test well.</dd>
</dl>
<p>The <code>setcookie()</code> function also has an alternate syntax:</p>
<pre data-type="programlisting" data-code-language="php"><code> </code><strong><code class="nb">setcookie</code></strong><code> </code><code class="p">(</code><code class="nv">$name</code><code> </code><code class="p">[,</code><code> </code><code class="nv">$value</code><code> </code><code class="o">=</code><code> </code><code class="s2">"</code><code class="s2">"</code><code> </code><code class="p">[,</code><code> </code><code class="nv">$options</code><code> </code><code class="o">=</code><code> </code><code class="p">[]</code><code> </code><code class="p">]]</code><code> </code><code class="p">)</code></pre>
<p>where <code>$options</code> is an array that holds the other parameters following the <code>$value</code> content. This saves a little on the code line length for the <code>setcookie()</code> function, but the <code>$options</code> array will have to be built prior to its use, so there is a trade-off of sorts in play.</p>
<p>When a browser sends a cookie back to the server, you can access that cookie through the <a contenteditable="false" data-type="indexterm" data-primary="$_COOKIE array" id="idm45922766517608"/><code>$_COOKIE</code> array. The key is the cookie name, and the value is the cookie’s <code>value</code> field. For instance, the following code at the top of a page keeps track of the number of times the page has been accessed by this client:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$pageAccesses</code> <code class="o">=</code> <code class="nv">$_COOKIE</code><code class="p">[</code><code class="s1">'accesses'</code><code class="p">];</code>
<code class="nb">setcookie</code><code class="p">(</code><code class="s1">'accesses'</code><code class="p">,</code> <code class="o">++</code><code class="nv">$pageAccesses</code><code class="p">);</code></pre>
<p>When cookies are decoded, any periods (<code>.</code>) in a cookie’s name are turned into underscores. For instance, a cookie named <code>tip.top</code> is accessible as <code>$_COOKIE['tip_top']</code>.</p>
<p>Let’s take a look at cookies in action. First, <a data-type="xref" href="#example_eight_onezerodot_preference_sel">Example 8-10</a> shows an HTML page that gives a range of options for background and foreground colors.</p>
<div data-type="example" id="example_eight_onezerodot_preference_sel">
<h5><span class="label">Example 8-10. </span>Preference selection (colors.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Set Your Preferences<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>
<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"prefs.php"</code> <code class="na">method=</code><code class="s">"post"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;p&gt;</code>Background:
 <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"background"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"black"</code><code class="nt">&gt;</code>Black<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"white"</code><code class="nt">&gt;</code>White<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"red"</code><code class="nt">&gt;</code>Red<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"blue"</code><code class="nt">&gt;</code>Blue<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;/select&gt;&lt;br</code> <code class="nt">/&gt;</code>

 Foreground:
 <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"foreground"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"black"</code><code class="nt">&gt;</code>Black<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"white"</code><code class="nt">&gt;</code>White<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"red"</code><code class="nt">&gt;</code>Red<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"blue"</code><code class="nt">&gt;</code>Blue<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;/select&gt;&lt;/p&gt;</code>

 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="na">value=</code><code class="s">"Change Preferences"</code><code class="nt">&gt;</code>
<code class="nt">&lt;/form&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>The form in <a data-type="xref" href="#example_eight_onezerodot_preference_sel">Example 8-10</a> submits to the PHP script <em>prefs.php</em>, which is shown in <a data-type="xref" href="#example_eight_oneonedot_setting_prefere">Example 8-11</a>. This script then sets cookies for the color preferences specified in the form. Note that the calls to <code>setcookie()</code> are made after the HTML page is started.</p>
<div data-type="example" id="example_eight_oneonedot_setting_prefere">
<h5><span class="label">Example 8-11. </span>Setting preferences with cookies (prefs.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Preferences Set<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="cp">&lt;?php</code>
<code class="nv">$colors</code> <code class="o">=</code> <code class="k">array</code><code class="p">(</code>
 <code class="s1">'black'</code> <code class="o">=&gt;</code> <code class="s2">"#000000"</code><code class="p">,</code>
 <code class="s1">'white'</code> <code class="o">=&gt;</code> <code class="s2">"#ffffff"</code><code class="p">,</code>
 <code class="s1">'red'</code> <code class="o">=&gt;</code> <code class="s2">"#ff0000"</code><code class="p">,</code>
 <code class="s1">'blue'</code> <code class="o">=&gt;</code> <code class="s2">"#0000ff"</code>
<code class="p">);</code>

<code class="nv">$backgroundName</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'background'</code><code class="p">];</code>
<code class="nv">$foregroundName</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'foreground'</code><code class="p">];</code>

<code class="nb">setcookie</code><code class="p">(</code><code class="s1">'bg'</code><code class="p">,</code> <code class="nv">$colors</code><code class="p">[</code><code class="nv">$backgroundName</code><code class="p">]);</code>
<code class="nb">setcookie</code><code class="p">(</code><code class="s1">'fg'</code><code class="p">,</code> <code class="nv">$colors</code><code class="p">[</code><code class="nv">$foregroundName</code><code class="p">]);</code>
<code class="cp">?&gt;</code>

<code class="nt">&lt;p&gt;</code>Thank you. Your preferences have been changed to:<code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
Background: <code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$backgroundName</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
Foreground: <code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$foregroundName</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="nt">&lt;/p&gt;</code>

<code class="nt">&lt;p&gt;</code>Click <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"prefs_demo.php"</code><code class="nt">&gt;</code>here<code class="nt">&lt;/a&gt;</code> to see the preferences
in action.<code class="nt">&lt;/p&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>The page created by <a data-type="xref" href="#example_eight_oneonedot_setting_prefere">Example 8-11</a> contains a link to another page, shown in <a data-type="xref" href="#example_eight_onetwodot_using_the_color">Example 8-12</a>, that uses the color preferences by accessing the <a contenteditable="false" data-type="indexterm" data-primary="$_COOKIE array" id="idm45922766071352"/><code>$_COOKIE</code> array.</p>
<div data-type="example" id="example_eight_onetwodot_using_the_color">
<h5><span class="label">Example 8-12. </span>Using the color preferences with cookies (prefs_demo.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Front Door<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="cp">&lt;?php</code>
<code class="nv">$backgroundName</code> <code class="o">=</code> <code class="nv">$_COOKIE</code><code class="p">[</code><code class="s1">'bg'</code><code class="p">];</code>
<code class="nv">$foregroundName</code> <code class="o">=</code> <code class="nv">$_COOKIE</code><code class="p">[</code><code class="s1">'fg'</code><code class="p">];</code>
<code class="cp">?&gt;</code>
<code class="nt">&lt;body</code> <code class="na">bgcolor=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$backgroundName</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">text=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$foregroundName</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code><code class="nt">&gt;</code>

<code class="nt">&lt;h1&gt;</code>Welcome to the Store<code class="nt">&lt;/h1&gt;</code>

<code class="nt">&lt;p&gt;</code>We have many fine products for you to view. Please feel free to browse
the aisles and stop an assistant at any time. But remember, you break it
you bought it!<code class="nt">&lt;/p&gt;</code>

<code class="nt">&lt;p&gt;</code>Would you like to <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"colors.php"</code><code class="nt">&gt;</code>change your preferences?<code class="nt">&lt;/a&gt;&lt;/p&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>There are plenty of caveats about the use of cookies. Not all clients (browsers) support or accept cookies, and even if the client does support cookies, the user can turn them off. Furthermore, the cookie specification says that no cookie can exceed 4 KB in size, only 20 cookies are allowed per domain, and a total of 300 cookies can be stored on the client side. Some browsers may have higher limits, but you can’t rely on that. Finally, you have no control over when browsers actually expire cookies—if a browser is at capacity and needs to add a new cookie, it may discard a cookie that has not yet expired. You should also be careful of setting cookies to expire quickly. Expiration times rely on the client’s clock being as accurate as yours. Many people do not have their system clocks set accurately, so you can’t rely on rapid expirations.</p>
<p>Despite these limitations, cookies are very useful for retaining information through repeated visits by a browser.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_cookies" id="idm45922765976984"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_cookies_http" id="idm45922765975736"/></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sessions"><div class="sect2" id="sessions">
<h2>Sessions</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="sessions" id="ix_sessions_http_ch8"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="sessions with" id="ix_http_sessions"/>PHP has built-in support for sessions, handling all the cookie manipulation for you to provide persistent variables that are accessible from different pages and across multiple visits to the site. Sessions allow you to easily create multipage forms (such as shopping carts), save user authentication information from page to page, and store persistent user preferences on a site.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="URLs" data-secondary="session IDs in" id="idm45922765969528"/>Each first-time visitor is issued a unique session ID. By default, the session ID is stored in a cookie called <a contenteditable="false" data-type="indexterm" data-primary="PHPSESSID cookie" id="idm45922765967896"/><code>PHPSESSID</code>. If the user’s browser does not support cookies or has cookies turned off, the session ID is propagated in URLs within the website.</p>
<p>Every session has a data store associated with it. You can <em>register</em> variables to be loaded from the data store when each page starts and saved back to the data store when the page ends. Registered variables persist between pages, and changes to variables made on one page are visible from others. For example, an “add this to your shopping cart” link can take the user to a page that adds an item to a registered array of items in the cart. This registered array can then be used on another page to display the contents of the cart.</p>
<section data-type="sect3" data-pdf-bookmark="Session basics"><div class="sect3" id="session_basics">
<h3>Session basics</h3>
<p>Sessions start automatically when a script begins running. A new session ID is generated if necessary, possibly creating a cookie to be sent to the browser, and loads any persistent variables from the store.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="$_SESSION array" id="idm45922765962280"/>You can register a variable with the session by passing the name of the variable to the <code>$_SESSION[]</code> array. For example, here is a basic hit counter:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">session_start</code><code class="p">();</code>
<code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'hits'</code><code class="p">]</code> <code class="o">=</code> <code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'hits'</code><code class="p">]</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code>

<code class="k">echo</code> <code class="s2">"This page has been viewed </code><code class="si">{</code><code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'hits'</code><code class="p">]</code><code class="si">}</code><code class="s2"> times."</code><code class="p">;</code></pre>
<p>The <a contenteditable="false" data-type="indexterm" data-primary="session_start function" id="idm45922766031176"/><code>session_start()</code> function loads registered variables into the associative array <code>$_SESSION</code>. The keys are the variables’ names (e.g., <code>$_SESSION['hits']</code>). If you’re curious, the <a contenteditable="false" data-type="indexterm" data-primary="session_id function" id="idm45922766315320"/><code>session_id()</code> function returns the current session ID.</p>
<p>To end a session, call <a contenteditable="false" data-type="indexterm" data-primary="session_destroy function" id="idm45922766313448"/><code>session_destroy()</code>. This removes the data store for the current session, but it doesn’t remove the cookie from the browser cache. This means that, on subsequent visits to sessions-enabled pages, the user will have the same session ID as before the call to <code>session_destroy()</code>, but none of the data.</p>
<p><a data-type="xref" href="#example_eight_onethreedot_setting_prefe">Example 8-13</a> shows the code from <a data-type="xref" href="#example_eight_oneonedot_setting_prefere">Example 8-11</a> rewritten to use sessions instead of manually setting cookies.</p>
<div data-type="example" id="example_eight_onethreedot_setting_prefe">
<h5><span class="label">Example 8-13. </span>Setting preferences with sessions (prefs_session.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code><code> </code><code class="nb">session_start</code><code class="p">();</code><code> </code><code class="cp">?&gt;</code><code>

</code><code class="nt">&lt;html</code><code class="nt">&gt;</code><code>
</code><code class="nt">&lt;head</code><code class="nt">&gt;</code><code class="nt">&lt;title</code><code class="nt">&gt;</code><code>Preferences Set</code><code class="nt">&lt;/title&gt;</code><code class="nt">&lt;/head&gt;</code><code>
</code><code class="nt">&lt;body</code><code class="nt">&gt;</code><code>

</code><code class="cp">&lt;?php</code><code>
</code><code class="nv">$colors</code><code> </code><code class="o">=</code><code> </code><strong><code class="k">array</code></strong><code class="p">(</code><code>
 </code><code class="s1">'black'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s2">"</code><code class="s2">#000000</code><code class="s2">"</code><code class="p">,</code><code>
 </code><code class="s1">'white'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s2">"</code><code class="s2">#ffffff</code><code class="s2">"</code><code class="p">,</code><code>
 </code><code class="s1">'red'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s2">"</code><code class="s2">#ff0000</code><code class="s2">"</code><code class="p">,</code><code>
 </code><code class="s1">'blue'</code><code> </code><code class="o">=&gt;</code><code> </code><code class="s2">"</code><code class="s2">#0000ff</code><code class="s2">"</code><code>
</code><code class="p">);</code><code>

</code><code class="nv">$bg</code><code> </code><code class="o">=</code><code> </code><code class="nv">$colors</code><code class="p">[</code><strong><code class="nv">$_POST</code></strong><code class="p">[</code><code class="s1">'background'</code><code class="p">]];</code><code>
</code><code class="nv">$fg</code><code> </code><code class="o">=</code><code> </code><code class="nv">$colors</code><code class="p">[</code><strong><code class="nv">$_POST</code></strong><code class="p">[</code><code class="s1">'foreground'</code><code class="p">]];</code><code>

</code><strong><code class="nv">$_SESSION</code></strong><code class="p">[</code><code class="s1">'bg'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="nv">$bg</code><code class="p">;</code><code>
</code><strong><code class="nv">$_SESSION</code></strong><code class="p">[</code><code class="s1">'fg'</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="nv">$fg</code><code class="p">;</code><code>
</code><code class="cp">?&gt;</code><code>

</code><code class="nt">&lt;p</code><code class="nt">&gt;</code><code>Thank you. Your preferences have been changed to:</code><code class="nt">&lt;br</code><code> </code><code class="nt">/&gt;</code><code>
Background: </code><code class="cp">&lt;?php</code><code> </code><strong><code class="k">echo</code><code> </code><code class="nv">$_POST</code></strong><code class="p">[</code><code class="s1">'background'</code><code class="p">];</code><code> </code><code class="cp">?&gt;</code><code class="nt">&lt;br</code><code> </code><code class="nt">/&gt;</code><code>
Foreground: </code><code class="cp">&lt;?php</code><code> </code><strong><code class="k">echo</code><code> </code><code class="nv">$_POST</code></strong><code class="p">[</code><code class="s1">'foreground'</code><code class="p">];</code><code> </code><code class="cp">?&gt;</code><code class="nt">&lt;/p&gt;</code><code>

</code><code class="nt">&lt;p</code><code class="nt">&gt;</code><code>Click </code><code class="nt">&lt;a</code><code> </code><code class="na">href=</code><code class="s">"prefs_session_demo.php"</code><code class="nt">&gt;</code><code>here</code><code class="nt">&lt;/a&gt;</code><code> to see the preferences
in action.</code><code class="nt">&lt;/p&gt;</code><code>

</code><code class="nt">&lt;/body&gt;</code><code>
</code><code class="nt">&lt;/html&gt;</code></pre>
</div>
<p><a data-type="xref" href="#example_eight_onefourdot_using_preferen">Example 8-14</a> shows <a data-type="xref" href="#example_eight_onetwodot_using_the_color">Example 8-12</a> rewritten to use sessions. Once the session is started, the <code>$bg</code> and <code>$fg</code> variables are created, and all the script has to do is use them.</p>
<div data-type="example" id="example_eight_onefourdot_using_preferen">
<h5><span class="label">Example 8-14. </span>Using preferences from sessions (prefs_session_demo.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code><code>
</code><code class="nb">session_start</code><code class="p">()</code><code> </code><code class="p">;</code><code>
</code><code class="nv">$backgroundName</code><code> </code><code class="o">=</code><code> </code><strong><code class="nv">$_SESSION</code></strong><code class="p">[</code><code class="s1">'bg'</code><code class="p">]</code><code> </code><code class="p">;</code><code>
</code><code class="nv">$foregroundName</code><code> </code><code class="o">=</code><code> </code><strong><code class="nv">$_SESSION</code></strong><code class="p">[</code><code class="s1">'fg'</code><code class="p">]</code><code> </code><code class="p">;</code><code>
</code><code class="cp">?&gt;</code><code>
</code><code class="nt">&lt;html</code><code class="nt">&gt;</code><code>
</code><code class="nt">&lt;head</code><code class="nt">&gt;</code><code class="nt">&lt;title</code><code class="nt">&gt;</code><code>Front Door</code><code class="nt">&lt;/title&gt;</code><code class="nt">&lt;/head&gt;</code><code>
</code><code class="nt">&lt;body</code><code> </code><code class="na">bgcolor=</code><code class="s">"</code><code class="cp">&lt;?php</code><code> </code><strong><code class="k">echo</code></strong><code> </code><code class="nv">$backgroundName</code><code class="p">;</code><code> </code><code class="cp">?&gt;</code><code class="s">"</code><code> </code><code class="na">text=</code><code class="s">"</code><code class="cp">&lt;?php</code><code> </code><strong><code class="k">echo</code></strong><code> </code><code class="nv">$foregroundName</code><code class="p">;</code><code> </code><code class="cp">?&gt;</code><code class="s">"</code><code class="nt">&gt;</code><code>

</code><code class="nt">&lt;h1</code><code class="nt">&gt;</code><code>Welcome to the Store</code><code class="nt">&lt;/h1&gt;</code><code>

</code><code class="nt">&lt;p</code><code class="nt">&gt;</code><code>We have many fine products for you to view. Please feel free to browse
the aisles and stop an assistant at any time. But remember, you break it
you bought it!</code><code class="nt">&lt;/p&gt;</code><code>

</code><code class="nt">&lt;p</code><code class="nt">&gt;</code><code>Would you like to </code><code class="nt">&lt;a</code><code> </code><code class="na">href=</code><code class="s">"colors.php"</code><code class="nt">&gt;</code><code>change your preferences?</code><code class="nt">&lt;/a&gt;</code><code class="nt">&lt;/p&gt;</code><code>

</code><code class="nt">&lt;/body&gt;</code><code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>To see this change, simply update the action destination in the <em>colors.php</em> file. By default, PHP session ID cookies expire when the browser closes. That is, sessions don’t persist after the browser ceases to exist. To change this, you’ll need to set the <a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="session.cookie_lifetime option" id="idm45922765805176"/><a contenteditable="false" data-type="indexterm" data-primary="session.cookie_lifetime option, php.ini file" id="idm45922765803896"/><code>session.cookie_lifetime</code> option in <em>php.ini</em> to the lifetime of the cookie in seconds.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Alternatives to cookies"><div class="sect3" id="alternatives_to_cookies">
<h3>Alternatives to cookies</h3>
<p>By default, the session ID is passed from page to page in the <code>PHPSESSID</code> cookie. However, PHP’s session system supports two alternatives: form fields and URLs. Passing the session ID via hidden form fields is extremely awkward, as it forces you to make every link between pages to be a form’s submit button. We will not discuss this method further here.</p>
<p>The URL system for passing around the session ID, however, is somewhat more elegant. PHP can rewrite your HTML files, adding the session ID to every relative link. For this to work, though, PHP must be configured with the <code>-enable-trans-id</code> option when compiled. There is a performance penalty for this, as PHP must parse and rewrite every page. Busy sites may wish to stick with cookies, as they do not incur the slowdown caused by page rewriting. In addition, this exposes your session IDs, potentially allowing for man-in-the-middle attacks.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Custom storage"><div class="sect3" id="custom_storage">
<h3>Custom storage</h3>
<p>By default, PHP stores session information in files in your server’s temporary directory. Each session’s variables are stored in a separate file. Every variable is serialized into the file in a proprietary format. You can change all of these values in the <a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="session.save_path option" id="idm45922765758456"/><a contenteditable="false" data-type="indexterm" data-primary="session.save_path option, php.ini file" id="idm45922765740712"/><em>php.ini</em> file.</p>
<p>You can change the location of the session files by setting the <code>session.save_path</code> value in <em>php.ini</em>. If you are on a shared server with your own installation of PHP, set the directory to somewhere in your own directory tree, so other users on the same machine cannot access your session files.</p>
<p>PHP can store session information in one of two formats in the current session store—either PHP’s built-in format or Web Distributed Data eXchange (WDDX). You can change the format by setting the <a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="session.serialize_handler option" id="idm45922765737160"/><a contenteditable="false" data-type="indexterm" data-primary="session.serialize_handler option, php.ini file" id="idm45922765735944"/><code>session.serialize_handler</code> value in your <em>php.ini</em> file to either <code>php</code> for the default behavior, or <code>wddx</code> for WDDX format.</p>
</div></section>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Combining Cookies and Sessions"><div class="sect2" id="combining_cookies_and_sessions">
<h2>Combining Cookies and Sessions</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="cookies" id="idm45922765732008"/><a contenteditable="false" data-type="indexterm" data-primary="HTTP (HyperText Transfer Protocol)" data-secondary="cookies with" id="idm45922765731032"/>Using a combination of cookies and your own session handler, you can preserve state across visits. Any state that should be forgotten when a user leaves the site, such as which page the user is on, can be left up to PHP’s built-in sessions. Any state that should persist between user visits, such as a unique user ID, can be stored in a cookie. With the user ID, you can retrieve the user’s more permanent state (display preferences, mailing address, etc.) from a permanent store, such as a database.</p>
<p><a data-type="xref" href="#example_eight_onefivedot_saving_state_a">Example 8-15</a> allows the user to select text and background colors and stores those values in a cookie. Any visits to the page within the next week send the color values in the cookie.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_maintain_state" id="idm45922765727848"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_maintain_state_http" id="idm45922765726632"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_webserver_maintain_state" id="idm45922765725416"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_sessions_http_ch8" id="idm45922765724200"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_http_sessions" id="idm45922765722984"/></p>
<div data-type="example" id="example_eight_onefivedot_saving_state_a">
<h5><span class="label">Example 8-15. </span>Saving state across visits (save_state.php)</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code>
<code class="k">if</code><code class="p">(</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'bgcolor'</code><code class="p">])</code> <code class="p">{</code>
 <code class="nb">setcookie</code><code class="p">(</code><code class="s1">'bgcolor'</code><code class="p">,</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'bgcolor'</code><code class="p">],</code> <code class="nb">time</code><code class="p">()</code> <code class="o">+</code> <code class="p">(</code><code class="mi">60</code> <code class="o">*</code> <code class="mi">60</code> <code class="o">*</code> <code class="mi">24</code> <code class="o">*</code> <code class="mi">7</code><code class="p">));</code>
<code class="p">}</code>

<code class="k">if</code> <code class="p">(</code><code class="nb">isset</code><code class="p">(</code><code class="nv">$_COOKIE</code><code class="p">[</code><code class="s1">'bgcolor'</code><code class="p">]))</code> <code class="p">{</code>
 <code class="nv">$backgroundName</code> <code class="o">=</code> <code class="nv">$_COOKIE</code><code class="p">[</code><code class="s1">'bgcolor'</code><code class="p">];</code>
<code class="p">}</code>
<code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nb">isset</code><code class="p">(</code><code class="nv">$_POST</code><code class="p">[</code><code class="s1">'bgcolor'</code><code class="p">]))</code> <code class="p">{</code>
 <code class="nv">$backgroundName</code> <code class="o">=</code> <code class="nv">$_POST</code><code class="p">[</code><code class="s1">'bgcolor'</code><code class="p">];</code>
<code class="p">}</code>
<code class="k">else</code> <code class="p">{</code>
 <code class="nv">$backgroundName</code> <code class="o">=</code> <code class="s2">"gray"</code><code class="p">;</code>
<code class="p">}</code> <code class="cp">?&gt;</code>
<code class="nt">&lt;html&gt;</code>
<code class="nt">&lt;head&gt;&lt;title&gt;</code>Save It<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body</code> <code class="na">bgcolor=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$backgroundName</code><code class="p">;</code> <code class="cp">?&gt;</code><code class="s">"</code><code class="nt">&gt;</code>

<code class="nt">&lt;form</code> <code class="na">action=</code><code class="s">"</code><code class="cp">&lt;?php</code> <code class="k">echo</code> <code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'PHP_SELF'</code><code class="p">];</code> <code class="cp">?&gt;</code><code class="s">"</code> <code class="na">method=</code><code class="s">"POST"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;p&gt;</code>Background color:
 <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"bgcolor"</code><code class="nt">&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"gray"</code><code class="nt">&gt;</code>Gray<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"white"</code><code class="nt">&gt;</code>White<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"black"</code><code class="nt">&gt;</code>Black<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"blue"</code><code class="nt">&gt;</code>Blue<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"green"</code><code class="nt">&gt;</code>Green<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"red"</code><code class="nt">&gt;</code>Red<code class="nt">&lt;/option&gt;</code>
 <code class="nt">&lt;/select&gt;&lt;/p&gt;</code>

 <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"submit"</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/form&gt;</code>

<code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="SSL"><div class="sect1" id="ssl">
<h1>SSL</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="Secure Sockets Layer (SSL)" id="idm45922765717640"/><a contenteditable="false" data-type="indexterm" data-primary="SSL (Secure Sockets Layer)" id="idm45922765582472"/>The Secure Sockets Layer (SSL) provides a secure channel over which regular HTTP requests and responses can flow. PHP doesn’t specifically concern itself with SSL, so you cannot control the encryption in any way from PHP. <a contenteditable="false" data-type="indexterm" data-primary="HTTPS" id="idm45922765581032"/>An <em>https://</em> URL indicates a secure connection for that document, unlike an <em>http://</em> URL.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="$_SERVER array" id="idm45922765578616"/>The <code>HTTPS</code> entry in the <code>$_SERVER</code> array is set to <code>'on'</code> if the PHP page was generated in response to a request over an SSL connection. To prevent a page from being generated over a nonencrypted connection, simply use:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">if</code> <code class="p">(</code><code class="nv">$_SERVER</code><code class="p">[</code><code class="s1">'HTTPS'</code><code class="p">]</code> <code class="o">!==</code> <code class="s1">'on'</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="s2">"Must be a secure connection."</code><code class="p">);</code>
<code class="p">}</code></pre>
<p>A common mistake is to send a form over a secure connection (e.g., <em>https://www.example.com/form.html</em>), but have the <code>action</code> of the <code>form</code> submit to an <em>http://</em> URL. Any form parameters then entered by the user are sent over an insecure connection, and a trivial packet sniffer can reveal them.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What’s Next"><div class="sect1" id="whatapostrophes_next-id00066">
<h1>What’s Next</h1>
<p>There are many tips, tricks, and gotchas in modern web development, and we hope that the ones this chapter has pointed out will be helpful as you build great sites. Coming in the next chapter is a discussion on saving data to data stores within PHP. We will cover most of the more commonly used approaches, like databases, SQL and NoSQL style, SQLite, and direct file information storage.</p>
</div></section>
</div></section></div>



  </body></html>