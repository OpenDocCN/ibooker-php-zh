<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Objects"><div class="chapter" id="objects-id00032">
<h1><span class="label">Chapter 6. </span>Objects</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="OOP (object-oriented programming)" id="idm45922775188456"/><a contenteditable="false" data-type="indexterm" data-primary="objects" id="ix_objects_ch6"/>In this chapter you’ll learn how to define, create, and use objects in PHP. Object-oriented programming (OOP) opens the door to cleaner designs, easier maintenance, and greater code reuse. OOP has proven so valuable that few today would dare to introduce a language that wasn’t object-oriented. PHP supports many useful features of OOP, and this chapter shows you how to use them, covering basic OOP concepts as well as advanced topics such as introspection and serialization.</p>
<section data-type="sect1" data-pdf-bookmark="Objects"><div class="sect1" id="objects-id00033">
<h1>Objects</h1>
<p>Object-oriented programming acknowledges the fundamental connection between data and the code that works on it, and lets you design and implement programs around that connection. For example, a bulletin-board system usually keeps track of many users. In a procedural programming language, each user is represented by a data structure, and there would probably be a set of functions that work with those data structures (to create the new users, get their information, etc.). In an OOP language, each user is represented by an <em>object</em>—a data structure with attached code. The data and the code are still there, but they’re treated as an inseparable unit. The object, as a union of code and data, is the modular unit for application development and code reuse.</p>
<p>In this hypothetical bulletin-board design, objects can represent not just users but also messages and threads. A user object has a username and password for that user, and code to identify all the messages by that author. A message object knows which thread it belongs to and has code to post a new message, reply to an existing message, and display messages. A thread object is a collection of message objects, and it has code to display a thread index. This is only one way of dividing the necessary functionality into objects, though. For instance, in an alternate design, the code to post a new message lives in the user object, not the message object.</p>
<p>Designing object-oriented systems is a complex topic, and many books have been written on it. The good news is that however you design your system, you can implement it in PHP. Let’s begin by introducing some of the key terms and concepts you’ll need to know before diving into this programming approach.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Terminology"><div class="sect1" id="terminology">
<h1>Terminology</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="objects" data-secondary="terminology in PHP" id="idm45922775240392"/>Every object-oriented language seems to have a different set of terms for the same old concepts. This section describes the terms that PHP uses, but be warned that in other languages these terms may have other meanings.</p>
<p>Let’s return to the example of the users of a bulletin board. You need to keep track of the same information for each user, and the same functions can be called on each user’s data structure. When you design the program, you decide the fields for each user and come up with the functions. In OOP terms, you’re designing the user <em>class</em>. A class is a template for building objects.</p>
<p>An <em>object</em> is an instance (or occurrence) of a class. In this case, it’s an actual user data structure with attached code. Objects and classes are a bit like values and data types. There’s only one integer data type, but there are many possible integers. Similarly, your program defines only one user class but can create many different (or identical) users from it.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="defined" id="idm45922775235928"/>The data associated with an object are called its <em>properties</em>. The functions associated with an object are called its <a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="defined" id="idm45922775234008"/><em>methods</em>. When you define a class, you define the names of its properties and give the code for its methods.</p>
<p>Debugging and maintenance of programs is much easier if you use <a contenteditable="false" data-type="indexterm" data-primary="encapsulation" id="idm45922775231688"/><em>encapsulation</em>. This is the idea that a class provides certain methods (the <em>interface</em>) to the code that uses its objects, so the outside code does not directly access the data structures of those objects. Debugging is thus easier because you know where to look for bugs—the only code that changes an object’s data structures is within the class—and maintenance is easier because you can swap out implementations of a class without changing the code that uses the class, as long as you maintain the same interface.</p>
<p>Any nontrivial object-oriented design probably involves <a contenteditable="false" data-type="indexterm" data-primary="inheritance" id="idm45922775228664"/><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="inheritance of" id="idm45922775227560"/><em>inheritance</em>. This is a way of defining a new class by saying that it’s like an existing class, but with certain new or changed properties and methods. The original class is called the <a contenteditable="false" data-type="indexterm" data-primary="superclass, defined" id="idm45922775225576"/><em>superclass</em> (or parent or base class), and the new class is called the <a contenteditable="false" data-type="indexterm" data-primary="subclass, defined" id="idm45922775224056"/><em>subclass</em> (or derived class). Inheritance is a form of code reuse—the superclass code is reused instead of being copied and pasted into the subclass. Any improvements or modifications to the superclass are automatically passed on to the subclass.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Creating an Object"><div class="sect1" id="creating_an_object">
<h1>Creating an Object</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="objects" data-secondary="creating" id="idm45922775220408"/>It’s much easier to create (or <em>instantiate</em>) objects and use them than it is to define object classes, so before we discuss how to define classes, let’s look at creating objects. To create an object of a given class, use the <a contenteditable="false" data-type="indexterm" data-primary="new keyword" id="idm45922775218280"/><code>new</code> keyword:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$</code><em><code class="nv">object</code></em><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><em><code class="nx">Class</code></em><code class="p">;</code></pre>
<p>Assuming that a <code>Person</code> class has been defined, here’s how to create a <code>Person</code> object:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$moana</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">;</code></pre>
<p>Do not quote the class name, or you’ll get a compilation error:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$moana</code> <code class="o">=</code> <code class="k">new</code> <code class="s2">"Person"</code><code class="p">;</code> <code class="c1">// does not work</code></pre>
<p>Some classes permit you to pass arguments to the <code>new</code> call. The class’s documentation should say whether it accepts arguments. If it does, you’ll create objects like this:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$object</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">(</code><code class="s2">"Sina"</code><code class="p">,</code> <code class="mi">35</code><code class="p">);</code></pre>
<p>The class name does not have to be hardcoded into your program. You can supply the class name through a variable:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$class</code> <code class="o">=</code> <code class="s2">"Person"</code><code class="p">;</code>
<code class="nv">$object</code> <code class="o">=</code> <code class="k">new</code> <code class="nv">$class</code><code class="p">;</code>
<code class="c1">// is equivalent to</code>
<code class="nv">$object</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">;</code></pre>
<p>Specifying a class that doesn’t exist causes a runtime error.</p>
<p>Variables containing object references are just normal variables—they can be used in the same ways as other variables. Note that variable variables work with objects, as shown here:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$account</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Account</code><code class="p">;</code>
<code class="nv">$object</code> <code class="o">=</code> <code class="s2">"account"</code><code class="p">;</code>
<code class="nv">${$object}</code><code class="o">-&gt;</code><code class="na">init</code><code class="p">(</code><code class="mi">50000</code><code class="p">,</code> <code class="mf">1.10</code><code class="p">);</code> <code class="c1">// same as $account-&gt;init</code></pre>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Accessing Properties and Methods"><div class="sect1" id="accessing_properties_and_methods">
<h1>Accessing Properties and Methods</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="accessing" id="ix_methods_access"/><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="accessing" id="ix_properties_access"/>Once you have an object, you can use the <a contenteditable="false" data-type="indexterm" data-primary="-&gt; (hyphen, right angle bracket)" id="idm45922775078584"/><a contenteditable="false" data-type="indexterm" data-primary="hyphen, right angle bracket (-&gt;), accessing object members" id="idm45922775035912"/><code>-&gt;</code> notation to access methods and properties of the object:</p>
<pre data-type="programlisting" data-code-language="php"><em><code class="nv">$object</code></em><code class="o">-&gt;</code><em><code class="na">propertyname</code><code> </code><code class="nv">$object</code></em><code class="o">-&gt;</code><em><code class="na">methodname</code></em><code class="p">([</code><em><code class="nx">arg</code></em><code class="p">,</code><code> </code><code class="o">...</code><code> </code><code class="p">])</code></pre>
<p>For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">echo</code> <code class="s2">"Moana is </code><code class="si">{</code><code class="nv">$moana</code><code class="o">-&gt;</code><code class="na">age</code><code class="si">}</code><code class="s2"> years old.</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code> <code class="c1">// property access</code>
<code class="nv">$moana</code><code class="o">-&gt;</code><code class="na">birthday</code><code class="p">();</code> <code class="c1">// method call</code>
<code class="nv">$moana</code><code class="o">-&gt;</code><code class="na">setAge</code><code class="p">(</code><code class="mi">21</code><code class="p">);</code> <code class="c1">// method call with arguments</code></pre>
<p>Methods act the same as functions (only specifically to the object in question), so they can take arguments and return a value:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$clan</code> <code class="o">=</code> <code class="nv">$moana</code><code class="o">-&gt;</code><code class="na">family</code><code class="p">(</code><code class="s2">"extended"</code><code class="p">);</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="public or private" id="idm45922775362248"/><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="public or private" id="idm45922775361032"/>Within a class’s definition, you can specify which methods and properties are publicly accessible and which are accessible only from within the class itself using the <a contenteditable="false" data-type="indexterm" data-primary="public keyword" id="idm45922775359336"/><a contenteditable="false" data-type="indexterm" data-primary="private keyword" id="idm45922775358232"/>public and private access modifiers. You can use these to provide <a contenteditable="false" data-type="indexterm" data-primary="encapsulation" id="idm45922775357000"/>encapsulation.</p>
<p>You can use variable variables with property names:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$prop</code> <code class="o">=</code> <code class="s1">'age'</code><code class="p">;</code>
<code class="k">echo</code> <code class="nv">$moana</code><code class="o">-&gt;</code><code class="nv">$prop</code><code class="p">;</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="static methods" id="idm45922775413976"/><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="static methods called on" id="idm45922775413000"/><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="static" id="idm45922775411688"/>A static method is one that is called on a class, not on an object. Such methods cannot access properties. The name of a static method is the class name followed by <a contenteditable="false" data-type="indexterm" data-primary="colons, double (::)" data-secondary="preceding static method calls" id="idm45922775410008"/><a contenteditable="false" data-type="indexterm" data-primary=":: (colons, double)" data-secondary="preceding static method calls" id="idm45922775408664"/>two colons and the function name. For instance, this calls the <code>p()</code> static method in the HTML class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nx">HTML</code><code class="o">::</code><code class="na">p</code><code class="p">(</code><code class="s2">"Hello, world"</code><code class="p">);</code></pre>
<p>When declaring a class, you define which properties and methods are static using the static access property.</p>
<p>Once created, objects are passed by reference—that is, instead of copying around the entire object itself (a time- and memory-consuming endeavor), a reference to the object is passed around instead. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$f</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Person</code><code class="p">(</code><code class="s2">"</code><code class="s2">Pua</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="mi">75</code><code class="p">);</code><code>

</code><code class="nv">$b</code><code> </code><code class="o">=</code><code> </code><code class="nv">$f</code><code class="p">;</code><code> </code><code class="c1">// $b and $f point at same object
</code><code class="nv">$b</code><code class="o">-&gt;</code><code class="na">setName</code><code class="p">(</code><code class="s2">"</code><code class="s2">Hei Hei</code><code class="s2">"</code><code class="p">);</code><code>

</code><code class="nb">printf</code><code class="p">(</code><code class="s2">"</code><code class="s2">%s and %s are best friends.</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="nv">$b</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">(),</code><code> </code><code class="nv">$f</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">());</code><code>
</code><strong><code class="nx">Hei</code><code> </code><code class="nx">Hei</code><code> </code><code class="k">and</code><code> </code><code class="nx">Hei</code><code> </code><code class="nx">Hei</code><code> </code><code class="nx">are</code><code> </code><code class="nx">best</code><code> </code><code class="nx">friends</code><code class="o">.</code></strong></pre>
<p>If you want to create a true copy of an object, you use the clone operator<a contenteditable="false" data-type="indexterm" data-primary="clone operator" id="idm45922774673016"/>:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$f</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Person</code><code class="p">(</code><code class="s2">"</code><code class="s2">Pua</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="mi">35</code><code class="p">);</code><code>

</code><code class="nv">$b</code><code> </code><code class="o">=</code><code> </code><code class="k">clone</code><code> </code><code class="nv">$f</code><code class="p">;</code><code> </code><code class="c1">// make a copy
</code><code class="nv">$b</code><code class="o">-&gt;</code><code class="na">setName</code><code class="p">(</code><code class="s2">"</code><code class="s2">Hei Hei</code><code class="s2">"</code><code class="p">);</code><code class="c1">// change the copy
</code><code>
</code><code class="nb">printf</code><code class="p">(</code><code class="s2">"</code><code class="s2">%s and %s are best friends.</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="nv">$b</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">(),</code><code> </code><code class="nv">$f</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">());</code><code>
</code><strong><code class="nx">Pua</code><code> </code><code class="k">and</code><code> </code><code class="nx">Hei</code><code> </code><code class="nx">Hei</code><code> </code><code class="nx">are</code><code> </code><code class="nx">best</code><code> </code><code class="nx">friends</code><code class="o">.</code></strong></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="objects" data-secondary="cloning" id="idm45922774599288"/>When you use the clone operator to create a copy of an object and that class declares the <a contenteditable="false" data-type="indexterm" data-primary="__clone method" data-primary-sortas="clone method" id="idm45922774600920"/><code>__clone()</code> method, that method is called on the new object immediately after it’s cloned. You might use this in cases where an object holds external resources (such as file handles) to create new resources, rather than copying the existing ones.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_properties_access" id="idm45922774584136"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_methods_access" id="idm45922774628648"/></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Declaring a Class"><div class="sect1" id="declaring_a_class">
<h1>Declaring a Class</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="declaring or defining" id="ix_classes_declare"/><a contenteditable="false" data-type="indexterm" data-primary="classes" id="ix_classes_ch6"/>To design your program or code library in an object-oriented fashion, you’ll need to define your own classes, using the <a contenteditable="false" data-type="indexterm" data-primary="class keyword" id="idm45922774540024"/><code>class</code> keyword. A class definition includes the class name and the properties and methods of the class. <a contenteditable="false" data-type="indexterm" data-primary="case sensitivity" data-secondary="of class names" data-secondary-sortas="class names" id="idm45922774538392"/><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="case sensitivity of" id="idm45922774536744"/>Class names are case-insensitive and must conform to the rules for PHP identifiers. Among others, the class name <code>stdClass</code> is reserved. Here’s the syntax for a class definition:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">classname</code> <code class="p">[</code> <code class="k">extends</code> <code class="nx">baseclass</code> <code class="p">]</code> <code class="p">[</code> <code class="k">implements</code> <code class="nx">interfacename</code> <code class="p">,</code>
 <code class="p">[</code><code class="nx">interfacename</code><code class="p">,</code> <code class="o">...</code> <code class="p">]</code> <code class="p">]</code> <code class="p">{</code>
 <code class="p">[</code> <code class="k">use</code> <code class="nx">traitname</code><code class="p">,</code> <code class="p">[</code> <code class="nx">traitname</code><code class="p">,</code> <code class="o">...</code> <code class="p">];</code> <code class="p">]</code>

 <code class="p">[</code> <code class="nx">visibility</code> <code class="nv">$property</code> <code class="p">[</code> <code class="o">=</code> <code class="nx">value</code> <code class="p">];</code> <code class="o">...</code> <code class="p">]</code>

 <code class="p">[</code> <code class="k">function</code> <code class="nf">functionname</code> <code class="p">(</code><code class="nx">args</code><code class="p">)</code> <code class="p">[</code><code class="o">:</code> <code class="nx">type</code> <code class="p">]</code> <code class="p">{</code>
 <code class="c1">// code</code>
 <code class="p">}</code>
 <code class="o">...</code>
 <code class="p">]</code>
<code class="p">}</code></pre>
<section data-type="sect2" data-pdf-bookmark="Declaring Methods"><div class="sect2" id="declaring_methods">
<h2>Declaring Methods</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="declaring or defining" id="ix_methods_declare"/>A method is a function defined inside a class. Although PHP imposes no special restrictions, most methods act only on data within the object in which the method resides. Method names beginning with two <a contenteditable="false" data-type="indexterm" data-primary="__ (underscores, two), reserved for methods in PHP" id="idm45922774463224"/><a contenteditable="false" data-type="indexterm" data-primary="underscores, two (__), reserved for methods in PHP" id="idm45922774462088"/>underscores (<code>__</code>) may be used in the future by PHP (and are currently used for the object serialization methods <code>__sleep()</code> and <code>__wakeup()</code>, described later in this chapter, among others), so it’s recommended that you do not begin your method names with this sequence.</p>
<p>Within a method, the <code>$this</code> variable contains a reference to the object on which the method was called. For instance, if you call <code>$moana-&gt;birthday()</code>, inside the <code>birthday()</code> method, <code>$this</code> holds the same value as <code>$moana</code>. Methods use the <code>$this</code> variable to access the properties of the current object and to call other methods on that object.</p>
<p>Here’s a simple class definition of the <code>Person</code> class that shows the <code>$this</code> variable in action:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$name</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf">getName</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf">setName</code><code class="p">(</code><code class="nv">$newName</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code> <code class="o">=</code> <code class="nv">$newName</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>As you can see, the <code>getName()</code> and <code>setName()</code> methods use <code>$this</code> to access and set the <code>$name</code> property of the current object.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="static" id="idm45922774418776"/><a contenteditable="false" data-type="indexterm" data-primary="static methods" id="idm45922774417400"/>To declare a method as a static method, use the <a contenteditable="false" data-type="indexterm" data-primary="static keyword" id="idm45922774416104"/><code>static</code> keyword. Inside of static methods the variable <a contenteditable="false" data-type="indexterm" data-primary="$this variable" id="idm45922774414520"/><code>$this</code> is not defined. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">HTMLStuff</code> <code class="p">{</code>
 <code class="k">static</code> <code class="k">function</code> <code class="nf">startTable</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;table border=</code><code class="se">\"</code><code class="s2">1</code><code class="se">\"</code><code class="s2">&gt;</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="k">static</code> <code class="k">function</code> <code class="nf">endTable</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;/table&gt;</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="nx">HTMLStuff</code><code class="o">::</code><code class="na">startTable</code><code class="p">();</code>
 <code class="c1">// print HTML table rows and columns</code>
<code class="nx">HTMLStuff</code><code class="o">::</code><code class="na">endTable</code><code class="p">();</code></pre>
<p>If you declare a method using the <a contenteditable="false" data-type="indexterm" data-primary="final keyword" id="idm45922774353880"/><code>final</code> keyword, subclasses cannot <a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="preventing from overriding" id="idm45922774337272"/>override that method. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$name</code><code class="p">;</code>

 <code class="k">final</code> <code class="k">function</code> <code class="nf">getName</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Child</code> <code class="k">extends</code> <code class="nx">Person</code> <code class="p">{</code>
 <code class="c1">// syntax error</code>
 <code class="k">function</code> <code class="nf">getName</code><code class="p">()</code> <code class="p">{</code>
 <code class="c1">// do something</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>Using access modifiers, you can change the visibility of methods. Methods that are accessible outside methods on the object should be declared <a contenteditable="false" data-type="indexterm" data-primary="public keyword" id="idm45922774252792"/><a contenteditable="false" data-type="indexterm" data-primary="private keyword" id="idm45922774251816"/><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="public or private" id="idm45922774250744"/><code>public</code>; methods on an instance that can be called only by methods within the same class should be declared <code>private</code>. Finally, methods declared as <a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="protected" id="idm45922774248424"/><code>protected</code> can be called only from within the object’s class methods and the class methods of classes inheriting from the class. Defining the visibility of class methods is optional; if a visibility is not specified, a method is public. For example, you might define:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$age</code><code class="p">;</code>

 <code class="k">public</code> <code class="k">function</code> <code class="nf-Magic">__construct</code><code class="p">()</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">age</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="k">public</code> <code class="k">function</code> <code class="nf">incrementAge</code><code class="p">()</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">age</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">ageChanged</code><code class="p">();</code>
 <code class="p">}</code>

 <code class="k">protected</code> <code class="k">function</code> <code class="nf">decrementAge</code><code class="p">()</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">age</code> <code class="o">-=</code> <code class="mi">1</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">ageChanged</code><code class="p">();</code>
 <code class="p">}</code>

 <code class="k">private</code> <code class="k">function</code> <code class="nf">ageChanged</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"Age changed to </code><code class="si">{</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">age</code><code class="si">}</code><code class="s2">"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">SupernaturalPerson</code> <code class="k">extends</code> <code class="nx">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="k">function</code> <code class="nf">incrementAge</code><code class="p">()</code> <code class="p">{</code>
 <code class="c1">// ages in reverse</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">decrementAge</code><code class="p">();</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="nv">$person</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">;</code>
<code class="nv">$person</code><code class="o">-&gt;</code><code class="na">incrementAge</code><code class="p">();</code>
<code class="nv">$person</code><code class="o">-&gt;</code><code class="na">decrementAge</code><code class="p">();</code> <code class="c1">// not allowed</code>
<code class="nv">$person</code><code class="o">-&gt;</code><code class="na">ageChanged</code><code class="p">();</code> <code class="c1">// also not allowed</code>

<code class="nv">$person</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">SupernaturalPerson</code><code class="p">;</code>
<code class="nv">$person</code><code class="o">-&gt;</code><code class="na">incrementAge</code><code class="p">();</code> <code class="c1">// calls decrementAge under the hood</code></pre>
<p>You can use <a contenteditable="false" data-type="indexterm" data-primary="type hinting, functions" id="idm45922774243560"/><a contenteditable="false" data-type="indexterm" data-primary="functions" data-secondary="type hinting" id="idm45922774242584"/>type hinting (described in <a data-type="xref" href="ch03.xhtml#functions">Chapter 3</a>) when declaring a method on an object:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_methods_declare" id="idm45922773910568"/></p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf">takeJob</code><code class="p">(</code><code class="nx">Job</code> <code class="nv">$job</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"Now employed as a </code><code class="si">{</code><code class="nv">$job</code><code class="o">-&gt;</code><code class="na">title</code><code class="si">}</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>When a method returns a value, you can use type hinting to declare the method’s return value type:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf">bestJob</code><code class="p">()</code><code class="o">:</code> <code class="nx">Job</code> <code class="p">{</code>
 <code class="nv">$job</code> <code class="o">=</code> <code class="nx">Job</code><code class="p">(</code><code class="s2">"PHP developer"</code><code class="p">);</code>

 <code class="k">return</code> <code class="nv">$job</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Declaring Properties"><div class="sect2" id="declaring_properties">
<h2>Declaring Properties</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="declaring or defining" id="ix_properties_declare"/>In the previous definition of the <code>Person</code> class, we explicitly declared the <code>$name</code> property. Property declarations are optional and are simply a courtesy to whomever maintains your program. It’s good PHP style to declare your properties, but you can add new properties at any time.</p>
<p>Here’s a version of the <code>Person</code> class that has an undeclared <code>$name</code> property:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf">getName</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf">setName</code><code class="p">(</code><code class="nv">$newName</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code> <code class="o">=</code> <code class="nv">$newName</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>You can assign default values to properties, but those default values must be simple constants:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">public</code> <code class="nv">$name</code> <code class="o">=</code> <code class="s2">"J Doe"</code><code class="p">;</code> <code class="c1">// works</code>
<code class="k">public</code> <code class="nv">$age</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="c1">// works</code>
<code class="k">public</code> <code class="nv">$day</code> <code class="o">=</code> <code class="mi">60</code> <code class="o">*</code> <code class="mi">60</code> <code class="o">*</code> <code class="nx">hoursInDay</code><code class="p">();</code> <code class="c1">// doesn't work</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="public or private" id="idm45922773983848"/>Using access modifiers, you can change the visibility of properties. Properties that are accessible outside the object’s scope should be declared <a contenteditable="false" data-type="indexterm" data-primary="public keyword" id="idm45922774071048"/><a contenteditable="false" data-type="indexterm" data-primary="public properties" id="idm45922774069944"/><code>public</code>; properties on an instance that can be accessed only by methods within the same class should be declared <a contenteditable="false" data-type="indexterm" data-primary="private keyword" id="idm45922774068296"/><code>private</code>. Finally, properties declared as <a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="protected" id="idm45922774066776"/><a contenteditable="false" data-type="indexterm" data-primary="protected keyword" id="idm45922774065400"/><code>protected</code> can be accessed only by the object’s class methods and the class methods of classes inheriting from the class. For example, you might declare a user class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">protected</code> <code class="nv">$rowId</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

 <code class="k">public</code> <code class="nv">$username</code> <code class="o">=</code> <code class="s1">'Anyone can see me'</code><code class="p">;</code>

 <code class="k">private</code> <code class="nv">$hidden</code> <code class="o">=</code> <code class="k">true</code><code class="p">;</code>
<code class="p">}</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="static" id="idm45922773820360"/>In addition to properties on instances of objects, PHP allows you to define static properties, which are variables on an object class, and can be accessed by referencing the property with the class name. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">static</code> <code class="nv">$global</code> <code class="o">=</code> <code class="mi">23</code><code class="p">;</code>
<code class="p">}</code>

<code class="nv">$localCopy</code> <code class="o">=</code> <code class="nx">Person</code><code class="o">::</code><code class="nv">$global</code><code class="p">;</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary=":: (colons, double)" data-secondary="preceding static properties" id="idm45922773798872"/><a contenteditable="false" data-type="indexterm" data-primary="colons, double (::)" data-secondary="preceding static properties" id="idm45922773806344"/>Inside an instance of the object class, you can also refer to the static property using the <a contenteditable="false" data-type="indexterm" data-primary="self keyword" id="idm45922773804792"/><code>self</code> keyword, like <code>echo self::$global;</code>.</p>
<p>If a property is accessed on an object that doesn’t exist, and if the <a contenteditable="false" data-type="indexterm" data-primary="__get method" data-primary-sortas="get method" id="idm45922773767192"/><code>__get()</code> or <a contenteditable="false" data-type="indexterm" data-primary="__set method" data-primary-sortas="set method" id="idm45922773765400"/><code>__set()</code> method is defined for the object’s class, that method is given an opportunity to either retrieve a value or set the value for that property.</p>
<p>For example, you might declare a class that represents data pulled from a database, but you might not want to pull in large data values—such as Binary Large Objects (BLOBs)—unless specifically requested. One way to implement that, of course, would be to create access methods for the property that read and write the data whenever requested. Another method might be to use these overloading methods:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_properties_declare" id="idm45922773762584"/></p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="k">function</code> <code class="nf-Magic">__get</code><code class="p">(</code><code class="nv">$property</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">if</code> <code class="p">(</code><code class="nv">$property</code> <code class="o">===</code> <code class="s1">'biography'</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$biography</code> <code class="o">=</code> <code class="s2">"long text here..."</code><code class="p">;</code> <code class="c1">// would retrieve from database</code>

 <code class="k">return</code> <code class="nv">$biography</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="p">}</code>

 <code class="k">public</code> <code class="k">function</code> <code class="nf-Magic">__set</code><code class="p">(</code><code class="nv">$property</code><code class="p">,</code> <code class="nv">$value</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">if</code> <code class="p">(</code><code class="nv">$property</code> <code class="o">===</code> <code class="s1">'biography'</code><code class="p">)</code> <code class="p">{</code>
 <code class="c1">// set the value in the database</code>
 <code class="p">}</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Declaring Constants"><div class="sect2" id="declaring_constants">
<h2>Declaring Constants</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="constants in" id="idm45922773719320"/><a contenteditable="false" data-type="indexterm" data-primary="constants" id="idm45922773717944"/>As with global constants, assigned through the <a contenteditable="false" data-type="indexterm" data-primary="define function" id="idm45922773716712"/><code>define()</code> function, PHP provides a way to assign constants within a class. Like static properties, constants can be accessed directly through the class or within object methods using the <code>self</code> notation. <a contenteditable="false" data-type="indexterm" data-primary="const keyword" id="idm45922773714584"/>Once a constant is defined, its value cannot be changed:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">PaymentMethod</code><code> </code><code class="p">{</code><code>
 </code><code class="k">public</code><code> </code><code class="k">const</code><code> </code><code class="no">TYPE_CREDITCARD</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code>
 </code><code class="k">public</code><code> </code><code class="k">const</code><code> </code><code class="no">TYPE_CASH</code><code> </code><code class="o">=</code><code> </code><code class="mi">1</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="k">echo</code><code> </code><code class="nx">PaymentMethod</code><code class="o">::</code><code class="na">TYPE_CREDITCARD</code><code class="p">;</code><code>
</code><strong><code class="mi">0</code></strong></pre>
<p>As with global constants, it is common practice to define class constants with uppercase identifiers.</p>
<p>Using access modifiers, you can change the visibility of class constants. Class constants that are accessible outside methods on the object should be declared <a contenteditable="false" data-type="indexterm" data-primary="public keyword" id="idm45922773616360"/><code>public</code>; class constants on an instance that can be accessed only by methods within the same class should be declared <a contenteditable="false" data-type="indexterm" data-primary="private keyword" id="idm45922773614840"/><code>private</code>. Finally, constants declared as <a contenteditable="false" data-type="indexterm" data-primary="protected keyword" id="idm45922773613320"/><code>protected</code> can be accessed only from within the object’s class methods and the class methods of classes inheriting from the class. Defining the visibility of class constants is optional; if a visibility is not specified, a method is <code>public</code>. For example, you might define:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">protected</code> <code class="k">const</code> <code class="no">PROTECTED_CONST</code> <code class="o">=</code> <code class="k">false</code><code class="p">;</code>
 <code class="k">public</code> <code class="k">const</code> <code class="no">DEFAULT_USERNAME</code> <code class="o">=</code> <code class="s2">"&lt;unknown&gt;"</code><code class="p">;</code>
 <code class="k">private</code> <code class="nx">INTERNAL_KEY</code> <code class="o">=</code> <code class="s2">"ABC1234"</code><code class="p">;</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Inheritance"><div class="sect2" id="inheritance">
<h2>Inheritance</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="inheritance of" id="idm45922773581112"/><a contenteditable="false" data-type="indexterm" data-primary="inheritance" id="idm45922773579736"/>To inherit the properties and methods from another class, use the <a contenteditable="false" data-type="indexterm" data-primary="extends keyword" id="idm45922773576808"/><code>extends</code> keyword in the class definition, followed by the name of the base class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$name</code><code class="p">,</code> <code class="nv">$address</code><code class="p">,</code> <code class="nv">$age</code><code class="p">;</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Employee</code> <code class="k">extends</code> <code class="nx">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$position</code><code class="p">,</code> <code class="nv">$salary</code><code class="p">;</code>
<code class="p">}</code></pre>
<p>The <code>Employee</code> class contains the <code>$position</code> and <code>$salary</code> properties, as well as the <code>$name</code>, <code>$address</code>, and <code>$age</code> properties inherited from the <code>Person</code> class.</p>
<p>If a derived class has a property or method with the same name as one in its parent class, the property or method in the derived class takes precedence over the property or method in the parent class. Referencing the property returns the value of the property on the child, while referencing the method calls the method on the child.</p>
<p>Use the <code>parent::</code><em><code>method</code></em><code>()</code> notation to access an overridden method on an object’s parent class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">parent</code><code class="o">::</code><code class="na">birthday</code><code class="p">();</code> <code class="c1">// call parent class's birthday() method</code></pre>
<p>A common mistake is to hardcode the name of the parent class into calls to overridden methods:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nx">Creature</code><code class="o">::</code><code class="na">birthday</code><code class="p">();</code> <code class="c1">// when Creature is the parent class</code></pre>
<p>This is a mistake because it distributes knowledge of the parent class’s name throughout the derived class. Using <code>parent::</code> centralizes the knowledge of the parent class in the <code>extends</code> clause.</p>
<p>If a method might be subclassed and you want to ensure that you’re calling it on the current class, use the <code>self::</code><em><code>method</code></em><code>()</code> notation:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nx">self</code><code class="o">::</code><code class="na">birthday</code><code class="p">();</code> <code class="c1">// call this class's birthday() method</code></pre>
<p>To check if an object is an instance of a particular class or if it implements a particular interface (see the section “Interfaces”), you can use the <a contenteditable="false" data-type="indexterm" data-primary="extends keyword" id="idm45922773419784"/><code>instanceof</code> operator:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">if</code> <code class="p">(</code><code class="nv">$object</code> <code class="nx">instanceof</code> <code class="nx">Animal</code><code class="p">)</code> <code class="p">{</code>
 <code class="c1">// do something</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Interfaces"><div class="sect2" id="interfaces">
<h2>Interfaces</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="interfaces for" id="idm45922773453816"/><a contenteditable="false" data-type="indexterm" data-primary="interfaces, defining for classes" id="idm45922773399240"/>Interfaces provide a way for defining contracts to which a class adheres; the interface provides method prototypes and constants, and any class that implements the interface must provide implementations for all methods in the interface. Here’s the syntax for an interface definition:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">interface</code><code> </code><em><code class="nx">interfacename</code></em><code> </code><code class="p">{</code><code>
 </code><code class="p">[</code><code> </code><code class="k">function</code><code> </code><em><code class="nf">functionname</code></em><code class="p">();</code><code>
 </code><code class="o">...</code><code>
 </code><code class="p">]</code><code>
</code><code class="p">}</code></pre>
<p>To declare that a class implements an interface, include the <a contenteditable="false" data-type="indexterm" data-primary="implements keyword" id="idm45922773373128"/><code>implements</code> keyword and any number of interfaces, separated by commas:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">interface</code> <code class="nx">Printable</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf">printOutput</code><code class="p">();</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">ImageComponent</code> <code class="k">implements</code> <code class="nx">Printable</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf">printOutput</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"Printing an image..."</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>An interface may inherit from other interfaces (including multiple interfaces) as long as none of the interfaces it inherits from declare methods with the same name as those declared in the child interface.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Traits"><div class="sect2" id="traits">
<h2>Traits</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="traits shared by" id="ix_classes_traits"/><a contenteditable="false" data-type="indexterm" data-primary="traits, shared by classes" id="ix_traits_classes"/>Traits provide a mechanism for reusing code outside of a class hierarchy. Traits allow you to share functionality across different classes that don’t (and shouldn’t) share a common ancestor in a class hierarchy. Here’s the syntax for a <a contenteditable="false" data-type="indexterm" data-primary="trait keyword" id="idm45922773290856"/>trait definition:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><em><code class="nx">traitname</code></em><code> </code><code class="p">[</code><code> </code><code class="k">extends</code><code> </code><em><code class="nx">baseclass</code></em><code> </code><code class="p">]</code><code> </code><code class="p">{</code><code>
 </code><code class="p">[</code><code> </code><code class="k">use</code><code> </code><em><code class="nx">traitname</code></em><code class="p">,</code><code> </code><code class="p">[</code><code> </code><em><code class="nx">traitname</code></em><code class="p">,</code><code> </code><code class="o">...</code><code> </code><code class="p">];</code><code> </code><code class="p">]</code><code>

 </code><code class="p">[</code><code> </code><code class="nx">visibility</code><code> </code><code class="nv">$property</code><code> </code><code class="p">[</code><code> </code><code class="o">=</code><code> </code><code class="nx">value</code><code> </code><code class="p">];</code><code> </code><code class="o">...</code><code> </code><code class="p">]</code><code>

 </code><code class="p">[</code><code> </code><code class="k">function</code><code> </code><em><code class="nf">functionname</code></em><code> </code><code class="p">(</code><em><code class="nx">args</code></em><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="c1">// </code><em><code class="c1">code</code></em><code class="c1">
</code><code> </code><code class="p">}</code><code>
 </code><code class="o">...</code><code>
 </code><code class="p">]</code><code>
</code><code class="p">}</code></pre>
<p>To declare that a class should include a trait’s methods, include the <a contenteditable="false" data-type="indexterm" data-primary="use keyword" id="idm45922773216920"/><code>use</code> keyword and any number of traits, separated by commas:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><code class="nx">Logger</code><code> </code><code class="p">{</code><code>
 </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">log</code><code class="p">(</code><code class="nv">$logString</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="nv">$className</code><code> </code><code class="o">=</code><code> </code><code class="nv-Magic">__CLASS__</code><code class="p">;</code><code>
 </code><code class="k">echo</code><code> </code><code class="nb">date</code><code class="p">(</code><code class="s2">"</code><code class="s2">Y-m-d h:i:s</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="nb">time</code><code class="p">())</code><code> </code><code class="o">.</code><code> </code><code class="s2">"</code><code class="s2">: [</code><code class="si">{</code><code class="nv">$className</code><code class="si">}</code><code class="s2">] </code><code class="si">{</code><code class="nv">$logString</code><code class="si">}</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">User</code><code> </code><code class="p">{</code><code>
 </code><code class="k">use</code><code> </code><code class="nx">Logger</code><code class="p">;</code><code>

 </code><code class="k">public</code><code> </code><code class="nv">$name</code><code class="p">;</code><code>

 </code><code class="k">function</code><code> </code><code class="nf-Magic">__construct</code><code class="p">(</code><code class="nv">$name</code><code> </code><code class="o">=</code><code> </code><code class="s1">''</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code> </code><code class="o">=</code><code> </code><code class="nv">$name</code><code class="p">;</code><code>
 </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">log</code><code class="p">(</code><code class="s2">"</code><code class="s2">Created user '</code><code class="si">{</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="si">}</code><code class="s2">'</code><code class="s2">"</code><code class="p">);</code><code>
 </code><code class="p">}</code><code>

 </code><code class="k">function</code><code> </code><code class="nf-Magic">__toString</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="k">return</code><code> </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">UserGroup</code><code> </code><code class="p">{</code><code>
 </code><code class="k">use</code><code> </code><code class="nx">Logger</code><code class="p">;</code><code>

 </code><code class="k">public</code><code> </code><code class="nv">$users</code><code> </code><code class="o">=</code><code> </code><code class="k">array</code><code class="p">();</code><code>

 </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">addUser</code><code class="p">(</code><code class="nx">User</code><code> </code><code class="nv">$user</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="k">if</code><code> </code><code class="p">(</code><code class="o">!</code><code class="nb">in_array</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">users</code><code class="p">,</code><code> </code><code class="nv">$user</code><code class="p">))</code><code> </code><code class="p">{</code><code>
 </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">users</code><code class="p">[]</code><code> </code><code class="o">=</code><code> </code><code class="nv">$user</code><code class="p">;</code><code>
 </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">log</code><code class="p">(</code><code class="s2">"</code><code class="s2">Added user '</code><code class="si">{</code><code class="nv">$user</code><code class="si">}</code><code class="s2">' to group</code><code class="s2">"</code><code class="p">);</code><code>
 </code><code class="p">}</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$group</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">UserGroup</code><code class="p">;</code><code>
</code><code class="nv">$group</code><code class="o">-&gt;</code><code class="na">addUser</code><code class="p">(</code><code class="k">new</code><code> </code><code class="nx">User</code><code class="p">(</code><code class="s2">"</code><code class="s2">Franklin</code><code class="s2">"</code><code class="p">));</code><code>
</code><strong><code class="mi">2012</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">09</code><code> </code><code class="mo">07</code><code class="o">:</code><code class="mi">12</code><code class="o">:</code><code class="mi">58</code><code class="o">:</code><code> </code><code class="p">[</code><code class="nx">User</code><code class="p">]</code><code> </code><code class="nx">Created</code><code> </code><code class="nx">user</code><code> </code><code class="s1">'Franklin'</code><code class="mi">2012</code><code class="o">-</code><code class="mo">03</code><code class="o">-</code><code class="mi">09</code><code> </code><code class="mo">07</code><code class="o">:</code><code class="mi">12</code><code class="o">:</code><code class="mi">58</code><code class="o">:</code><code>
</code><code class="p">[</code><code class="nx">UserGroup</code><code class="p">]</code><code> </code><code class="nx">Added</code><code> </code><code class="nx">user</code><code> </code><code class="s1">'Franklin'</code><code> </code><code class="nx">to</code><code> </code><code class="nx">group</code></strong></pre>
<p>The methods defined by the <code>Logger</code> trait are available to instances of the <code>UserGroup</code> class as if they were defined in that class.</p>
<p>To declare that a trait should be composed of other traits, include the <code>use</code> statement in the trait’s declaration, followed by one or more trait names separated by commas, as shown here:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><code class="nx">First</code><code> </code><code class="p">{</code><code>
 </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">doFirst</code><code class="p">(</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">first</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">trait</code><code> </code><code class="nx">Second</code><code> </code><code class="p">{</code><code>
 </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">doSecond</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">second</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">trait</code><code> </code><code class="nx">Third</code><code> </code><code class="p">{</code><code>
 </code><code class="k">use</code><code> </code><code class="nx">First</code><code class="p">,</code><code> </code><code class="nx">Second</code><code class="p">;</code><code>

 </code><code class="k">public</code><code> </code><code class="k">function</code><code> </code><code class="nf">doAll</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">doFirst</code><code class="p">();</code><code>
 </code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">doSecond</code><code class="p">();</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Combined</code><code> </code><code class="p">{</code><code>
 </code><code class="k">use</code><code> </code><code class="nx">Third</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$object</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Combined</code><code class="p">;</code><code>
</code><code class="nv">$object</code><code class="o">-&gt;</code><code class="na">doAll</code><code class="p">();</code><code>
</code><strong><code class="nx">firstsecond</code></strong></pre>
<p>Traits can declare abstract methods.</p>
<p>If a class uses multiple traits defining the same method, PHP gives a fatal error. However, you can override this behavior by telling the compiler specifically which implementation of a given method you want to use. When defining which traits a class includes, use the <a contenteditable="false" data-type="indexterm" data-primary="insteadof keyword" id="idm45922772862408"/><code>insteadof</code> keyword for each conflict:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><code class="nx">Command</code><code> </code><code class="p">{</code><code>
 </code><code class="k">function</code><code> </code><code class="nf">run</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Executing a command</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">trait</code><code> </code><code class="nx">Marathon</code><code> </code><code class="p">{</code><code>
 </code><code class="k">function</code><code> </code><code class="nf">run</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Running a marathon</code><code class="se">\n</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Person</code><code> </code><code class="p">{</code><code>
 </code><code class="k">use</code><code> </code><code class="nx">Command</code><code class="p">,</code><code> </code><code class="nx">Marathon</code><code> </code><code class="p">{</code><code>
 </code><code class="nx">Marathon</code><code class="o">::</code><code class="na">run</code><code> </code><code class="nx">insteadof</code><code> </code><code class="nx">Command</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$person</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Person</code><code class="p">;</code><code>
</code><code class="nv">$person</code><code class="o">-&gt;</code><code class="na">run</code><code class="p">();</code><code>
</code><strong><code class="nx">Running</code><code> </code><code class="nx">a</code><code> </code><code class="nx">marathon</code></strong></pre>
<p>Instead of picking just one method to include, you can use the <a contenteditable="false" data-type="indexterm" data-primary="as keyword" id="idm45922772893896"/><code>as</code> keyword to alias a trait’s method within the class including it to a different name. You must still explicitly resolve any conflicts in the included traits. For example:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_traits_classes" id="idm45922772897080"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_classes_traits" id="idm45922772895816"/></p>
<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code><code> </code><code class="nx">Command</code><code> </code><code class="p">{</code><code>
 </code><code class="k">function</code><code> </code><code class="nf">run</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Executing a command</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">trait</code><code> </code><code class="nx">Marathon</code><code> </code><code class="p">{</code><code>
 </code><code class="k">function</code><code> </code><code class="nf">run</code><code class="p">()</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Running a marathon</code><code class="s2">"</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="k">class</code><code> </code><code class="nc">Person</code><code> </code><code class="p">{</code><code>
 </code><code class="k">use</code><code> </code><code class="nx">Command</code><code class="p">,</code><code> </code><code class="nx">Marathon</code><code> </code><code class="p">{</code><code>
 </code><code class="nx">Command</code><code class="o">::</code><code class="na">run</code><code> </code><code class="k">as</code><code> </code><code class="nx">runCommand</code><code class="p">;</code><code>
 </code><code class="nx">Marathon</code><code class="o">::</code><code class="na">run</code><code> </code><code class="nx">insteadof</code><code> </code><code class="nx">Command</code><code class="p">;</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>

</code><code class="nv">$person</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">Person</code><code class="p">;</code><code>
</code><code class="nv">$person</code><code class="o">-&gt;</code><code class="na">run</code><code class="p">();</code><code>
</code><code class="nv">$person</code><code class="o">-&gt;</code><code class="na">runCommand</code><code class="p">();</code><code>
</code><strong><code class="nx">Running</code><code> </code><code class="nx">a</code><code> </code><code class="nx">marathonExecuting</code><code> </code><code class="nx">a</code><code> </code><code class="nx">command</code></strong></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Abstract Methods"><div class="sect2" id="abstract_methods">
<h2>Abstract Methods</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="abstract methods" id="ix_abstract_methods"/><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="abstract" id="ix_methods_abstract"/>PHP also provides a mechanism for declaring that certain methods on the class must be implemented by subclasses—the implementation of those methods is not defined in the parent class. In these cases, you provide an abstract method; in addition, if a class contains any methods defined as abstract, you must also declare the class as an abstract class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">abstract</code> <code class="k">class</code> <code class="nc">Component</code> <code class="p">{</code>
 <code class="k">abstract</code> <code class="k">function</code> <code class="nf">printOutput</code><code class="p">();</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">ImageComponent</code> <code class="k">extends</code> <code class="nx">Component</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf">printOutput</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"Pretty picture"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>Abstract classes cannot be instantiated. Also note that, unlike some languages, PHP does not allow you to provide a default implementation for abstract methods.</p>
<p>Traits can also declare abstract methods. Classes that include a trait that defines an abstract method must implement that method:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">trait</code> <code class="nx">Sortable</code> <code class="p">{</code>
 <code class="k">abstract</code> <code class="k">function</code> <code class="nf">uniqueId</code><code class="p">();</code>

 <code class="k">function</code> <code class="nf">compareById</code><code class="p">(</code><code class="nv">$object</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">return</code> <code class="p">(</code><code class="nv">$object</code><code class="o">-&gt;</code><code class="na">uniqueId</code><code class="p">()</code> <code class="o">&lt;</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">uniqueId</code><code class="p">())</code> <code class="o">?</code> <code class="nx">−1</code> <code class="o">:</code> <code class="mi">1</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Bird</code> <code class="p">{</code>
 <code class="k">use</code> <code class="nx">Sortable</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf">uniqueId</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">return</code> <code class="nv-Magic">__CLASS__</code> <code class="o">.</code> <code class="s2">":</code><code class="si">{</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">id</code><code class="si">}</code><code class="s2">"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="c1">// this will not compile</code>
<code class="k">class</code> <code class="nc">Car</code> <code class="p">{</code>
 <code class="k">use</code> <code class="nx">Sortable</code><code class="p">;</code>
<code class="p">}</code>

<code class="nv">$bird</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Bird</code><code class="p">;</code>
<code class="nv">$car</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Car</code><code class="p">;</code>
<code class="nv">$comparison</code> <code class="o">=</code> <code class="nv">$bird</code><code class="o">-&gt;</code><code class="na">compareById</code><code class="p">(</code><code class="nv">$car</code><code class="p">);</code></pre>
<p>When you implement an abstract method in a child class, the method signatures must match—that is, they must take in the same number of required parameters, and if any of the parameters have type hints, those type hints must match. In addition, the method must have the same or less restricted visibility.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_methods_abstract" id="idm45922772757016"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_abstract_methods" id="idm45922772371736"/></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Constructors"><div class="sect2" id="constructors">
<h2>Constructors</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="constructors" id="idm45922772368904"/><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="constructors for" id="idm45922772367688"/><a contenteditable="false" data-type="indexterm" data-primary="constructors" id="idm45922772366472"/>You may also provide a list of arguments following the class name when instantiating an object:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$person</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">(</code><code class="s2">"Fred"</code><code class="p">,</code> <code class="mi">35</code><code class="p">);</code></pre>
<p>These arguments are passed to the class’s <em>constructor</em>, a special function that initializes the properties of the class.</p>
<p>A constructor is a function in the class called <code>__construct()</code>. <a contenteditable="false" data-type="indexterm" data-primary="__construct method" data-primary-sortas="construct method" id="idm45922772358328"/>Here’s a constructor for the <code>Person</code> class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf-Magic">__construct</code><code class="p">(</code><code class="nv">$name</code><code class="p">,</code> <code class="nv">$age</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code> <code class="o">=</code> <code class="nv">$name</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">age</code> <code class="o">=</code> <code class="nv">$age</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
<p>PHP does not provide for an automatic chain of constructors; that is, if you instantiate an object of a derived class, only the constructor in the derived class is automatically called. For the constructor of the parent class to be called, the constructor in the derived class must explicitly call the constructor. In this example, the <code>Employee</code> class constructor calls the <code>Person</code> constructor:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$name</code><code class="p">,</code> <code class="nv">$address</code><code class="p">,</code> <code class="nv">$age</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf-Magic">__construct</code><code class="p">(</code><code class="nv">$name</code><code class="p">,</code> <code class="nv">$address</code><code class="p">,</code> <code class="nv">$age</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code> <code class="o">=</code> <code class="nv">$name</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">address</code> <code class="o">=</code> <code class="nv">$address</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">age</code> <code class="o">=</code> <code class="nv">$age</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">Employee</code> <code class="k">extends</code> <code class="nx">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$position</code><code class="p">,</code> <code class="nv">$salary</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf-Magic">__construct</code><code class="p">(</code><code class="nv">$name</code><code class="p">,</code> <code class="nv">$address</code><code class="p">,</code> <code class="nv">$age</code><code class="p">,</code> <code class="nv">$position</code><code class="p">,</code> <code class="nv">$salary</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">parent</code><code class="o">::</code><code class="na">__construct</code><code class="p">(</code><code class="nv">$name</code><code class="p">,</code> <code class="nv">$address</code><code class="p">,</code> <code class="nv">$age</code><code class="p">);</code>

 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">position</code> <code class="o">=</code> <code class="nv">$position</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">salary</code> <code class="o">=</code> <code class="nv">$salary</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Destructors"><div class="sect2" id="destructors">
<h2>Destructors</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="destructors" id="idm45922772201304"/><a contenteditable="false" data-type="indexterm" data-primary="destructors" id="idm45922772199896"/><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="destructors for" id="idm45922772198792"/>When an object is destroyed, such as when the last reference to an object is removed or the end of the script is reached, its <em>destructor</em> is called. Because PHP automatically cleans up all resources when they fall out of scope and at the end of a script’s execution, their application is limited. The destructor is a method called <a contenteditable="false" data-type="indexterm" data-primary="__destruct method" data-primary-sortas="destruct method" id="idm45922772196520"/><code>__destruct()</code>:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_classes_declare" id="idm45922772194728"/></p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Building</code> <code class="p">{</code>
 <code class="k">function</code> <code class="nf-Magic">__destruct</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"A Building is being destroyed!"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Anonymous Classes"><div class="sect1" id="anonymous_classes">
<h1>Anonymous Classes</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="anonymous" id="idm45922772115128"/><a contenteditable="false" data-type="indexterm" data-primary="anonymous classes" id="idm45922772113752"/>While creating mock objects for testing, it’s useful to create anonymous classes. An anonymous class behaves the same as any other class, except that you do not provide a name (which means it cannot be directly instantiated):</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$name</code> <code class="o">=</code> <code class="nx">‘</code><code class="err">'</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf">getName</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">return</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">name</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code>

<code class="c1">// return an anonymous implementation of Person</code>
<code class="nv">$anonymous</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">class</code><code class="p">()</code> <code class="k">extends</code> <code class="nx">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="k">function</code> <code class="nf">getName</code><code class="p">()</code> <code class="p">{</code>
 <code class="c1">// return static value for testing purposes</code>
 <code class="k">return</code> <code class="s2">"Moana"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">};</code> <code class="c1">// note: requires closing semicolon, unlike nonanonymous class definitions</code></pre>
<p>Unlike instances of named classes, instances of anonymous classes cannot be serialized. Attempting to serialize an instance of an anonymous class results in an error.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Introspection"><div class="sect1" id="introspection">
<h1>Introspection</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="methods" data-secondary="introspection of" id="idm45922771980600"/><a contenteditable="false" data-type="indexterm" data-primary="properties" data-secondary="introspection of" id="idm45922771979224"/><a contenteditable="false" data-type="indexterm" data-primary="introspection, for classes" id="ix_introspection_classes"/><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="introspection of" id="ix_classes_introspection"/><em>Introspection</em> is the ability of a program to examine an object’s characteristics, such as its name, parent class (if any), properties, and methods. With introspection, you can write code that operates on any class or object. You don’t need to know which methods or properties are defined when you write your code; instead, you can discover that information at runtime, which makes it possible for you to write generic debuggers, serializers, profilers, and the like. In this section, we look at the introspective functions provided by PHP.</p>
<section data-type="sect2" data-pdf-bookmark="Examining Classes"><div class="sect2" id="examining_classes">
<h2>Examining Classes</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="classes" data-secondary="examining" id="ix_classes_examine"/>To determine whether a class exists, use the <a contenteditable="false" data-type="indexterm" data-primary="class_exists function" id="idm45922771970184"/><code>class_exists()</code> function, which takes in a string and returns a Boolean value. Alternately, you can use the <a contenteditable="false" data-type="indexterm" data-primary="get_declared_classes function" id="idm45922771968552"/><code>get_declared_classes()</code> function, which returns an array of defined classes and checks if the class name is in the returned array:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$doesClassExist</code><code> </code><code class="o">=</code><code> </code><code class="nb">class_exists</code><code class="p">(</code><em><code class="nx">classname</code></em><code class="p">);</code><code>

</code><code class="nv">$classes</code><code> </code><code class="o">=</code><code> </code><code class="nb">get_declared_classes</code><code class="p">();</code><code>
</code><code class="nv">$doesClassExist</code><code> </code><code class="o">=</code><code> </code><code class="nb">in_array</code><code class="p">(</code><em><code class="nx">classname</code></em><code class="p">,</code><code> </code><code class="nv">$classes</code><code class="p">);</code></pre>
<p>You can get the methods and properties that exist in a class (including those that are inherited from superclasses) using the <a contenteditable="false" data-type="indexterm" data-primary="get_class_methods function" id="idm45922772047288"/><code>get_class_methods()</code> and <a contenteditable="false" data-type="indexterm" data-primary="get_class_vars function" id="idm45922772046040"/><code>get_class_vars()</code> functions. These functions take a class name and return an array:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$methods</code><code> </code><code class="o">=</code><code> </code><code class="nb">get_class_methods</code><code class="p">(</code><em><code class="nx">classname</code></em><code class="p">);</code><code>
</code><code class="nv">$properties</code><code> </code><code class="o">=</code><code> </code><code class="nb">get_class_vars</code><code class="p">(</code><em><code class="nx">classname</code></em><code class="p">);</code></pre>
<p>The class name can be either a variable containing the class name, a bare word, or a quoted string:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$class</code> <code class="o">=</code> <code class="s2">"Person"</code><code class="p">;</code>
<code class="nv">$methods</code> <code class="o">=</code> <code class="nb">get_class_methods</code><code class="p">(</code><code class="nv">$class</code><code class="p">);</code>
<code class="nv">$methods</code> <code class="o">=</code> <code class="nb">get_class_methods</code><code class="p">(</code><code class="nx">Person</code><code class="p">);</code> <code class="c1">// same</code>
<code class="nv">$methods</code> <code class="o">=</code> <code class="nb">get_class_methods</code><code class="p">(</code><code class="s2">"Person"</code><code class="p">);</code> <code class="c1">// same</code></pre>
<p>The array returned by <code>get_class_methods()</code> is a simple list of method names. The associative array returned by <code>get_class_vars()</code> maps property names to values and also includes inherited properties.</p>
<p>One quirk of <code>get_class_vars()</code> is that it returns only properties that have default values and are visible in the current scope; there’s no way to discover uninitialized properties.</p>
<p>Use <code>get_parent_class()</code> to find a class’s parent class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$superclass</code><code> </code><code class="o">=</code><code> </code><code class="nb">get_parent_class</code><code class="p">(</code><em><code class="nx">classname</code></em><code class="p">);</code></pre>
<p><a data-type="xref" href="#example_six_onedot_displaying_all_decla">Example 6-1</a> lists the <a contenteditable="false" data-type="indexterm" data-primary="displayClasses function" id="idm45922771867688"/><code>displayClasses()</code> function, which displays all currently declared classes and the methods and properties for each.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_classes_examine" id="idm45922771866088"/></p>
<div data-type="example" id="example_six_onedot_displaying_all_decla">
<h5><span class="label">Example 6-1. </span>Displaying all declared classes</h5>
<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">displayClasses</code><code class="p">()</code> <code class="p">{</code>
 <code class="nv">$classes</code> <code class="o">=</code> <code class="nb">get_declared_classes</code><code class="p">();</code>

 <code class="k">foreach</code> <code class="p">(</code><code class="nv">$classes</code> <code class="k">as</code> <code class="nv">$class</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"Showing information about </code><code class="si">{</code><code class="nv">$class</code><code class="si">}</code><code class="s2">&lt;br /&gt;"</code><code class="p">;</code>
 <code class="nv">$reflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$class</code><code class="p">);</code>

 <code class="nv">$isAnonymous</code> <code class="o">=</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">isAnonymous</code><code class="p">()</code> <code class="o">?</code> <code class="s2">"yes"</code> <code class="o">:</code> <code class="s2">"no"</code><code class="p">;</code>
 <code class="k">echo</code> <code class="s2">"Is Anonymous: </code><code class="si">{</code><code class="nv">$isAnonymous</code><code class="si">}</code><code class="s2">&lt;br /&gt;"</code><code class="p">;</code>

 <code class="k">echo</code> <code class="s2">"Class methods:&lt;br /&gt;"</code><code class="p">;</code>
 <code class="nv">$methods</code> <code class="o">=</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getMethods</code><code class="p">(</code><code class="nx">ReflectionMethod</code><code class="o">::</code><code class="na">IS_STATIC</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">count</code><code class="p">(</code><code class="nv">$methods</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;None&lt;/i&gt;&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="k">foreach</code> <code class="p">(</code><code class="nv">$methods</code> <code class="k">as</code> <code class="nv">$method</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;b&gt;</code><code class="si">{</code><code class="nv">$method</code><code class="si">}</code><code class="s2">&lt;/b&gt;()&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="p">}</code>

 <code class="k">echo</code> <code class="s2">"Class properties:&lt;br /&gt;"</code><code class="p">;</code>

 <code class="nv">$properties</code> <code class="o">=</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getProperties</code><code class="p">();</code>

 <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">count</code><code class="p">(</code><code class="nv">$properties</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;None&lt;/i&gt;&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="k">foreach</code><code class="p">(</code><code class="nb">array_keys</code><code class="p">(</code><code class="nv">$properties</code><code class="p">)</code> <code class="k">as</code> <code class="nv">$property</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;b&gt;</code><code class="se">\$</code><code class="si">{</code><code class="nv">$property</code><code class="si">}</code><code class="s2">&lt;/b&gt;&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="p">}</code>

 <code class="k">echo</code> <code class="s2">"&lt;hr /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
</div>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Examining an Object"><div class="sect2" id="examining_an_object">
<h2>Examining an Object</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="objects" data-secondary="examining" id="idm45922771844824"/>To get the class to which an object belongs, first make sure it is an object using the <a contenteditable="false" data-type="indexterm" data-primary="is_object function" id="idm45922771668280"/><code>is_object()</code> function, and then get the class with the <a contenteditable="false" data-type="indexterm" data-primary="get_class function" id="idm45922771666760"/><code>get_class()</code> function:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$isObject</code><code> </code><code class="o">=</code><code> </code><code class="nb">is_object</code><code class="p">(</code><em><code class="k">var</code></em><code class="p">);</code><code>
</code><code class="nv">$classname</code><code> </code><code class="o">=</code><code> </code><code class="nb">get_class</code><code class="p">(</code><em><code class="nx">object</code></em><code class="p">);</code></pre>
<p>Before calling a method on an object, you can ensure that it exists using the <a contenteditable="false" data-type="indexterm" data-primary="method_exists function" id="idm45922771663128"/><code>method_exists()</code> function:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$methodExists</code><code> </code><code class="o">=</code><code> </code><code class="nb">method_exists</code><code class="p">(</code><em><code class="nx">object</code></em><code class="p">,</code><code> </code><em><code class="nx">method</code></em><code class="p">);</code></pre>
<p>Calling an undefined method triggers a runtime exception.</p>
<p>Just as <code>get_class_vars()</code> returns an array of properties for a class, <code>get_object_vars()</code> returns an array of properties set in an object:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$array</code><code> </code><code class="o">=</code><code> </code><code class="nb">get_object_vars</code><code class="p">(</code><em><code class="nx">object</code></em><code class="p">);</code></pre>
<p>And just as <a contenteditable="false" data-type="indexterm" data-primary="get_class_vars function" id="idm45922771589736"/><code>get_class_vars()</code> returns only those properties with default values, <a contenteditable="false" data-type="indexterm" data-primary="get_object_vars function" id="idm45922771588280"/><code>get_object_vars()</code> returns only those properties that are set:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Person</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$name</code><code class="p">;</code>
 <code class="k">public</code> <code class="nv">$age</code><code class="p">;</code>
<code class="p">}</code>

<code class="nv">$fred</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Person</code><code class="p">;</code>
<code class="nv">$fred</code><code class="o">-&gt;</code><code class="na">name</code> <code class="o">=</code> <code class="s2">"Fred"</code><code class="p">;</code>
<code class="nv">$props</code> <code class="o">=</code> <code class="nb">get_object_vars</code><code class="p">(</code><code class="nv">$fred</code><code class="p">);</code> <code class="c1">// array('name' =&gt; "Fred", 'age' =&gt; NULL);</code></pre>
<p>The <a contenteditable="false" data-type="indexterm" data-primary="get_parent_class function" id="idm45922771585160"/><code>get_parent_class()</code> function accepts either an object or a class name. It returns the name of the parent class, or <code>FALSE</code> if there is no parent class:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code><code> </code><code class="nc">A</code><code> </code><code class="p">{}</code><code>
</code><code class="k">class</code><code> </code><code class="nc">B</code><code> </code><code class="k">extends</code><code> </code><code class="nx">A</code><code> </code><code class="p">{}</code><code>

</code><code class="nv">$obj</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">B</code><code class="p">;</code><code>
</code><code class="k">echo</code><code> </code><code class="nb">get_parent_class</code><code class="p">(</code><code class="nv">$obj</code><code class="p">);</code><code>
</code><code class="k">echo</code><code> </code><code class="nb">get_parent_class</code><code class="p">(</code><code class="nx">B</code><code class="p">);</code><code>
</code><strong><code class="nx">AA</code></strong></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sample Introspection Program"><div class="sect2" id="sample_introspection_program">
<h2>Sample Introspection Program</h2>
<p><a data-type="xref" href="#example_six_twodot_object_introspection">Example 6-2</a> shows a collection of functions that display a reference page of information about an object’s properties, methods, and inheritance tree.</p>
<div data-type="example" id="example_six_twodot_object_introspection">
<h5><span class="label">Example 6-2. </span>Object introspection functions</h5>
<pre data-type="programlisting" data-code-language="php"><code class="c1">// return an array of callable methods (include inherited methods)</code>
<code class="k">function</code> <code class="nf">getCallableMethods</code><code class="p">(</code><code class="nv">$object</code><code class="p">)</code><code class="o">:</code> <code class="k">Array</code> <code class="p">{</code>
 <code class="nv">$reflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>
 <code class="nv">$methods</code> <code class="o">=</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getMethods</code><code class="p">();</code>

 <code class="k">return</code> <code class="nv">$methods</code><code class="p">;</code>
<code class="p">}</code>

<code class="c1">// return an array of superclasses</code>
<code class="k">function</code> <code class="nf">getLineage</code><code class="p">(</code><code class="nv">$object</code><code class="p">)</code><code class="o">:</code> <code class="k">Array</code> <code class="p">{</code>
 <code class="nv">$reflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getParentClass</code><code class="p">())</code> <code class="p">{</code>
 <code class="nv">$parent</code> <code class="o">=</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getParentClass</code><code class="p">();</code>

 <code class="nv">$lineage</code> <code class="o">=</code> <code class="nx">getLineage</code><code class="p">(</code><code class="nv">$parent</code><code class="p">);</code>
 <code class="nv">$lineage</code><code class="p">[]</code> <code class="o">=</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">();</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="nv">$lineage</code> <code class="o">=</code> <code class="k">array</code><code class="p">(</code><code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">());</code>
 <code class="p">}</code>

 <code class="k">return</code> <code class="nv">$lineage</code><code class="p">;</code>
<code class="p">}</code>

<code class="c1">// return an array of subclasses</code>
<code class="k">function</code> <code class="nf">getChildClasses</code><code class="p">(</code><code class="nv">$object</code><code class="p">)</code><code class="o">:</code> <code class="k">Array</code> <code class="p">{</code>
 <code class="nv">$reflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>

 <code class="nv">$classes</code> <code class="o">=</code> <code class="nb">get_declared_classes</code><code class="p">();</code>

 <code class="nv">$children</code> <code class="o">=</code> <code class="k">array</code><code class="p">();</code>

 <code class="k">foreach</code> <code class="p">(</code><code class="nv">$classes</code> <code class="k">as</code> <code class="nv">$class</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$checkedReflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$class</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="nv">$checkedReflection</code><code class="o">-&gt;</code><code class="na">isSubclassOf</code><code class="p">(</code><code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">()))</code> <code class="p">{</code>
 <code class="nv">$children</code><code class="p">[]</code> <code class="o">=</code> <code class="nv">$checkedReflection</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">();</code>
 <code class="p">}</code>
 <code class="p">}</code>

 <code class="k">return</code> <code class="nv">$children</code><code class="p">;</code>
<code class="p">}</code>

<code class="c1">// return an array of properties</code>
<code class="k">function</code> <code class="nf">getProperties</code><code class="p">(</code><code class="nv">$object</code><code class="p">)</code><code class="o">:</code> <code class="k">Array</code> <code class="p">{</code>
 <code class="nv">$reflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>

 <code class="k">return</code> <code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getProperties</code><code class="p">();</code>
<code class="p">}</code>

<code class="c1">// display information on an object</code>
<code class="k">function</code> <code class="nf">printObjectInfo</code><code class="p">(</code><code class="nv">$object</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$reflection</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ReflectionClass</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>
 <code class="k">echo</code> <code class="s2">"&lt;h2&gt;Class&lt;/h2&gt;"</code><code class="p">;</code>
 <code class="k">echo</code> <code class="s2">"&lt;p&gt;</code><code class="si">{</code><code class="nv">$reflection</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">()</code><code class="si">}</code><code class="s2">&lt;/p&gt;"</code><code class="p">;</code>

 <code class="k">echo</code> <code class="s2">"&lt;h2&gt;Inheritance&lt;/h2&gt;"</code><code class="p">;</code>

 <code class="k">echo</code> <code class="s2">"&lt;h3&gt;Parents&lt;/h3&gt;"</code><code class="p">;</code>
 <code class="nv">$lineage</code> <code class="o">=</code> <code class="nx">getLineage</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>
 <code class="nb">array_pop</code><code class="p">(</code><code class="nv">$lineage</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="nb">count</code><code class="p">(</code><code class="nv">$lineage</code><code class="p">)</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;p&gt;"</code> <code class="o">.</code> <code class="nb">join</code><code class="p">(</code><code class="s2">" -&amp;gt; "</code><code class="p">,</code> <code class="nv">$lineage</code><code class="p">)</code> <code class="o">.</code> <code class="s2">"&lt;/p&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;None&lt;/i&gt;"</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="k">echo</code> <code class="s2">"&lt;h3&gt;Children&lt;/h3&gt;"</code><code class="p">;</code>
 <code class="nv">$children</code> <code class="o">=</code> <code class="nx">getChildClasses</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>
 <code class="k">echo</code> <code class="s2">"&lt;p&gt;"</code><code class="p">;</code>

 <code class="k">if</code> <code class="p">(</code><code class="nb">count</code><code class="p">(</code><code class="nv">$children</code><code class="p">)</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="nb">join</code><code class="p">(</code><code class="s1">', '</code><code class="p">,</code> <code class="nv">$children</code><code class="p">);</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;None&lt;/i&gt;"</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="k">echo</code> <code class="s2">"&lt;/p&gt;"</code><code class="p">;</code>

 <code class="k">echo</code> <code class="s2">"&lt;h2&gt;Methods&lt;/h2&gt;"</code><code class="p">;</code>
 <code class="nv">$methods</code> <code class="o">=</code> <code class="nx">getCallableMethods</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">count</code><code class="p">(</code><code class="nv">$methods</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;None&lt;/i&gt;&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="k">foreach</code><code class="p">(</code><code class="nv">$methods</code> <code class="k">as</code> <code class="nv">$method</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;b&gt;</code><code class="si">{</code><code class="nv">$method</code><code class="si">}</code><code class="s2">&lt;/b&gt;();&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="p">}</code>

 <code class="k">echo</code> <code class="s2">"&lt;h2&gt;Properties&lt;/h2&gt;"</code><code class="p">;</code>
 <code class="nv">$properties</code> <code class="o">=</code> <code class="nx">getProperties</code><code class="p">(</code><code class="nv">$object</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">count</code><code class="p">(</code><code class="nv">$properties</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;None&lt;/i&gt;&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="k">else</code> <code class="p">{</code>
 <code class="k">foreach</code><code class="p">(</code><code class="nb">array_keys</code><code class="p">(</code><code class="nv">$properties</code><code class="p">)</code> <code class="k">as</code> <code class="nv">$property</code><code class="p">)</code> <code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;b&gt;</code><code class="se">\$</code><code class="si">{</code><code class="nv">$property</code><code class="si">}</code><code class="s2">&lt;/b&gt; = "</code> <code class="o">.</code> <code class="nv">$object</code><code class="o">-&gt;</code><code class="nv">$property</code> <code class="o">.</code> <code class="s2">"&lt;br /&gt;"</code><code class="p">;</code>
 <code class="p">}</code>
 <code class="p">}</code>

 <code class="k">echo</code> <code class="s2">"&lt;hr /&gt;"</code><code class="p">;</code>
<code class="p">}</code></pre>
</div>
<p>Here are some sample classes and objects that exercise the introspection functions from <a data-type="xref" href="#example_six_twodot_object_introspection">Example 6-2</a>:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_classes_ch6" id="idm45922771442200"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_classes_introspection" id="idm45922771440888"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_introspection_classes" id="idm45922771439448"/></p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">A</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$foo</code> <code class="o">=</code> <code class="s2">"foo"</code><code class="p">;</code>
 <code class="k">public</code> <code class="nv">$bar</code> <code class="o">=</code> <code class="s2">"bar"</code><code class="p">;</code>
 <code class="k">public</code> <code class="nv">$baz</code> <code class="o">=</code> <code class="mf">17.0</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf">firstFunction</code><code class="p">()</code> <code class="p">{</code> <code class="p">}</code>

 <code class="k">function</code> <code class="nf">secondFunction</code><code class="p">()</code> <code class="p">{</code> <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">B</code> <code class="k">extends</code> <code class="nx">A</code> <code class="p">{</code>
 <code class="k">public</code> <code class="nv">$quux</code> <code class="o">=</code> <code class="k">false</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf">thirdFunction</code><code class="p">()</code> <code class="p">{</code> <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">C</code> <code class="k">extends</code> <code class="nx">B</code> <code class="p">{</code> <code class="p">}</code>

<code class="nv">$a</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">A</code><code class="p">();</code>
<code class="nv">$a</code><code class="o">-&gt;</code><code class="na">foo</code> <code class="o">=</code> <code class="s2">"sylvie"</code><code class="p">;</code>
<code class="nv">$a</code><code class="o">-&gt;</code><code class="na">bar</code> <code class="o">=</code> <code class="mi">23</code><code class="p">;</code>

<code class="nv">$b</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">B</code><code class="p">();</code>
<code class="nv">$b</code><code class="o">-&gt;</code><code class="na">foo</code> <code class="o">=</code> <code class="s2">"bruno"</code><code class="p">;</code>
<code class="nv">$b</code><code class="o">-&gt;</code><code class="na">quux</code> <code class="o">=</code> <code class="k">true</code><code class="p">;</code>

<code class="nv">$c</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">C</code><code class="p">();</code>

<code class="nx">printObjectInfo</code><code class="p">(</code><code class="nv">$a</code><code class="p">);</code>
<code class="nx">printObjectInfo</code><code class="p">(</code><code class="nv">$b</code><code class="p">);</code>
<code class="nx">printObjectInfo</code><code class="p">(</code><code class="nv">$c</code><code class="p">);</code></pre>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Serialization"><div class="sect1" id="serialization">
<h1>Serialization</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="serialization" id="ix_serializing_objects"/><a contenteditable="false" data-type="indexterm" data-primary="objects" data-secondary="serializing" id="ix_objects_serializing"/><em>Serializing</em> an object means converting it to a bytestream representation that can be stored in a file. This is useful for persistent data; for example, PHP sessions automatically save and restore objects. Serialization in PHP is mostly automatic—it requires little extra work from you, beyond calling the <a contenteditable="false" data-type="indexterm" data-primary="serialize function" id="idm45922770554456"/><code>serialize()</code> and <a contenteditable="false" data-type="indexterm" data-primary="unserialize function" id="idm45922770552936"/><code>unserialize()</code> <span class="keep-together">functions:</span></p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$encoded</code><code> </code><code class="o">=</code><code> </code><code class="nb">serialize</code><code class="p">(</code><em><code class="nx">something</code></em><code class="p">);</code><code>
</code><code class="nv">$something</code><code> </code><code class="o">=</code><code> </code><code class="nb">unserialize</code><code class="p">(</code><em><code class="nx">encoded</code></em><code class="p">);</code></pre>
<p>Serialization is most commonly used with PHP’s sessions, which handle the serialization for you. All you need to do is tell PHP which variables to keep track of, and they’re automatically preserved between visits to pages on your site. However, sessions are not the only use of serialization—if you want to implement your own form of persistent objects, <code>serialize()</code> and <code>unserialize()</code> are a natural choice.</p>
<p>An object’s class must be defined before unserialization can occur. Attempting to unserialize an object whose class is not yet defined puts the object into <code>stdClass</code>, which renders it almost useless. One practical consequence of this is that if you use PHP sessions to automatically serialize and unserialize objects, you must include the file containing the object’s class definition in every page on your site. For example, your pages might start like this:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">include</code> <code class="s2">"object_definitions.php"</code><code class="p">;</code> <code class="c1">// load object definitions</code>
<code class="nb">session_start</code><code class="p">();</code> <code class="c1">// load persistent variables</code>
<code class="cp">?&gt;</code><code class="x"/>
<code class="x">&lt;html&gt;...</code></pre>
<p>PHP has two hooks for objects during the serialization and unserialization process: <a contenteditable="false" data-type="indexterm" data-primary="__sleep method" data-primary-sortas="sleep method" id="idm45922770880696"/><code>__sleep()</code> and <a contenteditable="false" data-type="indexterm" data-primary="__wakeup method" data-primary-sortas="wakeup method" id="idm45922770879064"/><code>__wakeup()</code>. These methods are used to notify objects that they’re being serialized or unserialized. Objects can be serialized if they do not have these methods; however, they won’t be notified about the process.</p>
<p>The <code>__sleep()</code> method is called on an object just before serialization; it can perform any cleanup necessary to preserve the object’s state, such as closing database connections, writing out unsaved persistent data, and so on. It should return an array containing the names of the data members that need to be written into the bytestream. If you return an empty array, no data is written.</p>
<p>Conversely, the <code>__wakeup()</code> method is called on an object immediately after an object is created from a bytestream. The method can take any action it requires, such as reopening database connections and other initialization tasks.</p>
<p><a data-type="xref" href="#example_six_threedot_the_logdotphp_file">Example 6-3</a> is an object class, <code>Log</code>, that provides two useful methods: <code>write()</code> to append a message to the logfile, and <code>read()</code> to fetch the current contents of the logfile. It uses <code>__wakeup()</code> to reopen the logfile and <code>__sleep()</code> to close the logfile.</p>
<div data-type="example" id="example_six_threedot_the_logdotphp_file">
<h5><span class="label">Example 6-3. </span>The Log.php file</h5>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">Log</code> <code class="p">{</code>
 <code class="k">private</code> <code class="nv">$filename</code><code class="p">;</code>
 <code class="k">private</code> <code class="nv">$fh</code><code class="p">;</code>

 <code class="k">function</code> <code class="nf-Magic">__construct</code><code class="p">(</code><code class="nv">$filename</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code> <code class="o">=</code> <code class="nv">$filename</code><code class="p">;</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">open</code><code class="p">();</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf">open</code><code class="p">()</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">fh</code> <code class="o">=</code> <code class="nb">fopen</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="p">,</code> <code class="s1">'a'</code><code class="p">)</code> <code class="k">or</code> <code class="k">die</code><code class="p">(</code><code class="s2">"Can't open </code><code class="si">{</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf">write</code><code class="p">(</code><code class="nv">$note</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">fwrite</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">fh</code><code class="p">,</code> <code class="s2">"</code><code class="si">{</code><code class="nv">$note</code><code class="si">}</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf">read</code><code class="p">()</code> <code class="p">{</code>
 <code class="k">return</code> <code class="nb">join</code><code class="p">(</code><code class="s1">''</code><code class="p">,</code> <code class="nb">file</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="p">));</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf-Magic">__wakeup</code><code class="p">(</code><code class="k">array</code> <code class="nv">$data</code><code class="p">)</code><code class="o">:</code> <code class="nx">void</code> <code class="p">{</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code> <code class="o">=</code> <code class="nv">$data</code><code class="p">[</code><code class="s2">"filename"</code><code class="p">];</code>
 <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">open</code><code class="p">();</code>
 <code class="p">}</code>

 <code class="k">function</code> <code class="nf-Magic">__sleep</code><code class="p">()</code> <code class="p">{</code>
 <code class="c1">// write information to the account file</code>
 <code class="nb">fclose</code><code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">fh</code><code class="p">);</code>

 <code class="k">return</code> <code class="p">[</code><code class="s2">"filename"</code> <code class="o">=&gt;</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">filename</code><code class="p">];</code>
 <code class="p">}</code>
<code class="p">}</code></pre>
</div>
<p>Store the <code>Log</code> class definition in a file called <em>Log.php</em>. The HTML front page in <a data-type="xref" href="#example_six_fourdot_frontdotphp">Example 6-4</a> uses the <code>Log</code> class and PHP sessions to create a persistent log variable, <code>$logger</code>.</p>
<div data-type="example" id="example_six_fourdot_frontdotphp">
<h5><span class="label">Example 6-4. </span>front.php</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code>
<code class="k">include_once</code> <code class="s2">"Log.php"</code><code class="p">;</code>
<code class="nb">session_start</code><code class="p">();</code>
<code class="cp">?&gt;</code>

<code class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</code>Front Page<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="cp">&lt;?php</code>
<code class="nv">$now</code> <code class="o">=</code> <code class="nb">strftime</code><code class="p">(</code><code class="s2">"%c"</code><code class="p">);</code>

<code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">isset</code><code class="p">(</code><code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'logger'</code><code class="p">]))</code> <code class="p">{</code>
 <code class="nv">$logger</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Log</code><code class="p">(</code><code class="s2">"/tmp/persistent_log"</code><code class="p">);</code>
 <code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'logger'</code><code class="p">]</code> <code class="o">=</code> <code class="nv">$logger</code><code class="p">;</code>
 <code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">write</code><code class="p">(</code><code class="s2">"Created </code><code class="si">$now</code><code class="s2">"</code><code class="p">);</code>

 <code class="k">echo</code><code class="p">(</code><code class="s2">"&lt;p&gt;Created session and persistent log object.&lt;/p&gt;"</code><code class="p">);</code>
<code class="p">}</code>
<code class="k">else</code> <code class="p">{</code>
 <code class="nv">$logger</code> <code class="o">=</code> <code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'logger'</code><code class="p">];</code>
<code class="p">}</code>

<code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">write</code><code class="p">(</code><code class="s2">"Viewed first page </code><code class="si">{</code><code class="nv">$now</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code>

<code class="k">echo</code> <code class="s2">"&lt;p&gt;The log contains:&lt;/p&gt;"</code><code class="p">;</code>
<code class="k">echo</code> <code class="nb">nl2br</code><code class="p">(</code><code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">read</code><code class="p">());</code>
<code class="cp">?&gt;</code>

<code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"next.php"</code><code class="nt">&gt;</code>Move to the next page<code class="nt">&lt;/a&gt;</code>

<code class="nt">&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
<p><a data-type="xref" href="#example_six_fivedot_nextdotphp">Example 6-5</a> shows the file <em>next.php</em>, an HTML page. Following the link from the front page to this page triggers the loading of the persistent object <code>$logger</code>. The <code>__wakeup()</code> call reopens the logfile so the object is ready to be used.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_objects_ch6" id="idm45922770193064"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_objects_serializing" id="idm45922770191688"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_serializing_objects" id="idm45922770190312"/></p>
<div data-type="example" id="example_six_fivedot_nextdotphp">
<h5><span class="label">Example 6-5. </span>next.php</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code>
<code class="k">include_once</code> <code class="s2">"Log.php"</code><code class="p">;</code>
<code class="nb">session_start</code><code class="p">();</code>
<code class="cp">?&gt;</code>

<code class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</code>Next Page<code class="nt">&lt;/title&gt;&lt;/head&gt;</code>
<code class="nt">&lt;body&gt;</code>

<code class="cp">&lt;?php</code>
<code class="nv">$now</code> <code class="o">=</code> <code class="nb">strftime</code><code class="p">(</code><code class="s2">"%c"</code><code class="p">);</code>
<code class="nv">$logger</code> <code class="o">=</code> <code class="nv">$_SESSION</code><code class="p">[</code><code class="s1">'logger'</code><code class="p">];</code>
<code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">write</code><code class="p">(</code><code class="s2">"Viewed page 2 at </code><code class="si">{</code><code class="nv">$now</code><code class="si">}</code><code class="s2">"</code><code class="p">);</code>

<code class="k">echo</code> <code class="s2">"&lt;p&gt;The log contains:"</code><code class="p">;</code>
<code class="k">echo</code> <code class="nb">nl2br</code><code class="p">(</code><code class="nv">$logger</code><code class="o">-&gt;</code><code class="na">read</code><code class="p">());</code>
<code class="k">echo</code> <code class="s2">"&lt;/p&gt;"</code><code class="p">;</code>
<code class="cp">?&gt;</code>

<code class="nt">&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What’s Next"><div class="sect1" id="whatapostrophes_next-id00064">
<h1>What’s Next</h1>
<p>Learning how to use objects in your own scripts is an enormous task. In the next chapter, we transition from language semantics to practice and show you one of PHP’s most commonly used set of object-oriented classes—the date and time classes.</p>
</div></section>
</div></section></div>



  </body></html>