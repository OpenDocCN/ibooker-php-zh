<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 17. Debugging PHP"><div class="chapter" id="debugging_php">
<h1><span class="label">Chapter 17. </span>Debugging PHP</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="PHP" data-secondary="debugging" id="ix_php_debug_ch17"/><a contenteditable="false" data-type="indexterm" data-primary="debugging" id="ix_debugging_ch17"/>Debugging is an acquired skill. As is often said in the development world, “You are given all the rope you should ever need; just attempt to tie a pretty bow with it rather than getting yourself hanged.” It naturally stands to reason that the more debugging you do, the more proficient you will become. Of course, you will also get some excellent hints from your server environment when your code does not deliver what you were expecting. Before we get too deep into debugging concepts, however, we need to look at the bigger picture and discuss these programming environments. Every development shop has its own setup and its own way of doing things, so what we’ll be covering here reflects the ideal conditions, also known as best practices.</p>
<p>PHP development in a utopian world has at least three separate environments in which work is being done: development, staging, and production. We’ll explore each in turn in the following sections.</p>
<section data-type="sect1" data-pdf-bookmark="The Development Environment"><div class="sect1" id="the_development_environment">
<h1>The Development Environment</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="development environment" id="ix_debugging_dev_environ"/>The development environment is a place where the raw code is created without fear of server crashes or peer ridicule. This should be a place where concepts and theories are proven or disproven, where code can be created experimentally. Therefore, the error-reporting environmental feedback should be as verbose as possible. All error reporting should be logged and at the same time also sent to the output device (the browser). All warnings should be as sensitive and descriptive as possible.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Later in this chapter, <a data-type="xref" href="#php_error_directives_for_server_environ">Table 17-1</a> compares the recommended server settings for each of the three environments as it relates to debugging and error reporting.</p>
</div>
<p>The location of this development environment can be debated. However, if your company has the resources, then a separate server should be established for this purpose with full code management (e.g., SVN, aka Subversion, or Git) in place. If the resources are not available, then a development PC can serve this purpose via a <code>localhost</code>-style setup. This <a contenteditable="false" data-type="indexterm" data-primary="localhost environment" id="idm45922745751016"/><code>localhost</code> environment can be advantageous in and of itself in the sense that you may want to try something completely off-the-wall, and by coding on a standalone PC you can be fully experimental without affecting a common development server or anyone else’s code base.</p>
<p>You can create <code>localhost</code> environments with the Apache web server, or Microsoft’s Internet Information Services (IIS), as a manual process. There are a few all-in-one environments that can be utilized as well; Zend Server CE (Community Edition) is a great example.</p>
<p>No matter what setup you have for raw development, be sure to give your developers full freedom to do what they want without fear of reprimand. This gives them the confidence to be as innovative as possible, and no one gets “hurt.”</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are at least two alternatives to setting up a local environment on your own PC. The first one is, as of PHP 5.4, a <a href="http://bit.ly/TI0xTU">built-in web server</a>. This option saves on downloading and installing full Apache or IIS web server products for <code>localhost</code> purposes.</p>
<p>Second, there are now hosts (pun intended) of sites that allow for cloud development. <a href="http://www.phpcloud.com">Zend</a> offers one for free as a testing and development environment.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_debugging_dev_environ" id="idm45922745743896"/></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Staging Environment"><div class="sect1" id="the_staging_environment">
<h1>The Staging Environment</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="staging environment" id="idm45922745740712"/>The staging environment should mimic the production environment as closely as possible. Although this is sometimes hard to achieve, the more closely you can mimic the production environment, the better. You will be able to see how your code reacts in an area that is protected but also simulates the real production environment. The staging environment is often where the end user or client can test out new features or functionality, giving feedback and stress-testing code, without fear of affecting production code.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>As testing and experimentation progress, your staging area (at least from a data perspective) will eventually grow more distinct from the production environment. So it is a good practice to have procedures in place that will replace the staging area with production information from time to time. The set times will be different for each company or development shop depending on features being created, release cycles, and so on.</p>
</div>
<p>If resources permit, you should consider having two separate staging environments: one for developers (coding peers) and the other for client testing. Feedback from these two types of users is quite often very different and very telling. Server error reporting and feedback should be kept to a minimum here as well, to duplicate production as closely as possible.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Production Environment"><div class="sect1" id="the_production_environment">
<h1>The Production Environment</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="production environment" id="idm45922745734584"/>The production environment, from an error-reporting perspective, needs to be as tightly controlled as possible. You want to fully control what the end user sees and experiences. Things like SQL failures and code syntax warnings should never be seen by the client, if at all possible. Your code base, of course, should be well mitigated by this time (assuming you’ve been using the two aforementioned environments properly and religiously), but sometimes errors and bugs can still get through to production. If you’re going to fail in production, you want to fail as gracefully and as <em>quietly</em> as possible.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Consider using 404 page redirects and <code>try...catch</code> structures to redirect errors and failures to a safe landing area in the production environment. See <a data-type="xref" href="ch02.xhtml#language_basics">Chapter 2</a> for proper coding styles of the <code>try...catch</code> syntax.</p>
</div>
<p>At the very least, all error reporting should be suppressed and sent to the logfiles in the production environment.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="php.ini Settings"><div class="sect1" id="phpdotini_settings">
<h1>php.ini Settings</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" id="ix_phpini_settings"/><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="php.ini settings" id="ix_debugging_php.ini"/>There are a few environment-wide settings to consider for each type of server you’re using to develop your code. First, we’ll offer a brief summary of what these are, and then we’ll list the recommended settings for each of the three coding environments.</p>
<dl>
<dt><code>display_errors</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="display_errors option, php.ini file" id="idm45922745721320"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="display_errors option" id="idm45922745720248"/>An on-off toggle that controls the display of any errors encountered by PHP. This should be set to <code>0</code> (off) for production environments.</dd>
<dt><code>error_reporting</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="error_reporting option, php.ini file" id="idm45922745717352"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="error_reporting option " id="idm45922745716072"/>This is a setting of predefined constants that will report to the error log and/or the web browser any errors that PHP encounters. There are 16 different individual constants that can be set within this directive, and certain ones can be used collectively. The most common ones are <code>E_ALL</code>, for reporting all errors and warnings of any kind; <code>E_WARNING</code>, for only showing warnings (nonfatal errors) to the browser; and <code>E_DEPRECATED</code>, to display runtime notice warnings about code that will fail in future versions of PHP because some functionality is scheduled to be ended (like <code>register_globals</code> was). An example of these being used in combination is <code>E_ALL &amp; ~E_NOTICE</code>, which tells PHP to report all errors except the generated notices. <a contenteditable="false" data-type="indexterm" data-primary="website resources" data-secondary="php.ini error constants" id="idm45922745711800"/>A full listing of these defined constants can be found on the <a href="https://oreil.ly/N2AaV">PHP website</a>.</dd>
<dt><code>error_log</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="error_log option, php.ini file" id="idm45922745708680"/><a contenteditable="false" data-type="indexterm" data-primary=" php.ini file" data-secondary="error_log option" id="idm45922745707608"/>The path to the location of the error log. The error log is a text-based file located on the server at the path location that records all errors in text form. This could be <em>apache2/logs</em> in the case of an Apache server.</dd>
<dt><code>variables_order</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="variables_order option, php.ini file" id="idm45922745704632"/><a contenteditable="false" data-type="indexterm" data-primary=" php.ini file" data-secondary="variables_order option" id="idm45922745703320"/>Sets the order of precedence in which the superglobal arrays are loaded with information. The default order is <code>EGPCS</code>, meaning the environment (<code>$_ENV</code>) array is loaded first, then the <code>GET</code> (<code>$_GET</code>) array, then the <code>POST</code> (<code>$_POST</code>) array, then the cookie (<code>$_COOKIE</code>) array, and finally the server (<code>$_SERVER</code>) array.</dd>
<dt><code>request_order</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="request_order option, php.ini file" id="idm45922745697352"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="request_order option" id="idm45922745696232"/>Describes the order in which PHP registers <code>GET</code>, <code>POST</code>, and cookie variables into the <code>$_REQUEST</code> array. Registration is done from left to right, and newer values override older values.</dd>
<dt><code>zend.assertions</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="zend.assertions option" id="idm45922745692472"/>Determines whether assertions are run and throw errors. When disabled, the conditions in calls to <code>assert()</code> are never run (thus, any side effects they might have do not happen).</dd>
<dt><code>assert.exception</code></dt>
<dd><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="assert.exception option" id="idm45922745689496"/>Determines whether the exception system is enabled. By default, this is on in both development and production environments, and is generally the preferred way to handle error conditions.</dd>
</dl>
<p>Additional settings can be used as well; for example, you can use <a contenteditable="false" data-type="indexterm" data-primary="ignore_repeated_errors option, php.ini file" id="idm45922745687528"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="ignore_repeated_errors option" id="idm45922745686248"/><code>ignore_repeated_errors</code> if you are concerned with your logfile getting too large. This directive can suppress repeating errors being logged, but only from the same line of code in the same file. This could be useful if you are debugging a looping section of code and an error is occurring somewhere within it.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="changing settings" id="idm45922745683848"/>PHP also allows you to alter certain INI settings from their server-wide settings during the execution of your code. This can be a quick way to turn on some error reporting and display the results on screen, but it is still not recommended in a production environment. You could do this in the staging environment if desired. One example is to turn on all the error reporting and display any reported errors to the browser in a single suspect file. To do so, insert the following two commands at the top of the file:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">error_reporting</code><code class="p">(</code><code class="k">E_ALL</code><code class="p">);</code>
<code class="nb">ini_set</code><code class="p">(</code><code class="s2">"display_errors"</code><code class="p">,</code> <code class="mi">1</code><code class="p">);</code></pre>
<p>The <a contenteditable="false" data-type="indexterm" data-primary="error_reporting function" id="idm45922745674296"/><code>error_reporting()</code> function allows you to override the level of reported errors, and the <a contenteditable="false" data-type="indexterm" data-primary="ini_set function" id="idm45922745672936"/><code>ini_set()</code> function allows you to change <em>php.ini</em> settings. <a contenteditable="false" data-type="indexterm" data-primary="website resources" data-secondary="php.ini runtime-changeable settings" id="idm45922745671000"/>Again, not all INI settings can be altered, so be sure to check the <a href="https://oreil.ly/ILGqh">PHP website</a> for what can and cannot be changed at runtime.</p>
<p>As promised earlier, <a data-type="xref" href="#php_error_directives_for_server_environ">Table 17-1</a> lists the PHP directives and their recommendations for each of the three basic server environments.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_debugging_php.ini" id="idm45922745663080"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_phpini_settings" id="idm45922745661736"/></p>
<table class="border" id="php_error_directives_for_server_environ">
<caption><span class="label">Table 17-1. </span>PHP error directives for server environments</caption>
<thead>
<tr>
<th>PHP directive</th>
<th>Development</th>
<th>Staging</th>
<th>Production</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>display_errors</code></td>
<td>On</td>
<td><a contenteditable="false" data-type="indexterm" data-primary="display_errors option, php.ini file" id="idm45922745653640"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="display_errors option" id="idm45922745652568"/>Either setting, depending on desired outcome</td>
<td>Off</td>
</tr>
<tr>
<td><code>error_reporting</code></td>
<td><a contenteditable="false" data-type="indexterm" data-primary="error_reporting option, php.ini file" id="ix_error_reporting"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="error_reporting option " id="idm45922745647848"/><code>E_ALL</code></td>
<td><code>E_ALL &amp; ~E_WARNING &amp; ~E_DEPRECATED</code></td>
<td><code>E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT</code></td>
</tr>
<tr>
<td><code>error_log</code></td>
<td><a contenteditable="false" data-type="indexterm" data-primary="error_log option, php.ini file" id="idm45922745590664"/><a contenteditable="false" data-type="indexterm" data-primary=" php.ini file" data-secondary="error_log option" id="idm45922745589496"/><em>/logs</em> folder</td>
<td><em>/logs</em> folder</td>
<td><em>/logs</em> folder</td>
</tr>
<tr>
<td><code>variables_order</code></td>
<td><a contenteditable="false" data-type="indexterm" data-primary="variables_order option, php.ini file" id="idm45922745584888"/><a contenteditable="false" data-type="indexterm" data-primary=" php.ini file" data-secondary="variables_order option" id="idm45922745583768"/>EGPCS</td>
<td>GPCS</td>
<td>GPCS</td>
</tr>
<tr>
<td><code>request_order</code></td>
<td><a contenteditable="false" data-type="indexterm" data-primary="request_order option, php.ini file" id="idm45922745580024"/><a contenteditable="false" data-type="indexterm" data-primary="php.ini file" data-secondary="request_order option" id="idm45922745578904"/>GP</td>
<td>GP</td>
<td>GP</td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Error Handling"><div class="sect1" id="error_handling">
<h1>Error Handling</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="error handling" id="ix__error_handling_debugging"/><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="error handling" id="ix_debugging_error_handling"/>Error handling is an important part of any real-world application. PHP provides a number of mechanisms that you can use to handle errors, both during the development process and once your application is in a production environment.</p>
<section data-type="sect2" data-pdf-bookmark="Error Reporting"><div class="sect2" id="error_reporting">
<h2>Error Reporting</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="error handling" data-secondary="reporting errors" id="idm45922745569336"/>Normally, when an error occurs in a PHP script, the error message is inserted into the script’s output. If the error is fatal, the script execution stops.</p>
<p>There are three levels of conditions: notices, warnings, and errors. A <em>notice</em> that occurs during a script’s execution might indicate an error, but it could also occur during normal execution (e.g., a script trying to access a variable that has not been set). A <em>warning</em> indicates a nonfatal error condition; typically, warnings are displayed when you call a function with invalid arguments. Scripts will continue executing after issuing a warning. An <em>error</em> indicates a fatal condition from which the script cannot recover. A <em>parse error</em> is a specific kind of error that occurs when a script is syntactically incorrect. All errors except parse errors are runtime errors.</p>
<p>It’s recommended that you treat all notices, warnings, and errors as if they were errors; this helps prevent mistakes such as using variables before they have legitimate values.</p>
<p class="pagebreak-before">By default, all conditions except runtime notices are caught and displayed to the user. You can change this behavior globally in your <em>php.ini</em> file with the <a contenteditable="false" data-type="indexterm" data-primary="error_reporting function" id="idm45922745563176"/><code>error_reporting</code> option. You can also locally change the error-reporting behavior in a script using the <code>error_reporting()</code> function.</p>
<p>With both the <code>error_reporting</code> option and the <code>error_reporting()</code> function, you specify the conditions that are caught and displayed by using the various bitwise operators to combine different constant values, as listed in <a data-type="xref" href="#error_reporting_values">Table 17-2</a>. For example, this indicates all error-level options:</p>
<pre data-type="programlisting" data-code-language="php"><code class="p">(</code><code class="k">E_ERROR</code> <code class="o">|</code> <code class="k">E_PARSE</code> <code class="o">|</code> <code class="nx">E_CORE_ERROR</code> <code class="o">|</code> <code class="nx">E_COMPILE_ERROR</code> <code class="o">|</code> <code class="nx">E_USER_ERROR</code><code class="p">)</code></pre>
<p>while this indicates all options except runtime notices:</p>
<pre data-type="programlisting" data-code-language="php"><code class="p">(</code><code class="k">E_ALL</code> <code class="o">&amp;</code> <code class="o">~</code><code class="nx">E_NOTICE</code><code class="p">)</code></pre>
<p>If you set the <a contenteditable="false" data-type="indexterm" data-primary="track_errors option, php.ini file" id="idm45922745523480"/><a contenteditable="false" data-type="indexterm" data-primary=" php.ini file" data-secondary="track_errors option" id="idm45922745522504"/><code>track_errors</code> option on in your <em>php.ini</em> file, a description of the current error is stored in <code>$PHP_ERRORMSG</code>.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_error_reporting" id="idm45922745545256"/></p>
<table class="border" id="error_reporting_values">
<caption><span class="label">Table 17-2. </span>Error-reporting values</caption>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>E_ERROR</code></td>
<td>Runtime errors</td>
</tr>
<tr>
<td><code>E_WARNING</code></td>
<td>Runtime warnings</td>
</tr>
<tr>
<td><code>E_PARSE</code></td>
<td>Compile-time parse errors</td>
</tr>
<tr>
<td><code>E_NOTICE</code></td>
<td>Runtime notices</td>
</tr>
<tr>
<td><code>E_CORE_ERROR</code></td>
<td>Errors generated internally by PHP</td>
</tr>
<tr>
<td><code>E_CORE_WARNING</code></td>
<td>Warnings generated internally by PHP</td>
</tr>
<tr>
<td><code>E_COMPILE_ERROR</code></td>
<td>Errors generated internally by the Zend scripting engine</td>
</tr>
<tr>
<td><code>E_COMPILE_WARNING</code></td>
<td>Warnings generated internally by the Zend scripting engine</td>
</tr>
<tr>
<td><code>E_USER_ERROR</code></td>
<td>Runtime errors generated by a call to <code>trigger_error()</code></td>
</tr>
<tr>
<td><code>E_USER_WARNING</code></td>
<td>Runtime warnings generated by a call to <code>trigger_error()</code></td>
</tr>
<tr>
<td><code>E_USER_NOTICE</code></td>
<td>Runtime notices generated by a call to <code>trigger_error()</code></td>
</tr>
<tr>
<td><code>E_ALL</code></td>
<td>All of the above options</td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Exceptions"><div class="sect2" id="exceptions">
<h2>Exceptions</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="error handling" data-secondary="exceptions" id="idm45922745469496"/>Many PHP functions now throw exceptions instead of fatally exiting operation. Exceptions allow a script to continue execution even after an error—when the exception occurs, an object that’s a subclass of the <code>BaseException</code> class is created, then thrown. A thrown exception must be “caught” by code following the throwing code.</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">try</code> <code class="p">{</code>
 <code class="nv">$result</code> <code class="o">=</code> <code class="k">eval</code><code class="p">(</code><code class="nv">$code</code><code class="p">);</code>
<code class="p">}</code> <code class="k">catch</code> <code class="p">{</code><code class="nx">\ParseException</code> <code class="nv">$exception</code><code class="p">)</code> <code class="p">{</code>
 <code class="c1">// handle the exception</code>
<code class="p">}</code></pre>
<p>You should include an exception handler to catch exceptions from any method that throws them. Any uncaught exceptions will cause the script to cease execution.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Error Suppression"><div class="sect2" id="error_suppression">
<h2>Error Suppression</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="error handling" data-secondary="suppression of errors" id="idm45922745457448"/>You can disable error messages for a single expression by putting the <a contenteditable="false" data-type="indexterm" data-primary="@ (at sign)" data-secondary="error suppression operator" id="idm45922745455944"/><a contenteditable="false" data-type="indexterm" data-primary="at sign (@)" data-secondary="error suppression operator" id="idm45922745439896"/>error suppression operator <code>@</code> before the expression. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$value</code> <code class="o">=</code> <code class="o">@</code><code class="p">(</code><code class="mi">2</code> <code class="o">/</code> <code class="mi">0</code><code class="p">);</code></pre>
<p>Without the error suppression operator, the expression would normally halt execution of the script with a “divide by zero” error. As shown here, the expression does nothing, although in other cases, your program might be in an unknown state if you simply ignore errors that would otherwise cause the program to halt. The error suppression operator cannot trap parse errors, only the various types of runtime errors.</p>
<p>Of course, the downside to suppressing errors is that you won’t know they’re there. You’re much better off handling potential error conditions properly; see “Triggering Errors” for an example.</p>
<p>To turn off error reporting entirely, use:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">error_reporting</code><code class="p">(</code><code class="mi">0</code><code class="p">);</code></pre>
<p>This function ensures that, regardless of the errors PHP encounters while processing and executing your script, no errors will be sent to the client (except parse errors, which cannot be suppressed). Of course, it doesn’t stop those errors from occurring. Better options for controlling which error messages are displayed in the client are shown in the section “Defining Error Handlers”.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Triggering Errors"><div class="sect2" id="triggering_errors">
<h2>Triggering Errors</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="error handling" data-secondary="triggering errors" id="idm45922745357016"/>You can throw an error from within a script with the <code>assertion()</code> function:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">assert</code><code> </code><code class="p">(</code><code class="nx">mixed</code><code> </code><em><code class="nv">$expression</code></em><code> </code><code class="p">[,</code><code> </code><code class="nx">mixed</code><code> </code><em><code class="nv">$message</code></em><code class="p">]);</code></pre>
<p>The first parameter is the condition that must be <code>true</code> to not trigger the assertion; the second (optional) parameter is the message.</p>
<p>Triggering errors is useful when you’re writing your own functions for sanity-checking the parameters. For example, here’s a function that divides one number by another and throws an error if the second parameter is <code>0</code>:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">divider</code><code class="p">(</code><code class="nv">$a</code><code class="p">,</code> <code class="nv">$b</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">assert</code><code class="p">(</code><code class="nv">$b</code> <code class="o">!=</code> <code class="mi">0</code><code class="p">,</code> <code class="s1">'$b cannot be 0'</code><code class="p">);</code>

 <code class="k">return</code><code class="p">(</code><code class="nv">$a</code> <code class="o">/</code> <code class="nv">$b</code><code class="p">);</code>
<code class="p">}</code>

<code class="k">echo</code> <code class="nx">divider</code><code class="p">(</code><code class="mi">200</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code>
<code class="k">echo</code> <code class="nx">divider</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">0</code><code class="p">);</code>
<code class="mf">66.666666666667</code>
<code class="nx">Fatal</code> <code class="nx">error</code><code class="o">:</code> <code class="nv">$b</code> <code class="nx">cannot</code> <code class="nx">be</code> <code class="mi">0</code> <code class="nx">in</code> <code class="nx">page</code><code class="o">.</code><code class="nx">php</code> <code class="nx">on</code> <code class="nx">line</code> <code class="mi">5</code></pre>
<p>When a call to <code>assert()</code> is triggered, an <code>AssertionException</code>—an exception extending <code>ErrorException</code> with a severity of <code>E_ERROR</code>—is thrown. In some cases, you might want to throw an error of a type that extends <code>AssertionException</code>. You can do so by providing an exception as the message parameter instead of a string:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">class</code> <code class="nc">DividerParameterException</code> <code class="k">extends</code> <code class="nx">AssertionException</code> <code class="p">{</code> <code class="p">}</code>

<code class="k">function</code> <code class="nf">divider</code><code class="p">(</code><code class="nv">$a</code><code class="p">,</code> <code class="nv">$b</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">assert</code><code class="p">(</code><code class="nv">$b</code> <code class="o">!=</code> <code class="mi">0</code><code class="p">,</code> <code class="k">new</code> <code class="nx">DividerParameterException</code><code class="p">(</code><code class="s1">'$b cannot be 0'</code><code class="p">));</code>

 <code class="k">return</code><code class="p">(</code><code class="nv">$a</code> <code class="o">/</code> <code class="nv">$b</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Defining Error Handlers"><div class="sect2" id="defining_error_handlers">
<h2>Defining Error Handlers</h2>
<p><a contenteditable="false" data-type="indexterm" data-primary="error handling" data-secondary="defining error handlers" id="ix_error_handlers_defining"/>If you want better error control than just hiding any errors (and you usually do), you can supply PHP with an error handler. The error handler is called when a condition of any kind is encountered, and can do anything you want it to, from logging information to a file to pretty-printing the error message. The basic process is to create an error-handling function and register it with <code>set_error_handler()</code>.</p>
<p>The function you declare can take in either two or five parameters. The first two parameters are the error code and a string describing the error. The final three parameters, if your function accepts them, are the filename in which the error occurred, the line number at which the error occurred, and a copy of the active symbol table at the time the error occurred. Your error handler should check the current level of errors being reported with <a contenteditable="false" data-type="indexterm" data-primary="error_reporting function" id="idm45922745235992"/><code>error_reporting()</code> and act appropriately.</p>
<p>The call to <code>set_error_handler()</code> returns the current error handler. You can restore the previous error handler either by calling <a contenteditable="false" data-type="indexterm" data-primary="set_error_handler function" id="idm45922745233496"/><code>set_error_handler()</code> with the returned value when your script is done with its own error handler, or by calling the <a contenteditable="false" data-type="indexterm" data-primary="restore_error_handler function" id="idm45922745231896"/><code>restore_error_handler()</code> function.</p>
<p>The following code shows how to use an error handler to format and print errors:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">displayError</code><code class="p">(</code><code class="nv">$error</code><code class="p">,</code> <code class="nv">$errorString</code><code class="p">,</code> <code class="nv">$filename</code><code class="p">,</code> <code class="nv">$line</code><code class="p">,</code> <code class="nv">$symbols</code><code class="p">)</code>
<code class="p">{</code>
 <code class="k">echo</code> <code class="s2">"&lt;p&gt;Error '&lt;b&gt;</code><code class="si">{</code><code class="nv">$errorString</code><code class="si">}</code><code class="s2">&lt;/b&gt;' occurred.&lt;br /&gt;"</code><code class="p">;</code>
 <code class="k">echo</code> <code class="s2">"-- in file '&lt;i&gt;</code><code class="si">{</code><code class="nv">$filename</code><code class="si">}</code><code class="s2">&lt;/i&gt;', line </code><code class="si">$line</code><code class="s2">.&lt;/p&gt;"</code><code class="p">;</code>
<code class="p">}</code>

<code class="nb">set_error_handler</code><code class="p">(</code><code class="s1">'displayError'</code><code class="p">);</code>
<code class="nv">$value</code> <code class="o">=</code> <code class="mi">4</code> <code class="o">/</code> <code class="mi">0</code><code class="p">;</code> <code class="c1">// divide by zero error</code>

<code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Error</code> <code class="s1">'&lt;b&gt;Division by zero&lt;/b&gt;'</code> <code class="nx">occurred</code><code class="o">.</code>
<code class="o">--</code> <code class="nx">in</code> <code class="nb">file</code> <code class="s1">'&lt;i&gt;err-2.php&lt;/i&gt;'</code><code class="p">,</code> <code class="nx">line</code> <code class="mf">8.</code><code class="o">&lt;/</code><code class="nx">p</code><code class="o">&gt;</code></pre>
<section data-type="sect3" data-pdf-bookmark="Logging in error handlers"><div class="sect3" id="logging_in_error_handlers">
<h3>Logging in error handlers</h3>
<p><a contenteditable="false" data-type="indexterm" data-primary="error_log function" id="ix_error_log_function"/>PHP provides the built-in function <code>error_log()</code> to log errors to the myriad places where administrators like to put them:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">error_log</code><code class="p">(</code><em><code class="nx">message</code></em><code class="p">,</code><code> </code><em><code class="nx">type</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">destination</code></em><code> </code><code class="p">[,</code><code> </code><em><code class="nx">extra_headers</code></em><code> </code><code class="p">]]);</code></pre>
<p>The first parameter is the error message. The second parameter specifies where the error is logged: a value of <code>0</code> logs the error via PHP’s standard error-logging mechanism; a value of <code>1</code> emails the error to the <em>destination</em> address, optionally adding any <em>extra_headers</em> to the message; a value of <code>3</code> appends the error to the <em>destination</em> file.</p>
<p>To save an error using PHP’s logging mechanism, call <code>error_log()</code> with a type of <code>0</code>. By changing the value of <code>error_log</code> in your <em>php.ini</em> file, you can change which file to log into. If you set <code>error_log</code> to <code>syslog</code>, the system logger is used instead. For <span class="keep-together">example:</span></p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">error_log</code><code class="p">(</code><code class="s1">'A connection to the database could not be opened.'</code><code class="p">,</code> <code class="mi">0</code><code class="p">);</code></pre>
<p>To send an error via email, call <code>error_log()</code> with a type of <code>1</code>. The third parameter is the email address to which to send the error message, and an optional fourth parameter can be used to specify additional email headers. Here’s how to send an error message by email:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">error_log</code><code class="p">(</code><code class="s1">'A connection to the database could not be opened.'</code><code class="p">,</code>
 <code class="mi">1</code><code class="p">,</code> <code class="s1">'errors@php.net'</code><code class="p">);</code></pre>
<p>Finally, to log to a file, call <code>error_log()</code> with a type of <code>3</code>. The third parameter specifies the name of the file to log into:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nb">error_log</code><code class="p">(</code><code class="s1">'A connection to the database could not be opened.'</code><code class="p">,</code>
 <code class="mi">3</code><code class="p">,</code> <code class="s1">'/var/log/php_errors.log'</code><code class="p">);</code></pre>
<p><a data-type="xref" href="#example_oneseven_onedot_log_rolling_err">Example 17-1</a> shows an example of an error handler that writes logs into a file and rotates the logfile when it gets above 1 KB.</p>
<div data-type="example" id="example_oneseven_onedot_log_rolling_err">
<h5><span class="label">Example 17-1. </span>Log-rolling error handler</h5>
<pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">logRoller</code><code class="p">(</code><code class="nv">$error</code><code class="p">,</code> <code class="nv">$errorString</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$file</code> <code class="o">=</code> <code class="s1">'/var/log/php_errors.log'</code><code class="p">;</code>

 <code class="k">if</code> <code class="p">(</code><code class="nb">filesize</code><code class="p">(</code><code class="nv">$file</code><code class="p">)</code> <code class="o">&gt;</code> <code class="mi">1024</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">rename</code><code class="p">(</code><code class="nv">$file</code><code class="p">,</code> <code class="nv">$file</code> <code class="o">.</code> <code class="p">(</code><code class="nx">string</code><code class="p">)</code> <code class="nb">time</code><code class="p">());</code>
 <code class="nb">clearstatcache</code><code class="p">();</code>
 <code class="p">}</code>

 <code class="nb">error_log</code><code class="p">(</code><code class="nv">$errorString</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="nv">$file</code><code class="p">);</code>
<code class="p">}</code>

<code class="nb">set_error_handler</code><code class="p">(</code><code class="s1">'logRoller'</code><code class="p">);</code>

<code class="k">for</code> <code class="p">(</code><code class="nv">$i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$i</code> <code class="o">&lt;</code> <code class="mi">5000</code><code class="p">;</code> <code class="nv">$i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">trigger_error</code><code class="p">(</code><code class="nb">time</code><code class="p">()</code> <code class="o">.</code> <code class="s2">": Just an error, ma'am.</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>

<code class="nb">restore_error_handler</code><code class="p">();</code></pre>
</div>
<p>Generally, while you are working on a site, you will want errors shown directly in the pages in which they occur. However, once the site goes live, it doesn’t make much sense to show internal error messages to visitors. A common approach is to use something like this in your <em>php.ini</em> file once your site goes live:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nx">display_errors</code> <code class="o">=</code> <code class="nx">Off</code>
<code class="nx">log_errors</code> <code class="o">=</code> <code class="nx">On</code>
<code class="nb">error_log</code> <code class="o">=</code> <code class="o">/</code><code class="nx">tmp</code><code class="o">/</code><code class="nx">errors</code><code class="o">.</code><code class="nb">log</code></pre>
<p>This tells PHP to never show any errors, but instead to log them to the location specified by the <code>error_log</code> directive.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_error_log_function" id="idm45922744686440"/></p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Output buffering in error handlers"><div class="sect3" id="output_buffering_in_error_handlers">
<h3>Output buffering in error handlers</h3>
<p><a contenteditable="false" data-type="indexterm" data-primary="output buffering" data-secondary="in error handlers" data-secondary-sortas="error handlers" id="idm45922744634952"/>Using a combination of output buffering and an error handler, you can send different content to the user depending on whether various error conditions occur. For example, if a script needs to connect to a database, you can suppress output of the page until the script successfully connects to the database.</p>
<p><a data-type="xref" href="#example_oneseven_twodot_output_bufferin">Example 17-2</a> shows the use of output buffering to delay output of a page until it has been generated successfully.</p>
<div data-type="example" id="example_oneseven_twodot_output_bufferin">
<h5><span class="label">Example 17-2. </span>Output buffering to handle errors</h5>
<pre data-type="programlisting" data-code-language="html+php"><code class="nt">&lt;html&gt;</code>
 <code class="nt">&lt;head&gt;</code>
 <code class="nt">&lt;title&gt;</code>Results!<code class="nt">&lt;/title&gt;</code>
 <code class="nt">&lt;/head&gt;</code>

 <code class="nt">&lt;body&gt;</code>
 <code class="cp">&lt;?php</code> <code class="k">function</code> <code class="nf">handle_errors</code> <code class="p">(</code><code class="nv">$error</code><code class="p">,</code> <code class="nv">$message</code><code class="p">,</code> <code class="nv">$filename</code><code class="p">,</code> <code class="nv">$line</code><code class="p">)</code> <code class="p">{</code>
 <code class="nb">ob_end_clean</code><code class="p">();</code>
 <code class="k">echo</code> <code class="s2">"&lt;b&gt;</code><code class="si">{</code><code class="nv">$message</code><code class="si">}</code><code class="s2">&lt;/b&gt;&lt;br/&gt; in line </code><code class="si">{</code><code class="nv">$line</code><code class="si">}</code><code class="s2">&lt;br/&gt; of "</code><code class="p">;</code>
 <code class="k">echo</code> <code class="s2">"&lt;i&gt;</code><code class="si">{</code><code class="nv">$filename</code><code class="si">}</code><code class="s2">&lt;/i&gt;&lt;/body&gt;&lt;/html&gt;"</code><code class="p">;</code>

 <code class="k">exit</code><code class="p">;</code>
 <code class="p">}</code>

 <code class="nb">set_error_handler</code><code class="p">(</code><code class="s1">'handle_errors'</code><code class="p">);</code>
 <code class="nb">ob_start</code><code class="p">();</code> <code class="cp">?&gt;</code>

 <code class="nt">&lt;h1&gt;</code>Results!<code class="nt">&lt;/h1&gt;</code>

 <code class="nt">&lt;p&gt;</code>Here are the results of your search:<code class="nt">&lt;/p&gt;</code>

 <code class="nt">&lt;table</code> <code class="na">border=</code><code class="s">"1"</code><code class="nt">&gt;</code>
 <code class="cp">&lt;?php</code> <code class="k">require_once</code><code class="p">(</code><code class="s1">'DB.php'</code><code class="p">);</code>
 <code class="nv">$db</code> <code class="o">=</code> <code class="nx">DB</code><code class="o">::</code><code class="na">connect</code><code class="p">(</code><code class="s1">'mysql://gnat:waldus@localhost/webdb'</code><code class="p">);</code>

 <code class="k">if</code> <code class="p">(</code><code class="nx">DB</code><code class="o">::</code><code class="na">iserror</code><code class="p">(</code><code class="nv">$db</code><code class="p">))</code> <code class="p">{</code>
 <code class="k">die</code><code class="p">(</code><code class="nv">$db</code><code class="o">-&gt;</code><code class="na">getMessage</code><code class="p">());</code>
 <code class="p">}</code> <code class="cp">?&gt;</code>
 <code class="nt">&lt;/table&gt;</code>
 <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>
</div>
<p>In <a data-type="xref" href="#example_oneseven_twodot_output_bufferin">Example 17-2</a>, after we start the <code>&lt;body&gt;</code> element, we register the error handler and begin output buffering. If we cannot connect to the database (or if anything else goes wrong in the subsequent PHP code), the heading and table are not displayed. Instead, the user sees only the error message. If no errors are raised by the PHP code, however, the user simply sees the HTML page.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_debugging_error_handling" id="idm45922744775608"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix__error_handling_debugging" id="idm45922744774296"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_error_handlers_defining" id="idm45922744772952"/></p>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Manual Debugging"><div class="sect1" id="manual_debugging">
<h1>Manual Debugging</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="manual debugging" id="ix_debugging_manual"/>Once you get a few good years of development time under your belt, you should be able to get at least 75% of your debugging done on a purely visual basis. What of the other 25%, and the more difficult segments of code that you need to work through? You can tackle some of it by using a great code development environment like Zend Studio for Eclipse or Komodo. These advanced IDEs can help with syntax checking and some simple logical problems and warnings.</p>
<p>You can do the next level of debugging (again, you’ll do most of this in the development environment) by <a contenteditable="false" data-type="indexterm" data-primary="echo construct" id="idm45922744766760"/>echoing values out onto the screen. This will catch a lot of logic errors that may be dependent on the contents of variables. For example, how would you be able to easily see the value of the third iteration of a <code>for...next</code> loop? Consider the following code:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">for</code> <code class="p">(</code><code class="nv">$j</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$j</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="p">;</code> <code class="nv">$j</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$sample</code><code class="p">[]</code> <code class="o">=</code> <code class="nv">$j</code> <code class="o">*</code> <code class="mi">12</code><code class="p">;</code>
<code class="p">}</code></pre>
<p class="pagebreak-before">The easiest way is to interrupt the loop conditionally and <code>echo</code> out the value at the time; alternatively, you can wait until the loop is completed, as in this case since the loop is building an array. Here are some examples of how to determine that third iteration value (remember that array keys start with 0):</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">for</code><code> </code><code class="p">(</code><code class="nv">$j</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code> </code><code class="nv">$j</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">10</code><code class="p">;</code><code> </code><code class="nv">$j</code><code class="o">++</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="nv">$sample</code><code class="p">[]</code><code> </code><code class="o">=</code><code> </code><code class="nv">$j</code><code> </code><code class="o">*</code><code> </code><code class="mi">12</code><code class="p">;</code><code>

 </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nv">$j</code><code> </code><code class="o">==</code><code> </code><code class="mi">2</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="nv">$sample</code><code class="p">[</code><code class="mi">2</code><code class="p">];</code><code>
 </code><code class="p">}</code><code>
</code><code class="p">}</code><code>
</code><strong><code class="mi">24</code></strong></pre>
<p>Here we are simply inserting a test (<code>if</code> statement) that will send a particular value to the browser when that condition is met. If you are having SQL syntax problems or failures, you can also <code>echo</code> the raw statement out to the browser and copy it into the SQL interface (<em>phpMyAdmin</em>, for example) and execute the code that way to see if any SQL error messages are returned.</p>
<p>If we want to see the entire array at the end of this loop, and what values it contains in each of its elements, we can still use the <code>echo</code> statement, but it would be tedious and cumbersome to write <code>echo</code> statements for each one. Rather, we can use the <a contenteditable="false" data-type="indexterm" data-primary="var_dump function" id="idm45922744756088"/><code>var_dump()</code> function. The extra advantage of <code>var_dump()</code> is that it also tells us the data type of each element of the array. The output is not necessarily pretty, but it is informative. You can copy the output into a text editor and use it to clean up the look of the output.</p>
<p>Of course you can use <code>echo</code> and <code>var_dump()</code> in concert as the need arises. Here is an example of the raw <code>var_dump()</code> output:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">for</code><code> </code><code class="p">(</code><code class="nv">$j</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">;</code><code> </code><code class="nv">$j</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">10</code><code class="p">;</code><code> </code><code class="nv">$j</code><code class="o">++</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="nv">$sample</code><code class="p">[]</code><code> </code><code class="o">=</code><code> </code><code class="nv">$j</code><code> </code><code class="o">*</code><code> </code><code class="mi">12</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><code class="nb">var_dump</code><code class="p">(</code><code class="nv">$sample</code><code class="p">);</code><code>
</code><strong><code class="k">array</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">12</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">24</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">36</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> 
</code><code class="nx">int</code><code class="p">(</code><code class="mi">48</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">60</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">72</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">84</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nx">int</code><code class="p">(</code><code class="mi">96</code><code class="p">)</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> 
</code><code class="nx">int</code><code class="p">(</code><code class="mi">108</code><code class="p">)}</code></strong></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are two other ways to send simple data to the browser: the <code>print</code> language construct and the <code>print_r()</code> function. <code>print</code> is merely an alternative to <code>echo</code> (except that it returns a value of <code>1</code>), while <code>print_r()</code> sends information to the browser in a human-readable format. You can think of <code>print_r()</code> as an alternative to <code>var_dump()</code>, except that the output on an array would not send out each element’s data type. The output for this code:<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_debugging_manual" id="idm45922744397608"/></p>
<pre data-type="programlisting" data-code-language="html+php"><code class="cp">&lt;?php</code>
<code class="k">for</code> <code class="p">(</code><code class="nv">$j</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$j</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="p">;</code> <code class="nv">$j</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
 <code class="nv">$sample</code><code class="p">[]</code> <code class="o">=</code> <code class="nv">$j</code> <code class="o">*</code> <code class="mi">12</code><code class="p">;</code>
<code class="p">}</code>
<code class="cp">?&gt;</code>
<code class="nt">&lt;pre&gt;</code><code class="cp">&lt;?php</code> <code class="nb">print_r</code><code class="p">(</code><code class="nv">$sample</code><code class="p">);</code> <code class="cp">?&gt;</code><code class="nt">&lt;/pre&gt;</code></pre>
<p>would look like this (notice the formatting accomplished by the <code>&lt;pre&gt;</code> tags):</p>
<pre data-type="programlisting" data-code-language="php"><strong><code class="k">Array</code><code class="p">(</code><code> </code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">0</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">12</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">24</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">36</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">48</code><code>
</code><code class="p">[</code><code class="mi">5</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">60</code><code> </code><code class="p">[</code><code class="mi">6</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">72</code><code> </code><code class="p">[</code><code class="mi">7</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">84</code><code> </code><code class="p">[</code><code class="mi">8</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">96</code><code> </code><code class="p">[</code><code class="mi">9</code><code class="p">]</code><code> </code><code class="o">=&gt;</code><code> </code><code class="mi">108</code><code class="p">)</code></strong></pre>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Error Logs"><div class="sect1" id="error_logs">
<h1>Error Logs</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="error logs" id="idm45922744264424"/>You will find many helpful descriptions in the error logfile. As mentioned previously, you should be able to locate the file under the web server’s installation folder in a folder called <em>logs</em>. You should make it part of your debugging routine to check this file for helpful clues as to what might be amiss. Here is just a sample of the verbosity of an error logfile:</p>
<pre data-type="programlisting">[20-Apr-2012 15:10:55] PHP Notice: Undefined variable: size in C:\Program Files
(x86)
[20-Apr-2012 15:10:55] PHP Notice: Undefined index: p in C:\Program Files
(x86)\Zend
[20-Apr-2012 15:10:55] PHP Warning: number_format() expects parameter 1 to be 
double
[20-Apr-2012 15:10:55] PHP Warning: number_format() expects parameter 1 to be 
double
[20-Apr-2012 15:10:55] PHP Deprecated: Function split() is deprecated in 
C:\Program
[20-Apr-2012 15:10:55] PHP Deprecated: Function split() is deprecated in 
C:\Program
[26-Apr-2012 13:18:38] PHP Fatal error: Maximum execution time of 30 seconds
exceeded</pre>
<p>As you can see, there are a few different types of errors being reported here—notices, warnings, deprecation notices, and a fatal error—with their respective timestamps, file locations, and the line on which the error occurred.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Depending on your environment, some commercial server space providers do not grant access for security reasons, so you may not have access to the logfile. Be sure to select a production provider that grants you access to the logfile. Additionally, note that the log can be and often is moved outside the web server’s installation folder. On Ubuntu, for example, the default is in <em>/var/logs/apache2/*.log</em>. Check the web server’s configuration if you can’t locate the log.</p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="IDE Debugging"><div class="sect1" id="ide_debugging">
<h1>IDE Debugging</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="Integrated Development Environment (IDE)" id="ix_integ_dev_environ"/><a contenteditable="false" data-type="indexterm" data-primary="IDE (Integrated Development Environment)" id="ix_ide_debugging"/><a contenteditable="false" data-type="indexterm" data-primary="debugging" data-secondary="IDEs" id="ix_debugging_ide"/>For more complex debugging issues, you would be best served to use a debugger that can be found in a good integrated development environment (IDE). We will be showing you a debug session example with <a contenteditable="false" data-type="indexterm" data-primary="Zend Studio for Eclipse" id="idm45922744183736"/>Zend Studio for Eclipse. Other IDEs, like Komodo and PhpED, have built-in debuggers, so they can also be used for this <span class="keep-together">purpose.</span></p>
<p>Zend Studio has an entire Debug Perspective setup for debugging purposes, as shown in <a data-type="xref" href="#the_default_debug_perspective_in_zend_s">Figure 17-1</a>.</p>
<figure><div id="the_default_debug_perspective_in_zend_s" class="figure">
<img src="Images/php4_1701.png" alt="The default Debug Perspective in Zend Studio" width="1441" height="764"/>
<h6><span class="label">Figure 17-1. </span>The default Debug Perspective in Zend Studio</h6>
</div></figure>
<p>To get your bearings with this debugger, open the Run menu. It shows all the options you can try when in the debug process—stepping into and over code segments, running to a cursor location, restarting the session from the beginning, and just simply letting your code run until it fails or ends, to name a few.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In Zend Studio for Eclipse, you can even debug JavaScript code with the right setup!</p>
</div>
<p>Check the many debug views in this product as well; you can watch the variables (both superglobals and user-defined) as they change over the course of code <span class="keep-together">execution.</span></p>
<p>Breakpoints can also be set (and suspended) anywhere in the PHP code, so you can run to a certain location in your code and view the overall situation at that particular moment. Two other handy views are Debug Output and Browser Output, which present the output of the code as the debugger runs through it. The Debug Output view presents the output in the format you would see if you had selected View Source in a browser, showing the raw HTML as it is being generated. The Browser Output view displays the executing code as it would appear in a browser. The neat thing about both of these views is that they’re populated as the code executes, so if you are stopped at a breakpoint halfway through your code file, they display only the information generated up to that point.</p>
<p><a data-type="xref" href="#the_debugger_in_action_with_watch_expre">Figure 17-2</a> shows an example of the sample code from earlier in this chapter (with an added <code>echo</code> statement within the <code>for</code> loop so that you can see the output as it is being created) run in the debugger. The two main variables (<code>$j</code> and <code>$sample</code>) are being tracked in the Expressions view, and the Browser Output and Debug Output views display their content at a stopped location in the code.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_debugging_ide" id="idm45922744154392"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_ide_debugging" id="idm45922744153016"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_integ_dev_environ" id="idm45922744151640"/></p>
<figure><div id="the_debugger_in_action_with_watch_expre" class="figure">
<img src="Images/php4_1702.png" alt="The debugger in action with watch expressions defined" width="1316" height="528"/>
<h6><span class="label">Figure 17-2. </span>The debugger in action with watch expressions defined</h6>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Additional Debugging Techniques"><div class="sect1" id="additional_debugging_techniques">
<h1>Additional Debugging Techniques</h1>
<p>There are more advanced techniques that can be used for debugging, but they are beyond the scope of this chapter. Two such techniques are profiling and unit testing. If you have a large web system that requires a lot of server resources, you should certainly look into the benefits of these two techniques, as they can make your code base more fault-tolerant and efficient.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_debugging_ch17" id="idm45922744146600"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_php_debug_ch17" id="idm45922744145224"/></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What’s Next"><div class="sect1" id="whatapostrophes_next-id00075">
<h1>What’s Next</h1>
<p>Up next, we’ll explore writing Unix and Windows cross-platform scripts, and provide a brief introduction to hosting your PHP sites on Windows servers.</p>
</div></section>
</div></section></div>



  </body></html>