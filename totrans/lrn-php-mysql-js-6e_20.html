<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 17. JavaScript and PHP Validation and Error Handling" class="calibre4"><div class="preface" id="javascript_and_php_validation_and_error">
<h1 class="calibre10"><span class="keep-together">Chapter 17. </span>JavaScript and PHP Validation <span class="keep-together">and Error Handling</span></h1>

<p class="author1">With<a contenteditable="false" data-primary="validation" data-see="also regular expressions" data-type="indexterm" id="idm45694698220536" class="calibre6"/><a contenteditable="false" data-primary="error handling" data-see="also validation" data-type="indexterm" id="idm45694698219064" class="calibre6"/> your solid foundation in both PHP and JavaScript, it’s time to bring these technologies together to create web forms that are as user-friendly as possible.</p>

<p class="author1">We’ll be using PHP to create the forms and JavaScript to perform client-side validation to ensure that the data is as complete and correct as it can be before it is submitted. Final validation of the input will then be done by PHP, which will, if necessary, present the form again to the user for further modification.</p>

<p class="author1">In the process, this chapter will cover validation and regular expressions in both JavaScript and PHP.</p>

<section data-type="sect1" data-pdf-bookmark="Validating User Input with JavaScript" class="calibre4"><div class="preface" id="validating_user_input_with_javascript">
<h1 class="calibre11">Validating User Input with JavaScript</h1>

<p class="author1">JavaScript<a contenteditable="false" data-primary="JavaScript" data-secondary="validating user input with" data-type="indexterm" id="JSvalid16" class="calibre6"/><a contenteditable="false" data-primary="validation" data-secondary="security issues surrounding" data-type="indexterm" id="idm45694698212408" class="calibre6"/><a contenteditable="false" data-primary="security issues" data-secondary="JavaScript validation" data-type="indexterm" id="idm45694698211016" class="calibre6"/> validation should be considered an assistance more to your users than to your websites because, as I have already stressed many times, you cannot trust any data submitted to your server, even if it has supposedly been validated with JavaScript. This is because hackers can quite easily simulate your web forms and submit any data of their choosing.</p>

<p class="author1">Another reason you cannot rely on JavaScript to perform all your input validation is that some users disable JavaScript, or use browsers that don’t support it.</p>

<p class="author1">So, the best types of validation to do in JavaScript are checking that fields have content if they are not to be left empty, ensuring that email addresses conform to the proper format, and ensuring that values entered are within expected bounds.</p>

<section data-type="sect2" data-pdf-bookmark="The validate.html Document (Part 1)" class="calibre4"><div class="preface" id="validatedothtml_document_left_parent">
<div class="calibre12" id="calibre_pb_0"/>
</div></section>

</div></section>

</div></section></div>

<div id="sbo-rt-content" class="calibre1">
<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 17. JavaScript and PHP Validation and Error Handling" class="calibre4">
<div class="preface" id="javascript_and_php_validation_and_error">
<section data-type="sect1" data-pdf-bookmark="Validating User Input with JavaScript" class="calibre4">
<div class="preface" id="validating_user_input_with_javascript">
<section data-type="sect2" data-pdf-bookmark="The validate.html Document (Part 1)" class="calibre4">
<div class="preface" id="validatedothtml_document_left_parent">
<h2 class="calibre28">The validate.html Document (Part 1)</h2>

<p class="author1">Let’s<a contenteditable="false" data-primary="validation" data-secondary="form data using JavaScript" data-type="indexterm" id="Vjs16" class="calibre6"/> begin with a general signup form, common on most sites that offer memberships or user registration. The inputs requested will be <em class="hyperlink">forename</em>, <em class="hyperlink">surname</em>, <em class="hyperlink">username</em>, <em class="hyperlink">password</em>, <em class="hyperlink">age</em>, and <em class="hyperlink">email address</em>. <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a> provides a good template for such a form.</p>

<div data-type="example" id="form_with_javascript_validation_left_p" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 17-1. </span>A form with JavaScript validation (part 1)</h5>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="cp">&lt;!DOCTYPE html&gt;</code><code class="calibre15">
</code><code class="nt">&lt;html</code><code class="nt">&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;head</code><code class="nt">&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;title</code><code class="nt">&gt;</code><code class="calibre15">An Example Form</code><code class="nt">&lt;/title&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;style</code><code class="nt">&gt;</code><code class="calibre15">
      </code><code class="nc">.signup</code><code class="calibre15"> </code><code class="p">{</code><code class="calibre15">
        </code><code class="k">border</code><code class="o">:</code><code class="mi">1px</code><code class="calibre15"> </code><code class="nb">solid</code><code class="calibre15"> </code><code class="mi">#999999</code><code class="p">;</code><code class="calibre15">
        </code><code class="k">font</code><code class="o">:</code><code class="calibre15">  </code><code class="n">normal</code><code class="calibre15"> </code><code class="mi">14px</code><code class="calibre15"> </code><code class="n">helvetica</code><code class="p">;</code><code class="calibre15">
        </code><code class="k">color</code><code class="o">:</code><code class="calibre15"> </code><code class="mi">#444444</code><code class="p">;</code><code class="calibre15">
      </code><code class="p">}</code><code class="calibre15">
    </code><code class="nt">&lt;/style&gt;</code><code class="calibre15">
    </code><strong class="calibre31"><code class="na1">&lt;script</code><code class="na1">&gt;</code><code class="calibre17">
      </code><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validate</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">)</code><code class="calibre17">
      </code><code class="p1">{</code><code class="calibre17">
        </code><code class="nx1">fail</code><code class="calibre17">  </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">validateForename</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">.</code><code class="nx1">forename</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre17">
        </code><code class="nx1">fail</code><code class="calibre17"> </code><code class="o1">+=</code><code class="calibre17"> </code><code class="nx1">validateSurname</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">.</code><code class="nx1">surname</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre17">
        </code><code class="nx1">fail</code><code class="calibre17"> </code><code class="o1">+=</code><code class="calibre17"> </code><code class="nx1">validateUsername</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">.</code><code class="nx1">username</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre17">
        </code><code class="nx1">fail</code><code class="calibre17"> </code><code class="o1">+=</code><code class="calibre17"> </code><code class="nx1">validatePassword</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">.</code><code class="nx1">password</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre17">
        </code><code class="nx1">fail</code><code class="calibre17"> </code><code class="o1">+=</code><code class="calibre17"> </code><code class="nx1">validateAge</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">.</code><code class="nx1">age</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre17">
        </code><code class="nx1">fail</code><code class="calibre17"> </code><code class="o1">+=</code><code class="calibre17"> </code><code class="nx1">validateEmail</code><code class="p1">(</code><code class="nx1">form</code><code class="p1">.</code><code class="nx1">email</code><code class="p1">.</code><code class="nx1">value</code><code class="p1">)</code><code class="calibre17">

        </code><code class="k1">if</code><code class="calibre17">   </code><code class="p1">(</code><code class="nx1">fail</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">""</code><code class="p1">)</code><code class="calibre17">   </code><code class="k1">return</code><code class="calibre17"> </code><code class="k1">true</code><code class="calibre17">
        </code><code class="k1">else</code><code class="calibre17"> </code><code class="p1">{</code><code class="calibre17"> </code><code class="nx1">alert</code><code class="p1">(</code><code class="nx1">fail</code><code class="p1">)</code><code class="p1">;</code><code class="calibre17"> </code><code class="k1">return</code><code class="calibre17"> </code><code class="k1">false</code><code class="calibre17"> </code><code class="p1">}</code><code class="calibre17">
      </code><code class="p1">}</code><code class="calibre17">
    </code><code class="na1">&lt;/script&gt;</code></strong><code class="calibre15">
  </code><code class="nt">&lt;/head&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;body</code><code class="nt">&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;table</code><code class="calibre15"> </code><code class="na">class=</code><code class="s">"signup"</code><code class="calibre15"> </code><code class="na">border=</code><code class="s">"0"</code><code class="calibre15"> </code><code class="na">cellpadding=</code><code class="s">"2"</code><code class="calibre15">
              </code><code class="na">cellspacing=</code><code class="s">"5"</code><code class="calibre15"> </code><code class="na">bgcolor=</code><code class="s">"#eeeeee"</code><code class="nt">&gt;</code><code class="calibre15">
      </code><code class="nt">&lt;th</code><code class="calibre15"> </code><code class="na">colspan=</code><code class="s">"2"</code><code class="calibre15"> </code><code class="na">align=</code><code class="s">"center"</code><code class="nt">&gt;</code><code class="calibre15">Signup Form</code><code class="nt">&lt;/th&gt;</code><code class="calibre15">
      </code><code class="nt">&lt;form</code><code class="calibre15"> </code><code class="na">method=</code><code class="s">"post"</code><code class="calibre15"> </code><code class="na">action=</code><code class="s">"adduser.php"</code><code class="calibre15"> </code><code class="na">onsubmit=</code><code class="s">"return validate(this)"</code><code class="nt">&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="calibre15">Forename</code><code class="nt">&lt;/td&gt;</code><code class="calibre15">
          </code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"text"</code><code class="calibre15"> </code><code class="na">maxlength=</code><code class="s">"32"</code><code class="calibre15"> </code><code class="na">name=</code><code class="s">"forename"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="calibre15">Surname</code><code class="nt">&lt;/td&gt;</code><code class="calibre15">
          </code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"text"</code><code class="calibre15"> </code><code class="na">maxlength=</code><code class="s">"32"</code><code class="calibre15"> </code><code class="na">name=</code><code class="s">"surname"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="calibre15">Username</code><code class="nt">&lt;/td&gt;</code><code class="calibre15">
          </code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"text"</code><code class="calibre15"> </code><code class="na">maxlength=</code><code class="s">"16"</code><code class="calibre15"> </code><code class="na">name=</code><code class="s">"username"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="calibre15">Password</code><code class="nt">&lt;/td&gt;</code><code class="calibre15">
          </code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"text"</code><code class="calibre15"> </code><code class="na">maxlength=</code><code class="s">"12"</code><code class="calibre15"> </code><code class="na">name=</code><code class="s">"password"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="calibre15">Age</code><code class="nt">&lt;/td&gt;</code><code class="calibre15">
          </code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"text"</code><code class="calibre15"> </code><code class="na">maxlength=</code><code class="s">"3"</code><code class="calibre15">  </code><code class="na">name=</code><code class="s">"age"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="calibre15">Email</code><code class="nt">&lt;/td&gt;</code><code class="calibre15">
          </code><code class="nt">&lt;td</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"text"</code><code class="calibre15"> </code><code class="na">maxlength=</code><code class="s">"64"</code><code class="calibre15"> </code><code class="na">name=</code><code class="s">"email"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
        </code><code class="nt">&lt;tr</code><code class="nt">&gt;</code><code class="nt">&lt;td</code><code class="calibre15"> </code><code class="na">colspan=</code><code class="s">"2"</code><code class="calibre15"> </code><code class="na">align=</code><code class="s">"center"</code><code class="nt">&gt;</code><code class="nt">&lt;input</code><code class="calibre15"> </code><code class="na">type=</code><code class="s">"submit"</code><code class="calibre15">
          </code><code class="na">value=</code><code class="s">"Signup"</code><code class="nt">&gt;</code><code class="nt">&lt;/td&gt;</code><code class="nt">&lt;/tr&gt;</code><code class="calibre15">
      </code><code class="nt">&lt;/form&gt;</code><code class="calibre15">
    </code><code class="nt">&lt;/table&gt;</code><code class="calibre15">
  </code><code class="nt">&lt;/body&gt;</code><code class="calibre15">
</code><code class="nt">&lt;/html&gt;</code></pre>
</div>

<p class="author1">As it stands, this form will display correctly but will not self-validate, because the main validation functions have not yet been added. Even so, save it as <em class="hyperlink">validate.html</em>, and when you call it up in your browser, it will look like <a data-type="xref" href="ch17_split_001.xhtml#output_from_example_16-1" class="calibre6">Figure 17-1</a>.</p>

<figure class="calibre23"><div id="output_from_example_16-1" class="figure"><img alt="The output from Example 16-1" src="Images/pmj6_1701.png" class="calibre88"/>
<h6 class="calibre24"><span class="keep-together">Figure 17-1. </span>The output from <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a></h6>
</div></figure>

<p class="author1">Let’s look at how this document is made up. The first few lines set up the document and use a little CSS to make the form look a little less plain. The parts of the document related to JavaScript come next and are shown in bold.</p>

<p class="author1">Between the <code class="calibre15">&lt;script&gt;</code> and <code class="calibre15">&lt;/script&gt;</code> tags lies a single function called <code class="calibre15">validate</code> that itself calls up six other functions to validate each of the form’s input fields. We’ll get to these functions shortly. For now I’ll just explain that they return either an empty string if a field validates or an error message if it fails. If there are any errors, the final line of the script pops up an alert box to display them.</p>

<p class="author1">Upon passing validation, the <code class="calibre15">validate</code> function returns a value of <code class="calibre15">true</code>; otherwise, it returns <code class="calibre15">false</code>. The return values from <code class="calibre15">validate</code> are important, because if it returns <code class="calibre15">false</code>, the form is prevented from being submitted. This allows the user to close the alert pop-up and make changes. If <code class="calibre15">true</code> is returned, no errors were encountered in the form’s fields, and so the form is submitted.</p>

<p class="author1">The second part of this example features the HTML for the form, with each field and its name placed within its own row of a table. This is pretty straightforward HTML, with the exception of the <code class="calibre15">onSubmit="return validate(this)"</code> statement within the opening <code class="calibre15">&lt;form&gt;</code> tag. Using <code class="calibre15">onSubmit</code>, you can cause a function of your choice to be called when a form is submitted. That function can perform some checking and return a value of either <code class="calibre15">true</code> or <code class="calibre15">false</code> to signify whether the form should be allowed to be submitted.</p>

<p class="author1">The <code class="calibre15">this</code> parameter is the current object (i.e., this form) and is passed to the <span class="keep-together"><code class="calibre15">validate</code></span> function just discussed. The <code class="calibre15">validate</code> function receives this parameter as the object <code class="calibre15">form</code>.</p>

<p class="author1">As you can see, the only JavaScript used within the form’s HTML is the call to <code class="calibre15">return</code> buried in the <code class="calibre15">onSubmit</code> attribute. Browsers with JavaScript disabled or not available will simply ignore the <code class="calibre15">onSubmit</code> attribute, and the HTML will display just fine.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="The validate.html Document (Part 2)" class="calibre4"><div class="preface" id="validatedothtml_document_left_pa-id00100">
<div class="calibre12" id="calibre_pb_1"/>
</div></section>
</div></section>

</div></section></div>

<div id="sbo-rt-content" class="calibre1">
<section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 17. JavaScript and PHP Validation and Error Handling" class="calibre4">
<div class="preface" id="javascript_and_php_validation_and_error">
<section data-type="sect1" data-pdf-bookmark="Validating User Input with JavaScript" class="calibre4">
<div class="preface" id="validating_user_input_with_javascript">
<section data-type="sect2" data-pdf-bookmark="The validate.html Document (Part 2)" class="calibre4">
<div class="preface" id="validatedothtml_document_left_pa-id00100">
<h2 class="calibre28">The validate.html Document (Part 2)</h2>

<p class="author1">Now we come to <a data-type="xref" href="ch17_split_002.xhtml#form_with_javascript_validation-id00101" class="calibre6">Example 17-2</a>, a set of six functions that do the actual form-field validation. I suggest that you type all of this second part and save it in the <code class="calibre15">&lt;script&gt;...&lt;/script&gt;</code> section of <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a>, which you should already have saved as <em class="hyperlink">validate.html</em>.</p>

<div data-type="example" id="form_with_javascript_validation-id00101" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 17-2. </span>A form with JavaScript validation (part 2)</h5>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validateForename</code><code class="p1">(</code><code class="nx1">field</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="k">return</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">==</code><code class="calibre15"> </code><code class="s">""</code><code class="p">)</code><code class="calibre15"> </code><code class="o">?</code><code class="calibre15"> </code><code class="s">"No Forename was entered.\n"</code><code class="calibre15"> </code><code class="o">:</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validateSurname</code><code class="p1">(</code><code class="nx1">field</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="k">return</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">==</code><code class="calibre15"> </code><code class="s">""</code><code class="p">)</code><code class="calibre15"> </code><code class="o">?</code><code class="calibre15"> </code><code class="s">"No Surname was entered.\n"</code><code class="calibre15"> </code><code class="o">:</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validateUsername</code><code class="p1">(</code><code class="nx1">field</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">==</code><code class="calibre15"> </code><code class="s">""</code><code class="p">)</code><code class="calibre15"> </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"No Username was entered.\n"</code><code class="calibre15">
  </code><code class="k">else</code><code class="calibre15"> </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="p">.</code><code class="n">length</code><code class="calibre15"> </code><code class="o">&lt;</code><code class="calibre15"> </code><code class="mi">5</code><code class="p">)</code><code class="calibre15">
    </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"Usernames must be at least 5 characters.\n"</code><code class="calibre15">
  </code><code class="k">else</code><code class="calibre15"> </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="sr">/[^a-zA-Z0-9_-]/</code><code class="p">.</code><code class="n">test</code><code class="p">(</code><code class="n">field</code><code class="p">)</code><code class="p">)</code><code class="calibre15">
    </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"Only a-z, A-Z, 0-9, - and _ allowed in Usernames.\n"</code><code class="calibre15">
  </code><code class="k">return</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validatePassword</code><code class="p1">(</code><code class="nx1">field</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">==</code><code class="calibre15"> </code><code class="s">""</code><code class="p">)</code><code class="calibre15"> </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"No Password was entered.\n"</code><code class="calibre15">
  </code><code class="k">else</code><code class="calibre15"> </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="p">.</code><code class="n">length</code><code class="calibre15"> </code><code class="o">&lt;</code><code class="calibre15"> </code><code class="mi">6</code><code class="p">)</code><code class="calibre15">
    </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"Passwords must be at least 6 characters.\n"</code><code class="calibre15">
  </code><code class="k">else</code><code class="calibre15"> </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="o">!</code><code class="sr">/[a-z]/</code><code class="p">.</code><code class="n">test</code><code class="p">(</code><code class="n">field</code><code class="p">)</code><code class="calibre15"> </code><code class="o">||</code><code class="calibre15"> </code><code class="o">!</code><code class="calibre15"> </code><code class="sr">/[A-Z]/</code><code class="p">.</code><code class="n">test</code><code class="p">(</code><code class="n">field</code><code class="p">)</code><code class="calibre15"> </code><code class="o">||</code><code class="calibre15">
           </code><code class="o">!</code><code class="sr">/[0-9]/</code><code class="p">.</code><code class="n">test</code><code class="p">(</code><code class="n">field</code><code class="p">)</code><code class="p">)</code><code class="calibre15">
    </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"Passwords require one each of a-z, A-Z and 0-9.\n"</code><code class="calibre15">
  </code><code class="k">return</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validateAge</code><code class="p1">(</code><code class="nx1">field</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">==</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15"> </code><code class="o">||</code><code class="calibre15"> </code><code class="nb">isNaN</code><code class="p">(</code><code class="n">field</code><code class="p">)</code><code class="p">)</code><code class="calibre15"> </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"No Age was entered.\n"</code><code class="calibre15">
  </code><code class="k">else</code><code class="calibre15"> </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">&lt;</code><code class="calibre15"> </code><code class="mi">18</code><code class="calibre15"> </code><code class="o">||</code><code class="calibre15"> </code><code class="n">field</code><code class="calibre15"> </code><code class="o">&gt;</code><code class="calibre15"> </code><code class="mi">110</code><code class="p">)</code><code class="calibre15">
    </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"Age must be between 18 and 110.\n"</code><code class="calibre15">
  </code><code class="k">return</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15">
</code><code class="p">}</code><code class="calibre15">

</code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nx1">validateEmail</code><code class="p1">(</code><code class="nx1">field</code><code class="p1">)</code></strong><code class="calibre15">
</code><code class="p">{</code><code class="calibre15">
  </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="n">field</code><code class="calibre15"> </code><code class="o">==</code><code class="calibre15"> </code><code class="s">""</code><code class="p">)</code><code class="calibre15"> </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"No Email was entered.\n"</code><code class="calibre15">
    </code><code class="k">else</code><code class="calibre15"> </code><code class="k">if</code><code class="calibre15"> </code><code class="p">(</code><code class="o">!</code><code class="p">(</code><code class="p">(</code><code class="n">field</code><code class="p">.</code><code class="n">indexOf</code><code class="p">(</code><code class="s">"."</code><code class="p">)</code><code class="calibre15"> </code><code class="o">&gt;</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code><code class="calibre15"> </code><code class="o">&amp;&amp;</code><code class="calibre15">
               </code><code class="p">(</code><code class="n">field</code><code class="p">.</code><code class="n">indexOf</code><code class="p">(</code><code class="s">"@"</code><code class="p">)</code><code class="calibre15"> </code><code class="o">&gt;</code><code class="calibre15"> </code><code class="mi">0</code><code class="p">)</code><code class="p">)</code><code class="calibre15"> </code><code class="o">||</code><code class="calibre15">
              </code><code class="sr">/[^a-zA-Z0-9.@_-]/</code><code class="p">.</code><code class="n">test</code><code class="p">(</code><code class="n">field</code><code class="p">)</code><code class="p">)</code><code class="calibre15">
      </code><code class="k">return</code><code class="calibre15"> </code><code class="s">"The Email address is invalid.\n"</code><code class="calibre15">
  </code><code class="k">return</code><code class="calibre15"> </code><code class="s">""</code><code class="calibre15">
</code><code class="p">}</code></pre>
</div>

<p class="author1">We’ll go through each of these functions in turn, starting with <code class="calibre15">validateForename</code>, so you can see how validation works.</p>

<section data-type="sect3" data-pdf-bookmark="Validating the forename" class="calibre4"><div class="preface" id="validating_the_forename">
<h3 class="calibre43">Validating the forename</h3>

<p class="author1"><code class="calibre15">validateForename</code> is quite a short function that accepts the parameter <code class="calibre15">field</code>, which is the value of the forename passed to it by the <code class="calibre15">validate</code> function.</p>

<p class="author1">If this value is the empty string, an error message is returned; otherwise, an empty string is returned to signify that no error was encountered.</p>

<p class="author1">If the user entered spaces in this field, it would be accepted by <code class="calibre15">validateForename</code>, even though it’s empty for all intents and purposes. You can fix this by adding an extra statement to trim whitespace from the field before checking whether it’s empty, use a regular expression to make sure there’s something besides whitespace in the field, or—as I do here—just let the user make the mistake and allow the PHP program to catch it on the server.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Validating the surname" class="calibre4"><div class="preface" id="validating_the_surname">
<h3 class="calibre43">Validating the surname</h3>

<p class="author1">The <code class="calibre15">validateSurname</code> function is almost identical to <code class="calibre15">validateForename</code> in that an error is returned only if the surname supplied was an empty string. I chose not to limit the characters allowed in either of the name fields to allow for possibilities such as non-English and accented characters.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Validating the username" class="calibre4"><div class="preface" id="validating_the_username">
<h3 class="calibre43">Validating the username</h3>

<p class="author1">The <code class="calibre15">validateUsername</code> function<a contenteditable="false" data-primary="usernames" data-secondary="validating for form input" data-type="indexterm" id="idm45694697366760" class="calibre6"/> is a little more interesting, because it has a more complicated job. It has to allow through only the characters <code class="calibre15">a-z</code>, <code class="calibre15">A-Z</code>, <code class="calibre15">0-9</code>, <code class="calibre15">_</code> and <code class="calibre15">-</code>, and ensure that usernames are at least five characters long.</p>

<p class="author1">The <code class="calibre15">if...else</code> statements commence by returning an error if <code class="calibre15">field</code> has not been <span class="keep-together">filled</span> in. If it’s not the empty string, but is fewer than five characters in length, another error message is returned.</p>

<p class="author1">Then the JavaScript <code class="calibre15">test</code> function is called, passing a regular expression (which matches any character that is <em class="hyperlink">not</em> one of those allowed) to be matched against <code class="calibre15">field</code> (see <a data-type="xref" href="ch17_split_002.xhtml#regular_expressions" class="calibre6">“Regular Expressions”</a>). If even one character that isn’t one of the acceptable characters is encountered, the <code class="calibre15">test</code> function returns <code class="calibre15">true</code>, and so <span class="keep-together"><code class="calibre15">validateUser</code></span> returns an error string.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Validating the password" class="calibre4"><div class="preface" id="validating_the_password">
<h3 class="calibre43">Validating the password</h3>

<p class="author1">Similar<a contenteditable="false" data-primary="passwords" data-secondary="validating for form input" data-type="indexterm" id="idm45694697651288" class="calibre6"/> techniques are used in the <code class="calibre15">validatePassword</code> function. First the function checks whether <code class="calibre15">field</code> is empty, and if it is, it returns an error. Next, an error message is returned if the password is shorter than six characters.</p>

<p class="author1">One of the requirements we’re imposing on passwords is that they must have at least one each of a lowercase, uppercase, and numerical character, so the <code class="calibre15">test</code> function is called three times, once for each of these cases. If any one of these calls returns <code class="calibre15">false</code>, one of the requirements was not met, and so an error message is returned. Otherwise, the empty string is returned to signify that the password was OK.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Validating the age" class="calibre4"><div class="preface" id="validating_the_age">
<h3 class="calibre43">Validating the age</h3>

<p class="author1"><code class="calibre15">validateAge</code> returns an error message if <code class="calibre15">field</code> is not a number (determined by a call to the <code class="calibre15">isNaN</code> function) or if the age entered is lower than 18 or greater than 110. Your applications may well have different or no age requirements. Again, upon successful validation, the empty string is returned.</p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Validating the email" class="calibre4"><div class="preface" id="validating_the_email">
<h3 class="calibre43">Validating the email</h3>

<p class="author1">In<a contenteditable="false" data-primary="email addresses, validating on forms" data-type="indexterm" id="idm45694697641528" class="calibre6"/> the last and most complicated example, the email address is validated with <span class="keep-together"><code class="calibre15">validateEmail</code></span>. After checking whether anything was actually entered, and returning an error message if it wasn’t, the function calls the JavaScript <code class="calibre15">indexOf</code> function twice. The first time a check is made to ensure there is a period (<code class="calibre15">.</code>) somewhere after the first character of the field, and the second checks that an <code class="calibre15">@</code> symbol appears somewhere after the first character.</p>

<p class="author1">If those two checks are satisfied, the <code class="calibre15">test</code> function is called to see whether any disallowed characters appear in the field. If any of these tests fail, an error message is returned. The allowed characters in an email address are uppercase and lowercase letters, numbers, and the <code class="calibre15">_</code>, <code class="calibre15">-</code>, period, and <code class="calibre15">@</code> characters, as detailed in the regular expression passed to the <code class="calibre15">test</code> method. If no errors are found, the empty string is returned to indicate successful validation. On the last line, the script and document are closed.</p>

<p class="author1"><a data-type="xref" href="ch17_split_002.xhtml#javascript_form_validation_in_action" class="calibre6">Figure 17-2</a> shows the result of the user clicking the Signup button without having completed any fields.</p>

<figure class="calibre23"><div id="javascript_form_validation_in_action" class="figure"><img alt="JavaScript form validation in action" src="Images/pmj6_1702.png" class="calibre88"/>
<h6 class="calibre24"><span class="keep-together">Figure 17-2. </span>JavaScript form validation in action</h6>
</div></figure>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Using a separate JavaScript file" class="calibre4"><div class="preface" id="using_a_separate_javascript_file">
<h3 class="calibre43">Using a separate JavaScript file</h3>

<p class="author1">Of course, because they are generic in construction and could apply to many types of validations you might require, these six functions make ideal candidates for moving out into a separate JavaScript file. You could name the file something like <em class="hyperlink">validate_functions.js</em> and include it right after the initial script section in <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a>, using the following<a contenteditable="false" data-primary="" data-startref="Vjs16" data-type="indexterm" id="idm45694697628504" class="calibre6"/><a contenteditable="false" data-primary="" data-startref="JSvalid16" data-type="indexterm" id="idm45694697627128" class="calibre6"/> statement:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="o">&lt;</code><code class="n">script</code> <code class="n">src</code><code class="o">=</code><code class="s">"validate_functions.js"</code><code class="o">&gt;&lt;</code><code class="err">/script&gt;</code></pre>
</div></section>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Regular Expressions" class="calibre4"><div class="preface" id="regular_expressions">
<h1 class="calibre11">Regular Expressions</h1>

<p class="author1">Let’s<a contenteditable="false" data-primary="pattern matching" data-see="regular expressions" data-type="indexterm" id="idm45694697619448" class="calibre6"/> look a little more closely at the pattern matching we have been doing. We’ve achieved it using <em class="hyperlink">regular expressions</em>, which are supported by both JavaScript and PHP. They make it possible to construct the most powerful of pattern-matching algorithms within a single expression.</p>

<section data-type="sect2" data-pdf-bookmark="Matching Through Metacharacters" class="calibre4"><div class="preface" id="matching_through_metacharacters">
<h2 class="calibre28">Matching Through Metacharacters</h2>

<p class="author1">Every<a contenteditable="false" data-primary="regular expressions" data-secondary="metacharacter matching" data-type="indexterm" id="idm45694697615032" class="calibre6"/><a contenteditable="false" data-primary="metacharacters, in regular expressions" data-type="indexterm" id="idm45694697613624" class="calibre6"/> regular expression must be enclosed<a contenteditable="false" data-primary="forward slash (/)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697606360" class="calibre6"/><a contenteditable="false" data-primary="/ (forward slash)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697604984" class="calibre6"/> in slashes. Within these slashes, certain characters have special meanings; they are called <em class="hyperlink">metacharacters</em>. For instance, an asterisk (<code class="calibre15">*</code>) has<a contenteditable="false" data-primary="asterisk (*)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697602536" class="calibre6"/><a contenteditable="false" data-primary="* (asterisk)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697601128" class="calibre6"/> a meaning similar to what you have seen if you’ve used a shell or Windows command prompt (but not quite the same). An asterisk means “The text you’re trying to match may have any number of the preceding characters—or none at all.”</p>

<p class="author1">For instance, let’s say you’re looking for the name <em class="hyperlink">Le Guin</em> and know that someone might spell it with or without a space. Because the text is laid out strangely (for instance, someone may have inserted extra spaces to right-justify lines), you could have to search for a line such as this:</p>

<pre data-programming-language="perl" class="calibre29">
The   difficulty  of   classifying Le      Guin's    works</pre>

<p class="author1">So you need to match <em class="hyperlink">LeGuin</em>, as well as <em class="hyperlink">Le</em> and <em class="hyperlink">Guin</em> separated by any number of spaces. The solution is to follow a space with an asterisk:</p>

<pre data-programming-language="perl" class="calibre29">
/Le *Guin/</pre>

<p class="author1">There’s a lot more than the name <em class="hyperlink">Le Guin</em> in the line, but that’s OK. As long as the regular expression matches some part of the line, the <code class="calibre15">test</code> function returns a <code class="calibre15">true</code> value. What if it’s important to make sure the line contains nothing but <em class="hyperlink">Le Guin</em>? I’ll show you how to ensure that later.</p>

<p class="author1">Suppose that you know there is always at least one space. In that case, you could use the plus sign (<code class="calibre15">+</code>), because it requires at least one of the preceding characters to be present:</p>

<pre data-programming-language="perl" class="calibre29">
/Le +Guin/</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Fuzzy Character Matching" class="calibre4"><div class="preface" id="fuzzy_character_matching">
<h2 class="calibre28">Fuzzy Character Matching</h2>

<p class="author1">The dot (<code class="calibre15">.</code>) is particularly<a contenteditable="false" data-primary="regular expressions" data-secondary="fuzzy character matching" data-type="indexterm" id="idm45694697572232" class="calibre6"/><a contenteditable="false" data-primary="dot (.)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697570808" class="calibre6"/><a contenteditable="false" data-primary=". (dot)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697569432" class="calibre6"/><a contenteditable="false" data-primary="fuzzy character matching" data-type="indexterm" id="idm45694697568056" class="calibre6"/> useful, because it can match anything except a newline. Suppose that you are looking for HTML tags, which start with <code class="calibre15">&lt;</code> and end with <code class="calibre15">&gt;</code>. A simple way to do so is shown here:</p>

<pre data-programming-language="perl" class="calibre29">
/&lt;.*&gt;/</pre>

<p class="author1">The dot matches any character, and the <code class="calibre15">*</code> expands it to match zero or more characters, so this is saying, “Match anything that lies between <code class="calibre15">&lt;</code> and <code class="calibre15">&gt;</code>, even if there’s nothing.” You will match <code class="calibre15">&lt;&gt;</code>, <code class="calibre15">&lt;em&gt;</code>, <code class="calibre15">&lt;br&gt;</code>, and so on. But if you don’t want to match the empty case, <code class="calibre15">&lt;&gt;</code>, you should use <code class="calibre15">+</code> instead of <code class="calibre15">*</code>, like this:</p>

<pre data-programming-language="perl" class="calibre29">
/&lt;.+&gt;/</pre>

<p class="author1">The plus sign expands the dot to match one or more characters, saying, “Match anything that lies between <code class="calibre15">&lt;</code> and <code class="calibre15">&gt;</code> as long as there’s at least one character between them.” You will match <code class="calibre15">&lt;em&gt;</code> and <code class="calibre15">&lt;/em&gt;</code>, <code class="calibre15">&lt;h1&gt;</code> and <code class="calibre15">&lt;/h1&gt;</code>, and tags with attributes, such as this:</p>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"www.mozilla.org"</code><code class="nt">&gt;</code></pre>

<p class="author1">Unfortunately, the plus sign keeps on matching up to the last <code class="calibre15">&gt;</code> on the line, so you might end up with this:</p>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="nt">&lt;h1&gt;&lt;b&gt;</code>Introduction<code class="nt">&lt;/b&gt;&lt;/h1&gt;</code></pre>

<p class="author1">A lot more than one tag! I’ll show a better solution later in this section.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">If you use the dot on its own between the angle brackets, without following it with either a <code class="calibre15">+</code> or <code class="calibre15">*</code>, then it matches a single character; you will match <code class="calibre15">&lt;b&gt;</code> and <code class="calibre15">&lt;i&gt;</code> but <em class="hyperlink">not</em> <code class="calibre15">&lt;em&gt;</code> or <code class="calibre15">&lt;textarea&gt;</code>.</p>
</div>

<p class="author1">If<a contenteditable="false" data-primary="backslash (\)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697511352" class="calibre6"/><a contenteditable="false" data-primary="\ (backslash)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697510056" class="calibre6"/> you want to match the dot character itself (<code class="calibre15">.</code>), you have to escape it by placing a backslash (<code class="calibre15">\</code>) before it, because otherwise it’s a metacharacter and matches anything. As an example, suppose you want to match the floating-point number <code class="calibre15">5.0</code>. The regular expression is as follows:</p>

<pre data-programming-language="perl" class="calibre29">
/5\.0/</pre>

<p class="author1">The backslash can escape any metacharacter, including another backslash (in case you’re trying to match a backslash in text). However, to make things a bit confusing, you’ll see later how backslashes sometimes give the following character a special meaning.</p>

<p class="author1">We just matched a floating-point number. But perhaps you want to match <code class="calibre15">5.</code> as well as <code class="calibre15">5.0</code>, because both mean the same thing as a floating-point number. You also want to match <code class="calibre15">5.00</code>, <code class="calibre15">5.000</code>, and so forth—any number of zeros is allowed. You can do this by adding an asterisk, as you’ve seen:</p>

<pre data-programming-language="perl" class="calibre29">
/5\.0*/</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Grouping Through Parentheses" class="calibre4"><div class="preface" id="grouping_through_parentheses">
<h2 class="calibre28">Grouping Through Parentheses</h2>

<p class="author1">Suppose<a contenteditable="false" data-primary="regular expressions" data-secondary="grouping through parentheses" data-type="indexterm" id="idm45694697546104" class="calibre6"/><a contenteditable="false" data-primary="() (parentheses)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697544728" class="calibre6"/><a contenteditable="false" data-primary="parentheses (())" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697542072" class="calibre6"/> you want to match powers of increments of units, such as kilo, mega, giga, and tera. In other words, you want all the following to match:</p>

<pre data-programming-language="perl" class="calibre29">
1,000
1,000,000
1,000,000,000
1,000,000,000,000
...</pre>

<p class="author1">The plus sign works here, too, but you need to group the string <code class="calibre15">,000</code> so the plus sign matches the whole thing. The regular expression is as follows:</p>

<pre data-programming-language="perl" class="calibre29">
/1(,000)+ /</pre>

<p class="author1">The parentheses mean “Treat this as a group when you apply something such as a plus sign.” <code class="calibre15">1,00,000</code> and <code class="calibre15">1,000,00</code> won’t match because the text must have a 1 followed by one or more complete groups of a comma followed by three zeros.</p>

<p class="author1">The space after the <code class="calibre15">+</code> character indicates that the match must end when a space is encountered. Without it, <code class="calibre15">1,000,00</code> would incorrectly match because only the first <code class="calibre15">1,000</code> would be taken into account, and the remaining <code class="calibre15">,00</code> would be ignored. Requiring a space afterward ensures that matching will continue right through to the end of a number.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Character Classes" class="calibre4"><div class="preface" id="character_classes">
<h2 class="calibre28">Character Classes</h2>

<p class="author1">Sometimes<a contenteditable="false" data-primary="regular expressions" data-secondary="character classes" data-type="indexterm" id="idm45694697249432" class="calibre6"/><a contenteditable="false" data-primary="fuzzy character matching" data-type="indexterm" id="idm45694697248216" class="calibre6"/> you want to match something fuzzy but not so broadly that you want to use a dot. Fuzziness is the great strength of regular expressions: they allow you to be as precise or vague as you want.</p>

<p class="author1">One<a contenteditable="false" data-primary="square brackets ([])" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697246296" class="calibre6"/><a contenteditable="false" data-primary="[] (square brackets)" data-secondary="in regular expressions" data-type="indexterm" id="idm45694697245080" class="calibre6"/><a contenteditable="false" data-primary="[] (square brackets)" data-secondary="in fuzzy matching" data-type="indexterm" id="idm45694697243864" class="calibre6"/><a contenteditable="false" data-primary="square brackets ([])" data-secondary="in fuzzy matching" data-type="indexterm" id="idm45694697242648" class="calibre6"/> of the key features supporting fuzzy matching is the pair of square brackets, <code class="calibre15">[]</code>. It matches a single character, like a dot, but inside the brackets you put a list of things that can match. If any of those characters appears, the text matches. For instance, if you wanted to match both the American spelling <em class="hyperlink">gray</em> and the British spelling <em class="hyperlink">grey</em>, you could specify the following:</p>

<pre data-programming-language="perl" class="calibre29">
/gr[ae]y/</pre>

<p class="author1">After the <code class="calibre15">gr</code> in the text you’re matching, there can be either an <code class="calibre15">a</code> or an <code class="calibre15">e</code>. But there must be only one of them: whatever you put inside the brackets matches exactly one character. The group of characters inside the brackets is called a <em class="hyperlink">character class</em>.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Indicating a Range" class="calibre4"><div class="preface" id="indicating_a_range">
<h2 class="calibre28">Indicating a Range</h2>

<p class="author1">Inside<a contenteditable="false" data-primary="regular expressions" data-secondary="indicating ranges" data-type="indexterm" id="idm45694697235576" class="calibre6"/><a contenteditable="false" data-primary="hyphen (-), in regular expressions" data-type="indexterm" id="idm45694697234360" class="calibre6"/><a contenteditable="false" data-primary="- (hyphen), in regular expressions" data-type="indexterm" id="idm45694697233384" class="calibre6"/> the brackets, you can use a hyphen (<code class="calibre15">-</code>) to indicate a range. One very common task is matching a single digit, which you can do with a range as follows:</p>

<pre data-programming-language="perl" class="calibre29">
/[0-9]/</pre>

<p class="author1">Digits are such a common item in regular expressions that a single character is provided to represent them: <code class="calibre15">\d</code>. You can use it in place of the bracketed regular expression to match a digit:</p>

<pre data-programming-language="perl" class="calibre29">
/\d/</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Negation" class="calibre4"><div class="preface" id="negation">
<h2 class="calibre28">Negation</h2>

<p class="author1">One<a contenteditable="false" data-primary="regular expressions" data-secondary="negation" data-type="indexterm" id="idm45694697227720" class="calibre6"/><a contenteditable="false" data-primary="caret (^), in regular expressions" data-type="indexterm" id="idm45694697226504" class="calibre6"/><a contenteditable="false" data-primary="^ (caret), in regular expressions" data-type="indexterm" id="idm45694697225528" class="calibre6"/><a contenteditable="false" data-primary="[] (square brackets)" data-secondary="negation of character class with" data-type="indexterm" id="idm45694697224552" class="calibre6"/><a contenteditable="false" data-primary="square brackets ([])" data-secondary="negation of character class with" data-type="indexterm" id="idm45694697223336" class="calibre6"/><a contenteditable="false" data-primary="negation" data-type="indexterm" id="idm45694697222120" class="calibre6"/> other important feature of the square brackets is <em class="hyperlink">negation</em> of a character class. You can turn the whole character class on its head by placing a caret (<code class="calibre15">^</code>) after the opening bracket. Here it means “Match any characters <em class="hyperlink">except</em> the following.” So let’s say you want to find instances of <em class="hyperlink">Yahoo</em> that lack the following exclamation point. (The name of the company officially contains an exclamation point!) You could do it as follows:</p>

<pre data-programming-language="perl" class="calibre29">
/Yahoo[^!]/</pre>

<p class="author1">The character class consists of a single character—an exclamation point—but it is inverted by the preceding <code class="calibre15">^</code>. This is actually not a great solution to the problem—for instance, it fails if <em class="hyperlink">Yahoo</em> is at the end of the line, because then it’s not followed by <em class="hyperlink">anything</em>, whereas the brackets must match a character. A better solution involves negative <em class="hyperlink">lookahead</em> (matching something that is not followed by anything else), but that’s beyond the scope of this book, so please refer to the <a href="https://tinyurl.com/regexdocs" class="calibre6">online documentation</a>.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Some More Complicated Examples" class="calibre4"><div class="preface" id="some_more_complicated_examples">
<h2 class="calibre28">Some More Complicated Examples</h2>

<p class="author1">With<a contenteditable="false" data-primary="regular expressions" data-secondary="examples of using" data-type="indexterm" id="idm45694697213592" class="calibre6"/> an understanding of character classes and negation, you’re ready now to see a better solution to the problem of matching an HTML tag. This solution avoids going past the end of a single tag but still matches tags such as <code class="calibre15">&lt;em&gt;</code> and <code class="calibre15">&lt;/em&gt;</code> as well as tags with attributes such as this:</p>

<pre data-code-language="html" data-programming-language="perl" class="calibre29">
<code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"www.mozilla.org"</code><code class="nt">&gt;</code></pre>

<p class="author1">Here is one solution:</p>

<pre data-programming-language="perl" class="calibre29">
/&lt;[^&gt;]+&gt;/</pre>

<p class="author1">That regular expression may look like I just dropped my teacup on the keyboard, but it is perfectly valid and very useful. Let’s break it apart. <a data-type="xref" href="ch17_split_002.xhtml#breakdown_of_a_typical_regular_expressio" class="calibre6">Figure 17-3</a> shows the various elements, which I’ll describe one by one.</p>

<figure class="calibre23"><div id="breakdown_of_a_typical_regular_expressio" class="figure"><img alt="Breakdown of a typical regular expression" src="Images/pmj6_1703.png" class="calibre89"/>
<h6 class="calibre24"><span class="keep-together">Figure 17-3. </span>Breakdown of a typical regular expression</h6>
</div></figure>

<p class="author1">The elements are as follows:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">/</code></dfn></dt>
	<dd class="calibre14">
	<p class="calibre59">Opening slash that indicates this is a regular expression.</p>
	</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">&lt;</code></dfn></dt>
	<dd class="calibre14">
	<p class="calibre59">Opening bracket of an HTML tag. This is matched exactly; it’s not a metacharacter.</p>
	</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">[^&gt;]</code></dfn></dt>
	<dd class="calibre14">
	<p class="calibre59">Character class. The embedded <code class="calibre15">^&gt;</code> means “Match anything except a closing angle bracket.”</p>
	</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">+</code></dfn></dt>
	<dd class="calibre14">
	<p class="calibre59">Allows any number of characters to match the previous <code class="calibre15">[^&gt;]</code>, as long as there is at least one of them.</p>
	</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">&gt;</code></dfn></dt>
	<dd class="calibre14">
	<p class="calibre59">Closing bracket of an HTML tag. This is matched exactly.</p>
	</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">/</code></dfn></dt>
	<dd class="calibre14">
	<p class="calibre59">Closing slash that indicates the end of the regular expression.</p>
	</dd>
</dl>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">Another<a contenteditable="false" data-primary="nongreedy (lazy) pattern matching" data-type="indexterm" id="idm45694697191688" class="calibre6"/> solution to the problem of matching HTML tags is to use a nongreedy operation. By default, pattern matching is greedy, returning the longest match possible. Nongreedy (or lazy) matching finds the shortest possible match. Its use is beyond the scope of this book, but there are more details on the <a href="https://tinyurl.com/regexgreedy" class="calibre6">JavaScript.info website</a>.</p>
</div>

<p class="author1">We<a contenteditable="false" data-primary="usernames" data-secondary="validating for form input" data-type="indexterm" id="idm45694697188904" class="calibre6"/><a contenteditable="false" data-primary="lazy (nongreedy) pattern matching" data-type="indexterm" id="idm45694697187528" class="calibre6"/> are going to look now at one of the expressions from <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a>, where the <code class="calibre15">validateUsername</code> function is used:</p>

<pre data-programming-language="perl" class="calibre29">
/[^a-zA-Z0-9_-]/</pre>

<p class="author1"><a data-type="xref" href="ch17_split_002.xhtml#val-usr-reg-exp" class="calibre6">Figure 17-4</a> shows the various elements.</p>

<figure class="calibre23"><div id="val-usr-reg-exp" class="figure"><img alt="" class="iimagesval-usr-reg-exppng" src="Images/pmj6_1704.png"/>
<h6 class="calibre24"><span class="keep-together">Figure 17-4. </span>Breakdown of the <code class="calibre15">validateUsername</code> regular expression</h6>
</div></figure>

<p class="author1">Let’s look at these elements in detail:</p>

<dl class="calibre13">
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">/</code></dfn></dt>
	<dd class="calibre14">Opening slash that indicates this is a regular expression.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">[</code></dfn></dt>
	<dd class="calibre14">Opening bracket that starts a character class.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">^</code></dfn></dt>
	<dd class="calibre14">Negation character: inverts everything else between the brackets.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">a-z</code></dfn></dt>
	<dd class="calibre14">Represents any lowercase letter.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">A-Z</code></dfn></dt>
	<dd class="calibre14">Represents any uppercase letter.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">0-9</code></dfn></dt>
	<dd class="calibre14">Represents any digit.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">_</code></dfn></dt>
	<dd class="calibre14">An underscore.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">-</code></dfn></dt>
	<dd class="calibre14">A dash.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">]</code></dfn></dt>
	<dd class="calibre14">Closing bracket that ends a character class.</dd>
	<dt class="plain"><dfn class="keep-together"><code class="calibre15">/</code></dfn></dt>
	<dd class="calibre14">Closing slash that indicates the end of the regular expression.</dd>
</dl>

<p class="author1">There are two other important metacharacters. They “anchor” a regular expression by requiring that it appear in a particular place. If a caret (<code class="calibre15">^</code>) appears at the beginning of the regular expression, the expression has to appear at the beginning of a line of text; otherwise, it doesn’t match. Similarly, if a dollar sign (<code class="calibre15">$</code>) appears at the end of the regular expression, the expression has to appear at the end of a line of text.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">It may be somewhat confusing that <code class="calibre15">^</code> can mean “negate the character class” inside square brackets and “match the beginning of the line” if it’s at the beginning of the regular expression. Unfortunately, the same character is used for two different things, so take care when using it.</p>
</div>

<p class="author1">We’ll finish our exploration of regular expression basics by answering a question raised earlier: suppose you want to make sure there is nothing extra on a line besides the regular expression? What if you want a line that has “Le Guin” and nothing else? We can do that by amending the earlier regular expression to anchor the two ends:</p>

<pre data-programming-language="perl" class="calibre29">
/^Le *Guin$/</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Summary of Metacharacters" class="calibre4"><div class="preface" id="summary_of_metacharacters">
<h2 class="calibre28">Summary of Metacharacters</h2>

<p class="author1"><a data-type="xref" href="ch17_split_002.xhtml#regular_expression_metacharacters" class="calibre6">Table 17-1</a> shows<a contenteditable="false" data-primary="regular expressions" data-secondary="metacharacter summary" data-type="indexterm" id="idm45694697142136" class="calibre6"/><a contenteditable="false" data-primary="metacharacters, in regular expressions" data-type="indexterm" id="idm45694697140920" class="calibre6"/> the metacharacters available in regular expressions.</p>

<table id="regular_expression_metacharacters" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 17-1. </span>Regular expression metacharacters</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Metacharacters</th>
			<th class="calibre37">Description</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">/</code></td>
			<td class="calibre39">Begins and ends the regular expression</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">.</code></td>
			<td class="calibre39">Matches any single character except the newline</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48"><em class="calibre30"><code class="calibre66">element</code></em>*</code></td>
			<td class="calibre39">Matches <em class="hyperlink"><code class="calibre51">element</code></em> zero or more times</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48"><em class="calibre30"><code class="calibre66">element</code></em>+</code></td>
			<td class="calibre39">Matches <em class="hyperlink"><code class="calibre51">element</code></em> one or more times</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48"><em class="calibre30"><code class="calibre66">element</code></em>?</code></td>
			<td class="calibre39">Matches <em class="hyperlink"><code class="calibre51">element</code></em> zero or one times</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">[<em class="calibre30"><code class="calibre66">characters</code></em>]</code></td>
			<td class="calibre39">Matches a character out of those contained within the brackets</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">[^<em class="calibre30"><code class="calibre66">characters</code></em>]</code></td>
			<td class="calibre39">Matches a single character that is not contained within the brackets</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">(<em class="calibre30"><code class="calibre66">regex</code></em>)</code></td>
			<td class="calibre39">Treats the <em class="hyperlink"><code class="calibre51">regex</code></em> as a group for counting or a following <code class="calibre48">*</code>, <code class="calibre48">+</code>, or <code class="calibre48">?</code></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48"><em class="calibre30"><code class="calibre66">left</code></em>|<em class="calibre30"><code class="calibre66">right</code></em></code></td>
			<td class="calibre39">Matches either <em class="hyperlink"><code class="calibre51">left</code></em> or <em class="hyperlink"><code class="calibre51">right</code></em></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">[<em class="calibre30"><code class="calibre66">l</code></em>-<em class="calibre30"><code class="calibre66">r</code></em>]</code></td>
			<td class="calibre39">Matches a range of characters between <em class="hyperlink"><code class="calibre51">l</code></em> and <em class="hyperlink"><code class="calibre51">r</code></em></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">^</code></td>
			<td class="calibre39">Requires match to be at the string’s start</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">$</code></td>
			<td class="calibre39">Requires match to be at the string’s end</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\b</code></td>
			<td class="calibre39">Matches a word boundary</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">\B</code></td>
			<td class="calibre39">Matches where there is not a word boundary</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\d</code></td>
			<td class="calibre39">Matches a single digit</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">\D</code></td>
			<td class="calibre39">Matches a single nondigit</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\n</code></td>
			<td class="calibre39">Matches a newline character</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">\s</code></td>
			<td class="calibre39">Matches a whitespace character</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\S</code></td>
			<td class="calibre39">Matches a nonwhitespace character</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">\t</code></td>
			<td class="calibre39">Matches a tab character</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\w</code></td>
			<td class="calibre39">Matches a word character (<code class="calibre48">a-z</code>, <code class="calibre48">A-Z</code>, <code class="calibre48">0-9</code>, and <code class="calibre48">_</code>)</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">\W</code></td>
			<td class="calibre39">Matches a nonword character (anything but <code class="calibre48">a-z</code>, <code class="calibre48">A-Z</code>, <code class="calibre48">0-9</code>, and <code class="calibre48">_</code>)</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\<em class="calibre30"><code class="calibre66">x</code></em></code></td>
			<td class="calibre39">Matches <em class="hyperlink"><code class="calibre51">x</code></em> (useful if <em class="hyperlink"><code class="calibre51">x</code></em> is a metacharacter, but you really want <em class="hyperlink"><code class="calibre51">x</code></em>)</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">{<em class="calibre30"><code class="calibre66">n</code></em>}</code></td>
			<td class="calibre39">Matches exactly <em class="hyperlink"><code class="calibre51">n</code></em> times</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">{<em class="calibre30"><code class="calibre66">n</code></em>,}</code></td>
			<td class="calibre39">Matches <em class="hyperlink"><code class="calibre51">n</code></em> times or more</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">{<em class="calibre30"><code class="calibre66">min</code></em>,<em class="calibre30"><code class="calibre66">max</code></em>}</code></td>
			<td class="calibre39">Matches at least <em class="hyperlink"><code class="calibre51">min</code></em> and at most <em class="hyperlink"><code class="calibre51">max</code></em> times</td>
		</tr>
	</tbody>
</table>

<p class="author1">Provided with this table, and looking again at the expression <code class="calibre15">/[^a-zA-Z0-9_]/</code>, you can see that it could easily be shortened to <code class="calibre15">/[^\w]/</code> because the single metacharacter <code class="calibre15">\w</code> (with a lowercase <code class="calibre15">w</code>) specifies the characters <code class="calibre15">a-z</code>, <code class="calibre15">A-Z</code>, <code class="calibre15">0-9</code>, and <code class="calibre15">_</code>.</p>

<p class="author1">In fact, we can be cleverer than that, because the metacharacter <code class="calibre15">\W</code> (with an uppercase <code class="calibre15">W</code>) specifies all characters <em class="hyperlink">except</em> for <code class="calibre15">a-z</code>, <code class="calibre15">A-Z</code>, <code class="calibre15">0-9</code>, and <code class="calibre15">_</code>. Therefore, we could also drop the <code class="calibre15">^</code> metacharacter and simply use <code class="calibre15">/[\W]/</code> for the expression, or even go a step further and drop the square brackets, as in <code class="calibre15">/\W/</code>, because it’s a single character.</p>

<p class="author1">To<a contenteditable="false" data-primary="regular expressions" data-secondary="examples of using" data-type="indexterm" id="idm45694697069864" class="calibre6"/> give you more ideas of how this all works, <a data-type="xref" href="ch17_split_002.xhtml#some_example_regular_expressions" class="calibre6">Table 17-2</a> shows a range of expressions and the patterns they match.</p>

<table id="some_example_regular_expressions" class="calibre33">
	<caption class="calibre34"><span class="keep-together">Table 17-2. </span>Some example regular expressions</caption>
	<thead class="calibre35">
		<tr class="calibre36">
			<th class="calibre37">Example</th>
			<th class="calibre37">Matches</th>
		</tr>
	</thead>
	<tbody class="calibre38">
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">r</code></td>
			<td class="calibre39">The first <em class="hyperlink">r</em> in <em class="hyperlink">The quick brown</em></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">rec[ei][ei]ve</code></td>
			<td class="calibre39">Either of <em class="hyperlink">receive</em> or <em class="hyperlink">recieve</em> (but also <em class="hyperlink">receeve</em> or <em class="hyperlink">reciive</em>)</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">rec[ei]{2}ve</code></td>
			<td class="calibre39">Either of <em class="hyperlink">receive</em> or <em class="hyperlink">recieve</em> (but also <em class="hyperlink">receeve</em> or <em class="hyperlink">reciive</em>)</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">rec(ei|ie)ve</code></td>
			<td class="calibre39">Either of <em class="hyperlink">receive</em> or <em class="hyperlink">recieve</em> (but not <em class="hyperlink">receeve</em> or <em class="hyperlink">reciive</em>)</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">cat</code></td>
			<td class="calibre39">The word <em class="hyperlink">cat</em> in <em class="hyperlink">I like cats and dogs</em></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">cat|dog</code></td>
			<td class="calibre39">The word <em class="hyperlink">cat</em> in <em class="hyperlink">I like cats and dogs</em> (matches either <em class="hyperlink">cat</em> or <em class="hyperlink">dog</em>, whichever is encountered first)</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">\.</code></td>
			<td class="calibre39"><code class="calibre48">.</code> (the <code class="calibre48">\</code> is necessary because <code class="calibre48">.</code> is a metacharacter)</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">5\.0*</code></td>
			<td class="calibre39"><em class="hyperlink">5.</em>, <em class="hyperlink">5.0</em>, <em class="hyperlink">5.00</em>, <em class="hyperlink">5.000</em>, etc.</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">[a-f]</code></td>
			<td class="calibre39">Any of the characters <em class="hyperlink">a</em>, <em class="hyperlink">b</em>, <em class="hyperlink">c</em>, <em class="hyperlink">d</em>, <em class="hyperlink">e</em>, or <em class="hyperlink">f</em></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">cats$</code></td>
			<td class="calibre39">Only the final <em class="hyperlink">cats</em> in <em class="hyperlink">My cats are friendly cats</em></td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">^my</code></td>
			<td class="calibre39">Only the first <em class="hyperlink">my</em> in <em class="hyperlink">my cats are my pets</em></td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">\d{2,3}</code></td>
			<td class="calibre39">Any two- or three-digit number (<em class="hyperlink">00</em> through <em class="hyperlink">999</em>)</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">7(,000)+</code></td>
			<td class="calibre39"><em class="hyperlink">7,000</em>; <em class="hyperlink">7,000,000</em>; <em class="hyperlink">7,000,000,000</em>; <em class="hyperlink">7,000,000,000,000</em>; etc.</td>
		</tr>
		<tr class="calibre40">
			<td class="calibre39"><code class="calibre48">[\w]+</code></td>
			<td class="calibre39">Any word of one or more characters</td>
		</tr>
		<tr class="calibre36">
			<td class="calibre39"><code class="calibre48">[\w]{5}</code></td>
			<td class="calibre39">Any five-letter word</td>
		</tr>
	</tbody>
</table>
</div></section>

<section data-type="sect2" data-pdf-bookmark="General Modifiers" class="calibre4"><div class="preface" id="general_modifiers">
<h2 class="calibre28">General Modifiers</h2>

<p class="author1">Some<a contenteditable="false" data-primary="regular expressions" data-secondary="general modifiers" data-type="indexterm" id="idm45694697021832" class="calibre6"/> additional modifiers are available for regular expressions:</p>

<ul class="printings">
	<li class="calibre9">
	<p class="author1"><code class="calibre15">/g</code> enables <em class="hyperlink">global</em> matching. When using a replace function, specify this modifier to replace all matches, rather than only the first one.</p>
	</li>
	<li class="calibre9">
	<p class="author1"><code class="calibre15">/i</code> makes the regular expression match case-insensitive. Thus, instead of <code class="calibre15">/[a-zA-Z]/</code>, you could specify <code class="calibre15">/[a-z]/i</code> or <code class="calibre15">/[A-Z]/i</code>.</p>
	</li>
	<li class="calibre9">
	<p class="author1"><code class="calibre15">/m</code> enables multiline mode, in which the caret (<code class="calibre15">^</code>) and dollar sign (<code class="calibre15">$</code>) match before and after any newlines in the subject string. Normally, in a multiline string, <code class="calibre15">^</code> matches only at the start of the string, and <code class="calibre15">$</code> matches only at the end of the string.</p>
	</li>
</ul>

<p class="author1">For example, the expression <code class="calibre15">/cats/g</code> will match both occurrences of the word <em class="hyperlink">cats</em> in the sentence “I like cats, and cats like me.” Similarly, <code class="calibre15">/dogs/gi</code> will match both occurrences of the word <em class="hyperlink">dogs</em> (<em class="hyperlink">Dogs</em> and <em class="hyperlink">dogs</em>) in the sentence “Dogs like other dogs,” because you can use these specifiers together.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Using Regular Expressions in JavaScript" class="calibre4"><div class="preface" id="using_regular_expressions_in_javascript">
<h2 class="calibre28">Using Regular Expressions in JavaScript</h2>

<p class="author1">In<a contenteditable="false" data-primary="regular expressions" data-secondary="using in JavaScript" data-type="indexterm" id="idm45694697007624" class="calibre6"/><a contenteditable="false" data-primary="JavaScript" data-secondary="regular expressions in" data-type="indexterm" id="idm45694697006248" class="calibre6"/> JavaScript, you will use regular expressions mostly in two methods: <code class="calibre15">test</code> (which you have already seen) and <code class="calibre15">replace</code>. Whereas <code class="calibre15">test</code> just tells you whether its argument matches the regular expression, <code class="calibre15">replace</code> takes a second parameter: the string to replace the text that matches. Like most functions, <code class="calibre15">replace</code> generates a new string as a return value; it does not change the input.</p>

<p class="author1">To compare the two methods, the following statement just returns <code class="calibre15">true</code> to let us know that the word <em class="hyperlink">cats</em> appears at least once somewhere within the string:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="nb">document</code><code class="p">.</code><code class="n">write</code><code class="p">(</code><code class="sr">/cats/i</code><code class="p">.</code><code class="n">test</code><code class="p">(</code><code class="s">"Cats are funny. I like cats."</code><code class="p">))</code></pre>

<p class="author1">But the following statement replaces both occurrences of the word <em class="hyperlink">cats</em> with the word <em class="hyperlink">dogs</em>, printing the result. The search has to be global (<code class="calibre15">/g</code>) to find all occurrences, and case-insensitive (<code class="calibre15">/i</code>) to find the capitalized <em class="hyperlink">Cats</em>:</p>

<pre data-code-language="javascript" data-programming-language="perl" class="calibre29">
<code class="nb">document</code><code class="p">.</code><code class="n">write</code><code class="p">(</code><code class="s">"Cats are friendly. I like cats."</code><code class="p">.</code><code class="n">replace</code><code class="p">(</code><code class="sr">/cats/gi</code><code class="p">,</code><code class="s">"dogs"</code><code class="p">))</code></pre>

<p class="author1">If you try out the statement, you’ll see a limitation of <code class="calibre15">replace</code>: because it replaces text with exactly the string you tell it to use, the first word <em class="hyperlink">Cats</em> is replaced by <em class="hyperlink">dogs</em> instead of <em class="hyperlink">Dogs</em>.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Using Regular Expressions in PHP" class="calibre4"><div class="preface" id="using_regular_expressions_in_php">
<h2 class="calibre28">Using Regular Expressions in PHP</h2>

<p class="author1">The<a contenteditable="false" data-primary="regular expressions" data-secondary="using in PHP" data-type="indexterm" id="idm45694696944616" class="calibre6"/><a contenteditable="false" data-primary="PHP programming language" data-secondary="regular expressions in" data-type="indexterm" id="idm45694696943208" class="calibre6"/> most common regular expression functions that you are likely to use in PHP are <code class="calibre15">preg_match</code>, <code class="calibre15">preg_match_all</code>, and <code class="calibre15">preg_replace</code>.</p>

<p class="author1">To test whether the word <em class="hyperlink">cats</em> appears anywhere within a string, in any combination of upper- and lowercase, you could use <code class="calibre15">preg_match</code> like this:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$n</code> <code class="o">=</code> <code class="nb">preg_match</code><code class="p">(</code><code class="s">"/cats/i"</code><code class="p">,</code> <code class="s">"Cats are crazy. I like cats."</code><code class="p">);</code></pre>

<p class="author1">Because PHP uses <code class="calibre15">1</code> for <code class="calibre15">TRUE</code> and <code class="calibre15">0</code> for <code class="calibre15">FALSE</code>, the preceding statement sets <code class="calibre15">$n</code> to <code class="calibre15">1</code>. The first argument is the regular expression, and the second is the text to match. But <code class="calibre15">preg_match</code> is actually a good deal more powerful and complicated, because it takes a third argument that shows what text matched:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$n</code> <code class="o">=</code> <code class="nb">preg_match</code><code class="p">(</code><code class="s">"/cats/i"</code><code class="p">,</code> <code class="s">"Cats are curious. I like cats."</code><code class="p">,</code> <code class="nv">$match</code><code class="p">);</code>
<code class="k">echo</code> <code class="s">"</code><code class="err">$n</code><code class="s"> Matches: </code><code class="err">$match[0]</code><code class="s">"</code><code class="p">;</code></pre>

<p class="author1">The third argument is an array (here, given the name <code class="calibre15">$match</code>). The function puts the matching text into the first element, so if the match is successful, you can find the text that matched in <code class="calibre15">$match[0]</code>. In this example, the output lets us know that the matched text was capitalized:</p>

<pre data-programming-language="perl" class="calibre29">
<strong class="calibre31">1 Matches: Cats</strong></pre>

<p class="author1">If you wish to locate all matches, you use the <code class="calibre15">preg_match_all</code> function, like this:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="nv">$n</code> <code class="o">=</code> <code class="nb">preg_match_all</code><code class="p">(</code><code class="s">"/cats/i"</code><code class="p">,</code> <code class="s">"Cats are strange. I like cats."</code><code class="p">,</code> <code class="nv">$match</code><code class="p">);</code>
<code class="k">echo</code> <code class="s">"</code><code class="err">$n</code><code class="s"> Matches: "</code><code class="p">;</code>
<code class="k">for</code> <code class="p">(</code><code class="nv">$j</code><code class="o">=</code><code class="mi">0</code> <code class="p">;</code> <code class="nv">$j</code> <code class="o">&lt;</code> <code class="nv">$n</code> <code class="p">;</code> <code class="o">++</code><code class="nv">$j</code><code class="p">)</code> <code class="k">echo</code> <code class="nv">$match</code><code class="p">[</code><code class="mi">0</code><code class="p">][</code><code class="nv">$j</code><code class="p">]</code><code class="o">.</code><code class="s">" "</code><code class="p">;</code></pre>

<p class="author1">As before, <code class="calibre15">$match</code> is passed to the function, and the element <code class="calibre15">$match[0]</code> is assigned the matches made but this time as a subarray. To display the subarray, this example iterates through it with a <code class="calibre15">for</code> loop.</p>

<p class="author1">When you want to replace part of a string, you can use <code class="calibre15">preg_replace</code>, as shown here. This example replaces all occurrences of the word <em class="hyperlink">cats</em> with the word <em class="hyperlink">dogs</em>, regardless of case:</p>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="k">echo</code> <code class="nb">preg_replace</code><code class="p">(</code><code class="s">"/cats/i"</code><code class="p">,</code> <code class="s">"dogs"</code><code class="p">,</code> <code class="s">"Cats are furry. I like cats."</code><code class="p">);</code></pre>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">The subject of regular expressions is a large one, and entire books have been written about it. If you would like further information, I suggest the <a href="http://bit.ly/regex-wiki" class="calibre6">Wikipedia entry</a> or <em class="hyperlink"><a href="https://www.regular-expressions.info" class="calibre6">Regular-Expressions.info</a></em>.</p>
</div>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Redisplaying a Form After PHP Validation" class="calibre4"><div class="preface" id="redisplaying_a_form_after_php_validation">
<h1 class="calibre11">Redisplaying a Form After PHP Validation</h1>

<p class="author1">OK, back<a contenteditable="false" data-primary="validation" data-secondary="redisplaying forms following" data-type="indexterm" id="Vredis17" class="calibre6"/> to form validation. So far we’ve created the HTML document <em class="hyperlink">validate.html</em>, which will post through to the PHP program <em class="hyperlink">adduser.php</em>, but only if JavaScript validates the fields or if JavaScript is disabled or unavailable.</p>

<p class="author1">So now it’s time to create <em class="hyperlink">adduser.php</em> to receive the posted form, perform its own validation, and then present the form again to the visitor if the validation fails. <a data-type="xref" href="ch17_split_002.xhtml#adduserdotphp_program" class="calibre6">Example 17-3</a> contains the code that you should type and save (or download from the companion website).</p>

<div data-type="example" id="adduserdotphp_program" class="calibre41">
<h5 class="calibre42"><span class="keep-together">Example 17-3. </span>The adduser.php program</h5>

<pre data-code-language="php" data-programming-language="perl" class="calibre29">
<code class="o">&lt;</code><code class="o">?</code><code class="n">php</code><code class="calibre15"> </code><code class="c">// adduser.php
</code><code class="calibre15">
  </code><strong class="calibre31"><code class="c2">// The PHP code</code></strong><code class="c">
</code><code class="calibre15">
  </code><strong class="calibre31"><code class="nv1">$forename</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nv1">$surname</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nv1">$username</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nv1">$password</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nv1">$age</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nv1">$email</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">isset</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'forename'</code><code class="p1">]))</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="nv1">$forename</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">fix_string</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'forename'</code><code class="p1">]);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">isset</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'surname'</code><code class="p1">]))</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="nv1">$surname</code><code class="calibre17">  </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">fix_string</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'surname'</code><code class="p1">]);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">isset</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'username'</code><code class="p1">]))</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="nv1">$username</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">fix_string</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'username'</code><code class="p1">]);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">isset</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'password'</code><code class="p1">]))</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="nv1">$password</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">fix_string</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'password'</code><code class="p1">]);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">isset</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'age'</code><code class="p1">]))</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="nv1">$age</code><code class="calibre17">      </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">fix_string</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'age'</code><code class="p1">]);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">isset</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'email'</code><code class="p1">]))</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="nv1">$email</code><code class="calibre17">    </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">fix_string</code><code class="p1">(</code><code class="nv1">$_POST</code><code class="p1">[</code><code class="s2">'email'</code><code class="p1">]);</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="nv1">$fail</code><code class="calibre17">  </code><code class="o1">=</code><code class="calibre17"> </code><code class="nx1">validate_forename</code><code class="p1">(</code><code class="nv1">$forename</code><code class="p1">);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nv1">$fail</code><code class="calibre17"> </code><code class="o1">.=</code><code class="calibre17"> </code><code class="nx1">validate_surname</code><code class="p1">(</code><code class="nv1">$surname</code><code class="p1">);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nv1">$fail</code><code class="calibre17"> </code><code class="o1">.=</code><code class="calibre17"> </code><code class="nx1">validate_username</code><code class="p1">(</code><code class="nv1">$username</code><code class="p1">);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nv1">$fail</code><code class="calibre17"> </code><code class="o1">.=</code><code class="calibre17"> </code><code class="nx1">validate_password</code><code class="p1">(</code><code class="nv1">$password</code><code class="p1">);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nv1">$fail</code><code class="calibre17"> </code><code class="o1">.=</code><code class="calibre17"> </code><code class="nx1">validate_age</code><code class="p1">(</code><code class="nv1">$age</code><code class="p1">);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="nv1">$fail</code><code class="calibre17"> </code><code class="o1">.=</code><code class="calibre17"> </code><code class="nx1">validate_email</code><code class="p1">(</code><code class="nv1">$email</code><code class="p1">);</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">echo</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">&lt;!DOCTYPE html&gt;</code><code class="s2">\n</code><code class="s2">&lt;html&gt;&lt;head&gt;&lt;title&gt;An Example Form&lt;/title&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$fail</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">echo</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">&lt;/head&gt;&lt;body&gt;Form data successfully validated:</code></strong><code class="s">
      </code><strong class="calibre31"><code class="si">$forename</code><code class="s2">, </code><code class="si">$surname</code><code class="s2">, </code><code class="si">$username</code><code class="s2">, </code><code class="si">$password</code><code class="s2">, </code><code class="si">$age</code><code class="s2">, </code><code class="si">$email</code><code class="s2">.&lt;/body&gt;&lt;/html&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">

    </code><strong class="calibre31"><code class="c2">// This is where you would enter the posted fields into a database,</code></strong><code class="c">
</code><code class="calibre15">    </code><strong class="calibre31"><code class="c2">// preferably using hash encryption for the password.</code></strong><code class="c">
</code><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">exit</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">echo</code><code class="calibre17"> </code><code class="s2">&lt;&lt;&lt;_END</code></strong><code class="s">

    &lt;!-- The HTML/JavaScript section --&gt;

    &lt;style&gt;
      .signup {
        border: 1px solid #999999;
      font:   normal 14px helvetica; color:#444444;
      }
    &lt;/style&gt;

    &lt;script&gt;
      function validate(form)
      {
        fail  = validateForename(form.forename.value)
        fail += validateSurname(form.surname.value)
        fail += validateUsername(form.username.value)
        fail += validatePassword(form.password.value)
        fail += validateAge(form.age.value)
        fail += validateEmail(form.email.value)

        if (fail == "")     return true
        else { alert(fail); return false }
      }

      function validateForename(field)
      {
        return (field == "") ? "No Forename was entered.\\n" : ""
      }

      function validateSurname(field)
      {
        return (field == "") ? "No Surname was entered.\\n" : ""
      }

      function validateUsername(field)
      {
        if (field == "") return "No Username was entered.\\n"
        else if (field.length &lt; 5)
          return "Usernames must be at least 5 characters.\\n"
        else if (/[^a-zA-Z0-9_-]/.test(field))
          return "Only a-z, A-Z, 0-9, - and _ allowed in Usernames.\\n"
        return ""
      }

      function validatePassword(field)
      {
        if (field == "") return "No Password was entered.\\n"
        else if (field.length &lt; 6)
          return "Passwords must be at least 6 characters.\\n"
        else if (!/[a-z]/.test(field) || ! /[A-Z]/.test(field) ||
                 !/[0-9]/.test(field))
          return "Passwords require one each of a-z, A-Z and 0-9.\\n"
        return ""
      }

      function validateAge(field)
      {
        if (isNaN(field)) return "No Age was entered.\\n"
        else if (field &lt; 18 || field &gt; 110)
          return "Age must be between 18 and 110.\\n"
        return ""
      }

      function validateEmail(field)
      {
        if (field == "") return "No Email was entered.\\n"
          else if (!((field.indexOf(".") &gt; 0) &amp;&amp;
                     (field.indexOf("@") &gt; 0)) ||
                    /[^a-zA-Z0-9.@_-]/.test(field))
            return "The Email address is invalid.\\n"
        return ""
      }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;table border="0" cellpadding="2" cellspacing="5" bgcolor="#eeeeee"&gt;
      &lt;th colspan="2" align="center"&gt;Signup Form&lt;/th&gt;

        &lt;tr&gt;&lt;td colspan="2"&gt;Sorry, the following errors were found&lt;br&gt;
          in your form: &lt;p&gt;&lt;font color=red size=1&gt;&lt;i&gt;$fail&lt;/i&gt;&lt;/font&gt;&lt;/p&gt;
        &lt;/td&gt;&lt;/tr&gt;

      &lt;form method="post" action="adduser.php" onSubmit="return validate(this)"&gt;
        &lt;tr&gt;&lt;td&gt;Forename&lt;/td&gt;
          &lt;td&gt;&lt;input type="text" maxlength="32" name="forename" value="$forename"&gt;
        &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Surname&lt;/td&gt;
          &lt;td&gt;&lt;input type="text" maxlength="32" name="surname"  value="$surname"&gt;
        &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Username&lt;/td&gt;
          &lt;td&gt;&lt;input type="text" maxlength="16" name="username" value="$username"&gt;
        &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Password&lt;/td&gt;
          &lt;td&gt;&lt;input type="text" maxlength="12" name="password" value="$password"&gt;
        &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Age&lt;/td&gt;
          &lt;td&gt;&lt;input type="text" maxlength="3"  name="age"      value="$age"&gt;
        &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Email&lt;/td&gt;
          &lt;td&gt;&lt;input type="text" maxlength="64" name="email"    value="$email"&gt;
        &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td colspan="2" align="center"&gt;&lt;input type="submit"
          value="Signup"&gt;&lt;/td&gt;&lt;/tr&gt;
      &lt;/form&gt;
    &lt;/table&gt;
  &lt;/body&gt;
&lt;/html&gt;

_END;
</code><code class="calibre15">
  </code><strong class="calibre31"><code class="c2">// The PHP functions</code></strong><code class="c">
</code><code class="calibre15">
  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">validate_forename</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">?</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">No Forename was entered&lt;br&gt;</code><code class="s2">"</code><code class="o1">:</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">validate_surname</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">?</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">No Surname was entered&lt;br&gt;</code><code class="s2">"</code><code class="calibre17"> </code><code class="o1">:</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">validate_username</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">No Username was entered&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">else</code><code class="calibre17"> </code><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">strlen</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">&lt;</code><code class="calibre17"> </code><code class="mi1">5</code><code class="p1">)</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">Usernames must be at least 5 characters&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">else</code><code class="calibre17"> </code><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">preg_match</code><code class="p1">(</code><code class="s2">"</code><code class="s2">/[^a-zA-Z0-9_-]/</code><code class="s2">"</code><code class="p1">,</code><code class="calibre17"> </code><code class="nv1">$field</code><code class="p1">))</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">Only letters, numbers, - and _ in usernames&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">validate_password</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">No Password was entered&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">else</code><code class="calibre17"> </code><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">strlen</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">&lt;</code><code class="calibre17"> </code><code class="mi1">6</code><code class="p1">)</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">Passwords must be at least 6 characters&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">else</code><code class="calibre17"> </code><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="o1">!</code><code class="nb1">preg_match</code><code class="p1">(</code><code class="s2">"</code><code class="s2">/[a-z]/</code><code class="s2">"</code><code class="p1">,</code><code class="calibre17"> </code><code class="nv1">$field</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">||</code></strong><code class="calibre15">
             </code><strong class="calibre31"><code class="o1">!</code><code class="nb1">preg_match</code><code class="p1">(</code><code class="s2">"</code><code class="s2">/[A-Z]/</code><code class="s2">"</code><code class="p1">,</code><code class="calibre17"> </code><code class="nv1">$field</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">||</code></strong><code class="calibre15">
             </code><strong class="calibre31"><code class="o1">!</code><code class="nb1">preg_match</code><code class="p1">(</code><code class="s2">"</code><code class="s2">/[0-9]/</code><code class="s2">"</code><code class="p1">,</code><code class="calibre17"> </code><code class="nv1">$field</code><code class="p1">))</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">Passwords require 1 each of a-z, A-Z and 0-9&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">validate_age</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">No Age was entered&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">else</code><code class="calibre17"> </code><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">&lt;</code><code class="calibre17"> </code><code class="mi1">18</code><code class="calibre17"> </code><code class="o1">||</code><code class="calibre17"> </code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">&gt;</code><code class="calibre17"> </code><code class="mi1">110</code><code class="p1">)</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">Age must be between 18 and 110&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">validate_email</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$field</code><code class="calibre17"> </code><code class="o1">==</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">No Email was entered&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
      </code><strong class="calibre31"><code class="k1">else</code><code class="calibre17"> </code><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="o1">!</code><code class="p1">((</code><code class="nb1">strpos</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">,</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">.</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">&gt;</code><code class="calibre17"> </code><code class="mi1">0</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">&amp;&amp;</code></strong><code class="calibre15">
                 </code><strong class="calibre31"><code class="p1">(</code><code class="nb1">strpos</code><code class="p1">(</code><code class="nv1">$field</code><code class="p1">,</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">@</code><code class="s2">"</code><code class="p1">)</code><code class="calibre17"> </code><code class="o1">&gt;</code><code class="calibre17"> </code><code class="mi1">0</code><code class="p1">))</code><code class="calibre17"> </code><code class="o1">||</code></strong><code class="calibre15">
                  </code><strong class="calibre31"><code class="nb1">preg_match</code><code class="p1">(</code><code class="s2">"</code><code class="s2">/[^a-zA-Z0-9.@_-]/</code><code class="s2">"</code><code class="p1">,</code><code class="calibre17"> </code><code class="nv1">$field</code><code class="p1">))</code></strong><code class="calibre15">
        </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">The Email address is invalid&lt;br&gt;</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="s2">"</code><code class="s2">"</code><code class="p1">;</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">

  </code><strong class="calibre31"><code class="k1">function</code><code class="calibre17"> </code><code class="nf2">fix_string</code><code class="p1">(</code><code class="nv1">$string</code><code class="p1">)</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">{</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">if</code><code class="calibre17"> </code><code class="p1">(</code><code class="nb1">get_magic_quotes_gpc</code><code class="p1">())</code><code class="calibre17"> </code><code class="nv1">$string</code><code class="calibre17"> </code><code class="o1">=</code><code class="calibre17"> </code><code class="nb1">stripslashes</code><code class="p1">(</code><code class="nv1">$string</code><code class="p1">);</code></strong><code class="calibre15">
    </code><strong class="calibre31"><code class="k1">return</code><code class="calibre17"> </code><code class="nb1">htmlentities</code><code class="calibre17"> </code><code class="p1">(</code><code class="nv1">$string</code><code class="p1">);</code></strong><code class="calibre15">
  </code><strong class="calibre31"><code class="p1">}</code></strong><code class="calibre15">
</code><code class="cp">?&gt;</code></pre>
</div>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">In this example, all input is sanitized prior to use—even passwords, which, since they may contain characters used to format HTML, will be changed into HTML entities. For example, <code class="calibre15">&amp;</code> will become <code class="calibre15">&amp;amp;</code>, <code class="calibre15">&lt;</code> will become <code class="calibre15">&amp;lt;</code>, and so on. If you will be using a hash function to store encrypted passwords, this will not be an issue as long as when you later check the password entered it is sanitized in the same way so that the same inputs will be compared.</p>
</div>

<p class="author1">The result of submitting the form with JavaScript disabled (and two fields incorrectly completed) is shown in <a data-type="xref" href="ch17_split_002.xhtml#form_as_represented_after_php_valida" class="calibre6">Figure 17-5</a>.</p>

<figure class="calibre23"><div id="form_as_represented_after_php_valida" class="figure"><img alt="The form as represented after PHP validation fails" src="Images/pmj6_1705.png" class="calibre90"/>
<h6 class="calibre24"><span class="keep-together">Figure 17-5. </span>The form as represented after PHP validation fails</h6>
</div></figure>

<p class="author1">I have put the PHP section of this code (and changes to the HTML section) in a bold typeface so that you can more clearly see the difference between this and Examples <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">17-1</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch17_split_002.xhtml#form_with_javascript_validation-id00101" class="calibre6">17-2</a>.</p>

<p class="author1">If you browsed through this example, or typed it in or downloaded it from the <a href="https://github.com/RobinNixon/lpmj6" class="calibre6">book’s example repository</a>, you’ll have seen that the PHP code is almost a clone of the JavaScript code; the same regular expressions are used to validate each field in very similar functions.</p>

<p class="author1">But there are a couple of things to note. First, the <code class="calibre15">fix_string</code> function (right at the end) is used to sanitize each field and prevent any attempts at code injection from succeeding.</p>

<p class="author1">Also, you will see that the HTML from <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a> has been repeated in the PHP code within an <code class="calibre15">&lt;&lt;&lt;_END..._END;</code> structure, displaying the form with the values that the visitor entered the previous time. You do this by simply adding an extra <code class="calibre15">value</code> parameter to each <code class="calibre15">&lt;input&gt;</code> tag (such as <code class="calibre15">value="$forename"</code>). This courtesy is highly recommended so that the user only has to edit the previously entered values and doesn’t have to type the values in the fields all over again.</p>

<div data-type="note" epub:type="note" class="calibre19"><h6 class="calibre20">Note</h6>
<p class="author1">In the real world, you probably wouldn’t start with an HTML form such as the one in <a data-type="xref" href="ch17_split_001.xhtml#form_with_javascript_validation_left_p" class="calibre6">Example 17-1</a>. Instead, you’d be more likely to go straight ahead and write the PHP program in <a data-type="xref" href="ch17_split_002.xhtml#adduserdotphp_program" class="calibre6">Example 17-3</a>, which incorporates all the HTML. And, of course, you’d also need to make a minor tweak for the case when it’s the first time the program is called up, to prevent it from displaying errors when all the fields are empty. You also might drop the six JavaScript functions into their own <em class="hyperlink">.js</em> file for separate inclusion, as mentioned in <a data-type="xref" href="ch17_split_002.xhtml#using_a_separate_javascript_file" class="calibre6">“Using a separate JavaScript file”</a>.</p>
</div>

<p class="author1">Now that you’ve seen how to bring PHP, HTML, and JavaScript together, the next chapter will introduce <em class="hyperlink">Ajax</em> (Asynchronous JavaScript and XML), which uses JavaScript calls to the server in the background to seamlessly update portions of a web page, without having to resubmit the entire page to the web server.<a contenteditable="false" data-primary="" data-startref="Vredis17" data-type="indexterm" id="idm45694696056872" class="calibre6"/></p>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Questions" class="calibre4"><div class="preface" id="questions-id00102">
<h1 class="calibre11">Questions</h1>

<ol class="calibre25">
	<li class="calibre26">
	<p class="author1">What JavaScript method can you use to send a form for validation prior to submitting it?</p>
	</li>
	<li class="calibre26">
	<p class="author1">What JavaScript method is used to match a string against a regular expression?</p>
	</li>
	<li class="calibre26">
	<p class="author1">Write a regular expression to match any characters that are <em class="hyperlink">not</em> in a word, as defined by regular expression syntax.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Write a regular expression to match either of the words <em class="hyperlink">fox</em> or <em class="hyperlink">fix</em>.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Write a regular expression to match any single word followed by any nonword character.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Using regular expressions, write a JavaScript function to test whether the word <em class="hyperlink">fox</em> exists in the string <code class="calibre15">The quick brown fox</code>.</p>
	</li>
	<li class="calibre26">
	<p class="author1">Using regular expressions, write a PHP function to replace all occurrences of the word <em class="hyperlink">the</em> in <code class="calibre15">The cow jumps over the moon</code> with the word <em class="hyperlink">my</em>.</p>
	</li>
	<li class="calibre26">
	<p class="author1">What HTML attribute is used to precomplete form fields with a value?</p>
	</li>
</ol>

<p class="author1">See <a data-type="xref" href="app01_split_016.xhtml#chapter_17_answers" class="calibre6">“Chapter 17 Answers”</a> in the <a data-type="xref" href="app01_split_000.xhtml#solutions_to_the_chapter_questions" class="calibre6">Appendix A</a> for the answers to these <span class="keep-together">questions</span>.</p>
</div></section>
</div></section></div></body></html>