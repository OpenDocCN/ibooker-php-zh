<html><head></head><body><section data-pdf-bookmark="Chapter 8. Artisan and Tinker" data-type="chapter" epub:type="chapter"><div class="chapter" id="artisan_and_tinker">&#13;
<h1><span class="label">Chapter 8. </span>Artisan and Tinker</h1>&#13;
&#13;
&#13;
<p>From installation onward, modern PHP frameworks expect many interactions to take place on the command line. Laravel provides three primary tools for command-line interaction: Artisan, a suite of built-in command-line actions with the ability to add more; Tinker, an REPL or interactive shell for your application; and the installer, which we’ve already covered in <a data-type="xref" href="ch02.html#setting_up_development_environment">Chapter 2</a>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="An Introduction to Artisan" data-type="sect1"><div class="sect1" id="id172">&#13;
<h1>An Introduction to Artisan</h1>&#13;
&#13;
<p>If<a data-primary="Artisan" data-secondary="introduction to" data-type="indexterm" id="id1267"/> you’ve been reading through this book chapter by chapter, you’ve already learned how to use Artisan commands. They look something like this:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">php<code class="w"> </code>artisan<code class="w"> </code>make:controller<code class="w"> </code>PostController<code class="w"/></pre>&#13;
&#13;
<p>If you look in the root folder of your application, you’ll see that <em>artisan</em> is actually just a PHP file. That’s why you’re starting your call with <code>php artisan</code>; you’re passing that file into PHP to be parsed. Everything after that is just passed into Artisan as &#13;
<span class="keep-together">arguments</span>.</p>&#13;
<div data-type="note" epub:type="note"><h1>Symfony Console Syntax</h1>&#13;
<p>Artisan<a data-primary="Symfony Console" data-type="indexterm" id="id1268"/> is actually a layer on top of the <a href="https://oreil.ly/7Cb3Y">Symfony Console component</a>; so, if you’re familiar with writing Symfony Console commands, you should feel right at home.</p>&#13;
</div>&#13;
&#13;
<p>Since the list of Artisan commands for an application can be changed by a package or by the specific code of the application, it’s worth checking every new application you encounter to see what commands are available.</p>&#13;
&#13;
<p>To<a data-primary="Artisan" data-secondary="listing available commands" data-type="indexterm" id="id1269"/> get a list of all available Artisan commands, you can run <code>php artisan list</code> from the project root (although if you just run <code>php artisan</code> with no parameters, it will do the same thing).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Basic Artisan Commands" data-type="sect1"><div class="sect1" id="id173">&#13;
<h1>Basic Artisan Commands</h1>&#13;
&#13;
<p>There’s<a data-primary="Artisan" data-secondary="commands" data-tertiary="basic commands" data-type="indexterm" id="id1270"/> not enough space here to cover all of the Artisan commands, but we’ll cover many of them. Let’s get started with the basic commands:</p>&#13;
<dl>&#13;
<dt><code>clear-compiled</code></dt>&#13;
<dd>&#13;
<p>Removes Laravel’s compiled class file, which is like an internal Laravel cache; run this as a first resort when things are going wrong and you don’t know why.</p>&#13;
</dd>&#13;
<dt><code>down</code>, <code>up</code></dt>&#13;
<dd>&#13;
<p>Puts your application in “maintenance mode” so you can fix an error, run migrations, or whatever else, and restores an application from maintenance mode, respectively.</p>&#13;
</dd>&#13;
<dt><code>dump-server</code></dt>&#13;
<dd>&#13;
<p>Starts the dump server (see <a data-type="xref" href="#dump_server">“Laravel Dump Server”</a>) to collect and output dumped variables.</p>&#13;
</dd>&#13;
<dt><code>env</code></dt>&#13;
<dd>&#13;
<p>Displays which environment Laravel is running in at the moment; it’s the equivalent of echoing <code>app()-&gt;environment()</code> in-app.</p>&#13;
</dd>&#13;
<dt><code>help</code></dt>&#13;
<dd>&#13;
<p>Provides help for a command; for example, <code>php artisan help <em>commandName</em></code>.</p>&#13;
</dd>&#13;
<dt><code>migrate</code></dt>&#13;
<dd>&#13;
<p>Runs all database migrations.</p>&#13;
</dd>&#13;
<dt><code>optimize</code></dt>&#13;
<dd>&#13;
<p>Clears and refreshes the configuration and route files.</p>&#13;
</dd>&#13;
<dt><code>serve</code></dt>&#13;
<dd>&#13;
<p>Pins up a PHP server at <code>localhost:8000</code>. (You<a data-primary="--host flag" data-type="indexterm" id="id1271"/><a data-primary="--port flag" data-type="indexterm" id="id1272"/> can customize the host and/or port with <code>--host</code> and <code>--port</code>.)</p>&#13;
</dd>&#13;
<dt><code>tinker</code></dt>&#13;
<dd>&#13;
<p>Brings up the Tinker REPL, which we’ll cover later in this chapter.</p>&#13;
</dd>&#13;
<dt><code>stub:publish</code></dt>&#13;
<dd>&#13;
<p>Publishes all stubs that are available for customization.</p>&#13;
</dd>&#13;
<dt><code>docs</code></dt>&#13;
<dd>&#13;
<p>Gives you quick access to Laravel docs; pass a parameter and you’ll be prompted to open the URL for those docs, or don’t pass a parameter and you’ll be able to navigate a list of documentation topics to choose from.</p>&#13;
</dd>&#13;
<dt><code>about</code></dt>&#13;
<dd>&#13;
<p>Shows an overview of your project environment, general configurations, packages, and more.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h1>Changes to the Artisan Commands List Over Time</h1>&#13;
<p>The list of Artisan commands and their names have changed in small ways over the lifetime of Laravel. This list is as up to date as possible at the time of publishing this book. However, the best way to see what’s available to you is to run <code>php artisan</code> from your application.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Options" data-type="sect2"><div class="sect2" id="id174">&#13;
<h2>Options</h2>&#13;
&#13;
<p>Before<a data-primary="Artisan" data-secondary="commands" data-tertiary="command options" data-type="indexterm" id="id1273"/> we cover the rest of the commands, let’s look at a few notable options you can pass any time you run an Artisan command:</p>&#13;
<dl>&#13;
<dt><code>-q</code></dt>&#13;
<dd>&#13;
<p>Suppresses all output</p>&#13;
</dd>&#13;
<dt><code>-v</code>, <code>-vv</code>, and <code>-vvv</code></dt>&#13;
<dd>&#13;
<p>Specifies the level of output verbosity (normal, verbose, and debug)</p>&#13;
</dd>&#13;
<dt><code>--no-interaction</code></dt>&#13;
<dd>&#13;
<p>Suppresses<a data-primary="--no-interatction flag" data-type="indexterm" id="id1274"/> interactive questions, so the command won’t interrupt automated processes running it</p>&#13;
</dd>&#13;
<dt><code>--env</code></dt>&#13;
<dd>&#13;
<p>Allows<a data-primary="--env flag" data-type="indexterm" id="id1275"/> you to define which environment the Artisan command should operate in (<code>local</code>, <code>production</code>, etc.)</p>&#13;
</dd>&#13;
<dt><code>--version</code></dt>&#13;
<dd>&#13;
<p>Shows<a data-primary="--version flag" data-type="indexterm" id="id1276"/> which version of Laravel your application is running on</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>You’ve probably guessed from looking at these options that Artisan commands are intended to be used much like basic shell commands: you might run them manually, but they can also function as a part of some automated process at some point.</p>&#13;
&#13;
<p>For example, there are many automated deployment processes that might benefit from certain Artisan commands. You might want to run <code>php artisan config:cache</code> every time you deploy an application. Flags like <code>-q</code> and <code>--no-interaction</code> ensure that your deployment scripts, not attended by a human being, can keep running smoothly.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Grouped Commands" data-type="sect2"><div class="sect2" id="id175">&#13;
<h2>The Grouped Commands</h2>&#13;
&#13;
<p>The rest of the commands available out of the box are<a data-primary="Artisan" data-secondary="commands" data-tertiary="grouped by context" data-type="indexterm" id="id1277"/> grouped by context. We won’t cover them all here, but we’ll cover each context broadly:</p>&#13;
<dl>&#13;
<dt><code>auth</code></dt>&#13;
<dd>&#13;
<p>All we have here is <code>auth:clear-resets</code>, which flushes all of the expired password reset tokens from the database.</p>&#13;
</dd>&#13;
<dt><code>cache</code></dt>&#13;
<dd>&#13;
<p><code>cache:clear</code> clears the cache, <code>cache:forget</code> removes an individual item from the cache, and <code>cache:table</code> creates a database migration if you plan to use the <code>database</code> cache driver.</p>&#13;
</dd>&#13;
<dt><code>config</code></dt>&#13;
<dd>&#13;
<p><code>config:cache</code> caches your configuration settings for faster lookup; to clear the cache, use <code>config:clear</code>.</p>&#13;
</dd>&#13;
<dt><code>db</code></dt>&#13;
<dd>&#13;
<p><code>db:seed</code> seeds your database, if you have configured database seeders.</p>&#13;
</dd>&#13;
<dt><code>event</code></dt>&#13;
<dd>&#13;
<p><code>event:list</code> lists all the events and listeners in your application, <code>event:cache</code> caches that list, <code>event:clear</code> clears that cache, and <code>event:generate</code> builds missing event and event listener files based on the definitions in <code>EventServiceProvider</code>. You’ll learn more about events in <a data-type="xref" href="ch16.html#queues_jobs_events">Chapter 16</a>.</p>&#13;
</dd>&#13;
<dt><code>key</code></dt>&#13;
<dd>&#13;
<p><code>key:generate</code> creates a random application encryption key in your <em>.env</em> file.</p>&#13;
<div data-type="warning" epub:type="warning" id="rerunning-artisan-keygenerate-means-losing-some-encrypted-data-yECLSOfvS9"><h1>Rerunning artisan key:generate Means Losing Some <span class="keep-together">Encrypted Data</span></h1>&#13;
<p>If you run <code>php artisan key:generate</code> more than once on your application, every currently logged-in user will be logged out. Additionally, any data you have manually encrypted will no longer be decryptable. To learn more, check out the article <a href="https://oreil.ly/T_l1h">“APP_KEY and You”</a> by fellow Tightenite Jake Bathman.</p>&#13;
</div>&#13;
</dd>&#13;
<dt><code>make</code></dt>&#13;
<dd>&#13;
<p>Each of the <code>make:</code> actions creates a single item from a stub and has parameters that vary accordingly. To learn more about any individual command’s parameters, use <code>help</code> to read its documentation.</p>&#13;
&#13;
<p>For<a contenteditable="false" data-primary="--create flag" data-type="indexterm" id="ix_glbl"/> example, you could run <code>php artisan help make:migration</code> and learn that you can pass <code>--create=<em>tableNameHere</em></code> to create a migration that already has <span class="keep-together">the create</span> table syntax in the file, as shown here: <code>php artisan make:migration create_posts_table --create=posts</code>.</p>&#13;
</dd>&#13;
<dt><code>migrate</code></dt>&#13;
<dd>&#13;
<p>The <code>migrate</code> command used to run all migrations was mentioned earlier; see <a data-type="xref" href="ch05.html#running_migrations">“Running Migrations”</a> for details on all the migration-related <span class="keep-together">commands</span>.</p>&#13;
</dd>&#13;
<dt><code>notifications</code></dt>&#13;
<dd>&#13;
<p><code>notifications:table</code> generates a migration that creates the table for database notifications.</p>&#13;
</dd>&#13;
</dl>&#13;
<dl>&#13;
<dt><code>package</code></dt>&#13;
<dd><p>Laravel has a manifest generated by its “autodiscover” feature. This registers third-party packages for you when you first install them. <code>package:discover</code> rebuilds Laravel’s “discovered” manifest of the service providers from your external packages. </p></dd>&#13;
</dl>&#13;
<dl>&#13;
<dt><code>queue</code></dt>&#13;
<dd>&#13;
<p>We’ll cover Laravel’s queues in <a data-type="xref" href="ch16.html#queues_jobs_events">Chapter 16</a>, but the basic idea is that you can push jobs up into remote queues to be executed one after another by a worker. This command group provides all the tools you need to interact with your queues, like <code>queue:listen</code> to start listening to a queue, <code>queue:table</code> to create a migration for database-backed queues, and <code>queue:flush</code> to flush all failed queue jobs. There are quite a few more, which you’ll learn about in <a data-type="xref" href="ch16.html#queues_jobs_events">Chapter 16</a>.</p>&#13;
</dd>&#13;
<dt><code>route</code></dt>&#13;
<dd>&#13;
<p>If you run <code>route:list</code>, you’ll see the definitions of every route defined in the application, including each route’s verb(s), path, name, controller/closure action, and middleware. You can cache the route definitions for faster lookups with <code>route:cache</code> and clear your cache with <code>route:clear</code>.</p>&#13;
</dd>&#13;
<dt><code>schedule</code></dt>&#13;
<dd>&#13;
<p>We’ll cover Laravel’s cron-like scheduler in <a data-type="xref" href="ch16.html#queues_jobs_events">Chapter 16</a>, but in order for it to work, you need to set the system cron to run <code>schedule:run</code> once a minute:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">*<code class="w"> </code>*<code class="w"> </code>*<code class="w"> </code>*<code class="w"> </code>*<code class="w"> </code>php<code class="w"> </code>/home/myapp.com/artisan<code class="w"> </code>schedule:run<code class="w"> </code>&gt;&gt;<code class="w"> </code>/dev/null<code class="w"> </code><code class="m">2</code>&gt;<code class="p">&amp;</code><code class="m">1</code><code class="w"/></pre>&#13;
&#13;
<p>As you can see, this Artisan command is intended to be run regularly in order to power a core Laravel service.</p>&#13;
</dd>&#13;
<dt><code>session</code></dt>&#13;
<dd>&#13;
<p><code>session:table</code> creates a migration for applications using database-backed <span class="keep-together">sessions</span>.</p>&#13;
</dd>&#13;
<dt><code>storage</code></dt>&#13;
<dd>&#13;
<p><code>storage:link</code> creates a symbolic link from <em>public/storage</em> to <em>storage/app/public</em>. This is a common convention in Laravel apps, to make it easy to put user uploads (or other files that commonly end up in <em>storage/app</em>) somewhere where they’ll be accessible at a public URL.</p>&#13;
</dd>&#13;
<dt><code>vendor</code></dt>&#13;
<dd>&#13;
<p>Some Laravel-specific packages need to “publish” some of their assets, either so that they can be served from your <em>public</em> directory or so that you can modify them. Either way, these packages register these “publishable assets” with Laravel, and when you run <code>vendor:publish</code>, it publishes them to their specified locations.</p>&#13;
</dd>&#13;
<dt><code>view</code></dt>&#13;
<dd>&#13;
<p>Laravel’s view rendering engine automatically caches your views. It usually does a good job of handling its own cache invalidation, but if you ever notice it’s gotten stuck, run <code>view:clear</code> to clear the cache.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Writing Custom Artisan Commands" data-type="sect1"><div class="sect1" id="id176">&#13;
<h1>Writing Custom Artisan Commands</h1>&#13;
&#13;
<p>Now<a data-primary="Artisan" data-secondary="custom commands" data-type="indexterm" id="ARcustom08"/> that we’ve covered the Artisan commands that come with Laravel out of the box, let’s talk about writing your own.</p>&#13;
&#13;
<p>First, you<a data-primary="Artisan" data-secondary="custom commands" data-tertiary="generating new commands" data-type="indexterm" id="id1278"/> should know: there’s an Artisan command for that! Running <code>php artisan make:command <em>YourCommandName</em></code> generates a new Artisan command in <em>app/Console/Commands/{YourCommandName}.php</em>.</p>&#13;
&#13;
<p>Your first argument should be the class name of the command, and you can optionally pass<a data-primary="--command flag" data-type="indexterm" id="id1279"/> a <code>--command</code> parameter to define what the terminal command will be (e.g., <code>appname:action</code>). So, let’s do it:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">php<code class="w"> </code>artisan<code class="w"> </code>make:command<code class="w"> </code>WelcomeNewUsers<code class="w"> </code>--command<code class="o">=</code>email:newusers<code class="w"/></pre>&#13;
&#13;
<p>Take a look at <a data-type="xref" href="#EX701">Example 8-1</a> to see what you’ll get.</p>&#13;
<div data-type="example" id="EX701">&#13;
<h5><span class="label">Example 8-1. </span>The default skeleton of an Artisan command</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="o">&lt;?</code><code class="nx">php</code>&#13;
&#13;
<code class="k">namespace</code> <code class="nx">App\Console\Commands</code><code class="p">;</code>&#13;
&#13;
<code class="k">use</code> <code class="nx">Illuminate\Console\Command</code><code class="p">;</code>&#13;
&#13;
<code class="k">class</code> <code class="nc">WelcomeNewUsers</code> <code class="k">extends</code> <code class="nx">Command</code>&#13;
<code class="p">{</code>&#13;
    <code class="sd">/**</code>&#13;
<code class="sd">     * The name and signature of the console command</code>&#13;
<code class="sd">     *</code>&#13;
<code class="sd">     * @var string</code>&#13;
<code class="sd">     */</code>&#13;
    <code class="k">protected</code> <code class="nv">$signature</code> <code class="o">=</code> <code class="s1">'email:newusers'</code><code class="p">;</code>&#13;
&#13;
    <code class="sd">/**</code>&#13;
<code class="sd">     * The console command description</code>&#13;
<code class="sd">     *</code>&#13;
<code class="sd">     * @var string</code>&#13;
<code class="sd">     */</code>&#13;
    <code class="k">protected</code> <code class="nv">$description</code> <code class="o">=</code> <code class="s1">'Command description'</code><code class="p">;</code>&#13;
&#13;
    <code class="sd">/**</code>&#13;
<code class="sd">     * Execute the console command.</code>&#13;
<code class="sd">     */</code>&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>&#13;
    <code class="p">{</code>&#13;
        <code class="c1">//</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>As you can see, it’s very easy to define the command signature, the help text it shows in command lists, and the command’s behavior on execution (<code>handle()</code>).</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Sample Command" data-type="sect2"><div class="sect2" id="id572">&#13;
<h2>A Sample Command</h2>&#13;
&#13;
<p>We<a data-primary="Artisan" data-secondary="custom commands" data-tertiary="sample command" data-type="indexterm" id="id1280"/> haven’t covered mail or Eloquent yet in this chapter (see <a data-type="xref" href="ch15.html#mail_and_notifications">Chapter 15</a> for mail and <a data-type="xref" href="ch05.html#database_and_eloquent">Chapter 5</a> <span class="keep-together">for Eloquent),</span> but the sample <code>handle()</code> method in <a data-type="xref" href="#EX703">Example 8-2</a> should read pretty clearly.</p>&#13;
<div data-type="example" id="EX703">&#13;
<h5><span class="label">Example 8-2. </span>A sample Artisan command <code>handle()</code> method</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// ...</code>&#13;
&#13;
<code class="k">class</code> <code class="nc">WelcomeNewUsers</code> <code class="k">extends</code> <code class="nx">Command</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>&#13;
    <code class="p">{</code>&#13;
        <code class="nx">User</code><code class="o">::</code><code class="na">signedUpThisWeek</code><code class="p">()</code><code class="o">-&gt;</code><code class="na">each</code><code class="p">(</code><code class="k">function</code> <code class="p">(</code><code class="nv">$user</code><code class="p">)</code> <code class="p">{</code>&#13;
            <code class="nx">Mail</code><code class="o">::</code><code class="na">to</code><code class="p">(</code><code class="nv">$user</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">send</code><code class="p">(</code><code class="k">new</code> <code class="nx">WelcomeEmail</code><code class="p">);</code>&#13;
        <code class="p">});</code>&#13;
    <code class="p">}</code></pre></div>&#13;
&#13;
<p>Now every time you run <code>php artisan email:newusers</code>, this command will grab every user that signed up this week and send them the welcome email.</p>&#13;
&#13;
<p>If you would prefer injecting your mail and user dependencies instead of using facades, you can typehint them in the command constructor, and Laravel’s container will inject them for you when the command is instantiated.</p>&#13;
&#13;
<p>Take a look at <a data-type="xref" href="#EX704">Example 8-3</a> to see what <a data-type="xref" href="#EX703">Example 8-2</a> might look like using dependency injection and extracting its behavior out to a service class.</p>&#13;
<div data-type="example" id="EX704">&#13;
<h5><span class="label">Example 8-3. </span>The same command, refactored</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="o">...</code>&#13;
<code class="k">class</code> <code class="nc">WelcomeNewUsers</code> <code class="k">extends</code> <code class="nx">Command</code>&#13;
<code class="p">{</code>&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="fm">__construct</code><code class="p">(</code><code class="nx">UserMailer</code> <code class="nv">$userMailer</code><code class="p">)</code>&#13;
    <code class="p">{</code>&#13;
        <code class="k">parent</code><code class="o">::</code><code class="na">__construct</code><code class="p">();</code>&#13;
&#13;
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">userMailer</code> <code class="o">=</code> <code class="nv">$userMailer</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>&#13;
    <code class="p">{</code>&#13;
        <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">userMailer</code><code class="o">-&gt;</code><code class="na">welcomeNewUsers</code><code class="p">();</code>&#13;
    <code class="p">}</code></pre></div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1281">&#13;
<h1>Keep It Simple</h1>&#13;
<p>It is possible to call Artisan commands from the rest of your code so you can use them to encapsulate chunks of application logic.</p>&#13;
&#13;
<p>However, the Laravel docs recommend instead packaging the application logic into a service class and injecting that service into your command. Console commands are seen as being similar to controllers: they’re not domain classes; they’re traffic cops that just route incoming requests to the correct behavior.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Arguments and Options" data-type="sect2"><div class="sect2" id="id177">&#13;
<h2>Arguments and Options</h2>&#13;
&#13;
<p>The<a data-primary="Artisan" data-secondary="custom commands" data-tertiary="arguments and options" data-type="indexterm" id="id1282"/> <code>$signature</code> property of the new command looks like it might just contain the command name. But this property is also where you’ll define any arguments and options for the command. There’s a specific, simple syntax you can use to add arguments and options to your Artisan commands.</p>&#13;
&#13;
<p>Before we dig into that syntax, take<a data-primary="--sendEmail flag" data-type="indexterm" id="sendemail08"/> a look at an example for some context:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">protected</code> <code class="nv">$signature</code> <code class="o">=</code> <code class="s1">'password:reset {userId} {--sendEmail}'</code><code class="p">;</code></pre>&#13;
<section data-pdf-bookmark="Arguments—required, optional, and/or with defaults" data-type="sect3"><div class="sect3" id="argumentsrequired-optional-andor-with-defaults-bWsKTOsPT2">&#13;
<h3>Arguments—required, optional, and/or with defaults</h3>&#13;
&#13;
<p>To define a required argument, surround it with braces:</p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userId}</pre>&#13;
&#13;
<p>To make the argument optional, add a question mark:</p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userId?}</pre>&#13;
&#13;
<p>To make it optional and provide a default, use:</p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userId=1}</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Options—required values, value defaults, and shortcuts" data-type="sect3"><div class="sect3" id="id178">&#13;
<h3>Options—required values, value defaults, and shortcuts</h3>&#13;
&#13;
<p>Options are similar to arguments, but they’re prefixed with <code>--</code> and can be used with no value. To add a basic option, surround it with braces:</p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userId} {--sendEmail}</pre>&#13;
&#13;
<p>If<a data-primary="--password flag" data-type="indexterm" id="id1283"/> your option requires a value, add an <code>=</code> to its signature:</p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userId} {--password=}</pre>&#13;
&#13;
<p>And if you want to pass a default value, add it<a data-primary="--queue flag" data-type="indexterm" id="id1284"/> after the <code>=</code>:</p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userId} {--queue=default}</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Array arguments and array options" data-type="sect3"><div class="sect3" id="id179">&#13;
<h3>Array arguments and array options</h3>&#13;
&#13;
<p>Both<a data-primary="--ids flag" data-type="indexterm" id="id1285"/> for arguments and for options, if you want to accept an array as input, use the <span class="keep-together"><code>*</code> character:</span></p>&#13;
&#13;
<pre data-type="programlisting">password:reset {userIds*}&#13;
&#13;
password:reset {--ids=*}</pre>&#13;
&#13;
<p>Using array arguments and parameters looks a bit like <a data-type="xref" href="#EX705">Example 8-4</a>.</p>&#13;
<div data-type="example" id="EX705">&#13;
<h5><span class="label">Example 8-4. </span>Using array syntax with Artisan commands</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// Argument</code>&#13;
<code class="nx">php</code> <code class="nx">artisan</code> <code class="nx">password</code><code class="o">:</code><code class="nb">reset</code> <code class="mi">1</code> <code class="mi">2</code> <code class="mi">3</code>&#13;
&#13;
<code class="c1">// Option</code>&#13;
<code class="nx">php</code> <code class="nx">artisan</code> <code class="nx">password</code><code class="o">:</code><code class="nb">reset</code> <code class="o">--</code><code class="nx">ids</code><code class="o">=</code><code class="mi">1</code> <code class="o">--</code><code class="nx">ids</code><code class="o">=</code><code class="mi">2</code> <code class="o">--</code><code class="nx">ids</code><code class="o">=</code><code class="mi">3</code></pre></div>&#13;
<div data-type="tip"><h1>Array Arguments Must Be the Last Argument</h1>&#13;
<p>Since an array argument captures every parameter after its definition and adds them as array items, an array argument has to be the last argument within an Artisan command’s signature.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Input descriptions" data-type="sect3"><div class="sect3" id="id678">&#13;
<h3>Input descriptions</h3>&#13;
&#13;
<p>Remember how the built-in Artisan commands can give us more information about their parameters if we use <code>artisan help</code>? We can provide that same information about our custom commands. Just add a colon and the description text within the curly braces, like in <a data-type="xref" href="#EX706X">Example 8-5</a>.</p>&#13;
<div data-type="example" id="EX706X">&#13;
<h5><span class="label">Example 8-5. </span>Defining description text for Artisan arguments and options</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">protected</code> <code class="nv">$signature</code> <code class="o">=</code> <code class="s1">'password:reset</code>&#13;
<code class="s1">                        {userId : The ID of the user}</code>&#13;
<code class="s1">                        {--sendEmail : Whether to send user an email}'</code><code class="p">;</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Input" data-type="sect2"><div class="sect2" id="id180">&#13;
<h2>Using Input</h2>&#13;
&#13;
<p>Now<a data-primary="" data-startref="sendemail08" data-type="indexterm" id="id1286"/><a data-primary="Artisan" data-secondary="custom commands" data-tertiary="using input" data-type="indexterm" id="id1287"/> that we’ve prompted for this input, how do we use it in our command’s <code class="keep-together">handle()</code> method? We have two sets of methods for retrieving the values of arguments and options.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="argument() and arguments()" data-type="sect3"><div class="sect3" id="id679">&#13;
<h3>argument() and arguments()</h3>&#13;
&#13;
<p><code>$this-&gt;arguments()</code> returns an array of all arguments (the first array item will be the command name). <code>$this-&gt;argument()</code>, called with no parameters, returns the same response; the plural method, which I prefer, is just available for better &#13;
<span class="keep-together">readability</span>.</p>&#13;
&#13;
<p>To get just the value of a single argument, pass the argument name as a parameter to <code>$this-&gt;argument()</code>, as shown in <a data-type="xref" href="#EX8a">Example 8-6</a>.</p>&#13;
<div data-type="example" id="EX8a">&#13;
<h5><span class="label">Example 8-6. </span>Using <code>$this-&gt;arguments()</code> in an Artisan command</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// With definition "password:reset {userId}"</code>&#13;
<code class="nx">php</code> <code class="nx">artisan</code> <code class="nx">password</code><code class="o">:</code><code class="nb">reset</code> <code class="mi">5</code>&#13;
&#13;
<code class="c1">// $this-&gt;arguments() returns this array</code>&#13;
<code class="p">[</code>&#13;
    <code class="s2">"command"</code><code class="o">:</code> <code class="s2">"password:reset"</code><code class="p">,</code>&#13;
    <code class="s2">"userId"</code><code class="o">:</code> <code class="s2">"5"</code><code class="p">,</code>&#13;
<code class="p">]</code>&#13;
&#13;
<code class="c1">// $this-&gt;argument('userId') returns this string</code>&#13;
<code class="s2">"5"</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="option() and options()" data-type="sect3"><div class="sect3" id="id181">&#13;
<h3>option() and options()</h3>&#13;
&#13;
<p><code>$this-&gt;options()</code>  returns an array of all options, including some that will by default be <code>false</code> or <code>null</code>. <code>$this-&gt;option()</code>, called with no parameters, returns the same response; again, the plural method, which I prefer, is just available for better &#13;
<span class="keep-together">readability</span>.</p>&#13;
&#13;
<p>To<a data-primary="--userID flag" data-type="indexterm" id="id1288"/> get just the value of a single option, pass the argument name as a parameter to <code>$this-&gt;option()</code>, as shown in <a data-type="xref" href="#EX8b">Example 8-7</a>.</p>&#13;
<div data-type="example" id="EX8b">&#13;
<h5><span class="label">Example 8-7. </span>Using <code>$this-&gt;options()</code> in an Artisan command</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// With definition "password:reset {--userId=}"</code>&#13;
<code class="nx">php</code> <code class="nx">artisan</code> <code class="nx">password</code><code class="o">:</code><code class="nb">reset</code> <code class="o">--</code><code class="nx">userId</code><code class="o">=</code><code class="mi">5</code>&#13;
&#13;
<code class="c1">// $this-&gt;options() returns this array</code>&#13;
<code class="p">[</code>&#13;
    <code class="s2">"userId"</code> <code class="o">=&gt;</code> <code class="s2">"5"</code><code class="p">,</code>&#13;
    <code class="s2">"help"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"quiet"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"verbose"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"version"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"ansi"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"no-ansi"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"no-interaction"</code> <code class="o">=&gt;</code> <code class="k">false</code><code class="p">,</code>&#13;
    <code class="s2">"env"</code> <code class="o">=&gt;</code> <code class="k">null</code><code class="p">,</code>&#13;
<code class="p">]</code>&#13;
&#13;
<code class="c1">// $this-&gt;option('userId') returns this string</code>&#13;
<code class="s2">"5"</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#EX707">Example 8-8</a> shows an Artisan command using <code>argument()</code> and <code>option()</code> in its <code class="keep-together">handle()</code> method.</p>&#13;
<div data-type="example" id="EX707">&#13;
<h5><span class="label">Example 8-8. </span>Getting input from an Artisan command</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>&#13;
<code class="p">{</code>&#13;
    <code class="c1">// All arguments, including the command name</code>&#13;
    <code class="nv">$arguments</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">arguments</code><code class="p">();</code>&#13;
&#13;
    <code class="c1">// Just the 'userId' argument</code>&#13;
    <code class="nv">$userid</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">argument</code><code class="p">(</code><code class="s1">'userId'</code><code class="p">);</code>&#13;
&#13;
    <code class="c1">// All options, including some defaults like 'no-interaction' and 'env'</code>&#13;
    <code class="nv">$options</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">options</code><code class="p">();</code>&#13;
&#13;
    <code class="c1">// Just the 'sendEmail' option</code>&#13;
    <code class="nv">$sendEmail</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">option</code><code class="p">(</code><code class="s1">'sendEmail'</code><code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Prompts" data-type="sect2"><div class="sect2" id="id573">&#13;
<h2>Prompts</h2>&#13;
&#13;
<p>There<a data-primary="Artisan" data-secondary="custom commands" data-tertiary="prompts" data-type="indexterm" id="id1289"/> are a few more ways to get user input from within your <code>handle()</code> code, <span class="keep-together">and they</span> all involve prompting the user to enter information during the execution of your command:</p>&#13;
<dl>&#13;
<dt><code>ask()</code></dt>&#13;
<dd>&#13;
<p>Prompts the user to enter freeform text:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$email</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">ask</code><code class="p">(</code><code class="s1">'What is your email address?'</code><code class="p">);</code></pre>&#13;
</dd>&#13;
<dt><code>secret()</code></dt>&#13;
<dd>&#13;
<p>Prompts the user to enter freeform text, but hides the typing with asterisks:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$password</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">secret</code><code class="p">(</code><code class="s1">'What is the DB password?'</code><code class="p">);</code></pre>&#13;
</dd>&#13;
<dt><code>confirm()</code></dt>&#13;
<dd>&#13;
<p>Prompts the user for a yes/no answer, and returns a Boolean:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">if</code> <code class="p">(</code><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">confirm</code><code class="p">(</code><code class="s1">'Do you want to truncate the tables?'</code><code class="p">))</code> <code class="p">{</code>&#13;
    <code class="c1">//</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>All answers except <code>y</code> or <code>Y</code> will be treated as a “no.”</p>&#13;
</dd>&#13;
<dt><code>anticipate()</code></dt>&#13;
<dd>&#13;
<p>Prompts the user to enter freeform text, and provides autocomplete suggestions. Still allows the user to type whatever they want:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$album</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">anticipate</code><code class="p">(</code><code class="s1">'What is the best album ever?'</code><code class="p">,</code> <code class="p">[</code>&#13;
    <code class="s2">"The Joshua Tree"</code><code class="p">,</code> <code class="s2">"Pet Sounds"</code><code class="p">,</code> <code class="s2">"What's Going On"</code>&#13;
<code class="p">]);</code></pre>&#13;
</dd>&#13;
<dt><code>choice()</code></dt>&#13;
<dd>&#13;
<p>Prompts the user to choose one of the provided options. The last parameter is the default if the user doesn’t choose:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$winner</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">choice</code><code class="p">(</code>&#13;
    <code class="s1">'Who is the best football team?'</code><code class="p">,</code>&#13;
    <code class="p">[</code><code class="s1">'Gators'</code><code class="p">,</code> <code class="s1">'Wolverines'</code><code class="p">],</code>&#13;
    <code class="mi">0</code>&#13;
<code class="p">);</code></pre>&#13;
&#13;
<p>Note that the final parameter, the default, should be the array key. Since we passed a nonassociative array, the key for <code>Gators</code> is <code>0</code>. You could also key your array, if you’d prefer:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$winner</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">choice</code><code class="p">(</code>&#13;
    <code class="s1">'Who is the best football team?'</code><code class="p">,</code>&#13;
    <code class="p">[</code><code class="s1">'gators'</code> <code class="o">=&gt;</code> <code class="s1">'Gators'</code><code class="p">,</code> <code class="s1">'wolverines'</code> <code class="o">=&gt;</code> <code class="s1">'Wolverines'</code><code class="p">],</code>&#13;
    <code class="s1">'gators'</code>&#13;
<code class="p">);</code></pre>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Output" data-type="sect2"><div class="sect2" id="id574">&#13;
<h2>Output</h2>&#13;
&#13;
<p>During<a data-primary="Artisan" data-secondary="custom commands" data-tertiary="output" data-type="indexterm" id="id1290"/> the execution of your command, you might want to write messages to <span class="keep-together">the user.</span> The most basic way to do this is to use <code>$this-&gt;info()</code> to output basic green text:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$this</code><code class="o">-&gt;</code><code class="na">info</code><code class="p">(</code><code class="s1">'Your command has run successfully.'</code><code class="p">);</code></pre>&#13;
&#13;
<p>You also have available the <code>comment()</code> (orange), <code>question()</code> (highlighted teal), <code>error()</code> (highlighted red), <code>line()</code> (uncolored), and <code>newLine()</code> (uncolored) methods to echo to the command line.</p>&#13;
&#13;
<p>Please note that the exact colors may vary from machine to machine, but they try to be in line with the local machine’s standards for communicating to the end user.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Table output" data-type="sect3"><div class="sect3" id="id680">&#13;
<h3>Table output</h3>&#13;
&#13;
<p>The <code>table()</code> method makes it simple to create ASCII tables full of your data. Take a look at <a data-type="xref" href="#EX708">Example 8-9</a>.</p>&#13;
<div data-type="example" id="EX708">&#13;
<h5><span class="label">Example 8-9. </span>Outputting tables with Artisan commands</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$headers</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'Name'</code><code class="p">,</code> <code class="s1">'Email'</code><code class="p">];</code>&#13;
&#13;
<code class="nv">$data</code> <code class="o">=</code> <code class="p">[</code>&#13;
    <code class="p">[</code><code class="s1">'Dhriti'</code><code class="p">,</code> <code class="s1">'dhriti@amrit.com'</code><code class="p">],</code>&#13;
    <code class="p">[</code><code class="s1">'Moses'</code><code class="p">,</code> <code class="s1">'moses@gutierez.com'</code><code class="p">],</code>&#13;
<code class="p">];</code>&#13;
&#13;
<code class="c1">// Or, you could get similar data from the database:</code>&#13;
<code class="nv">$data</code> <code class="o">=</code> <code class="nx">App\User</code><code class="o">::</code><code class="na">all</code><code class="p">([</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'email'</code><code class="p">])</code><code class="o">-&gt;</code><code class="na">toArray</code><code class="p">();</code>&#13;
&#13;
<code class="nv">$this</code><code class="o">-&gt;</code><code class="na">table</code><code class="p">(</code><code class="nv">$headers</code><code class="p">,</code> <code class="nv">$data</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Note that <a data-type="xref" href="#EX708">Example 8-9</a> has two sets of data: the headers, and the data itself. Both contain two “cells” per “row”; the first cell in each row is the name, and the second is the email. That way the data from the Eloquent call (which is constrained to pull only name and email) matches up with the headers.</p>&#13;
&#13;
<p>Take a look at <a data-type="xref" href="#EX709">Example 8-10</a> to see what the table output looks like.</p>&#13;
<div class="pagebreak-before" data-type="example" id="EX709">&#13;
<h5 class="less_space"><span class="label">Example 8-10. </span>Sample output of an Artisan table</h5>&#13;
&#13;
<pre data-type="programlisting">+---------+--------------------+&#13;
| Name    | Email              |&#13;
+---------+--------------------+&#13;
| Dhriti  | dhriti@amrit.com   |&#13;
| Moses   | moses@gutierez.com |&#13;
+---------+--------------------+</pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Progress bars" data-type="sect3"><div class="sect3" id="id681">&#13;
<h3>Progress bars</h3>&#13;
&#13;
<p>If you’ve ever run <code>npm install</code>, you’ve seen a command-line progress bar before. Let’s build one in <a data-type="xref" href="#EX710">Example 8-11</a>.</p>&#13;
<div data-type="example" id="EX710">&#13;
<h5><span class="label">Example 8-11. </span>Sample Artisan progress bar</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nv">$totalUnits</code> <code class="o">=</code> <code class="mi">350</code><code class="p">;</code>&#13;
<code class="nv">$this</code><code class="o">-&gt;</code><code class="na">output</code><code class="o">-&gt;</code><code class="na">progressStart</code><code class="p">(</code><code class="nv">$totalUnits</code><code class="p">);</code>&#13;
&#13;
<code class="k">for</code> <code class="p">(</code><code class="nv">$i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$i</code> <code class="o">&lt;</code> <code class="nv">$totalUnits</code><code class="p">;</code> <code class="nv">$i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nb">sleep</code><code class="p">(</code><code class="mi">1</code><code class="p">);</code>&#13;
&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">output</code><code class="o">-&gt;</code><code class="na">progressAdvance</code><code class="p">();</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nv">$this</code><code class="o">-&gt;</code><code class="na">output</code><code class="o">-&gt;</code><code class="na">progressFinish</code><code class="p">();</code></pre></div>&#13;
&#13;
<p>What did we do here? First, we informed the system how many “units” we needed <span class="keep-together">to work</span> through. Maybe a unit is a user, and you have 350 users. The bar will then divide the entire width it has available on your screen by 350, and increment it <span class="keep-together">by 1/350th</span> every time you run <code>progressAdvance()</code>. Once you’re done, run <code class="keep-together">progressFinish()</code> so that it knows it’s done displaying the progress bar.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Writing Closure-Based Commands" data-type="sect2"><div class="sect2" id="id182">&#13;
<h2>Writing Closure-Based Commands</h2>&#13;
&#13;
<p>If<a data-primary="Artisan" data-secondary="custom commands" data-tertiary="closure-based commands" data-type="indexterm" id="id1291"/> you’d prefer to keep your command definition process simpler, you can write commands as closures instead of classes by defining them in <em>routes/console.php</em>. Everything we discuss in this chapter will apply the same way, but you will define and register the commands in a single step in that file, as<a data-primary="" data-startref="ARcustom08" data-type="indexterm" id="id1292"/><a data-primary="--sendEmail flag" data-type="indexterm" id="emailflag08"/> shown in <a data-type="xref" href="#EX8c">Example 8-12</a>.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="EX8c">&#13;
<h5><span class="label">Example 8-12. </span>Defining an Artisan command using a closure</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="c1">// routes/console.php</code>&#13;
<code class="nx">Artisan</code><code class="o">::</code><code class="na">command</code><code class="p">(</code>&#13;
    <code class="s1">'password:reset {userId} {--sendEmail}'</code><code class="p">,</code>&#13;
    <code class="k">function</code> <code class="p">(</code><code class="nv">$userId</code><code class="p">,</code> <code class="nv">$sendEmail</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nv">$userId</code> <code class="o">=</code> <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">argument</code><code class="p">(</code><code class="s1">'userId'</code><code class="p">);</code>&#13;
        <code class="c1">// Do something...</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">);</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Calling Artisan Commands in Normal Code" data-type="sect1"><div class="sect1" id="id183">&#13;
<h1>Calling Artisan Commands in Normal Code</h1>&#13;
&#13;
<p>While<a data-primary="Artisan" data-secondary="commands" data-tertiary="calling from code" data-type="indexterm" id="id1293"/> Artisan commands are designed to be run from the command line, you can also call them from other code.</p>&#13;
&#13;
<p>The easiest way is to use the <code>Artisan</code> facade. You can either call a command using <code>Artisan::call()</code> (which will return the command’s exit code) or queue a command using <code>Artisan::queue()</code>.</p>&#13;
&#13;
<p>Both take two parameters: first, the terminal command (<code>password:reset</code>); and second, an array of parameters to pass it. Take a look at <a data-type="xref" href="#EX711">Example 8-13</a> to see how it works with arguments and options.</p>&#13;
<div data-type="example" id="EX711">&#13;
<h5><span class="label">Example 8-13. </span>Calling Artisan commands from other code</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'test-artisan'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nv">$exitCode</code> <code class="o">=</code> <code class="nx">Artisan</code><code class="o">::</code><code class="na">call</code><code class="p">(</code><code class="s1">'password:reset'</code><code class="p">,</code> <code class="p">[</code>&#13;
        <code class="s1">'userId'</code> <code class="o">=&gt;</code> <code class="mi">15</code><code class="p">,</code>&#13;
        <code class="s1">'--sendEmail'</code> <code class="o">=&gt;</code> <code class="k">true</code><code class="p">,</code>&#13;
    <code class="p">]);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>As<a data-primary="" data-startref="emailflag08" data-type="indexterm" id="id1294"/> you can see, arguments are passed by keying to the argument name, and options with no value can be passed <code>true</code> or <code>false</code>.</p>&#13;
<div data-type="tip"><h1>Calling Artisan Commands Using String Syntax</h1>&#13;
<p>You can also call Artisan commands much more naturally from your code by passing the same string you’d call from the command line into <code>Artisan::call()</code>:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Artisan</code><code class="o">::</code><code class="na">call</code><code class="p">(</code><code class="s1">'password:reset 15 --sendEmail'</code><code class="p">)</code></pre>&#13;
</div>&#13;
&#13;
<p>You can also call Artisan commands from other commands using <code>$this-&gt;call()</code>, (which is the same as <code>Artisan::call())</code> or <code>$this-&gt;callSilent()</code>, which is the same but suppresses all output. See <a data-type="xref" href="#EX712">Example 8-14</a> for an example.</p>&#13;
<div data-type="example" id="EX712">&#13;
<h5><span class="label">Example 8-14. </span>Calling Artisan commands from other Artisan commands</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">public</code> <code class="k">function</code> <code class="nf">handle</code><code class="p">()</code><code class="o">:</code> <code class="nx">void</code>&#13;
<code class="p">{</code>&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">callSilent</code><code class="p">(</code><code class="s1">'password:reset'</code><code class="p">,</code> <code class="p">[</code>&#13;
        <code class="s1">'userId'</code> <code class="o">=&gt;</code> <code class="mi">15</code><code class="p">,</code>&#13;
    <code class="p">]);</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>Finally, you can inject an instance of the <code>Illuminate\Contracts\Console\Kernel</code> contract and use its <code>call()</code> method.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Tinker" data-type="sect1"><div class="sect1" id="id184">&#13;
<h1>Tinker</h1>&#13;
&#13;
<p>Tinker<a data-primary="Tinker" data-type="indexterm" id="id1295"/><a data-primary="Artisan" data-secondary="REPL loop for" data-type="indexterm" id="id1296"/> is an REPL, or read–evaluate–print loop. REPLs give you a prompt, similar to the command-line prompt, that mimics a “waiting” state of your application. You type your commands into the REPL, hit Return, and then expect what you typed to be evaluated and the response printed out.</p>&#13;
&#13;
<p><a data-type="xref" href="#EX713">Example 8-15</a> provides a quick sample to give you a sense of how it works and how it might be useful. We start the REPL with <code>php artisan tinker</code> and are then presented with a blank prompt (<code>&gt;&gt;&gt;</code>); every response to our commands is printed on a line prefaced with <code>=&gt;</code>.</p>&#13;
<div data-type="example" id="EX713">&#13;
<h5><span class="label">Example 8-15. </span>Using Tinker</h5>&#13;
<pre data-type="programlisting">&#13;
$ <strong>php artisan tinker</strong>&#13;
&#13;
&gt;&gt;&gt; <strong>$user = new App\User;</strong>&#13;
=&gt; App\User: {}&#13;
&gt;&gt;&gt; <strong>$user-&gt;email = 'matt@mattstauffer.com';</strong>&#13;
=&gt; "matt@mattstauffer.com"&#13;
&gt;&gt;&gt; <strong>$user-&gt;password = bcrypt('superSecret');</strong>&#13;
=&gt; "$2y$10$TWPGBC7e8d1bvJ1q5kv.VDUGfYDnE9gANl4mleuB3htIY2dxcQfQ5"&#13;
&gt;&gt;&gt; <strong>$user-&gt;save();</strong>&#13;
=&gt; true&#13;
&#13;
</pre>&#13;
</div>&#13;
&#13;
<p>As you can see, we created a new user, set some data (hashing the password with <code>bcrypt()</code> for security), and saved it to the database. And this is real. If this were a production application, we would’ve just created a brand new user in our system.</p>&#13;
&#13;
<p>This makes Tinker a great tool for simple database interactions, for trying out new ideas, and for running snippets of code when it’d be a pain to find a place to put them in the application source files.</p>&#13;
&#13;
<p>Tinker is powered by <a href="http://psysh.org">Psy Shell</a>, so check that out to see what else you can do with Tinker.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Laravel Dump Server" data-type="sect1"><div class="sect1" id="dump_server">&#13;
<h1>Laravel Dump Server</h1>&#13;
&#13;
<p>One<a data-primary="Laravel dump server" data-type="indexterm" id="id1297"/><a data-primary="dump server" data-type="indexterm" id="id1298"/><a data-primary="Artisan" data-secondary="dump server for" data-type="indexterm" id="id1299"/> common method of debugging the state of your data during development is to use Laravel’s <code>dump()</code> helper, which runs a decorated <code>var_dump()</code> on anything you pass to it. This is fine, but it can often run into view issues.</p>&#13;
&#13;
<p>You can enable the Laravel dump server, which catches those <code>dump()</code> statements and displays them in your console instead of rendering them to the page.</p>&#13;
&#13;
<p>To run the dump server in your local console, navigate to your project’s root directory and run <code>php artisan dump-server</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>php artisan dump-server</strong>&#13;
&#13;
Laravel Var Dump Server&#13;
=======================&#13;
&#13;
 [OK] Server listening on tcp://127.0.0.1:9912&#13;
&#13;
 // Quit the server with CONTROL-C.</pre>&#13;
&#13;
<p>Now, try using the <code>dump()</code> helper function in your code somewhere. To test it out, try this code in your <em>routes/web.php</em> file:</p>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="nx">Route</code><code class="o">::</code><code class="na">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="k">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">dump</code><code class="p">(</code><code class="s1">'Dumped Value'</code><code class="p">);</code>&#13;
&#13;
    <code class="k">return</code> <code class="s1">'Hello World'</code><code class="p">;</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Without the dump server, you’d see both the dump and your “Hello World.” But with the dump server running, you’ll only see “Hello World” in the browser. In your console, you’ll see that the dump server caught that <code>dump()</code>, and you can inspect it there:</p>&#13;
&#13;
<pre data-type="programlisting">GET http://myapp.test/&#13;
--------------------&#13;
&#13;
 ------------ ---------------------------------&#13;
  date         Tue, 18 Sep 2018 22:43:10 +0000&#13;
  controller   "Closure"&#13;
  source       web.php on line 20&#13;
  file         routes/web.php&#13;
 ------------ ---------------------------------&#13;
&#13;
"Dumped Value"</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Customizing Generator Stubs" data-type="sect1"><div class="sect1" id="id186">&#13;
<h1>Customizing Generator Stubs</h1>&#13;
&#13;
<p>Any<a data-primary="Artisan" data-secondary="customizing generator stubs" data-type="indexterm" id="id1300"/><a data-primary="generator stubs, customizing" data-type="indexterm" id="id1301"/><a data-primary="stubs" data-secondary="customizing generator stubs" data-type="indexterm" id="id1302"/><a data-primary="files" data-secondary="customizing generator stubs" data-type="indexterm" id="id1303"/> Artisan commands that generate files (e.g. <code>make:model</code> and <code>make:controller</code>) use “stub” files that the command then copies and modifies to create the newly generated files. You can customize these stubs in your applications.</p>&#13;
&#13;
<p>To customize the stubs in your applications, run <code>php artisan stub:publish</code>, which will export the stub files into a <code>stub/</code> directory where you can customize them.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Testing" data-type="sect1"><div class="sect1" id="id433">&#13;
<h1>Testing</h1>&#13;
&#13;
<p>Since<a data-primary="Artisan" data-secondary="testing" data-type="indexterm" id="id1304"/><a data-primary="testing" data-secondary="Artisan commands" data-type="indexterm" id="id1305"/> you know how to call Artisan commands from code, it’s easy to do that in a test and ensure that whatever behavior you expected to be performed has been performed correctly, as in <a data-type="xref" href="#EX714">Example 8-16</a>. In our tests, we use <code>$this-&gt;artisan()</code> instead of <code>Artisan::call()</code> because it has the same syntax but adds a few testing-related assertions.</p>&#13;
<div data-type="example" id="EX714">&#13;
<h5 class="less_space"><span class="label">Example 8-16. </span>Calling Artisan commands from a test</h5>&#13;
<pre data-code-language="php" data-type="programlisting">&#13;
<code class="k">public</code> <code class="k">function</code> <code class="nf">test_empty_log_command_empties_logs_table</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="nx">DB</code><code class="o">::</code><code class="na">table</code><code class="p">(</code><code class="s1">'logs'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">insert</code><code class="p">([</code><code class="s1">'message'</code> <code class="o">=&gt;</code> <code class="s1">'Did something'</code><code class="p">]);</code>&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">assertCount</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="nx">DB</code><code class="o">::</code><code class="na">table</code><code class="p">(</code><code class="s1">'logs'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">get</code><code class="p">());</code>&#13;
&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">artisan</code><code class="p">(</code><code class="s1">'logs:empty'</code><code class="p">);</code> <code class="c1">// Same as Artisan::call('logs:empty');</code>&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">assertCount</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="nx">DB</code><code class="o">::</code><code class="na">table</code><code class="p">(</code><code class="s1">'logs'</code><code class="p">)</code><code class="o">-&gt;</code><code class="na">get</code><code class="p">());</code>&#13;
<code class="p">}</code>&#13;
</pre>&#13;
</div>&#13;
&#13;
<p>You can chain on a few new assertions to your <code>$this-&gt;artisan()</code> calls that make it even easier to test Artisan commands—​not just the impact they have on the rest of your app, but also how they actually operate. Take a look at <a data-type="xref" href="#EX716">Example 8-17</a> to see an example of this syntax.</p>&#13;
<div data-type="example" id="EX716">&#13;
<h5><span class="label">Example 8-17. </span>Making assertions against the input and output of Artisan commands</h5>&#13;
&#13;
<pre data-code-language="php" data-type="programlisting"><code class="k">public</code> <code class="k">function</code> <code class="nf">testItCreatesANewUser</code><code class="p">()</code>&#13;
<code class="p">{</code>&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">artisan</code><code class="p">(</code><code class="s1">'myapp:create-user'</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">expectsQuestion</code><code class="p">(</code><code class="s2">"What's the name of the new user?"</code><code class="p">,</code> <code class="s2">"Wilbur Powery"</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">expectsQuestion</code><code class="p">(</code><code class="s2">"What's the email of the new user?"</code><code class="p">,</code> <code class="s2">"wilbur@thisbook.co"</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">expectsQuestion</code><code class="p">(</code><code class="s2">"What's the password of the new user?"</code><code class="p">,</code> <code class="s2">"secret"</code><code class="p">)</code>&#13;
        <code class="o">-&gt;</code><code class="na">expectsOutput</code><code class="p">(</code><code class="s2">"User Wilbur Powery created!"</code><code class="p">);</code>&#13;
&#13;
    <code class="nv">$this</code><code class="o">-&gt;</code><code class="na">assertDatabaseHas</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="p">[</code>&#13;
        <code class="s1">'email'</code> <code class="o">=&gt;</code> <code class="s1">'wilbur@thisbook.co'</code>&#13;
    <code class="p">]);</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="TL;DR" data-type="sect1"><div class="sect1" id="id434">&#13;
<h1>TL;DR</h1>&#13;
&#13;
<p>Artisan commands<a data-primary="Artisan" data-secondary="overview of" data-type="indexterm" id="id1306"/> are Laravel’s command-line tools. Laravel comes with quite a few out of the box, but it’s also easy to create your own Artisan commands and call them from the command line or your own code.</p>&#13;
&#13;
<p>Tinker is an REPL that makes it simple to get into your application environment and interact with real code and real data, and the dump server lets you debug your code without stopping the code’s execution.</p>&#13;
</div></section>&#13;
</div></section></body></html>