<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Dates and Times"><div class="chapter" id="dates_and_times">
<h1><span class="label">Chapter 7. </span>Dates and Times</h1>
<p><a contenteditable="false" data-type="indexterm" data-primary="dates and times" id="ix_dates_times_ch7"/>The typical PHP developer likely needs to be aware of the available date and time functions, such as when adding a date stamp to a database record entry or calculating the difference between two dates. PHP provides a <code>DateTime</code> class that can handle both date and time information simultaneously, as well as a <code>DateTimeZone</code> class that works hand in hand with it.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="time zone management" id="ix_time_zone_ch7"/>Time zone management has become more prominent in recent years with the onset of web portals and social web communities like Facebook and Twitter. To be able to post information to a website and have it recognize where you are in the world in relation to others on the same site is definitely a requirement these days. However, keep in mind that a function like <a contenteditable="false" data-type="indexterm" data-primary="date function" id="idm45922770160008"/><code>date()</code> takes the default information from the server on which the script is running, so unless the human clients tell you where they are in the world, it can be quite difficult to determine time zone location automatically. Once you know the information, though, it’s easy to manipulate that data (more on time zones later in this chapter).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The original date (and related) functions contain a timing flaw on Windows and some Unix installations. They cannot process dates prior to December 13, 1901, or beyond January 19, 2038, due to the nature of the underlying 32-bit signed integer used to manage the date and time data. Therefore, it is recommended to use the newer <code>DateTime</code> class family for better accuracy going forward.</p>
</div>
<p>There are four interrelated classes for handling dates and times. The <code>DateTime</code> class handles dates themselves; the <code>DateTimeZone</code> class handles time zones; the <code>Date</code><span class="keep-together"><code>Interval</code></span> class handles spans of time between two <code>DateTime</code> instances; and finally, the <code>DatePeriod</code> class handles traversal over regular intervals of dates and times. There are two other rarely used supporting classes called <code>DateTimeImmutable</code> and <code>DateTimeInterface</code> that are part of the whole <code>DateTime</code> “family,” but we won’t cover those in this chapter.</p>
<p><a contenteditable="false" data-type="indexterm" data-primary="DateTimeZone class" id="ix_date_time_zone"/><a contenteditable="false" data-type="indexterm" data-primary="DateTime class" id="ix_datetime_class"/>The constructor of the <code>DateTime</code> class is naturally where it all starts. This method takes two parameters, the timestamp and the time zone. For example:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$dt</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DateTime</code><code class="p">(</code><code class="s2">"2019-06-27 16:42:33"</code><code class="p">,</code> <code class="k">new</code> <code class="nx">DateTimeZone</code><code class="p">(</code><code class="s2">"America/Halifax"</code><code class="p">));</code></pre>
<p>We create the <code>$dt</code> object, assign it a date and time string with the first parameter, and set the time zone with the second parameter. Here, we’re instantiating the <code>DateTimeZone</code> instance inline, but you could alternately instantiate the <code>DateTimeZone</code> object into its own variable and then use that in the constructor, like so:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$dtz</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DateTimeZone</code><code class="p">(</code><code class="s2">"America/Halifax"</code><code class="p">);</code>
<code class="nv">$dt</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DateTime</code><code class="p">(</code><code class="s2">"2019-06-27 16:42:33"</code><code class="p">,</code> <code class="nv">$dtz</code><code class="p">);</code></pre>
<p>Now obviously we are assigning hardcoded values to these classes, and this type of information may not always be available to your code or it may not be what you want. Alternatively, we can pick up the value of the time zone from the server and use that inside the <code>DateTimeZone</code> class. To pick up the current server value, use code similar to the following:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$tz</code> <code class="o">=</code> <code class="nb">ini_get</code><code class="p">(</code><code class="s1">'date.timezone'</code><code class="p">);</code>
<code class="nv">$dtz</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DateTimeZone</code><code class="p">(</code><code class="nv">$tz</code><code class="p">);</code>
<code class="nv">$dt</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DateTime</code><code class="p">(</code><code class="s2">"2019-06-27 16:42:33"</code><code class="p">,</code> <code class="nv">$dtz</code><code class="p">);</code></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="functions" data-secondary="dates and times" id="ix_functions_date_time"/>These code examples establish a set of values for two classes, <code>DateTime</code> and <code>DateTimeZone</code>. Eventually, you will be using that information in some way elsewhere in your script. One of the methods of the <code>DateTime</code> class is called <code>format()</code>, and it uses the same formatting output codes as the <a contenteditable="false" data-type="indexterm" data-primary="date_format function" id="idm45922770348952"/><code>date_format()</code> function does. Those date format codes are all listed in the <a data-type="xref" href="app01.xhtml#function_reference">Appendix</a>, in the section for the <code>date_format()</code> function. Here is a sample of the <a contenteditable="false" data-type="indexterm" data-primary="format method" id="idm45922770346056"/><code>format()</code> method being sent to the browser as output:</p>
<pre data-type="programlisting" data-code-language="php"><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">date: </code><code class="s2">"</code><code> </code><code class="o">.</code><code> </code><code class="nv">$dt</code><code class="o">-&gt;</code><code class="na">format</code><code class="p">(</code><code class="s2">"</code><code class="s2">Y-m-d h:i:s</code><code class="s2">"</code><code class="p">);</code><code>
</code><strong><code class="nb">date</code><code class="o">:</code><code> </code><code class="mi">2019</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">27</code><code> </code><code class="mo">04</code><code class="o">:</code><code class="mi">42</code><code class="o">:</code><code class="mi">33</code></strong></pre>
<p>So far we have provided the date and time to the constructor, but sometimes you will also want to pick up the date and time values from the server. To do that, simply provide the string <code>"now"</code> as the first parameter.</p>
<p>The following code does the same as the other examples, except here we are getting the date and time class values from the server. In fact, since we are getting the information from the server, the class properties are much more fully populated (note that some instances of PHP will not have this parameter set and thus will return an error, and the server’s time zone may not match your own):</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$tz</code><code> </code><code class="o">=</code><code> </code><code class="nb">ini_get</code><code class="p">(</code><code class="s1">'date.timezone'</code><code class="p">);</code><code>
</code><code class="nv">$dtz</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTimeZone</code><code class="p">(</code><code class="nv">$tz</code><code class="p">);</code><code>
</code><code class="nv">$dt</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTime</code><code class="p">(</code><code class="s2">"</code><code class="s2">now</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="nv">$dtz</code><code class="p">);</code><code>

</code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">date: </code><code class="s2">"</code><code> </code><code class="o">.</code><code> </code><code class="nv">$dt</code><code class="o">-&gt;</code><code class="na">format</code><code class="p">(</code><code class="s2">"</code><code class="s2">Y-m-d h:i:s</code><code class="s2">"</code><code class="p">);</code><code>
</code><strong><code class="nb">date</code><code class="o">:</code><code> </code><code class="mi">2019</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">27</code><code> </code><code class="mo">04</code><code class="o">:</code><code class="mo">02</code><code class="o">:</code><code class="mi">54</code></strong></pre>
<p>The <a contenteditable="false" data-type="indexterm" data-primary="diff method" id="idm45922770054248"/><code>diff()</code> method of <code>DateTime</code> does what you might expect—it returns the difference between two dates. The return value of the method is an instance of the <code>Date</code><span class="keep-together"><code>Interval</code></span> class.</p>
<p>To get the difference between two <code>DateTime</code> instances, use:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$tz</code><code> </code><code class="o">=</code><code> </code><code class="nb">ini_get</code><code class="p">(</code><code class="s1">'date.timezone'</code><code class="p">);</code><code>
</code><code class="nv">$dtz</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTimeZone</code><code class="p">(</code><code class="nv">$tz</code><code class="p">);</code><code>

</code><code class="nv">$past</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTime</code><code class="p">(</code><code class="s2">"</code><code class="s2">2019-02-12 16:42:33</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="nv">$dtz</code><code class="p">);</code><code>
</code><code class="nv">$current</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTime</code><code class="p">(</code><code class="s2">"</code><code class="s2">now</code><code class="s2">"</code><code class="p">,</code><code> </code><code class="nv">$dtz</code><code class="p">);</code><code>

</code><code class="c1">// creates a new instance of DateInterval
</code><code class="nv">$diff</code><code> </code><code class="o">=</code><code> </code><code class="nv">$past</code><code class="o">-&gt;</code><code class="na">diff</code><code class="p">(</code><code class="nv">$current</code><code class="p">);</code><code>

</code><code class="nv">$pastString</code><code> </code><code class="o">=</code><code> </code><code class="nv">$past</code><code class="o">-&gt;</code><code class="na">format</code><code class="p">(</code><code class="s2">"</code><code class="s2">Y-m-d</code><code class="s2">"</code><code class="p">);</code><code>
</code><code class="nv">$currentString</code><code> </code><code class="o">=</code><code> </code><code class="nv">$current</code><code class="o">-&gt;</code><code class="na">format</code><code class="p">(</code><code class="s2">"</code><code class="s2">Y-m-d</code><code class="s2">"</code><code class="p">);</code><code>
</code><code class="nv">$diffString</code><code> </code><code class="o">=</code><code> </code><code class="nv">$diff</code><code class="o">-&gt;</code><code class="na">format</code><code class="p">(</code><code class="s2">"</code><code class="s2">%yy %mm, %dd</code><code class="s2">"</code><code class="p">);</code><code>

</code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Difference between </code><code class="si">{</code><code class="nv">$pastString</code><code class="si">}</code><code class="s2"> and </code><code class="si">{</code><code class="nv">$currentString</code><code class="si">}</code><code class="s2"> is </code><code class="si">{</code><code class="nv">$diffString</code><code class="si">}</code><code class="s2">"</code><code class="p">;</code><code>
</code><strong><code class="nx">Difference</code><code> </code><code class="nx">between</code><code> </code><code class="mi">2019</code><code class="o">-</code><code class="mo">02</code><code class="o">-</code><code class="mi">12</code><code> </code><code class="k">and</code><code> </code><code class="mi">2019</code><code class="o">-</code><code class="mo">06</code><code class="o">-</code><code class="mi">27</code><code> </code><code class="nx">is</code><code> </code><code class="mi">0</code><code class="nx">y</code><code> </code><code class="mi">4</code><code class="nx">m</code><code class="p">,</code><code> </code><code class="mi">14</code><code class="nx">d</code></strong></pre>
<p>The <code>diff()</code> method is called on one of the <code>DateTime</code> objects with the other <code>DateTime</code> object passed in as a parameter. Then we prepare the browser output with the <a contenteditable="false" data-type="indexterm" data-primary="format method" id="idm45922769797784"/><span class="keep-together"><code>format()</code></span> method calls.</p>
<p>Notice that the <a contenteditable="false" data-type="indexterm" data-primary="DateInterval class" id="idm45922769784152"/><code>DateInterval</code> class has a <code>format()</code> method as well. Since it deals with the difference between two dates, the format character codes are slightly different from that of the <code>DateTime</code> class. Precede each character code with a percent sign, <code>%</code>. The available character codes are provided in <a data-type="xref" href="#dateinterval_formatting_control_charact">Table 7-1</a>.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_datetime_class" id="idm45922769789880"/></p>
<table class="border" id="dateinterval_formatting_control_charact">
<caption><span class="label">Table 7-1. </span>DateInterval formatting control characters</caption>
<thead>
<tr>
<th>Character</th>
<th>Formatting Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>a</code></td>
<td>Number of days (e.g., 23)</td>
</tr>
<tr>
<td><code>d</code></td>
<td>Number of days not already included in the number of months</td>
</tr>
<tr>
<td><code>D</code></td>
<td>Number of days, including a leading zero if under 10 days (e.g., 02 and 125)</td>
</tr>
<tr>
<td><code>f</code></td>
<td>Numeric microseconds (e.g., 6602 or 41569)</td>
</tr>
<tr>
<td><code>F</code></td>
<td>Numeric microseconds with leading zero, at least six digits in length (e.g., 006602 or 041569)</td>
</tr>
<tr>
<td><code>h</code></td>
<td>Number of hours</td>
</tr>
<tr>
<td><code>H</code></td>
<td>Number of hours, including a leading zero if under 10 hours (e.g., 12 and 04)</td>
</tr>
<tr>
<td><code>i</code></td>
<td>Number of minutes</td>
</tr>
<tr>
<td><code>I</code></td>
<td>Number of minutes, including a leading zero if under 10 minutes (e.g., 05 and 33)</td>
</tr>
<tr>
<td><code>m</code></td>
<td>Number of months</td>
</tr>
<tr>
<td><code>M</code></td>
<td>Number of months, including a leading zero if under 10 months (e.g., 05 and 1533)</td>
</tr>
<tr>
<td><code>r</code></td>
<td><code>–</code> if the difference is negative; empty if the difference is positive</td>
</tr>
<tr>
<td><code>R</code></td>
<td><code>–</code> if the difference is negative; <code>+</code> if the difference is positive</td>
</tr>
<tr>
<td><code>s</code></td>
<td>Number of seconds</td>
</tr>
<tr>
<td><code>S</code></td>
<td>Number of seconds, including a leading zero if under 10 seconds (e.g., 05 and 15)</td>
</tr>
<tr>
<td><code>y</code></td>
<td>Number of years</td>
</tr>
<tr>
<td><code>Y</code></td>
<td>Number of years, including a leading zero if under 10 years (e.g., 00 and 12)</td>
</tr>
<tr>
<td><code>%</code></td>
<td>A literal <code>%</code></td>
</tr>
</tbody>
</table>
<p>Let’s look a little more closely at the <code>DateTimeZone</code> class now. The time zone setting can be lifted out of the <em>php.ini</em> file with <a contenteditable="false" data-type="indexterm" data-primary="get_ini function" id="idm45922769833320"/><code>get_ini()</code>. You can get more information from the time zone object using the <a contenteditable="false" data-type="indexterm" data-primary="getLocation method" id="idm45922769831880"/><code>getLocation()</code> method. It provides the country of origin of the time zone, the longitude and the latitude, plus some comments. With these few lines of code, you can have the beginnings of a web-based GPS system:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$tz</code><code> </code><code class="o">=</code><code> </code><code class="nb">ini_get</code><code class="p">(</code><code class="s1">'date.timezone'</code><code class="p">);</code><code>
</code><code class="nv">$dtz</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTimeZone</code><code class="p">(</code><code class="nv">$tz</code><code class="p">);</code><code>

</code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Server's Time Zone: </code><code class="si">{</code><code class="nv">$tz</code><code class="si">}</code><code class="s2">&lt;br/&gt;</code><code class="s2">"</code><code class="p">;</code><code>

</code><code class="k">foreach</code><code> </code><code class="p">(</code><code class="nv">$dtz</code><code class="o">-&gt;</code><code class="na">getLocation</code><code class="p">()</code><code> </code><code class="k">as</code><code> </code><code class="nv">$key</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nv">$value</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="si">{</code><code class="nv">$key</code><code class="si">}</code><code class="s2"> </code><code class="si">{</code><code class="nv">$value</code><code class="si">}</code><code class="s2">&lt;br/&gt;</code><code class="s2">"</code><code class="p">;</code><code>
</code><code class="p">}</code><code>
</code><strong><code class="nx">Server</code><code class="err">'</code><code class="nx">s</code><code> </code><code class="nx">Time</code><code> </code><code class="nx">Zone</code><code class="o">:</code><code> </code><code class="nx">America</code><code class="o">/</code><code class="nx">Halifax</code><code>
</code><code class="nx">country_code</code><code> </code><code class="nx">CA</code><code>
</code><code class="nx">latitude</code><code> </code><code class="mf">44.65</code><code>
</code><code class="nx">longitude</code><code> </code><code class="o">-</code><code class="mf">63.6</code><code>
</code><code class="nx">comments</code><code> </code><code class="nx">Atlantic</code><code> </code><code class="o">-</code><code> </code><code class="nx">NS</code><code> </code><code class="p">(</code><code class="nx">most</code><code> </code><code class="nx">areas</code><code class="p">);</code><code> </code><code class="nx">PE</code></strong></pre>
<p>If you want to set a time zone other than the server’s, you must pass that value to the constructor of the <code>DateTimeZone</code> object. This example sets the time zone for Rome, Italy, and displays the information with the <code>getLocation()</code> method:</p>
<pre data-type="programlisting" data-code-language="php"><code class="nv">$dtz</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="nx">DateTimeZone</code><code class="p">(</code><code class="s2">"</code><code class="s2">Europe/Rome</code><code class="s2">"</code><code class="p">);</code><code>

</code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="s2">Time Zone: </code><code class="s2">"</code><code> </code><code class="o">.</code><code> </code><code class="nv">$dtz</code><code class="o">-&gt;</code><code class="na">getName</code><code class="p">()</code><code> </code><code class="o">.</code><code> </code><code class="s2">"</code><code class="s2">&lt;br/&gt;</code><code class="s2">"</code><code class="p">;</code><code>

</code><code class="k">foreach</code><code> </code><code class="p">(</code><code class="nv">$dtz</code><code class="o">-&gt;</code><code class="na">getLocation</code><code class="p">()</code><code> </code><code class="k">as</code><code> </code><code class="nv">$key</code><code> </code><code class="o">=&gt;</code><code> </code><code class="nv">$value</code><code class="p">)</code><code> </code><code class="p">{</code><code>
 </code><code class="k">echo</code><code> </code><code class="s2">"</code><code class="si">{</code><code class="nv">$key</code><code class="si">}</code><code class="s2"> </code><code class="si">{</code><code class="nv">$value</code><code class="si">}</code><code class="s2">&lt;br/&gt;</code><code class="s2">"</code><code class="p">;</code><code>
</code><code class="p">}</code><code>

</code><strong><code class="nx">Time</code><code> </code><code class="nx">Zone</code><code class="o">:</code><code> </code><code class="nx">Europe</code><code class="o">/</code><code class="nx">Rome</code><code>
</code><code class="nx">country_code</code><code> </code><code class="nx">IT</code><code>
</code><code class="nx">latitude</code><code> </code><code class="mf">41.9</code><code>
</code><code class="nx">longitude</code><code> </code><code class="mf">12.48333</code><code>
</code><code class="nx">comments</code></strong></pre>
<p><a contenteditable="false" data-type="indexterm" data-primary="website resources" data-secondary="time zone names" id="idm45922769608968"/>A list of valid time zone names by global regions can be found in the <a href="https://oreil.ly/EDpf6">PHP online manual</a>.</p>
<p>Using this same technique, you can make a website “local” to a visitor by providing a list of supported time zones for the visitor to choose from and then temporarily adjusting your <em>php.ini</em> setting with the <a contenteditable="false" data-type="indexterm" data-primary="ini_set function" id="idm45922769537224"/><code>ini_set()</code> function for the duration of the visit.</p>
<p>While there’s a fair amount of date and time processing power provided by the classes that we discussed in this chapter, it’s only the proverbial tip of the iceberg. Be sure to read more about these classes and what they can do on the PHP website.<a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_dates_times_ch7" id="idm45922769535208"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_date_time_zone" id="idm45922769533864"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_time_zone_ch7" id="idm45922769532488"/><a contenteditable="false" data-type="indexterm" data-primary="" data-startref="ix_functions_date_time" id="idm45922769531112"/></p>
<section data-type="sect1" data-pdf-bookmark="What’s Next"><div class="sect1" id="whatapostrophes_next-id00065">
<h1>What’s Next</h1>
<p>There’s so much more than date management to understand when you’re designing websites within PHP, and as a result there are many issues that can cause you stress and increase the PITA (pain in the ass) factor. The next chapter provides multiple tips and tricks, as well as some “gotchas” to watch out for, to help reduce these pain points. Techniques for working with variables, managing form data, and using SSL (Secure Sockets Layer) web data security are among the topics covered. Buckle up!</p>
</div></section>
</div></section></div>



  </body></html>